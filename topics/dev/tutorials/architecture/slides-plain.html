<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Galaxy Code Architecture</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="Galaxy is an open-source project. Everyone can contribute..." />
        <meta property="og:title" content="Galaxy Training: Galaxy Code Architecture" />
        <meta property="og:description" content="Galaxy is an open-source project. Everyone can contribute..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/hall-of-fame" title="Hall of Fame">
                           <i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span> Contributors
                        </a>
                        
                    </li>
                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/dev/faqs/" title="Check our FAQs for the Development in Galaxy topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/dev/tutorials/architecture/slides-plain.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/dev/tutorials/architecture/slides-plain.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Translate this page
            </div>

            <div id="lang-selector">
                
                <strong>Automatic Translations</strong>

<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url">
                Fran√ßais
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url">
                Êó•Êú¨Ë™û
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url">
                Espa√±ol
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url">
                Portugu√™s
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url">
                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                </a>
                
                <a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/dev/tutorials/architecture/slides-plain.html&edit-text=&act=url" title="">
                And more!
                </a>
            </div>
        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-10-01/topics/dev/tutorials/architecture/slides-plain.html" title="Version 2021-10-01">2021-10-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-09-01/topics/dev/tutorials/architecture/slides-plain.html" title="Version 2021-09-01">2021-09-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-08-01/topics/dev/tutorials/architecture/slides-plain.html" title="Version 2021-08-01">2021-08-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        <section class="tutorial">
	<a href="https://github.com/galaxyproject/training-material/blob/main//topics/dev/tutorials/architecture/slides.html">View markdown source on GitHub</a>
	<h1>Galaxy Code Architecture</h1>
		<h2>Contributors</h2>
		<a href="/training-material/hall-of-fame/jmchilton/" class="contributor-badge contributor-jmchilton"><img src="https://avatars.githubusercontent.com/jmchilton?s=27" alt="Avatar">John Chilton</a> <a href="/training-material/hall-of-fame/bgruening/" class="contributor-badge contributor-bgruening"><img src="https://avatars.githubusercontent.com/bgruening?s=27" alt="Avatar">Bj√∂rn Gr√ºning</a>

		
		<h2>Questions</h2>
		<ul>
		
		<li><p>How is the Galaxy code structured?</p>
</li>
		
		<li><p>What do the various other projects related to Galaxy do?</p>
</li>
		
		<li><p>What happens when I start Galaxy?</p>
</li>
		
		</ul>
		

		
		<h2>Objectives</h2>
		<ul>
		
		<li><p>Explore various aspects of the Galaxy codebase.</p>
</li>
		
		<li><p>Understand the various top-level files and modules in Galaxy.</p>
</li>
		
		<li><p>Understand how dependencies work in Galaxy‚Äôs frontend and backend.</p>
</li>
		
		</ul>
		

		

		<div><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Sep 24, 2021 </div>

	<hr />


	<p>layout: true
<span id="left-aligned"><i class="fas fa-link" aria-hidden="true"></i> left-aligned</span>
class: left, middle</p>

<hr />

<p>layout: true
class: center, middle</p>

<hr />

<p>layout: introduction_slides
topic_name: Galaxy Architecture</p>

<h1 id="galaxy-architecture">Galaxy Architecture</h1>

<hr />

<h3 id="please-interrupt">Please Interrupt!</h3>

<p>We‚Äôre here to answer your questions about Galaxy architecture!</p>

<hr />

<p>class: enlarge200</p>

<p><strong>Gitter:</strong> <a href="https://gitter.im/galaxyproject/Lobby">galaxyproject/Lobby </a></p>

<p><strong>GitHub:</strong> <a href="https://github.com/galaxyproject">github.com/galaxyproject </a></p>

<p><strong>Twitter:</strong> #usegalaxy, @galaxyproject</p>

<hr />

<h2 id="the-galaxyproject-projects">The <strong>/galaxyproject</strong> projects</h2>

<p><em>The architecture of the ecosystem.</em></p>

<p><span>Speaker Notes</span></p>

<p>Too many to cover all but we‚Äôll cover some of the big ones in a few big
categories. User-facing applications, projects for Galaxy plugin developers,
and projects for Galaxy administrators.</p>

<hr />

<h1 id="lots-of-gitter-actually">Lots of Gitter actually</h1>

<p><img src="../../images/gitter_galaxyproject.png" alt="galaxyproject gitter landing" /></p>

<p>https://gitter.im/galaxyproject</p>

<hr />

<p>More links we‚Äôll mention as we go through the slides:</p>

<ul>
  <li>https://gitter.im/galaxyproject/Lobby</li>
  <li>https://gitter.im/galaxyproject/dev</li>
  <li>https://gitter.im/galaxyproject/admins</li>
  <li>https://gitter.im/galaxyproject/FederatedGalaxy</li>
  <li>https://gitter.im/galaxyproject/bioblend</li>
  <li>https://gitter.im/galaxyproject/ephemeris</li>
  <li>https://gitter.im/usegalaxy-eu/Lobby</li>
  <li>https://gitter.im/galaxy-iuc/iuc</li>
  <li>https://gitter.im/bgruening/docker-galaxy-stable</li>
  <li>https://gitter.im/Galaxy-Training-Network/Lobby</li>
  <li>https://gitter.im/biocontainers/Lobby</li>
  <li>https://gitter.im/bioconda/Lobby</li>
</ul>

<p>Working group chats linked at https://galaxyproject.org/community/wg/.</p>

<hr />

<p>class: enlarge200</p>

<p><strong>User-Facing Applications</strong></p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/galaxy">galaxyproject/<strong>galaxy</strong> </a></p>

<p>The main Galaxy application.</p>

<p>Web interface, database model, job running, etc‚Ä¶</p>

<p>Also includes other web applications including the <strong>ToolShed</strong>.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/cloudlaunch">galaxyproject/<strong>cloudlaunch</strong> </a></p>

<p>CloudLaunch web application to make it easy to launch images on a cloud, drives <em>https://launch.usegalaxy.org</em></p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/training-material">galaxyproject/<strong>training-material</strong> </a></p>

<p><img src="/training-material/assets/images/GTNLogo1000.png" alt="logo" /></p>

<p>Galaxy training material for scientists, developers, and admins. Powers <em>https://training.galaxyproject.org/</em>.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/galaxy-hub">galaxyproject/<strong>hub</strong> </a></p>

<p>The Galaxy Hub is the community and documentation hub for the Galaxy Project. It is maintained by the community through this GitHub repository. It is a static website built using the metalsmith static site generator.</p>

<p>Powers <em>https://galaxyproject.org/</em>.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/bioblend">galaxyproject/<strong>bioblend</strong> </a></p>

<p>Official Python client for the Galaxy, ToolShed, and CloudMan APIs.</p>

<p>Best documented path to scripting the Galaxy API.</p>

<hr />

<p>class: enlarge150</p>

<ul>
  <li><a href="https://github.com/galaxyproject/blend4php">galaxyproject/<strong>blend4php</strong></a></li>
  <li><a href="https://github.com/galaxyproject/blend4j">galaxyproject/<strong>blend4j</strong></a></li>
  <li><a href="https://github.com/chapmanb/clj-blend"><strong>chapmanb/clj-blend</strong></a></li>
</ul>

<p>Galaxy API bindings for other languages, less actively maintained.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/cloudman">galaxyproject/<strong>cloudman</strong></a></p>

<p>Galaxy CloudMan - a web application which manages a Galaxy Kubernetes cluster in
the cloud.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/bgruening/docker-galaxy-stable"><strong>bgruening/docker-galaxy-stable</strong> </a></p>

<p>High quality Docker containers for stable Galaxy environments.</p>

<p>Releases corresponding to each new version of Galaxy.</p>

<p>Many flavors available.</p>

<hr />

<p>class: white
<img src="../../images/docker-chart.png" alt="Docker" /></p>

<hr />

<p>class: enlarge200</p>

<p><strong>For Plugin Developers</strong></p>

<hr />

<p><a href="https://github.com/galaxyproject/tools-iuc">galaxyproject/<strong>tools-iuc</strong> </a></p>

<p>Galaxy tools maintained by the <em>IUC</em> (‚ÄúIntergalactic Utilities Commission‚Äù).</p>

<p>A variety of tools, generally of high quality including many of the core tools for Galaxy main.</p>

<p>Demonstrates <em>current tool development best practices</em> - development on
github and then deployed to test/main ToolSheds</p>

<p><a href="https://github.com/galaxyproject/tools-devteam">galaxyproject/<strong>tools-devteam</strong> </a></p>

<p>Many older tools appearing on usegalaxy.org.</p>

<hr />

<h3 id="tools-aside---more-repositories">Tools Aside - More Repositories</h3>

<p>Other repositories with high quality tools:</p>

<ul>
  <li><a href="https://github.com/bgruening/galaxytools">Bj√∂rn Gr√ºning‚Äôs repo</a></li>
  <li>Peter Cock‚Äôs repos:
    <ul>
      <li><a href="https://github.com/peterjc/galaxy_blast">blast repo</a></li>
      <li><a href="https://github.com/peterjc/pico_galaxy">pico repo</a></li>
      <li><a href="https://github.com/peterjc/galaxy_mira">mira repo</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/modENCODE-DCC/Galaxy">ENCODE tools</a></li>
  <li><a href="https://github.com/biopython/galaxy_packages">Biopython repo</a></li>
  <li><a href="https://github.com/galaxyproteomics/tools-galaxyp">Galaxy Proteomics repo</a></li>
  <li><a href="https://github.com/gregvonkuster/galaxy-csg">Greg von Kuster‚Äôs repo</a></li>
  <li><a href="https://github.com/TGAC/tgac-galaxytools">TGAC repo</a></li>
  <li><a href="https://github.com/AAFC-MBB/Galaxy/tree/master/wrappers">AAFC-MBB Canada repo</a></li>
  <li><a href="https://gitlab.com/einonm/galaxy-tools">Mark Einon‚Äôs repo</a></li>
</ul>

<hr />

<p><a href="https://github.com/galaxyproject/iwc">galaxyproject/<strong>iwc</strong> </a></p>

<p>Intergalactic Workflow Commission. Hosting workflows and defining best practices for publishing workflows.</p>

<p>https://gitter.im/galaxyproject/iwc</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/planemo">galaxyproject/<strong>planemo</strong> </a></p>

<p>Command-line utilities to assist in the development of Galaxy tools and workflows.
Linting, testing, deploying to ToolSheds‚Ä¶</p>

<p><em>The best practice approach for Galaxy tool development!</em></p>

<p><a href="https://github.com/galaxyproject/planemo-machine">galaxyproject/<strong>planemo-machine</strong> </a></p>

<p>Builds Galaxy environments for Galaxy tool development including Docker
container, virtual machines, Google compute images</p>

<hr />

<p><a href="https://github.com/galaxyproject/galaxy-language-server">galaxyproject/<strong>galaxy-language-server</strong> </a></p>

<p><img src="https://github.com/galaxyproject/galaxy-language-server/raw/assets/snippets.gif" alt="Galaxy Language Server" /></p>

<p>Language server implementation for Galaxy tools. Visual Studio Code extension for tool development.</p>

<p>Test execution, code completion, best practices, documentation tooltips, etc..</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/starforge">galaxyproject/<strong>starforge</strong> </a></p>

<p><img src="https://raw.githubusercontent.com/galaxyproject/starforge/master/docs/starforge_logo.png" alt="StarForge logo" /></p>

<p>Build Galaxy framework dependencies as Python wheels when needed.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/cargo-port">galaxyproject/<strong>cargo-port</strong> </a></p>

<p><img src="https://raw.githubusercontent.com/galaxyproject/cargo-port/master/media/cpc-plain-small.png" alt="Cargo Port Logo" /></p>

<p>Provides stable URLs and caching for application links, etc.. An important layer for reproducibility but largely transparent.</p>

<hr />

<p>class: enlarge200</p>

<p><strong>For Deployers and Admins</strong></p>

<hr />

<p>class: enlarge150</p>

<p>galaxyproject/<strong>{ansible-*, *-playbook}</strong><br />
usegalaxy-eu/<strong>{ansible-*, *-playbook}</strong></p>

<p><a href="https://www.ansible.com/">Ansible</a> components to automate almost every aspect of Galaxy installation and maintenance.</p>

<p>Ansible is an advanced configuration management system</p>

<p>These playbooks are used to maintain Galaxy main, cloud and Docker images, virtual machines, ‚Ä¶</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/galaxy-helm">galaxyproject/<strong>galaxy-helm</strong> </a></p>

<p>Kubernetes helm chart for deploying Galaxy. Leveraged by cloudlaunch and CloudMan but usable standalone.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/pulsar">galaxyproject/<strong>pulsar</strong> </a></p>

<p><img src="https://galaxyproject.org/images/galaxy-logos/pulsar_transparent.png" alt="Pulsar Logo" /></p>

<p>Distributed job execution engine for Galaxy.</p>

<p>Stages data, scripts, configuration.</p>

<p>Can run jobs on Windows machines.</p>

<p>Can act as its own queuing system or access an existing cluster DRM.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/ephemeris">galaxyproject/<strong>ephemeris</strong> </a></p>

<p>Library and CLI for managing Galaxy plugins - tools, index data, and workflows.</p>

<p>Layer on top of BioBlend building useful utilities for working with the Galaxy API from an administrator perspective.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/galaxyproject/gxadmin">galaxyproject/<strong>gxadmin</strong> </a></p>

<p>Handy command-line utility for Galaxy administrators.</p>

<hr />

<p>class: enlarge150</p>

<h3 id="ephemeris-vs-gxadmin">ephemeris vs gxadmin</h3>

<p>Ephemeris generally talks to the Galaxy API and is a pure Python project, gxadmin talks directly to the Galaxy database and relevant files.</p>

<hr />

<p>class: enlarge150</p>

<p><a href="https://github.com/usegalaxy-eu/tiaas2">**usegalaxy-eu/tiaas2 **</a></p>

<p><img src="https://raw.githubusercontent.com/usegalaxy-eu/tiaas2/master/images/tiaas-logo.png" alt="TIAAS Logo" /></p>

<p>Django-based infrastructure for creating pools of users, etc.. for training events and connecting them to Galaxy.</p>

<hr />

<h3 id="some-out-of-many-friends-of-the-project">Some (out of many) friends of the project</h3>

<p><img src="../../../../shared/images/conda_logo.png" alt="Bioconda" /></p>

<p><img src="../../images/biocontainers.png" alt="Biocontainers" /></p>

<p>Check out dev training materials ‚ÄúTool Dependencies and Conda‚Äù and ‚ÄúTool Dependencies and Containers‚Äù
for more context.</p>

<hr />

<h2 id="putting-it-all-together">Putting it all together</h2>

<p><img src="../../images/galaxy_main_scheme.png" alt="Large graphic showing different domains and where different portions of the Galaxy community can be found from Biology, Dev, Packaging, Deployment, Documentation, Training, and Support." /></p>

<p><span>Speaker Notes</span></p>

<p>TODO: cover gxformat2</p>

<hr />

<p>class: enlarge200</p>

<p><a href="https://github.com/galaxyproject/galaxy">galaxyproject/<strong>galaxy</strong> </a></p>

<p>The rest of the slides will focus on the core repository.</p>

<hr />

<h2 id="project-management">Project Management</h2>

<p><em>The social architecture of the project.</em></p>

<hr />

<p>class: enlarge200</p>

<h3 id="contributing-quick-start">Contributing Quick Start</h3>

<p>Contribution guidelines: https://bit.ly/gx-CONTRIBUTING-md</p>

<hr />

<p>class: enlarge200</p>

<h3 id="pull-requests">Pull Requests</h3>

<p>Nearly all changes should come in through GitHub Pull Requests.</p>

<p>The exceptions include security patches, packaging and release process artifacts, and backporting fixes to older releases.</p>

<hr />

<p>class: enlarge150</p>

<h3 id="security-security_policymd">Security (SECURITY_POLICY.md)</h3>

<p>In brief, to responsibly report security issues e-mail</p>

<p><a href="mailto:galaxy-committers@lists.galaxyproject.org"><code class="language-plaintext highlighter-rouge">galaxy-committers@lists.galaxyproject.org</code></a></p>

<p>Check out the full policy in <a href="https://github.com/galaxyproject/galaxy/blob/dev/SECURITY_POLICY.md">SECURITY_POLICY.md</a>.</p>

<hr />

<h3 id="branches">Branches</h3>

<p><img src="../../images/core_branches.plantuml.svg" alt="Branches" /></p>

<hr />

<p>class: enlarge150</p>

<h3 id="committers--open-goverance">Committers &amp; Open Goverance</h3>

<p>All repository goverance is done in the open on GitHub via Pull Requests and voting. Galaxy goes beyond open source to open goverance.</p>

<blockquote>
  <p>‚ÄúThe committers group is the group of trusted developers and advocates who manage the core Galaxy code base.‚Äù</p>
</blockquote>

<blockquote>
  <p>‚ÄúGalaxy Project committers are the only individuals who may commit to the core Galaxy code base.‚Äù</p>
</blockquote>

<blockquote>
  <p>‚ÄúCommitters may participate in all formal votes, including votes to modify team membership, merge pull requests, and modify [policies].‚Äù</p>
</blockquote>

<hr />

<p>class: enlarge150</p>

<h3 id="working-groups">Working Groups</h3>

<p>https://galaxyproject.org/community/wg/</p>

<blockquote>
  <p>‚ÄúGalaxy has grown a lot over the years, going from a project at one university in 2005 to the global community it is today. Several parts of the Galaxy ecosystem have become avowedly and obviously community driven during that time, including tools, code, training, and several other international efforts. Galaxy Working Groups push this global model to other areas of Galaxy as well.‚Äù</p>
</blockquote>

<hr />

<p>class: enlarge200</p>

<h3 id="code-of-conduct-code_of_conductmd">Code of Conduct (CODE_OF_CONDUCT.md)</h3>

<p>Describes expectations, encourages diversity, and describes how to report issues such as unacceptable behavior.</p>

<p>Check out the full policy in <a href="https://github.com/galaxyproject/galaxy/blob/dev/CODE_OF_CONDUCT.md">CODE_OF_CONDUCT.md</a>.</p>

<hr />

<p>class: enlarge150</p>

<h3 id="release-process">Release Process</h3>

<p>New large releases are issued roughly every 4 months. The process is guided by an auto-created
self documenting release issue.</p>

<p>Check out the <a href="https://github.com/galaxyproject/galaxy/issues/11770">21.05 release issue</a> as an example.</p>

<p>Working groups create roadmaps aligned with each release and coordinated with project leadership.</p>

<hr />

<p>class: enlarge150</p>

<h3 id="organizing-issues-and-pull-requests">Organizing Issues and Pull Requests</h3>

<p>Extensive use of Github tags are used to try to organize the numerous issues and
pull requests of the Galaxy repository.</p>

<p>The tags are described in detail in <a href="https://github.com/galaxyproject/galaxy/blob/dev/doc/source/project/issues.rst">issues.rst</a>.</p>

<hr />

<h3 id="continuous-integration-ci">Continuous Integration (CI)</h3>

<p><img src="../../images/core_ci.png" alt="Galaxy CI" /></p>

<p>If you get Red Xs - take a second to ponder whether they make sense and don‚Äôt be afraid to ask, it is a complex system with a lot of noise!</p>

<hr />

<h3 id="linting-and-code-formatting">Linting and Code Formatting</h3>

<p>Part of the Galaxy CI process includes linting both the backend Python and frontend ES 6 code.
This linting process captures many common problems as well as enforcing a common code style.</p>

<p>The output reports from the CI process are relatively straightforward, but it is a good process
to lint changes before opening pull requests for them. The Python linter can be run using <code class="language-plaintext highlighter-rouge">tox</code>
as follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tox -e lint
</code></pre></div></div>

<p>The client code formatting guidelines are much more strict but as a result can be applied
automatically for very consistent code. Execute the <code class="language-plaintext highlighter-rouge">client-format</code> make command to format
the code and then the <code class="language-plaintext highlighter-rouge">client-lint</code> command to check the result.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ make client-format
$ make client-lint
</code></pre></div></div>

<hr />

<h3 id="mypy-and-python-types">mypy and Python Types</h3>

<p>Starting with release 21.01, portions of the Galaxy backend have
Python 3 type annotations and static checking is performed as part of
CI. Imported library types are not enforcing and
<a href="https://mypy.readthedocs.io/en/stable/">mypy</a> does a fair job
inferring types in most situations, so this process should be
relatively transparent to contributors.</p>

<p>If there are problems with typing, the CI produces explicit output
about how to correct problems. These problems generally just require a
single type annotation. Feel free to request help on a pull request
for what that should look like.</p>

<p>To run a subset of the python type checking locally, <code class="language-plaintext highlighter-rouge">tox</code> again can
be used:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tox -e mypy
</code></pre></div></div>

<p>A quick overview about why to add type annotations to Python code and how to use
them can be found on this <a href="https://dev.to/dstarner/using-pythons-type-annotations-4cfe">blog post</a>.
Additional useful resources include <a href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html">this cheat sheet from mypy</a>
and the Python docs for the <a href="https://docs.python.org/3/library/typing.html">typing module</a>.</p>

<hr />

<p>class: enlarge200</p>

<h3 id="development-environments">Development Environments</h3>

<p>Galaxy developers use a wide range of IDEs and we don‚Äôt offer any formal recommendation of one over another.</p>

<p>However, Marius has assembled some documentation on debugging the <a href="https://docs.galaxyproject.org/en/master/dev/debugging_galaxy.html">Galaxy server</a> and <a href="https://docs.galaxyproject.org/en/master/dev/debugging_tests.html">tests</a> using VS Code.</p>

<hr />

<h3 id="development-environment---gitpod">Development Environment - Gitpod</h3>

<p>Galaxy does have a Gitpod configuration that is enabled to allow editing and testing PRs https://www.gitpod.io/.</p>

<p>Video from Marius presenting Gitpod at the Galaxy Developer Roundtable (https://www.youtube.com/watch?v=3e71DFg3gsw#t=39m0s)</p>

<hr />

<h3 id="docsgalaxyprojectorg">docs.galaxyproject.org</h3>

<p><img src="../../images/core_docs.png" alt="docs.galaxyproject.org" /></p>

<p>All these documents as well as versions code and deployment documentation and release notes
can be found at <a href="https://docs.galaxyproject.org">docs.galaxyproject.org</a>.</p>

<hr />

<h2 id="principles">Principles</h2>

<p><em>The guiding principles of the core code architecture.</em></p>

<hr />

<h3 id="aspirational-principles-of-galaxy-architecture">Aspirational Principles of Galaxy Architecture</h3>

<p>Whereas the architecture of the frontend (Web UI) aims for consistency and is
highly opinionated, the backend (Python server) is guided by flexibility and is meant to be driven by plugins whenever possible.</p>

<p><span>Speaker Notes</span></p>

<p>Though an imperfect abstraction‚Ä¶ maybe it is beneficial to think of the organizational
principles that guide frontend and backend development of Galaxy as
diametrically opposite.</p>

<p>The frontend architecture is guided by the principle that the end user experience
should be as simple and consistent as possible. The backend has been deployed at
so many different sites and targeting so many different technologies - that
flexibility is paramount.</p>

<hr />

<h3 id="an-opinionated-frontend">An Opinionated Frontend</h3>

<ul>
  <li>The target audience is a <em>bench scientist</em> - no knowledge of programming, paths, or command lines should be assumed.</li>
  <li>Consistent colors, fonts, themes, etc‚Ä¶</li>
  <li>Reusable components for presenting common widgets - from the generic (forms and grids) to the specific (tools and histories).</li>
  <li>Tied to specific technologies:
    <ul>
      <li>Implemented in JavaScript (ES6)</li>
      <li>Built with <a href="https://webpack.js.org/">webpack</a></li>
      <li><a href="https://vuejs.org/">Vue.js</a> for component definitions</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="a-plugin-driven-backend">A Plugin Driven Backend</h3>

<p>Galaxy‚Äôs backend is in many ways driven by <em>pluggable interfaces</em> and
can be adapted to many different technologies.</p>

<ul>
  <li>SQLAlchemy allows using SQLite, PostgreSQL, or MySQL (sort of) for your database.</li>
  <li>Many different cluster backends or job managers are supported.</li>
  <li>Different frontend proxies (e.g. nginx) are supported as well as web
application containers (e.g. uWSGI, gunicorn).</li>
  <li>Different storage strategies and technologies are supported (e.g. S3, iRODS).</li>
  <li>Tool definitions, job metrics, stat middleware, tool dependency resolution, workflow modules,
datatype definitions are all plugin driven.</li>
</ul>

<p><span>Speaker Notes</span></p>

<p>If the chief architectural principle guiding the frontend is a fast and accessible
experience for the bench scientist, perhaps for the backend it is allowing
deployment on many different platforms and a different scales.</p>

<hr />

<h3 id="a-plugin-driven-backend-but">A Plugin Driven Backend but‚Ä¶</h3>

<p>Galaxy has long been guided by the principle that cloning it and calling
the <code class="language-plaintext highlighter-rouge">run.sh</code> should ‚Äújust work‚Äù and should work quickly.</p>

<p>So by default Galaxy does not require:</p>

<ul>
  <li>Compilation - it fetches <em>binary wheels</em> for your platform.</li>
  <li>A job manager - Galaxy can act as one.</li>
  <li>An external database server - Galaxy can use an sqlite database.</li>
  <li>A web proxy or external Python web server.</li>
</ul>

<hr />

<p>class: enlarge200</p>

<h3 id="in-other-words">In other words‚Ä¶</h3>

<p>The Galaxy frontend is architected with the bench scientist in mind first and foremost,
the Galaxy backend is architected with Galaxy administrators in mind first and foremost.</p>

<p><span>Speaker Notes</span></p>

<p>TODO: slide connecting architecture to people here</p>

<hr />

<h2 id="files-and-directories">Files and Directories</h2>

<p><em>The physical architecture of the Galaxy code.</em></p>

<hr />

<h3 id="project-docs">Project Docs</h3>

<p><img src="../../images/core_files_project_docs.plantuml.svg" alt="Project Files" /></p>

<hr />

<h3 id="code">Code</h3>

<p><img src="../../images/core_files_code.plantuml.svg" alt="Code" /></p>

<hr />

<h3 id="scripts">Scripts</h3>

<p><img src="../../images/core_files_scripts.plantuml.svg" alt="Scripts" /></p>

<hr />

<h3 id="test-sources">Test Sources</h3>

<p><img src="../../images/core_files_test.plantuml.svg" alt="Test Source Files" /></p>

<hr />

<h3 id="continuous-integration">Continuous Integration</h3>

<p><img src="../../images/core_files_ci.plantuml.svg" alt="Continuous Integration Files" /></p>

<hr />

<h3 id="one-repository-two-views-of-a-project">One Repository, Two Views of a Project</h3>

<p><img src="../../images/core_files_code_python_2_views.plantuml.svg" alt="Two Views of Galaxy Python Project" /></p>

<p><code class="language-plaintext highlighter-rouge">lib</code> contains a single monolithic view of the <code class="language-plaintext highlighter-rouge">galaxy</code> namespace.</p>

<p>Each sub-directory of <code class="language-plaintext highlighter-rouge">packages</code> contains a logical subset of this <code class="language-plaintext highlighter-rouge">galaxy</code> namespace. Directory symbolic links are used to ensure the same files are used.</p>

<p><span>Speaker Notes</span></p>

<p>TODO: a slide before this one describing Python modules and how they map to files
using galaxy.util, galaxy.model.mapping, and galaxy.web.framework.</p>

<hr />

<h3 id="package-structure">Package Structure</h3>

<p><img src="../../images/core_packages.plantuml.svg" alt="package structure" /></p>

<p>(somewhat aspirational still)</p>

<hr />

<h3 id="pypi">PyPI</h3>

<p><img src="../../images/core_tool_util_pypi.png" alt="galaxy-tool-util on PyPI" /></p>

<hr />

<p><img src="../../images/core_files_code_package.plantuml.svg" alt="Package Files" /></p>

<hr />

<h2 id="web-frameworks">Web Frameworks</h2>

<p><em>The architecture of an interaction.</em></p>

<hr />

<p>class: reduce70</p>

<p><img src="../../images/server_client_vuejs.plantuml.svg" alt="Client-Server Communications" /></p>

<p>Bits and pieces of older client technologies appear throughout - ranging from Python
mako templates to generate HTML, lower-level jQuery, and lots of Backbone legacy MVC.</p>

<hr />

<p><img src="../../images/asgi_app.plantuml.svg" alt="Processing requests on the server" /></p>

<p>Expanding the right side of that diagram. We will move through the components left to right.</p>

<hr />

<p>class: enlarge120
template: left-aligned</p>

<h3 id="asgi---application">ASGI - Application</h3>

<p>Spiritual successor to
<a href="https://www.python.org/dev/peps/pep-0333/">WSGI</a>. An ASGI application
is an async callable that takes in a <code class="language-plaintext highlighter-rouge">scope</code> (<code class="language-plaintext highlighter-rouge">dict</code> describing the
connection), <code class="language-plaintext highlighter-rouge">send</code> (an async callable to respond to events via),
and <code class="language-plaintext highlighter-rouge">receive</code> (an async callable to receive messages).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
    <span class="n">event</span> <span class="o">=</span> <span class="k">await</span> <span class="n">receive</span><span class="p">()</span>
    <span class="p">...</span>
    <span class="k">await</span> <span class="n">send</span><span class="p">({</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"http.response.body"</span><span class="p">,</span> <span class="p">...})</span>
</code></pre></div></div>

<p>Checkout <a href="https://asgi.readthedocs.io/">ASGI documentation</a> for more details.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="asgi--starlette-low-level-example">ASGI &amp; Starlette Low-level Example</h3>

<p>We will talk a lot about Galaxy and FastAPI - but much of its
plumbing is just aliases for starlette ASGI handling.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">PlainTextResponse</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">scope</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">"http"</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="s">'Hello, world!'</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">response</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
</code></pre></div></div>

<p>If this is placed in a file called <code class="language-plaintext highlighter-rouge">example.py</code> with Starlette on
the Python path, the application server uvicorn can then host this
application with the following shell command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ uvicorn example:app
INFO: Started server process [11509]
INFO: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
</code></pre></div></div>

<p>Example from <a href="https://www.starlette.io/">starlette.io</a>.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="asgi---starlette-high-level-example">ASGI - Starlette High-level Example</h3>

<p>Building a higher-level <code class="language-plaintext highlighter-rouge">example.py</code> with Starlette.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<span class="kn">from</span> <span class="nn">starlette.routing</span> <span class="kn">import</span> <span class="n">Route</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">homepage</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s">'hello'</span><span class="p">:</span> <span class="s">'world'</span><span class="p">})</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
    <span class="n">Route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">homepage</span><span class="p">),</span>
<span class="p">])</span>
</code></pre></div></div>

<p>A small framework for building web applications.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="asgi---fastapi">ASGI - FastAPI</h3>

<p>From https://github.com/tiangolo/fastapi/blob/master/fastapi/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<span class="p">...</span>

<span class="k">class</span> <span class="nc">FastAPI</span><span class="p">(</span><span class="n">Starlette</span><span class="p">):</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>FastAPI (the library and the application base) extends starlette framework with features for building APIs. These include data
validation, serialization, documentation generation.</p>

<hr />

<p><img src="../../images/asgi_app.plantuml.svg" alt="Processing requests on the server" /></p>

<hr />

<p>template: left-aligned</p>

<h3 id="fastapi-__call__">FastAPI <code class="language-plaintext highlighter-rouge">__call__</code></h3>

<p>https://github.com/tiangolo/fastapi/blob/master/fastapi/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">:</span> <span class="n">Receive</span><span class="p">,</span> <span class="n">send</span><span class="p">:</span> <span class="n">Send</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">root_path</span><span class="p">:</span>
        <span class="n">scope</span><span class="p">[</span><span class="s">"root_path"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root_path</span>
    <span class="k">if</span> <span class="n">AsyncExitStack</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
             <span class="n">scope</span><span class="p">[</span><span class="s">"fastapi_astack"</span><span class="p">]</span> <span class="o">=</span> <span class="n">stack</span>
             <span class="k">await</span> <span class="nb">super</span><span class="p">().</span><span class="n">__call__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">().</span><span class="n">__call__</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>  <span class="c1"># pragma: no cover
</span></code></pre></div></div>

<p>A light wrapper around Starlette‚Äôs call entry point.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="starlette-__call__">Starlette <code class="language-plaintext highlighter-rouge">__call__</code></h3>

<p>https://github.com/encode/starlette/blob/master/starlette/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">:</span> <span class="n">Receive</span><span class="p">,</span> <span class="n">send</span><span class="p">:</span> <span class="n">Send</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
   <span class="n">scope</span><span class="p">[</span><span class="s">"app"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
   <span class="k">await</span> <span class="bp">self</span><span class="p">.</span><span class="n">middleware_stack</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
</code></pre></div></div>

<p>Walks through Starlette middleware.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="starlette-build_middleware_stack">Starlette <code class="language-plaintext highlighter-rouge">build_middleware_stack</code></h3>

<p>https://github.com/encode/starlette/blob/master/starlette/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_middleware_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ASGIApp</span><span class="p">:</span>
    <span class="p">...</span>

    <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">router</span>
    <span class="k">for</span> <span class="n">cls</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">middleware</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</code></pre></div></div>

<p>Start with the router and surround it with each layer of configured middleware.</p>

<hr />

<p>template: left-aligned
class: enlarge150</p>

<h3 id="asgi-middleware">ASGI Middleware</h3>

<blockquote>
  <p>It is possible to have ASGI ‚Äúmiddleware‚Äù - code that plays the role of both server and application, taking in a scope and the send/receive awaitable callables, potentially modifying them, and then calling an inner application.</p>
</blockquote>

<p>https://asgi.readthedocs.io/en/latest/specs/main.html#middleware</p>

<hr />

<p>template: left-aligned
class: enlarge150</p>

<h3 id="starlette-middleware">Starlette Middleware</h3>

<blockquote>
  <p>Starlette includes several middleware classes for adding behavior that is applied across your entire application. These are all implemented as standard ASGI middleware classes, and can be applied either to Starlette or to any other ASGI application.</p>
</blockquote>

<p>https://www.starlette.io/middleware/</p>

<hr />

<p>template: left-aligned</p>

<h3 id="starlette-build_middleware_stack-1">Starlette <code class="language-plaintext highlighter-rouge">build_middleware_stack</code></h3>

<p>https://github.com/encode/starlette/blob/master/starlette/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_middleware_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ASGIApp</span><span class="p">:</span>
    <span class="p">...</span>

    <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">router</span>
    <span class="k">for</span> <span class="n">cls</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">middleware</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</code></pre></div></div>

<p>Notice the inner most layer is the router.</p>

<hr />

<p>template: left-aligned</p>

<h3 id="fastapi-router-initialization">FastAPI Router Initialization</h3>

<p>https://github.com/tiangolo/fastapi/blob/master/fastapi/applications.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FastAPI</span><span class="p">(</span><span class="n">Starlette</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">...):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">router</span><span class="p">:</span> <span class="n">routing</span><span class="p">.</span><span class="n">APIRouter</span> <span class="o">=</span> <span class="n">routing</span><span class="p">.</span><span class="n">APIRouter</span><span class="p">(</span>
            <span class="n">routes</span><span class="o">=</span><span class="n">routes</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></div>

<hr />

<h3 id="fastapi-router">FastAPI Router</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">starlette</span> <span class="kn">import</span> <span class="n">routing</span>

<span class="k">class</span> <span class="nc">APIRouter</span><span class="p">(</span><span class="n">routing</span><span class="p">.</span><span class="n">Router</span><span class="p">):</span>
   <span class="p">...</span>
</code></pre></div></div>

<hr />

<h3 id="starlette-router">Starlette Router</h3>

<p>https://github.com/encode/starlette/blob/master/starlette/routing.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">:</span> <span class="n">Receive</span><span class="p">,</span> <span class="n">send</span><span class="p">:</span> <span class="n">Send</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
   <span class="p">...</span>
   <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">routes</span><span class="p">:</span>
       <span class="c1"># Determine if any route matches the incoming scope,
</span>       <span class="c1"># and hand over to the matching route if found.
</span>       <span class="n">match</span><span class="p">,</span> <span class="n">child_scope</span> <span class="o">=</span> <span class="n">route</span><span class="p">.</span><span class="n">matches</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
       <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="n">Match</span><span class="p">.</span><span class="n">FULL</span><span class="p">:</span>
           <span class="n">scope</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">child_scope</span><span class="p">)</span>
           <span class="k">await</span> <span class="n">route</span><span class="p">.</span><span class="n">handle</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
           <span class="k">return</span>
       <span class="p">...</span>
</code></pre></div></div>

<p>https://www.starlette.io/routing/</p>

<hr />

<p><img src="../../images/routers.plantuml.svg" alt="Router Class Diagram" /></p>

<ul>
  <li>https://www.starlette.io/routing/</li>
  <li>https://fastapi.tiangolo.com/tutorial/bigger-applications/#apirouter</li>
  <li>https://fastapi-utils.davidmontague.xyz/user-guide/inferring-router/</li>
</ul>

<hr />

<p>class: enlarge200</p>

<p>In order to understand how the routing classes are setup within Galaxy,
lets step back and look really quickly at how Galaxy‚Äôs FastAPI
application (ASGI endpoint) is constructed.</p>

<hr />

<h3 id="fastapi-factory">FastAPI Factory</h3>

<p><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/fast_factory.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">factory</span><span class="p">():</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">WebappSetupProps</span><span class="p">(</span>
        <span class="n">app_name</span><span class="o">=</span><span class="s">'galaxy'</span><span class="p">,</span>
        <span class="n">default_section_name</span><span class="o">=</span><span class="n">DEFAULT_CONFIG_SECTION</span><span class="p">,</span>
        <span class="n">env_config_file</span><span class="o">=</span><span class="s">'GALAXY_CONFIG_FILE'</span><span class="p">,</span>
        <span class="n">env_config_section</span><span class="o">=</span><span class="s">'GALAXY_CONFIG_SECTION'</span><span class="p">,</span>
        <span class="n">check_galaxy_root</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">config_provider</span> <span class="o">=</span> <span class="n">WebappConfigResolver</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config_provider</span><span class="p">.</span><span class="n">resolve_config</span><span class="p">()</span>
    <span class="n">gx_webapp</span><span class="p">,</span> <span class="n">gx_app</span> <span class="o">=</span> <span class="n">app_pair</span><span class="p">(</span>
        <span class="n">global_conf</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">global_conf</span><span class="p">,</span>
        <span class="n">load_app_kwds</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">load_app_kwds</span><span class="p">,</span>
        <span class="n">wsgi_preflight</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">wsgi_preflight</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">initialize_fast_app</span><span class="p">(</span><span class="n">gx_webapp</span><span class="p">,</span> <span class="n">gx_app</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h3 id="fastapi-application">FastAPI Application</h3>

<p><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/fast_app.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize_fast_app</span><span class="p">(</span><span class="n">gx_webapp</span><span class="p">,</span> <span class="n">gx_app</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s">"Galaxy API"</span><span class="p">,</span>
        <span class="n">docs_url</span><span class="o">=</span><span class="s">"/api/docs"</span><span class="p">,</span>
        <span class="n">openapi_tags</span><span class="o">=</span><span class="n">api_tags_metadata</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">add_exception_handler</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">add_galaxy_middleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">gx_app</span><span class="p">)</span>
    <span class="n">add_request_id_middleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">include_all_package_routers</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">'galaxy.webapps.galaxy.api'</span><span class="p">)</span>
    <span class="n">wsgi_handler</span> <span class="o">=</span> <span class="n">WSGIMiddleware</span><span class="p">(</span><span class="n">gx_webapp</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">wsgi_handler</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</code></pre></div></div>

<hr />

<h3 id="finding-api-routers">Finding API Routers</h3>

<p>Following this line:</p>

<p><code class="language-plaintext highlighter-rouge">include_all_package_routers(app, 'galaxy.webapps.galaxy.api')</code></p>

<p>to the file</p>

<p><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/base/api.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">include_all_package_routers</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">walk_controller_modules</span><span class="p">(</span><span class="n">package_name</span><span class="p">):</span>
        <span class="n">router</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">"router"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">router</span><span class="p">:</span>
            <span class="n">app</span><span class="p">.</span><span class="n">include_router</span><span class="p">(</span><span class="n">router</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p>class: reduce70</p>

<h3 id="routing-inside-the-application">Routing inside the Application</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">'tags'</span><span class="p">])</span>


<span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">cbv</span>
<span class="k">class</span> <span class="nc">FastAPITags</span><span class="p">:</span>
    <span class="n">manager</span><span class="p">:</span> <span class="n">TagsManager</span> <span class="o">=</span> <span class="n">depends</span><span class="p">(</span><span class="n">TagsManager</span><span class="p">)</span>

    <span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">put</span><span class="p">(</span>
        <span class="s">'/api/tags'</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="s">"Apply a new set of tags to an item."</span><span class="p">,</span>
        <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span> <span class="o">=</span> <span class="n">DependsOnTrans</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">ItemTagsPayload</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(</span>
            <span class="p">...,</span>  <span class="c1"># Required
</span>            <span class="n">title</span><span class="o">=</span><span class="s">"Payload"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">"Request body containing the item and the tags to be assigned."</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">):</span>
        <span class="s">"""Replaces the tags associated with an item with the new ones specified in the payload.

        - The previous tags will be __deleted__.
        - If no tags are provided in the request body, the currently associated tags will also be __deleted__.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">manager</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p><img src="../../images/routers.plantuml.svg" alt="Router Class Diagram" /></p>

<ul>
  <li>https://www.starlette.io/routing/</li>
  <li>https://fastapi.tiangolo.com/tutorial/bigger-applications/#apirouter</li>
  <li>https://fastapi-utils.davidmontague.xyz/user-guide/inferring-router/</li>
</ul>

<hr />

<h3 id="wsgi-fallback">WSGI Fallback</h3>

<p>Back to <code class="language-plaintext highlighter-rouge">initialize_fast_app</code>, two of the final lines were as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wsgi_handler</span> <span class="o">=</span> <span class="n">WSGIMiddleware</span><span class="p">(</span><span class="n">gx_webapp</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">wsgi_handler</span><span class="p">)</span>
</code></pre></div></div>

<p>This effectively provides a fallback to our legacy WSGI application.</p>

<hr />

<h3 id="wsgi">WSGI</h3>

<ul>
  <li>Python interface for web servers defined by PEP 333 - https://www.python.org/dev/peps/pep-0333/.</li>
  <li>Galaxy tends to favor uWSGI, but other options such as Gunicorn and Paste can be used to host the application.
    <ul>
      <li>https://uwsgi-docs.readthedocs.io/ (a million bells and whistles, highly performant, a bit brittle)</li>
      <li>https://gunicorn.org/ (simpler, more standard Python 3 WSGI server)</li>
      <li>https://bitbucket.org/ianb/paste (more of legacy interest, but still heavily used in testing for instance)</li>
    </ul>
  </li>
</ul>

<hr />

<p><img src="../../images/wsgi_app.plantuml.svg" alt="Processing requests on the server" /></p>

<hr />

<p>template: left-aligned</p>

<h3 id="wsgi-middleware">WSGI Middleware</h3>

<p>A WSGI function:</p>

<p><code class="language-plaintext highlighter-rouge">def app(environ, start_response):</code></p>

<ul>
  <li>Middleware act as filters, modify the <code class="language-plaintext highlighter-rouge">environ</code> and then pass through to the next webapp</li>
  <li>Galaxy uses several middleware components defined in the <code class="language-plaintext highlighter-rouge">wrap_in_middleware</code>
function of <code class="language-plaintext highlighter-rouge">galaxy.webapps.galaxy.buildapp</code>.</li>
</ul>

<hr />

<p>template: left-aligned</p>

<h3 id="galaxys-wsgi-middleware">Galaxy‚Äôs WSGI Middleware</h3>

<p>Middleware configured in <code class="language-plaintext highlighter-rouge">galaxy.webapps.galaxy.buildapp#wrap_in_middleware</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">paste.httpexceptions#make_middleware</code></li>
  <li><code class="language-plaintext highlighter-rouge">galaxy.web.framework.middleware.remoteuser#RemoteUser</code> (if configured)</li>
  <li><code class="language-plaintext highlighter-rouge">paste.recursive#RecursiveMiddleware</code></li>
  <li><code class="language-plaintext highlighter-rouge">galaxy.web.framework.middleware.sentry#Sentry</code> (if configured)</li>
  <li>Various debugging middleware (linting, interactive exceptions, etc‚Ä¶)</li>
  <li><code class="language-plaintext highlighter-rouge">galaxy.web.framework.middleware.statsd#StatsdMiddleware</code> (if configured)</li>
  <li><code class="language-plaintext highlighter-rouge">galaxy.web.framework.middleware.xforwardedhost#XForwardedHostMiddleware</code></li>
  <li><code class="language-plaintext highlighter-rouge">galaxy.web.framework.middleware.request_id#RequestIDMiddleware</code></li>
</ul>

<hr />

<p><img src="../../images/wsgi_app.plantuml.svg" alt="Processing requests on the server (WSGI)" /></p>

<hr />

<h3 id="instances">Instances</h3>

<p><img src="../../images/webapp.plantuml.svg" alt="webapp" /></p>

<hr />

<h3 id="classes">Classes</h3>

<p><img src="../../images/webapp_classes.plantuml.svg" alt="GalaxyWebApplication class diagram" /></p>

<hr />

<p>template: left-aligned</p>

<h3 id="routes">Routes</h3>

<p>Setup on <code class="language-plaintext highlighter-rouge">webapp</code> in <code class="language-plaintext highlighter-rouge">galaxy.webapps.galaxy.buildapp.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">webapp</span><span class="p">.</span><span class="n">add_route</span><span class="p">(</span>
    <span class="s">'/datasets/:dataset_id/display/{filename:.+?}'</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">'dataset'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'display'</span><span class="p">,</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span>
<span class="p">)</span>
</code></pre></div></div>

<p>URL <code class="language-plaintext highlighter-rouge">/datasets/278043/display</code> matches this route, so <code class="language-plaintext highlighter-rouge">handle_request</code> will</p>

<ul>
  <li>lookup the controller named ‚Äúdataset‚Äù</li>
  <li>look for a method named ‚Äúdisplay‚Äù that is exposed</li>
  <li>call it, passing dataset_id and filename as keyword arg</li>
</ul>

<p>Uses popular Routes library (https://pypi.python.org/pypi/Routes).</p>

<hr />

<p>template: left-aligned</p>

<p>Simplified <code class="language-plaintext highlighter-rouge">handle_request</code> from <code class="language-plaintext highlighter-rouge">lib/galaxy/web/framework/base.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">path_info</span> <span class="o">=</span> <span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span> <span class="s">'PATH_INFO'</span><span class="p">,</span> <span class="s">''</span> <span class="p">)</span>
    <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">mapper</span><span class="p">.</span><span class="n">match</span><span class="p">(</span> <span class="n">path_info</span><span class="p">,</span> <span class="n">environ</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">path_info</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'/api'</span><span class="p">):</span>
        <span class="n">controllers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">api_controllers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">controllers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">controllers</span>

    <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transaction_factory</span><span class="p">(</span> <span class="n">environ</span> <span class="p">)</span>

    <span class="n">controller_name</span> <span class="o">=</span> <span class="nb">map</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span> <span class="s">'controller'</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">controllers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span> <span class="n">controller_name</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>

    <span class="c1"># Resolve action method on controller
</span>    <span class="n">action</span> <span class="o">=</span> <span class="nb">map</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span> <span class="s">'action'</span><span class="p">,</span> <span class="s">'index'</span> <span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">controller</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">trans</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">mixed</span><span class="p">()</span>
    <span class="c1"># Read controller arguments from mapper match
</span>    <span class="n">kwargs</span><span class="p">.</span><span class="n">update</span><span class="p">(</span> <span class="nb">map</span> <span class="p">)</span>

    <span class="n">body</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span> <span class="n">trans</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
    <span class="c1"># Body may be a file, string, etc... respond with it.
</span></code></pre></div></div>

<hr />

<p>class: enlarge150</p>

<h3 id="controllers">Controllers</h3>

<p>Three varieties</p>

<ol>
  <li>FastAPI ASGI API controllers</li>
  <li>WSGI API controllers</li>
  <li>Legacy WSGI web controllers.</li>
</ol>

<p>Ideally each of these are <em>thin</em>. Focused on ‚Äúweb things‚Äù - adapting parameters and responses and move
‚Äúbusiness logic‚Äù to components not bound to web functionality.</p>

<hr />

<p>class: enlarge150</p>

<h3 id="fastapi-controllers">FastAPI Controllers</h3>

<ul>
  <li>Found in <code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/controllers/api/</code>.</li>
  <li>Consume and produce typed data using Python 3 type annotations, FastAPI helpers, and Pydantic models.</li>
  <li>Router specifies HTTP verb (GET, POST, PUT, etc..) and how to parse path.</li>
</ul>

<hr />

<p>class: reduce70</p>

<h3 id="fastapi-controller-example">FastAPI Controller Example</h3>

<p><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/controllers/api/roles.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">cbv</span>
<span class="k">class</span> <span class="nc">FastAPIRoles</span><span class="p">:</span>
    <span class="n">role_manager</span><span class="p">:</span> <span class="n">RoleManager</span> <span class="o">=</span> <span class="n">depends</span><span class="p">(</span><span class="n">RoleManager</span><span class="p">)</span>

    <span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/api/roles'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span> <span class="o">=</span> <span class="n">DependsOnTrans</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RoleListModel</span><span class="p">:</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">list_displayable_roles</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RoleListModel</span><span class="p">(</span><span class="n">__root__</span><span class="o">=</span><span class="p">[</span><span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">])</span>

    <span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/api/roles/{id}'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">EncodedDatabaseIdField</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span> <span class="o">=</span> <span class="n">DependsOnTrans</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RoleModel</span><span class="p">:</span>
        <span class="n">role_id</span> <span class="o">=</span> <span class="n">trans</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">security</span><span class="p">.</span><span class="n">decode_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>

    <span class="o">@</span><span class="n">router</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/api/roles"</span><span class="p">,</span> <span class="n">require_admin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span> <span class="o">=</span> <span class="n">DependsOnTrans</span><span class="p">,</span> <span class="n">role_definition_model</span><span class="p">:</span> <span class="n">RoleDefinitionModel</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(...))</span> <span class="o">-&gt;</span> <span class="n">RoleModel</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">create_role</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role_definition_model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p>class: reduce70</p>

<h3 id="fastapi-and-pydantic">FastAPI and Pydantic</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RoleIdField</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"ID"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Encoded ID of the role"</span><span class="p">)</span>
<span class="n">RoleNameField</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Name"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Name of the role"</span><span class="p">)</span>
<span class="n">RoleDescriptionField</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Description"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Description of the role"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BasicRoleModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">EncodedDatabaseIdField</span> <span class="o">=</span> <span class="n">RoleIdField</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RoleNameField</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Type"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Type or category of the role"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RoleModel</span><span class="p">(</span><span class="n">BasicRoleModel</span><span class="p">):</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RoleDescriptionField</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"URL"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"URL for the role"</span><span class="p">)</span>
    <span class="n">model_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Model class"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"Database model class (Role)"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RoleDefinitionModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RoleNameField</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RoleDescriptionField</span>
    <span class="n">user_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EncodedDatabaseIdField</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"User IDs"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">group_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EncodedDatabaseIdField</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Group IDs"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span>
</code></pre></div></div>

<hr />

<h3 id="fastapi-and-openapi">FastAPI and OpenAPI</h3>

<p><code class="language-plaintext highlighter-rouge">FastAPI(title="Galaxy API", docs_url="/api/docs", ...)</code></p>

<p><img src="../../images/core_api_docs.png" alt="OpenAPI Docs from FastAPI at api/docs" /></p>

<hr />

<p><img src="../../images/core_api_docs_roles.png" alt="OpenAPI Docs from FastAPI at api/docs for roles" /></p>

<hr />

<p>class: enlarge150</p>

<h3 id="wsgi-api-controllers">WSGI API Controllers</h3>

<ul>
  <li>Also in <code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/controllers/api/</code></li>
  <li>Mirroring FastAPI controllers until FastAPI required (likely 21.09)</li>
  <li>Exposed method take <code class="language-plaintext highlighter-rouge">trans</code> and request parameters and return a JSON response (possibly including Pydantic objects)</li>
</ul>

<hr />

<p>class: reduce70</p>

<h3 id="wsgi-api-controller-example">WSGI API Controller Example</h3>

<p><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/controllers/api/roles.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RoleAPIController</span><span class="p">(</span><span class="n">BaseGalaxyAPIController</span><span class="p">):</span>
    <span class="n">role_manager</span><span class="p">:</span> <span class="n">RoleManager</span> <span class="o">=</span> <span class="n">depends</span><span class="p">(</span><span class="n">RoleManager</span><span class="p">)</span>

    <span class="o">@</span><span class="n">web</span><span class="p">.</span><span class="n">expose_api</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="s">"""
        GET /api/roles
        Displays a collection (list) of roles.
        """</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">list_displayable_roles</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RoleListModel</span><span class="p">(</span><span class="n">__root__</span><span class="o">=</span><span class="p">[</span><span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">])</span>

    <span class="o">@</span><span class="n">web</span><span class="p">.</span><span class="n">expose_api</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="s">"""
        GET /api/roles/{encoded_role_id}
        Displays information about a role.
        """</span>
        <span class="n">role_id</span> <span class="o">=</span> <span class="n">decode_id</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">app</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>

    <span class="o">@</span><span class="n">web</span><span class="p">.</span><span class="n">expose_api</span>
    <span class="o">@</span><span class="n">web</span><span class="p">.</span><span class="n">require_admin</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">ProvidesUserContext</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="s">"""
        POST /api/roles
        Creates a new role.
        """</span>
        <span class="n">expand_json_keys</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="p">[</span><span class="s">"user_ids"</span><span class="p">,</span> <span class="s">"group_ids"</span><span class="p">])</span>
        <span class="n">role_definition_model</span> <span class="o">=</span> <span class="n">RoleDefinitionModel</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">role_manager</span><span class="p">.</span><span class="n">create_role</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role_definition_model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">role_to_model</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p>class: enlarge150</p>

<h3 id="legacy-wsgi-controllers">Legacy WSGI Controllers</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">lib/galaxy/webapps/galaxy/controllers/</code></li>
  <li>Return arbitrary content - JSON, HTML, etc‚Ä¶</li>
  <li>Render HTML components using <a href="http://www.makotemplates.org/">mako</a> templates (see <code class="language-plaintext highlighter-rouge">templates/</code>)</li>
  <li>The usage of these should continue to decrease over time.</li>
</ul>

<hr />

<h2 id="app-and-dependency-injection"><code class="language-plaintext highlighter-rouge">app</code> and Dependency Injection</h2>

<p><em>The architecture of connecting Galaxy components.</em></p>

<hr />

<p><img src="../../images/app_py2.plantuml.svg" alt="Big Interconnected App Python 2" /></p>

<hr />

<h3 id="a-god-object">A God object</h3>

<blockquote>
  <p>‚Äúa God object is an object that knows too much or does too much. The God object is an example of an anti-pattern and a code smell.‚Äù</p>
</blockquote>

<p>https://en.wikipedia.org/wiki/God_object</p>

<p>Not only does <code class="language-plaintext highlighter-rouge">app</code> know and do too much, it is also used way too many places. Every interesting component, every controller, the web transaction, etc.. has a reference to <code class="language-plaintext highlighter-rouge">app</code>.</p>

<hr />

<h3 id="a-typical-usage">A Typical Usage</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatasetCollectionManager</span><span class="p">:</span>

     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">DATASET_COLLECTION_TYPES_REGISTRY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">collection_type_descriptions</span> <span class="o">=</span> <span class="n">COLLECTION_TYPE_DESCRIPTION_FACTORY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">security</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">security</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">hda_manager</span> <span class="o">=</span> <span class="n">hdas</span><span class="p">.</span><span class="n">HDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">history_manager</span> <span class="o">=</span> <span class="n">histories</span><span class="p">.</span><span class="n">HistoryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tag_handler</span> <span class="o">=</span> <span class="n">tags</span><span class="p">.</span><span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ldda_manager</span> <span class="o">=</span> <span class="n">lddas</span><span class="p">.</span><span class="n">LDDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p><img src="../../images/app_types_no_interface.plantuml.svg" alt="Big Interconnected App Python 3 - no right" /></p>

<hr />

<h2 id="problematic-dependency-graph">Problematic Dependency Graph</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatasetCollectionManager</span><span class="p">:</span>

     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">UniverseApplication</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">DATASET_COLLECTION_TYPES_REGISTRY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">collection_type_descriptions</span> <span class="o">=</span> <span class="n">COLLECTION_TYPE_DESCRIPTION_FACTORY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">security</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">security</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">hda_manager</span> <span class="o">=</span> <span class="n">hdas</span><span class="p">.</span><span class="n">HDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">history_manager</span> <span class="o">=</span> <span class="n">histories</span><span class="p">.</span><span class="n">HistoryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tag_handler</span> <span class="o">=</span> <span class="n">tags</span><span class="p">.</span><span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ldda_manager</span> <span class="o">=</span> <span class="n">lddas</span><span class="p">.</span><span class="n">LDDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">UniverseApplication</code> creates a <code class="language-plaintext highlighter-rouge">DatasetCollectionManager</code> for the application and <code class="language-plaintext highlighter-rouge">DatasetCollectionManager</code> imports and annotates
the <code class="language-plaintext highlighter-rouge">UniverseApplication</code> as a requirement. This creates an unfortunate dependency loop.</p>

<p><strong>Dependencies should form a DAG (directed acyclic graph)</strong>.</p>

<hr />

<p><img src="../../images/app_types.plantuml.svg" alt="Big Interconnected App with Python 3 Types" /></p>

<hr />

<h2 id="why-an-interface">Why an Interface?</h2>

<p>Dependencies now closer to a DAG - <code class="language-plaintext highlighter-rouge">DatasetCollectionManager</code> no longer annotated with the type <code class="language-plaintext highlighter-rouge">UniverseApplication</code>! Imports are cleaner.</p>

<hr />

<h2 id="benefits-of-typing">Benefits of Typing</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatasetCollectionManager</span><span class="p">:</span>

     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">StructuredApp</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">DATASET_COLLECTION_TYPES_REGISTRY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">collection_type_descriptions</span> <span class="o">=</span> <span class="n">COLLECTION_TYPE_DESCRIPTION_FACTORY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">security</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">security</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">hda_manager</span> <span class="o">=</span> <span class="n">hdas</span><span class="p">.</span><span class="n">HDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">history_manager</span> <span class="o">=</span> <span class="n">histories</span><span class="p">.</span><span class="n">HistoryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tag_handler</span> <span class="o">=</span> <span class="n">tags</span><span class="p">.</span><span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ldda_manager</span> <span class="o">=</span> <span class="n">lddas</span><span class="p">.</span><span class="n">LDDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>mypy provides robust type checking.</li>
  <li>IDE can provide hints to make developing this class and usage of this class easier.</li>
</ul>

<hr />

<p>class: reduce90</p>

<h3 id="design-problems-with-handling-dependencies-directly">Design Problems with Handling Dependencies Directly</h3>

<p>Using app to construct a manager for dealing with dataset collections.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatasetCollectionManager</span><span class="p">:</span>

     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">StructuredApp</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">DATASET_COLLECTION_TYPES_REGISTRY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">collection_type_descriptions</span> <span class="o">=</span> <span class="n">COLLECTION_TYPE_DESCRIPTION_FACTORY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">security</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">security</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">hda_manager</span> <span class="o">=</span> <span class="n">hdas</span><span class="p">.</span><span class="n">HDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">history_manager</span> <span class="o">=</span> <span class="n">histories</span><span class="p">.</span><span class="n">HistoryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tag_handler</span> <span class="o">=</span> <span class="n">tags</span><span class="p">.</span><span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ldda_manager</span> <span class="o">=</span> <span class="n">lddas</span><span class="p">.</span><span class="n">LDDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>DatasetCollectionManager needs to know how to construct all the other managers it is using, not just their interface.</li>
  <li><code class="language-plaintext highlighter-rouge">app</code> has a instance of this class and <code class="language-plaintext highlighter-rouge">app</code> is used to construct and instance of this class - this circular dependency
chain results in brittleness and complexity in how to construct <code class="language-plaintext highlighter-rouge">app</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">app</code> is very big and we‚Äôre depending on a lot of it but not a large percent it. This makes typing less than ideal.</li>
</ul>

<hr />

<p>class: reduce90</p>

<h3 id="testing-problems-with-handling-dependencies-directly">Testing Problems with Handling Dependencies Directly</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatasetCollectionManager</span><span class="p">:</span>

     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">StructuredApp</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">DATASET_COLLECTION_TYPES_REGISTRY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">collection_type_descriptions</span> <span class="o">=</span> <span class="n">COLLECTION_TYPE_DESCRIPTION_FACTORY</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">security</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">security</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">hda_manager</span> <span class="o">=</span> <span class="n">hdas</span><span class="p">.</span><span class="n">HDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">history_manager</span> <span class="o">=</span> <span class="n">histories</span><span class="p">.</span><span class="n">HistoryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tag_handler</span> <span class="o">=</span> <span class="n">tags</span><span class="p">.</span><span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ldda_manager</span> <span class="o">=</span> <span class="n">lddas</span><span class="p">.</span><span class="n">LDDAManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Difficult to unit test properly
    <ul>
      <li>What parts of app are being used?</li>
      <li>How do we construct a smaller app with just those pieces?</li>
      <li>How do we stub out classes cleanly when we‚Äôre creating the dependent objects internally.</li>
    </ul>
  </li>
</ul>

<hr />

<p>class: reduce90</p>

<h3 id="design-benefits-of-injecting-dependencies">Design Benefits of Injecting Dependencies</h3>

<p>.code[```python
class DatasetCollectionManager:
    def <strong>init</strong>(
        self,
        model: GalaxyModelMapping,
        security: IdEncodingHelper,
        hda_manager: HDAManager,
        history_manager: HistoryManager,
        tag_handler: GalaxyTagHandler,
        ldda_manager: LDDAManager,
    ):
        self.type_registry = DATASET_COLLECTION_TYPES_REGISTRY
        self.collection_type_descriptions = COLLECTION_TYPE_DESCRIPTION_FACTORY
        self.model = model
        self.security = security</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.hda_manager = hda_manager
    self.history_manager = history_manager
    self.tag_handler = tag_handler
    self.ldda_manager = ldda_manager ```]
</code></pre></div></div>

<ul>
  <li>We‚Äôre no longer depending on <code class="language-plaintext highlighter-rouge">app</code>.</li>
  <li>The type signature very clearly delineates what dependencies are required.</li>
  <li>Unit testing can inject precise dependencies supplying only the behavior needed.</li>
</ul>

<hr />

<h3 id="constructing-the-object-is-still-brittle">Constructing the Object Is Still Brittle</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DatasetCollectionManager</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">security</span><span class="p">,</span>
    <span class="n">HDAManager</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
    <span class="n">HistoryManager</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
    <span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">),</span>
    <span class="n">LDDAManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>The complexity in ordering of construction of <code class="language-plaintext highlighter-rouge">app</code> is still challenging.</li>
  <li>The constructing code of this object still needs to know how to construct each dependency of the object.</li>
  <li>The constructing code of this object needs to explicitly import all the types.</li>
</ul>

<hr />

<p>class: enlarge150</p>

<h3 id="what-is-type-based-dependency-injection">What is Type-based Dependency Injection?</h3>

<p>A dependency injection <strong>container</strong> keeps tracks of singletons or recipes for how to construct each type. By
default when it goes to construct an object, it can just ask the container for each dependency based on the
type signature of the class being constructed.</p>

<p>If an object declares it consumes a dependency of type <code class="language-plaintext highlighter-rouge">X</code> (e.g. <code class="language-plaintext highlighter-rouge">HDAManager</code>), just query the container
recursively for an object of type <code class="language-plaintext highlighter-rouge">X</code>.</p>

<hr />

<h3 id="what-happens-to-object-construction">What happens to object construction?</h3>

<p>Once all the dependencies have been type annotated properly and the needed singletons have been configured.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dcm</span> <span class="o">=</span> <span class="n">DatasetCollectionManager</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">security</span><span class="p">,</span>
    <span class="n">HDAManager</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
    <span class="n">HistoryManager</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
    <span class="n">GalaxyTagHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">context</span><span class="p">),</span>
    <span class="n">LDDAManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>becomes</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dcm</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="n">DatasetCollectionManager</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<p>class: enlarge150</p>

<h3 id="picking-a-library">Picking a Library</h3>

<p>Many of the existing DI libraries for Python predate widespread Python 3 and don‚Äôt readily infer things based on types.
The benefits of typing and DI are both enhanced by the other - so it was important to pick one that could do type-based
injection.</p>

<p>We went with Lagom, but we‚Äôve built abstractions that would make it very easy to switch.</p>

<hr />

<h3 id="lagom">Lagom</h3>

<p><img src="../../images/lagom_ss.png" alt="Lagom Website" /></p>

<p>https://lagom-di.readthedocs.io/en/latest/</p>

<hr />

<h3 id="di-and-controllers---fastapi">DI and Controllers - FastAPI</h3>

<p>FastAPI controllers allowed some basic dependency injection.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_tags_manager</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TagsManager</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TagsManager</span><span class="p">()</span>


<span class="o">@</span><span class="n">cbv</span><span class="p">(</span><span class="n">router</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FastAPITags</span><span class="p">:</span>
    <span class="n">manager</span><span class="p">:</span> <span class="n">TagsManager</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_tags_manager</span><span class="p">)</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>Dependency injection allows for type checking but doesn‚Äôt use type inference (requires factory functions, etc..)</p>

<p>https://fastapi.tiangolo.com/tutorial/dependencies/</p>

<hr />

<h3 id="di-and-controllers---fastapi-limitations">DI and Controllers - FastAPI Limitations</h3>

<p>Also we have two different controller styles and only the new FastAPI allowed dependency injection.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_tags_manager</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TagsManager</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TagsManager</span><span class="p">()</span>


<span class="o">@</span><span class="n">cbv</span><span class="p">(</span><span class="n">router</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FastAPITags</span><span class="p">:</span>
    <span class="n">manager</span><span class="p">:</span> <span class="n">TagsManager</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_tags_manager</span><span class="p">)</span>
    <span class="p">...</span>

<span class="k">class</span> <span class="nc">TagsController</span><span class="p">(</span><span class="n">BaseAPIController</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">TagsManager</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<p>class: reduce90</p>

<h3 id="di-and-controllers---unified-approach">DI and Controllers - Unified Approach</h3>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-def get_tags_manager() -&gt; TagsManager:
-    return TagsManager()
-
-
</span> @cbv(router)
 class FastAPITags:
<span class="gd">-    manager: TagsManager = Depends(get_tags_manager)
</span><span class="gi">+    manager: TagsManager = depends(TagsManager)
</span>
     @router.put(
         '/api/tags',
<span class="p">@@ -58,11 +54,8 @@</span> def update(
         self.manager.update(trans, payload)


<span class="gd">-class TagsController(BaseAPIController):
-
-    def __init__(self, app):
-        super().__init__(app)
-        self.manager = TagsManager()
</span><span class="gi">+class TagsController(BaseGalaxyAPIController):
+    manager: TagsManager = depends(TagsManager)
</span></code></pre></div></div>

<p>Building dependency injection into our application and not relying on FastAPI allows for dependency injection that is <em>less verbose</em>, available uniformly across the application,
<em>works for the legacy controllers identically</em>.</p>

<hr />

<h3 id="di-and-tasks---framework">DI and Tasks - Framework</h3>

<p>From <code class="language-plaintext highlighter-rouge">lib/galaxy/celery/tasks.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lagom</span> <span class="kn">import</span> <span class="n">magic_bind_to_container</span>
<span class="p">...</span>

<span class="k">def</span> <span class="nf">galaxy_task</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">CELERY_TASKS</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">get_galaxy_app</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">app</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">magic_bind_to_container</span><span class="p">(</span><span class="n">app</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">magic_bind_to_container</code> to binds function parameters to a specified Lagom DI container automatically.</p>

<hr />

<h3 id="di-and-tasks---examples">DI and Tasks - Examples</h3>

<p>From <code class="language-plaintext highlighter-rouge">lib/galaxy/celery/tasks.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">celery_app</span><span class="p">.</span><span class="n">task</span><span class="p">(</span><span class="n">ignore_result</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">@</span><span class="n">galaxy_task</span>
<span class="k">def</span> <span class="nf">purge_hda</span><span class="p">(</span><span class="n">hda_manager</span><span class="p">:</span> <span class="n">HDAManager</span><span class="p">,</span> <span class="n">hda_id</span><span class="p">):</span>
    <span class="n">hda</span> <span class="o">=</span> <span class="n">hda_manager</span><span class="p">.</span><span class="n">by_id</span><span class="p">(</span><span class="n">hda_id</span><span class="p">)</span>
    <span class="n">hda_manager</span><span class="p">.</span><span class="n">_purge</span><span class="p">(</span><span class="n">hda</span><span class="p">)</span>


<span class="o">@</span><span class="n">celery_app</span><span class="p">.</span><span class="n">task</span>
<span class="o">@</span><span class="n">galaxy_task</span>
<span class="k">def</span> <span class="nf">set_metadata</span><span class="p">(</span><span class="n">hda_manager</span><span class="p">:</span> <span class="n">HDAManager</span><span class="p">,</span> <span class="n">ldda_manager</span><span class="p">:</span> <span class="n">LDDAManager</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">model_class</span><span class="o">=</span><span class="s">'HistoryDatasetAssociation'</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">model_class</span> <span class="o">==</span> <span class="s">'HistoryDatasetAssociation'</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">hda_manager</span><span class="p">.</span><span class="n">by_id</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_class</span> <span class="o">==</span> <span class="s">'LibraryDatasetDatasetAssociation'</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ldda_manager</span><span class="p">.</span><span class="n">by_id</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
    <span class="n">dataset</span><span class="p">.</span><span class="n">datatype</span><span class="p">.</span><span class="n">set_meta</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p><img src="../../images/app_decomposed.plantuml.svg" alt="Decomposed App" /></p>

<hr />

<h3 id="tips-for-designing-new-galaxy-backend-components">Tips for Designing New Galaxy Backend Components</h3>

<ul>
  <li>Consume only the related components you need to avoid <code class="language-plaintext highlighter-rouge">app</code> when possible.</li>
  <li>Annotate inputs to the component with Python types.</li>
  <li>Use interface types to shield consumers from implementation details.</li>
  <li>Rely on Galaxy‚Äôs dependency injection to construct the component and provide it to consumers.</li>
</ul>

<hr />

<h2 id="application-components---models-and-managers">Application Components - Models and Managers</h2>

<p><em>The architecture surrounding Galaxy components.</em></p>

<hr />

<p><img src="../../images/wsgi_app.plantuml.svg" alt="This section will talk about that manager layer and what lies below" /></p>

<hr />

<p>There are many ways to describe and visualize the Galaxy server architecture,
one is to imagine the Galaxy database as the ultimate source for Galaxy ‚Äústuff‚Äù
and the API controllers as the ultimate sink.</p>

<p>In this architecture imagining of Galaxy, managers are the layer meant to
mediate all controller interactions (and isolate the backend from the web
framework) while the model layer is meant to mediate all database interactions
(and isolate the backend from database internals).</p>

<hr />

<p><img src="../../images/core_models_managers.plantuml.svg" alt="Models and Managers" /></p>

<hr />

<h3 id="managers">Managers</h3>

<p>High-level business logic that ties all of these components together.</p>

<p>Controllers should ideally be thin wrappers around actions defined in managers.</p>

<p>Whenever a model requires more than just the database, the operation should be defined
in a manager instead of in the model.</p>

<hr />

<h3 id="managers---some-key-files">Managers - Some Key Files</h3>

<p><img src="../../images/core_files_managers.plantuml.svg" alt="Key Managers" /></p>

<hr />

<h3 id="managers---some-helpers">Managers - Some Helpers</h3>

<p><img src="../../images/core_files_managers_helpers.plantuml.svg" alt="Manager Helpers" /></p>

<hr />

<h3 id="galaxy-models">Galaxy Models</h3>

<ul>
  <li>Database interactions powered by SQLAlchemy - https://www.sqlalchemy.org/.</li>
  <li>Galaxy doesn‚Äôt think in terms of ‚Äúrows‚Äù but ‚Äúobjects‚Äù.</li>
  <li>Classes for Galaxy model objects in <code class="language-plaintext highlighter-rouge">lib/galaxy/model/__init__.py</code>.</li>
  <li>Classes mapped to tables in <code class="language-plaintext highlighter-rouge">lib/galaxy/model/mapping.py</code>
    <ul>
      <li>Describes table definitions and relationships.</li>
    </ul>
  </li>
</ul>

<hr />

<p><img src="../../images/sqla_arch_small.png" alt="SQLAlchemy Architecture" /></p>

<hr />

<h3 id="galaxy-model-migrations">Galaxy Model Migrations</h3>

<ul>
  <li>A migration describes a linear list of database ‚Äúdiff‚Äùs to
end up with the current Galaxy model.</li>
  <li>Allow the schema to be migrated forward automatically.</li>
  <li>Powered by sqlalchemy-migrate - https://sqlalchemy-migrate.readthedocs.io/en/latest/.</li>
  <li>Each file in <code class="language-plaintext highlighter-rouge">lib/galaxy/model/migrate/versions/</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">0124_job_state_history.py</code></li>
      <li><code class="language-plaintext highlighter-rouge">0125_workflow_step_tracking.py</code></li>
      <li><code class="language-plaintext highlighter-rouge">0126_password_reset.py</code></li>
    </ul>
  </li>
</ul>

<hr />

<p><img src="../../images/galaxy_schema.png" alt="Galaxy Schema" /></p>

<h3 id="database-diagram">Database Diagram</h3>

<p>https://galaxyproject.org/admin/internals/data-model/</p>

<hr />

<p><img src="../../images/hda.svg" alt="HDA" /></p>

<hr />

<p><img src="../../images/hda_dataset.plantuml.svg" alt="HDA Dataset" /></p>

<hr />

<h3 id="dataset-metadata">Dataset Metadata</h3>

<ul>
  <li>Typed key-value pairs attached to HDA.</li>
  <li>Keys and types defined at the datatype level.</li>
  <li>Can be used by tools to dynamically control the tool form.</li>
</ul>

<p><span>Speaker Notes</span></p>

<hr />

<p><img src="../../images/hda_hdca.plantuml.svg" alt="HDAs and HDCAs" /></p>

<hr />

<p><img src="../../images/workflow_definition.svg" alt="Workflows" /></p>

<hr />

<p><img src="../../images/workflow_run.svg" alt="Workflow Running" /></p>

<hr />

<p><img src="../../images/libraries.svg" alt="Libraries" /></p>

<hr />

<p><img src="../../images/library_permissions.svg" alt="Library Permissions" /></p>

<hr />

<h2 id="application-components---plugins">Application Components - Plugins</h2>

<p><em>The architecture of pluggable Galaxy components.</em></p>

<hr />

<p><img src="../../images/core_models_managers.plantuml.svg" alt="Models and Managers" /></p>

<hr />

<h3 id="plugins-all-the-way-down">Plugins All the Way Down</h3>

<p><img src="../../images/core_plugins_overview.plantuml.svg" alt="Plugins" /></p>

<hr />

<h4 id="datatypes">Datatypes</h4>

<p><img src="../../images/core_files_datatypes.plantuml.svg" alt="Datatype Files" /></p>

<p>Developer docs on adding new datatypes can be found at https://docs.galaxyproject.org/en/latest/dev/data_types.html.</p>

<hr />

<h4 id="tools">Tools</h4>

<p><img src="../../images/core_toolbox_classes.plantuml.svg" alt="ToolBox Classes" /></p>

<p>Three major classes can be summarized as - the <code class="language-plaintext highlighter-rouge">ToolBox</code> contains <code class="language-plaintext highlighter-rouge">Tool</code> objects
that execute a <code class="language-plaintext highlighter-rouge">ToolAction</code>.</p>

<hr />

<h4 id="subclasses-of-tool">Subclasses of Tool</h4>

<p><img src="../../images/core_tool_classes.plantuml.svg" alt="Tool Classes" /></p>

<hr />

<p><img src="../../images/core_tool_sequence.plantuml.svg" alt="Running Tools" /></p>

<hr />

<h3 id="a-little-about-jobs">A Little About Jobs</h3>

<ul>
  <li>Job is placed into the database and picked up by the job handler.</li>
  <li>Job handler (<code class="language-plaintext highlighter-rouge">JobHandler</code>) watches the job and transitions job‚Äôs state - common startup and finishing.</li>
  <li>Job mapper (<code class="language-plaintext highlighter-rouge">JobRunnerMapper</code>) decides the ‚Äúdestination‚Äù for a job.</li>
  <li>Job runner (e.g. <code class="language-plaintext highlighter-rouge">DrammaJobRunner</code>) actual runs the job and provides an interface for checking status.</li>
</ul>

<hr />

<h3 id="job-runners">Job Runners</h3>

<p><img src="../../images/core_runner_classes.plantuml.svg" alt="Job Runners" /></p>

<hr />

<p><img src="../../images/core_jobs_sequence.plantuml.svg" alt="Handling Jobs" /></p>

<hr />

<p><img src="../../images/data_managers.svg" alt="Data Managers" /></p>

<hr />

<h3 id="visualization-plugins">Visualization Plugins</h3>

<p>Adding new visualizations to a Galaxy instance</p>

<ul>
  <li>Configuration file (XML)</li>
  <li>Base template (Mako or JavaScript)</li>
  <li>Additional static data if needed (CSS, JS, ‚Ä¶)</li>
</ul>

<p>.footnote[<a href="/training-material/topics/dev/tutorials/visualization-generic/slides.html">Learn more about it with our visualization tutorial.</a>]</p>

<hr />

<p>class: reduce70</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE visualization SYSTEM "../../visualization.dtd"&gt;</span>
<span class="nt">&lt;visualization</span> <span class="na">name=</span><span class="s">"ChiRAViz"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;description&gt;</span>ChiRAViz<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;data_sources&gt;</span>
        <span class="nt">&lt;data_source&gt;</span>
           <span class="nt">&lt;model_class&gt;</span>HistoryDatasetAssociation<span class="nt">&lt;/model_class&gt;</span>
           <span class="nt">&lt;test</span> <span class="na">type=</span><span class="s">"isinstance"</span> <span class="na">test_attr=</span><span class="s">"datatype"</span> <span class="na">result_type=</span><span class="s">"datatype"</span><span class="nt">&gt;</span>binary.ChiraSQLite<span class="nt">&lt;/test&gt;</span>
            <span class="nt">&lt;to_param</span> <span class="na">param_attr=</span><span class="s">"id"</span><span class="nt">&gt;</span>dataset_id<span class="nt">&lt;/to_param&gt;</span>
        <span class="nt">&lt;/data_source&gt;</span>
    <span class="nt">&lt;/data_sources&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">type=</span><span class="s">"dataset"</span> <span class="na">var_name_in_template=</span><span class="s">"hda"</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>dataset_id<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
    <span class="nt">&lt;template&gt;</span>chiraviz.mako<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/visualization&gt;</span>
</code></pre></div></div>

<hr />

<p>template: left-aligned</p>

<h3 id="visualization-examples">Visualization Examples</h3>

<p>All in <code class="language-plaintext highlighter-rouge">config/plugins/visualizations</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">chiraviz</code> - Latest addition mid-2020, demonstrates current state of the art building and packing. <a href="https://github.com/galaxyproject/galaxy/pull/9562">#9562</a></li>
  <li><code class="language-plaintext highlighter-rouge">csg</code> - Chemical structure viewer</li>
  <li><code class="language-plaintext highlighter-rouge">graphviz</code> - Visualize graph data using <a href="http://www.cytoscape.org/">cytoscape.js</a></li>
  <li><code class="language-plaintext highlighter-rouge">charts</code> - Classic charts as well as some integrated BioJS visualizations</li>
  <li><code class="language-plaintext highlighter-rouge">trackster</code> - Genome browser, deeply tied to Galaxy internals.</li>
</ul>

<hr />

<h3 id="data-providers">Data Providers</h3>

<p>Provide efficient access to data for viz &amp; API</p>

<p>Framework provides direct link to read the raw dataset
or use data providers to adapt it</p>

<p>In config, assert that visualization requires a given type of data providers</p>

<p>Data providers process data before sending to browser - slice, filter, reformat, ‚Ä¶</p>

<hr />

<h3 id="interactive-environments">Interactive Environments</h3>

<p>Similar to visualizations: config and template</p>

<p>Within the base template, launch a Docker container running a web accessible
process</p>

<p>Build a UI that accesses that process through a proxy</p>

<p>.footnote[<a href="/training-material/topics/dev/tutorials/interactive-environments/slides.html">Learn more about it with our IE tutorial.</a>]</p>

<hr />

<p>template: left-aligned</p>

<h3 id="interactive-environments---examples">Interactive Environments - Examples</h3>

<p>All in <code class="language-plaintext highlighter-rouge">config/plugins/interactive_environments</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jupyter</code></li>
  <li><code class="language-plaintext highlighter-rouge">rstudio</code></li>
  <li><code class="language-plaintext highlighter-rouge">phinch</code></li>
  <li><code class="language-plaintext highlighter-rouge">bam_iobio</code></li>
</ul>

<hr />

<h3 id="object-store">Object Store</h3>

<p>.strike[```python</p>
<blockquote>
  <blockquote>
    <blockquote>
      <p>fh = open(dataset.file_path, ‚Äòw‚Äô)
fh.write(‚Äòfoo‚Äô)
fh.close()
fh = open(dataset.file_path, ‚Äòr‚Äô)
fh.read()
```]</p>
    </blockquote>
  </blockquote>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="p">.</span><span class="n">objectstore</span><span class="p">.</span><span class="n">update_from_file</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="err">‚Äò</span><span class="n">foo</span><span class="p">.</span><span class="n">txt</span><span class="err">‚Äô</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="p">.</span><span class="n">objectstore</span><span class="p">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="p">.</span><span class="n">objectstore</span><span class="p">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p><img src="../../images/objectstore.plantuml.svg" alt="Object Store" /></p>

<p>These implementation are found below <code class="language-plaintext highlighter-rouge">lib/galaxy/objectstore/</code>.</p>

<hr />

<p><img src="../../images/core_file_sources.plantuml.svg" alt="File Source Plugins" /></p>

<hr />

<h1 id="filesources-vs-objectstores">FileSources vs ObjectStores</h1>

<p>ObjectStores provide datasets not files, the files are organized logically in a very flat way around a dataset.</p>

<p>FilesSources instead provide files and directories, not datasets. A FilesSource is meant to be browsed in hierarchical fashion - and also has no concept of extra files, etc..
The former is assumed to be persistent, the latter makes no such assumption.</p>

<hr />

<p>More information about File source plugins can be found at http://bit.ly/gcc21files</p>

<hr />

<h4 id="workflow-modules">Workflow Modules</h4>

<p><img src="../../images/core_workflow_modules.plantuml.svg" alt="Workflow Modules" /></p>

<p>All these modules are found in <code class="language-plaintext highlighter-rouge">lib/galaxy/workflow/modules.py</code>.</p>

<hr />

<h4 id="libgalaxyutilplugin_configpy"><code class="language-plaintext highlighter-rouge">lib/galaxy/util/plugin_config.py</code></h4>

<p>Standardized way to load both a set of possible plugin class implementations
from a directory of Python files and to parse either an XML or YAML/JSON
description of configured plugins.</p>

<hr />

<h4 id="libgalaxyutilplugin_configpy-example-files"><code class="language-plaintext highlighter-rouge">lib/galaxy/util/plugin_config.py</code> Example Files</h4>

<p><img src="../../images/core_files_plugin_example.plantuml.svg" alt="Workflow Modules" /></p>

<hr />

<h4 id="libgalaxyutilplugin_configpy-plugin-implementations"><code class="language-plaintext highlighter-rouge">lib/galaxy/util/plugin_config.py</code> Plugin Implementations</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plugins_dict</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">plugin_type_identifier</span><span class="p">):</span>
    <span class="n">plugin_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">plugin_module</span> <span class="ow">in</span> <span class="n">import_submodules</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="n">__plugin_classes_in_module</span><span class="p">(</span><span class="n">plugin_module</span><span class="p">):</span>
            <span class="n">plugin_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">plugin_type_identifier</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plugin_type</span><span class="p">:</span>
                <span class="n">plugin_dict</span><span class="p">[</span><span class="n">plugin_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">clazz</span>

    <span class="k">return</span> <span class="n">plugin_dict</span>
</code></pre></div></div>

<hr />

<h4 id="pieces-of-libgalaxytool_utildepscontainerspy">Pieces of <code class="language-plaintext highlighter-rouge">lib/galaxy/tool_util/deps/containers.py</code></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ContainerRegistry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_info</span><span class="p">,</span> <span class="n">mulled_resolution_cache</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">resolver_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__resolvers_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">app_info</span> <span class="o">=</span> <span class="n">app_info</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">container_resolvers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__build_container_resolvers</span><span class="p">(</span><span class="n">app_info</span><span class="p">)</span>
        <span class="c1"># ... other stuff here
</span>
    <span class="k">def</span> <span class="nf">__build_container_resolvers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_info</span><span class="p">):</span>
        <span class="n">conf_file</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app_info</span><span class="p">,</span> <span class="s">'containers_resolvers_config_file'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">plugin_source</span> <span class="o">=</span> <span class="n">plugin_config</span><span class="p">.</span><span class="n">plugin_source_from_path</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_parse_resolver_conf</span><span class="p">(</span><span class="n">plugin_source</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_resolver_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin_source</span><span class="p">):</span>
        <span class="n">extra_kwds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'app_info'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">app_info</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">plugin_config</span><span class="p">.</span><span class="n">load_plugins</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">resolver_classes</span><span class="p">,</span> <span class="n">plugin_source</span><span class="p">,</span> <span class="n">extra_kwds</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__resolvers_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">galaxy.tool_util.deps.container_resolvers</span>
        <span class="k">return</span> <span class="n">plugin_config</span><span class="p">.</span><span class="n">plugins_dict</span><span class="p">(</span>
            <span class="n">galaxy</span><span class="p">.</span><span class="n">tool_util</span><span class="p">.</span><span class="n">deps</span><span class="p">.</span><span class="n">container_resolvers</span><span class="p">,</span>
            <span class="s">'resolver_type'</span>
        <span class="p">)</span>
</code></pre></div></div>

<hr />

<h4 id="pieces-of-libgalaxytool_utildepscontainer_resolversmulledpy">Pieces of <code class="language-plaintext highlighter-rouge">lib/galaxy/tool_util/deps/container_resolvers/mulled.py</code></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CachedMulledDockerContainerResolver</span><span class="p">(</span><span class="n">ContainerResolver</span><span class="p">):</span>

<span class="n">resolver_type</span> <span class="o">=</span> <span class="s">"cached_mulled"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_info</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">"biocontainers"</span><span class="p">,</span> <span class="n">hash_func</span><span class="o">=</span><span class="s">"v2"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CachedMulledDockerContainerResolver</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">(</span><span class="n">app_info</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">hash_func</span> <span class="o">=</span> <span class="n">hash_func</span>

    <span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled_container_types</span><span class="p">,</span> <span class="n">tool_info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># ... do the magic with configured plugin
</span></code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">container_resolvers_conf.xml</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;container_resolvers&gt;</span>
  <span class="nt">&lt;cached_mulled</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;cached_mulled</span> <span class="na">namespace=</span><span class="s">"mycustom"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/container_resolvers&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">container_resolvers_conf.yml</code></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">resolver_type</span><span class="pi">:</span> <span class="s">cached_mulled</span>
<span class="pi">-</span> <span class="na">resolver_type</span><span class="pi">:</span> <span class="s">cached_mulled</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">mycustom</span>
</code></pre></div></div>

<hr />

<h2 id="client-architecture">Client Architecture</h2>

<p><em>The architecture of Galaxy‚Äôs web user interface.</em></p>

<hr />

<p>template: left-aligned</p>

<h3 id="client-directories">Client Directories</h3>

<ul>
  <li>Source JavaScript for the client is in <code class="language-plaintext highlighter-rouge">client/src</code>.</li>
  <li>Source stylesheets are in <code class="language-plaintext highlighter-rouge">client/src/style</code>.</li>
  <li>‚ÄúPacked‚Äù bundles served by Galaxy stored in <code class="language-plaintext highlighter-rouge">static/dist</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">run.sh</code> uses <code class="language-plaintext highlighter-rouge">git diff</code> to try to determine if client needs to be built before starting Galaxy</li>
      <li>webpack builds these ‚Äúcompiled‚Äù artifacts</li>
    </ul>
  </li>
</ul>

<p>Upshot - to develop against the client, modify files in <code class="language-plaintext highlighter-rouge">client/</code> and rebuild with <code class="language-plaintext highlighter-rouge">make client</code> before
deployment.</p>

<hr />

<p>class: normal</p>

<h3 id="building-the-client---makefile-targets">Building the Client - Makefile Targets</h3>

<pre><code class="language-Makefile">client: node-deps ## Rebuild all client-side artifacts (for local dev)
  cd client &amp;&amp; yarn run build

client-production-maps: node-deps ## Build optimized artifacts with sourcemaps.
  cd client &amp;&amp; yarn run build-production-maps

client-watch: node-deps ## Rebuild client on each change.
  cd client &amp;&amp; yarn run watch

client-format: node-deps ## Reformat client code
  cd client &amp;&amp; yarn run prettier

client-lint: client-eslint client-format-check ## ES lint and check format of client

client-test: node-deps  ## Run JS unit tests
  cd client &amp;&amp; yarn run test

client-test-watch: client ## Watch and run all client unit tests on changes
  cd client &amp;&amp; yarn run jest-watch

node-deps: ## Install NodeJS and dependencies.
</code></pre>

<hr />

<h3 id="automatically-reloading-during-development">Automatically Reloading During Development</h3>

<p>The following command rebuilds the application on each change.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make client-watch
</code></pre></div></div>

<p>This is still a relatively slow process, an extra client development server can be started that proxies non-client requests
to your Galaxy server and selectively reloads only what is needed during active development (hot module replacement or HMR).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make client-dev-server
</code></pre></div></div>

<p>Make sure to open Galaxy at http://localhost:8081 instead to point at the client proxy.</p>

<hr />

<p>class: white
<img src="../../images/what-is-webpack.svg" alt="What is Webpack" /></p>

<hr />

<p>class: enlarge150</p>

<h3 id="webpack-in-galaxy">webpack in Galaxy</h3>

<p>Packs and ‚Äútranspiles‚Äù Galaxy ES6 code (.js), Galaxy Vue modules (.vue), libraries from npm, scss stylesheets (.scss) into browser native bundles.</p>

<p>Hundreds of high-level well organized files into optimized single files that can be quickly downloaded.</p>

<p>Lots of active development and complexity around Viz plugins and dependencies for instance, but the webpack configuration file in <code class="language-plaintext highlighter-rouge">config/webpack.config.js</code> is fairly straightforward.</p>

<hr />

<p>class: white
<img src="../../images/jsload.png" alt="Webpack in Action" /></p>

<hr />

<h3 id="stylesheets">Stylesheets</h3>

<ul>
  <li>Galaxy shared stylesheets are generally defined using the SCSS syntax</li>
  <li>SCSS is a high-level superset of CSS - https://sass-lang.com/documentation/syntax</li>
  <li><code class="language-plaintext highlighter-rouge">sass</code> is leveraged by webpack to convert these styles to native CSS at client build time</li>
  <li>Rebuild style with <code class="language-plaintext highlighter-rouge">make style</code></li>
  <li>Galaxy‚Äôs SCSS files can be found in <code class="language-plaintext highlighter-rouge">client/src/style/scss/</code></li>
</ul>

<hr />

<h3 id="package-and-build-files">Package and Build Files</h3>

<p><img src="../../images/core_files_client_build.plantuml.svg" alt="Client Build Files" /></p>

<hr />

<h3 id="source-files">Source Files</h3>

<p><img src="../../images/core_files_client_sources.plantuml.svg" alt="Client Build Files" /></p>

<hr />

<h3 id="es6">ES6</h3>

<p>The client is built from JavaScript source files. We use ES6 JavaScript.</p>

<p>A tutorial to help learn JavaScript generally might be https://www.w3schools.com/js/.</p>

<p>For someone familiar with JavaScript but that wants a primer on the new language features in ES6,
https://www.w3schools.com/js/js_es6.asp may be more appropriate.</p>

<hr />

<h3 id="vue">Vue</h3>

<p>Vue.js is a reactive framework for building web client applications.</p>

<p>We chose Vue.js over React initially because of its focus on allowing developers to incrementally or progressively replace pieces of complex existing applications.</p>

<p>The idea behind Vue.js is fairly simple to pick up and there is a lot of great tutorials and videos available. https://vuejs.org/v2/guide/ is a really good jumping off point.</p>

<hr />

<h3 id="vuex">Vuex</h3>

<blockquote>
  <p>Vuex is a state management pattern + library for Vue.js applications. It serves as a centralized store for all the components in an application, with rules ensuring that the state can only be mutated in a predictable fashion.</p>
</blockquote>

<p>https://vuex.vuejs.org/</p>

<hr />

<h3 id="client-unit-tests">Client Unit Tests</h3>

<p>https://jestjs.io/</p>

<p>Configured in <code class="language-plaintext highlighter-rouge">client/src/jest/jest.config.js</code>.</p>

<p>Vue tests are placed beside components in <code class="language-plaintext highlighter-rouge">client/src</code>, more tests in <code class="language-plaintext highlighter-rouge">client/test/qunit/tests</code> and <code class="language-plaintext highlighter-rouge">client/test/jest/standalone/</code>.</p>

<hr />

<h3 id="vue-test-utils">Vue Test Utils</h3>

<blockquote>
  <p>Vue Test Utils is the official unit testing utility library for Vue.js.</p>
</blockquote>

<p>https://vue-test-utils.vuejs.org/</p>

<p>Really nice reference library documentation. A lot of helpers and concepts to unit test Vue components.</p>

<hr />

<h3 id="client-unit-test-design-tips">Client Unit Test Design Tips</h3>

<p>https://github.com/galaxyproject/galaxy/tree/dev/client/docs/src/component-design/unit-testing</p>

<ul>
  <li>Clearly document the intent of your test</li>
  <li>Implement logic in pure functions when possible</li>
  <li>Wrap native browser resources in a function so they can be easily mocked</li>
</ul>

<hr />

<h3 id="webhooks-in-galaxy">Webhooks in Galaxy</h3>

<p>Webhooks is a system in Galaxy which can be used to write small JS and/or Python functions to change predefined locations in the Galaxy client.
<br /><br />
In short: A plugin infrastructure for the Galaxy UI</p>

<p>.footnote[You can learn more about webhooks using our webhook <a href="/training-material/topics/dev/tutorials/webhooks/slides.html">training</a>.]</p>

<hr />

<h3 id="webhook-masthead-example">Webhook masthead example</h3>

<p><img src="../../images/webhook_masthead.png" alt="A person shaped icon in the Galaxy masthead is being hovered over and the popup reads &quot;Show Username&quot;, presumably a custom webhook from a tutorial." /></p>

<p>At the header menu: Enabling the overlay search, link to communities ‚Ä¶</p>

<p>.footnote[You can learn more about webhooks using our webhook <a href="/training-material/topics/dev/tutorials/webhooks/slides.html">training</a>.]</p>

<hr />

<h3 id="webhook-toolworkflow-example">Webhook tool/workflow example</h3>

<p><img src="../../images/webhook_tool.png" alt="Screenshot of Galaxy with the job completion screen shown and a PhD comic image shown below." /></p>

<p>Shown after tool or workflow execution. Comics, citations, support ‚Ä¶</p>

<p>.footnote[You can learn more about webhooks using our webhook <a href="/training-material/topics/dev/tutorials/webhooks/slides.html">training</a>.]</p>

<hr />

<h3 id="webhook-history-menu-example">Webhook history-menu example</h3>

<p><img src="../../images/webhook_history.png" alt="A section of the history menu is labelled Webhooks and shows a custom menu entry." /></p>

<p>Adds an entry to the history menu - no functionality as of now</p>

<p>.footnote[You can learn more about webhooks using our webhook <a href="/training-material/topics/dev/tutorials/webhooks/slides.html">training</a>.]</p>

<hr />

<h2 id="dependencies">Dependencies</h2>

<hr />

<p>template: left-aligned</p>

<h3 id="dependencies---python">Dependencies - Python</h3>

<p><code class="language-plaintext highlighter-rouge">script/common_startup.sh</code> sets up a <code class="language-plaintext highlighter-rouge">virtualenv</code> with required dependencies in <code class="language-plaintext highlighter-rouge">$GALAXY_ROOT/.venv</code> (or <code class="language-plaintext highlighter-rouge">$GALAXY_VIRTUAL_ENV</code> if set).</p>

<ul>
  <li>Check for existing virtual environment, if it doesn‚Äôt exist check for <code class="language-plaintext highlighter-rouge">virtualenv</code>.</li>
  <li>If <code class="language-plaintext highlighter-rouge">virtualenv</code> exists, use it. Otherwise download it as a script and setup a virtual environment using it.</li>
  <li><code class="language-plaintext highlighter-rouge">. "$GALAXY_VIRTUAL_ENV/bin/activate"</code></li>
  <li>Upgrade to latest <code class="language-plaintext highlighter-rouge">pip</code> to allow use of binary wheels.</li>
  <li><code class="language-plaintext highlighter-rouge">pip install -r requirements.txt --index-url https://wheels.galaxyproject.org/simple</code></li>
  <li>Install dozens of dependencies.</li>
</ul>

<hr />

<p>template: left-aligned</p>

<h3 id="dependencies---javascript">Dependencies - JavaScript</h3>

<ul>
  <li>Dependencies are defined in <code class="language-plaintext highlighter-rouge">client/package.json</code>.</li>
  <li>These are fetched from npm and compiled into bundles as part of <code class="language-plaintext highlighter-rouge">make client</code> and related <code class="language-plaintext highlighter-rouge">Makefile</code> targets.</li>
</ul>

<hr />

<h2 id="galaxy-startup-process">Galaxy Startup Process</h2>

<hr />

<h3 id="cloning-galaxy">Cloning Galaxy</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/galaxyproject/galaxy.git galaxy
Cloning into <span class="s1">'galaxy'</span>...
remote: Counting objects: 173809, <span class="k">done</span><span class="nb">.</span>
remote: Total 173809 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 173809
Receiving objects: 100% <span class="o">(</span>173809/173809<span class="o">)</span>, 55.18 MiB | 11.08 MiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>137885/137885<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
Checking connectivity... <span class="k">done</span><span class="nb">.</span>
<span class="nv">$ </span><span class="nb">cd </span>galaxy
<span class="nv">$ </span>git checkout <span class="nt">-b</span> master origin/master
Branch master <span class="nb">set </span>up to track remote branch master from origin.
Switched to a new branch <span class="s1">'master'</span>
<span class="nv">$ </span>sh run.sh
</code></pre></div></div>

<hr />

<p>class: reduce90</p>

<h3 id="copying-configs">Copying Configs</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sh run.sh
Initializing config/migrated_tools_conf.xml from migrated_tools_conf.xml.sample
Initializing config/shed_tool_conf.xml from shed_tool_conf.xml.sample
Initializing config/shed_tool_data_table_conf.xml from shed_tool_data_table_conf.xml.sample
Initializing config/shed_data_manager_conf.xml from shed_data_manager_conf.xml.sample
Initializing tool-data/shared/ucsc/builds.txt from builds.txt.sample
Initializing tool-data/shared/ucsc/manual_builds.txt from manual_builds.txt.sample
Initializing tool-data/shared/ucsc/ucsc_build_sites.txt from ucsc_build_sites.txt.sample
Initializing tool-data/shared/igv/igv_build_sites.txt from igv_build_sites.txt.sample
Initializing tool-data/shared/rviewer/rviewer_build_sites.txt from rviewer_build_sites.txt.sample
Initializing static/welcome.html from welcome.html.sample
</code></pre></div></div>

<hr />

<h3 id="setting-up-venv-and-pip">Setting up <code class="language-plaintext highlighter-rouge">.venv</code> and <code class="language-plaintext highlighter-rouge">pip</code></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Using real prefix '/usr'
New python executable in .venv/bin/python
Installing setuptools, pip, wheel...done.
Activating virtualenv at .venv
Collecting pip&gt;=8.1
  Using cached pip-8.1.2-py2.py3-none-any.whl
Installing collected packages: pip
  Found existing installation: pip 7.1.2
    Uninstalling pip-7.1.2:
      Successfully uninstalled pip-7.1.2
Successfully installed pip-8.1.2
</code></pre></div></div>

<hr />

<p>class: reduce70</p>

<h3 id="installing-dependencies">Installing Dependencies</h3>

<p>.code[```
Collecting bx-python==0.7.3 (from -r requirements.txt (line 2))
  Downloading https://wheels.galaxyproject.org/packages/bx_python-0.7.3-cp27-cp27mu-manylinux1_x86_64.whl (2.1MB)
Collecting MarkupSafe==0.23 (from -r requirements.txt (line 3))
  Downloading https://wheels.galaxyproject.org/packages/MarkupSafe-0.23-cp27-cp27mu-manylinux1_x86_64.whl
Collecting PyYAML==3.11 (from -r requirements.txt (line 4))
  Downloading https://wheels.galaxyproject.org/packages/PyYAML-3.11-cp27-cp27mu-manylinux1_x86_64.whl (367kB)
Collecting SQLAlchemy==1.0.8 (from -r requirements.txt (line 5))
  Downloading https://wheels.galaxyproject.org/packages/SQLAlchemy-1.0.8-cp27-cp27mu-manylinux1_x86_64.whl (1.0MB)
Collecting mercurial==3.7.3 (from -r requirements.txt (line 6))
  Downloading https://wheels.galaxyproject.org/packages/mercurial-3.7.3-cp27-cp27mu-manylinux1_x86_64.whl (1.5MB)
‚Ä¶
‚Ä¶
Building wheels for collected packages: repoze.lru
  Running setup.py bdist_wheel for repoze.lru: started
  Running setup.py bdist_wheel for repoze.lru: finished with status ‚Äòdone‚Äô
  Stored in directory: /home/john/.cache/pip/wheels/b2/cd/b3/7e24400bff83325a01d492940eff6e9579f553f33348323d79
Successfully built repoze.lru
Installing collected packages: bx-python, MarkupSafe, PyYAML, SQLAlchemy, mercurial, numpy, pycrypto, six, Paste, PasteDeploy, docutils, wchartype, repoze.lru, Routes, WebOb, WebHelpers, Mako, pytz, Babel, Beaker, dictobj, nose, Parsley, Whoosh, Markdown, Cheetah, requests, boto, requests-toolbelt, bioblend, anyjson, amqp, kombu, psutil, PasteScript, pulsar-galaxy-lib, sqlparse, pbr, decorator, Tempita, sqlalchemy-migrate, pyparsing, svgwrite, ecdsa, paramiko, Fabric, pysam
Successfully installed Babel-2.0 Beaker-1.7.0 Cheetah-2.4.4 Fabric-1.10.2 Mako-1.0.2 Markdown-2.6.3 MarkupSafe-0.23 Parsley-1.3 Paste-2.0.2 PasteDeploy-1.5.2 PasteScript-2.0.2 PyYAML-3.11 Routes-2.2 SQLAlchemy-1.0.8 Tempita-0.5.3.dev0 WebHelpers-1.3 WebOb-1.4.1 Whoosh-2.7.4 amqp-1.4.8 anyjson-0.3.3 bioblend-0.7.0 boto-2.38.0 bx-python-0.7.3 decorator-4.0.2 dictobj-0.3.1 docutils-0.12 ecdsa-0.13 kombu-3.0.30 mercurial-3.7.3 nose-1.3.7 numpy-1.9.2 paramiko-1.15.2 pbr-1.8.0 psutil-4.1.0 pulsar-galaxy-lib-0.7.0.dev4 pycrypto-2.6.1 pyparsing-2.1.1 pysam-0.8.4+gx1 pytz-2015.4 repoze.lru-0.6 requests-2.8.1 requests-toolbelt-0.4.0 six-1.9.0 sqlalchemy-migrate-0.10.0 sqlparse-0.1.16 svgwrite-1.1.6 wchartype-0.1</p>
<pre><code class="language-]">
---

class: reduce70

### Initial Debugging as App Starts

.code[```
Activating virtualenv at .venv
DEBUG:galaxy.app:python path is: /home/john/workspace/galaxy-clean/scripts,
/home/john/workspace/galaxy-clean/lib, /home/john/workspace/galaxy-clean/.venv/lib/python2.7,/home/john/workspace/galaxy-clean/.venv/lib/python2.7/plat-x86_64-linux-gnu,
/home/john/workspace/galaxy-clean/.venv/lib/python2.7/lib-tk, /home/john/workspace/galaxy-clean/.venv/lib/python2.7/lib-old, /home/john/workspace/galaxy-clean/.venv/lib/python2.7/lib-dynload,
/usr/lib/python2.7, /usr/lib/python2.7/plat-x86_64-linux-gnu, /usr/lib/python2.7/lib-tk, /home/john/workspace/galaxy-clean/.venv/local/lib/python2.7/site-packages
INFO:galaxy.config:Logging at '10' level to 'stdout'
galaxy.queue_worker INFO 2016-06-23 19:11:51,925 Initializing main Galaxy Queue Worker on sqlalchemy+sqlite:///./database/control.sqlite?isolation_level=IMMEDIATE
tool_shed.tool_shed_registry DEBUG 2016-06-23 19:11:51,951 Loading references to tool sheds from ./config/tool_sheds_conf.xml.sample
tool_shed.tool_shed_registry DEBUG 2016-06-23 19:11:51,951 Loaded reference to tool shed: Galaxy Main Tool Shed
galaxy.app DEBUG 2016-06-23 19:11:51,956 Using "galaxy.yml" config file:
/home/john/workspace/galaxy-clean/config/galaxy.yml.sample
```]

---

class: reduce70

### Database Migrations

.code[```
migrate.versioning.repository DEBUG 2016-06-23 19:11:51,993 Loading repository lib/galaxy/model/migrate...
migrate.versioning.script.base DEBUG 2016-06-23 19:11:51,994 Loading script lib/galaxy/model/migrate/versions/0001_initial_tables.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:11:51,994 Script lib/galaxy/model/migrate/versions/0001_initial_tables.py loaded successfully
migrate.versioning.script.base DEBUG 2016-06-23 19:11:51,994 Loading script lib/galaxy/model/migrate/versions/0002_metadata_file_table.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:11:52,009 Loading script lib/galaxy/model/migrate/versions/0131_subworkflow_and_input_parameter_modules.py...
...
galaxy.model.migrate.check INFO 2016-06-23 19:13:32,812 Migrating 128 -&gt; 129...
galaxy.model.migrate.check INFO 2016-06-23 19:13:33,436
galaxy.model.migrate.check INFO 2016-06-23 19:13:33,437 Migration script to allow invalidation of job external output metadata temp files
galaxy.model.migrate.check INFO 2016-06-23 19:13:33,437
galaxy.model.migrate.check INFO 2016-06-23 19:13:33,437
galaxy.model.migrate.check INFO 2016-06-23 19:13:33,437 Migrating 129 -&gt; 130...
galaxy.model.migrate.check INFO 2016-06-23 19:13:34,325
galaxy.model.migrate.check INFO 2016-06-23 19:13:34,325 Migration script to change the value column of user_preference from varchar to text.
galaxy.model.migrate.check INFO 2016-06-23 19:13:34,325
galaxy.model.migrate.check INFO 2016-06-23 19:13:34,325
galaxy.model.migrate.check INFO 2016-06-23 19:13:34,326 Migrating 130 -&gt; 131...
galaxy.model.migrate.check INFO 2016-06-23 19:13:35,633
galaxy.model.migrate.check INFO 2016-06-23 19:13:35,633 Migration script to support subworkflows and workflow request input parameters
galaxy.model.migrate.check INFO 2016-06-23 19:13:35,633
galaxy.model.migrate.check INFO 2016-06-23 19:13:35,633
```]

---

Everything after here happens every time

---

class: reduce70

.code[```
migrate.versioning.repository DEBUG 2016-06-23 19:13:35,635 Loading repository lib/tool_shed/galaxy_install/migrate...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,635 Loading script lib/tool_shed/galaxy_install/migrate/versions/0001_tools.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Script lib/tool_shed/galaxy_install/migrate/versions/0001_tools.py loaded successfully
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Loading script lib/tool_shed/galaxy_install/migrate/versions/0002_tools.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Script lib/tool_shed/galaxy_install/migrate/versions/0002_tools.py loaded successfully
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Loading script lib/tool_shed/galaxy_install/migrate/versions/0003_tools.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Script lib/tool_shed/galaxy_install/migrate/versions/0003_tools.py loaded successfully
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Loading script lib/tool_shed/galaxy_install/migrate/versions/0004_tools.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Script lib/tool_shed/galaxy_install/migrate/versions/0004_tools.py loaded successfully
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Loading script lib/tool_shed/galaxy_install/migrate/versions/0005_tools.py...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,636 Script lib/tool_shed/galaxy_install/migrate/versions/0005_tools.py loaded successfully
...
migrate.versioning.script.base DEBUG 2016-06-23 19:13:35,637 Script lib/tool_shed/galaxy_install/migrate/versions/0012_tools.py loaded successfully
migrate.versioning.repository DEBUG 2016-06-23 19:13:35,637 Repository lib/tool_shed/galaxy_install/migrate loaded successfully
tool_shed.galaxy_install.migrate.check DEBUG 2016-06-23 19:13:35,660 The main Galaxy tool shed is not currently available, so skipped tool migration 1 until next server startup
galaxy.config INFO 2016-06-23 19:13:35,679 Install database targetting Galaxy's database configuration.
```]

---

class: reduce70

.code[```
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,748 Loading datatypes from ./config/datatypes_conf.xml.sample
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,749 Retrieved datatype module galaxy.datatypes.binary:Ab1 from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,750 Retrieved datatype module galaxy.datatypes.assembly:Amos from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,751 Retrieved datatype module galaxy.datatypes.text:Arff from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,751 Retrieved datatype module galaxy.datatypes.data:GenericAsn1 from the datatype registry.
...
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,822 Retrieved datatype module galaxy.datatypes.mothur:SquareDistanceMatrix from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,822 Retrieved datatype module galaxy.datatypes.mothur:LowerTriangleDistanceMatrix from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,822 Retrieved datatype module galaxy.datatypes.mothur:RefTaxonomy from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,822 Retrieved datatype module galaxy.datatypes.mothur:RefTaxonomy from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:RefTaxonomy from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:ConsensusTaxonomy from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:TaxonomySummary from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:Frequency from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:Quantile from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:Quantile from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:Quantile from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,823 Retrieved datatype module galaxy.datatypes.mothur:Quantile from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Retrieved datatype module galaxy.datatypes.mothur:Axes from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Retrieved datatype module galaxy.datatypes.mothur:SffFlow from the datatype registry.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Retrieved datatype module galaxy.datatypes.mothur:CountTable from the datatype registry.
```]

---

class: reduce70

.code[```
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Sabund'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Otu'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:GroupAbund'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:SecondaryStructureMap'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:LowerTriangleDistanceMatrix'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,824 Loaded sniffer for datatype 'galaxy.datatypes.mothur:SquareDistanceMatrix'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:PairwiseDistanceMatrix'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Oligos'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Quantile'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Frequency'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:LaneMask'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:RefTaxonomy'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.mothur:Axes'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.constructive_solid_geometry:PlyAscii'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.constructive_solid_geometry:PlyBinary'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.constructive_solid_geometry:VtkAscii'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.constructive_solid_geometry:VtkBinary'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.interval:ScIdx'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,825 Loaded sniffer for datatype 'galaxy.datatypes.tabular:Vcf'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,826 Loaded sniffer for datatype 'galaxy.datatypes.binary:TwoBit'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,826 Loaded sniffer for datatype 'galaxy.datatypes.binary:GeminiSQLite'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,826 Loaded sniffer for datatype 'galaxy.datatypes.binary:MzSQlite'
...
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Psd'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Xbm'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Rgb'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Pbm'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Pgm'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,832 Loaded sniffer for datatype 'galaxy.datatypes.images:Xpm'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.images:Eps'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.images:Rast'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliCountGraph'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliNodeGraph'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliTagSet'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliStopTags'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliSubset'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded sniffer for datatype 'galaxy.datatypes.binary:OxliGraphLabels'
</code></pre>
<p>]</p>

<hr />

<p>class: reduce70</p>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,833 Loaded build site 'ucsc': tool-data/shared/ucsc/ucsc_build_sites.txt with display sites: main,test,archaea,ucla
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,834 Loaded build site 'gbrowse': tool-data/shared/gbrowse/gbrowse_build_sites.txt with display sites: modencode,sgd_yeast,tair,wormbase,wormbase_ws120,wormbase_ws140,wormbase_ws170,wormbase_ws180,wormbase_ws190,wormbase_ws200,wormbase_ws204,wormbase_ws210,wormbase_ws220,wormbase_ws225
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,834 Loaded build site 'ensembl': tool-data/shared/ensembl/ensembl_sites.txt
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,834 Loaded build site 'ensembl_data_url': tool-data/shared/ensembl/ensembl_sites_data_URL.txt
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,834 Loaded build site 'igv': tool-data/shared/igv/igv_build_sites.txt
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:35,834 Loaded build site 'rviewer': tool-data/shared/rviewer/rviewer_build_sites.txt
</code>]</p>

<hr />

<p>class: reduce70</p>

<p>.code[```
galaxy.tools.data INFO 2016-06-23 19:13:35,871 Could not find tool data tool-data/all_fasta.loc, reading sample
galaxy.tools.data DEBUG 2016-06-23 19:13:35,871 Loaded tool data table ‚Äòall_fasta‚Äô
galaxy.tools.data INFO 2016-06-23 19:13:35,871 Could not find tool data tool-data/bfast_indexes.loc, reading sample
galaxy.tools.data DEBUG 2016-06-23 19:13:35,871 Loaded tool data table ‚Äòbfast_indexes‚Äô
galaxy.tools.data WARNING 2016-06-23 19:13:35,871 Cannot find index file ‚Äòtool-data/blastdb_p.loc‚Äô for tool data table ‚Äòblastdb_p‚Äô
‚Ä¶
galaxy.tools.data DEBUG 2016-06-23 19:13:36,210 Loaded tool data table ‚Äòvcf_iobio‚Äô
galaxy.tools.data INFO 2016-06-23 19:13:36,211 Could not find tool data tool-data/biom_simple_display.loc, reading sample
galaxy.tools.data DEBUG 2016-06-23 19:13:36,211 Loaded tool data table ‚Äòbiom_simple_display‚Äô</p>

<p>```]</p>

<hr />

<p>class: reduce70</p>

<h3 id="job-configuration-citation-cache">Job Configuration, Citation Cache</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.jobs DEBUG 2016-06-23 19:13:36,233 Loading job configuration from /home/john/workspace/galaxy-clean/config/galaxy.yml.sample
galaxy.jobs DEBUG 2016-06-23 19:13:36,233 Done loading job configuration
beaker.container DEBUG 2016-06-23 19:13:36,278 data file ./database/citations/data/container_file/4/48/48e563f148dc04d8b31c94878c138019862e580d.cache
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="load-toolbox">Load Toolbox</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.tools.toolbox.base INFO 2016-06-23 19:13:36,279 Parsing the tool configuration ./config/tool_conf.xml.sample
galaxy.tools.toolbox.base DEBUG 2016-06-23 19:13:36,291 Loaded tool id: upload1, version: 1.1.4 into tool panel..
galaxy.tools.toolbox.base DEBUG 2016-06-23 19:13:36,294 Loaded tool id: ucsc_table_direct1, version: 1.0.0 into tool panel..
galaxy.tools.toolbox.base DEBUG 2016-06-23 19:13:36,296 Loaded tool id: ucsc_table_direct_test1, version: 1.0.0 into tool panel..
galaxy.tools.toolbox.base DEBUG 2016-06-23 19:13:36,298 Loaded tool id: ucsc_table_direct_archaea1, version: 1.0.0 into tool panel..
...
galaxy.tools.toolbox.base DEBUG 2016-06-23 19:13:36,496 Loaded tool id: vcf_to_maf_customtrack1, version: 1.0.0 into tool panel..
galaxy.tools.toolbox.base INFO 2016-06-23 19:13:36,497 Parsing the tool configuration ./config/shed_tool_conf.xml
galaxy.tools.toolbox.base INFO 2016-06-23 19:13:36,497 Parsing the tool configuration ./config/migrated_tools_conf.xml
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="tool-dependency-resolution-and-indexing">Tool Dependency Resolution and Indexing</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.tools.deps WARNING 2016-06-23 19:13:36,498 Path './database/dependencies' does not exist, ignoring
galaxy.tools.deps WARNING 2016-06-23 19:13:36,498 Path './database/dependencies' is not directory, ignoring
galaxy.tools.deps DEBUG 2016-06-23 19:13:36,503 Unable to find config file './dependency_resolvers_conf.xml'
galaxy.tools.search DEBUG 2016-06-23 19:13:36,560 Starting to build toolbox index.
galaxy.tools.search DEBUG 2016-06-23 19:13:37,789 Toolbox index finished. It took: 0:00:01.229406
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="display-applications">Display Applications</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:37,795 Loaded display application 'ucsc_bam' for datatype 'bam', inherit=False.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:37,797 Loaded display application 'ensembl_bam' for datatype 'bam', inherit=False.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:37,833 Loaded display application 'igv_bam' for datatype 'bam', inherit=False.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:37,834 Loaded display application 'igb_bam' for datatype 'bam', inherit=False.
...
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,002 Loaded display application 'igv_vcf' for datatype 'vcf_bgzip', inherit=False.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,003 Loaded display application 'biom_simple' for datatype 'biom1', inherit=False.
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,003 Adding inherited display application 'ensembl_gff' to datatype 'gtf'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,004 Adding inherited display application 'igv_gff' to datatype 'gtf'
...
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,007 Adding inherited display application 'gbrowse_interval_as_bed' to datatype 'bed6'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,007 Adding inherited display application 'rviewer_interval' to datatype 'bed6'
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,007 Adding inherited display application 'igv_interval_as_bed' to datatype 'bed6'
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="datatype-converters">Datatype Converters</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,010 Loaded converter: CONVERTER_Bam_Bai_0
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,011 Loaded converter: CONVERTER_bam_to_bigwig_0
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,012 Loaded converter: CONVERTER_bed_to_gff_0
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,012 Loaded converter: CONVERTER_bed_to_bgzip_0
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,013 Loaded converter: CONVERTER_bed_to_tabix_0
...
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,096 Loaded converter: CONVERTER_cml_to_inchi
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,097 Loaded converter: CONVERTER_cml_to_sdf
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,098 Loaded converter: CONVERTER_cml_to_mol2
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,099 Loaded converter: CONVERTER_ref_to_seq_taxomony
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="special-tools">Special Tools</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.datatypes.registry DEBUG 2016-06-23 19:13:38,101 Loaded external metadata tool: __SET_METADATA__
galaxy.tools.special_tools DEBUG 2016-06-23 19:13:38,107 Loaded history import tool: __IMPORT_HISTORY__
galaxy.tools.special_tools DEBUG 2016-06-23 19:13:38,108 Loaded history export tool: __EXPORT_HISTORY__
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="visualization-plugins-1">Visualization Plugins</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,109 VisualizationsRegistry, loaded plugin: charts
galaxy.visualization.plugins.config_parser INFO 2016-06-23 19:13:38,110 Visualizations plugin disabled: Circster. Skipping...
galaxy.visualization.plugins.config_parser INFO 2016-06-23 19:13:38,111 template syntax is deprecated: use entry_point instead
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,111 VisualizationsRegistry, loaded plugin: csg
galaxy.visualization.plugins.config_parser INFO 2016-06-23 19:13:38,111 template syntax is deprecated: use entry_point instead
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,112 VisualizationsRegistry, loaded plugin: graphviz
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,112 VisualizationsRegistry, loaded plugin: phyloviz
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,113 VisualizationsRegistry, loaded plugin: scatterplot
galaxy.visualization.plugins.config_parser INFO 2016-06-23 19:13:38,113 Visualizations plugin disabled: Sweepster. Skipping...
galaxy.web.base.pluginframework INFO 2016-06-23 19:13:38,114 VisualizationsRegistry, loaded plugin: trackster
</code>]</p>

<hr />

<h3 id="tours">Tours</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.tours INFO 2016-06-23 19:13:38,125 Loaded tour 'core.scratchbook'
galaxy.tours INFO 2016-06-23 19:13:38,158 Loaded tour 'core.galaxy_ui'
galaxy.tours INFO 2016-06-23 19:13:38,183 Loaded tour 'core.history'
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="job-handler-and-runners">Job Handler and Runners</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.jobs.manager DEBUG 2016-06-23 19:13:38,196 Starting job handler
galaxy.jobs INFO 2016-06-23 19:13:38,196 Handler 'main' will load all configured runner plugins
galaxy.jobs.runners.state_handler_factory DEBUG 2016-06-23 19:13:38,198 Loaded 'failure' state handler from module galaxy.jobs.runners.state_handlers.resubmit
galaxy.jobs.runners DEBUG 2016-06-23 19:13:38,198 Starting 5 LocalRunner workers
galaxy.jobs DEBUG 2016-06-23 19:13:38,200 Loaded job runner 'galaxy.jobs.runners.local:LocalJobRunner' as 'local'
galaxy.jobs DEBUG 2016-06-23 19:13:38,200 Legacy destination with id 'local:///', url 'local:///' converted, got params:
galaxy.jobs.handler DEBUG 2016-06-23 19:13:38,200 Loaded job runners plugins: local
galaxy.jobs.handler INFO 2016-06-23 19:13:38,200 job handler stop queue started
galaxy.jobs.handler INFO 2016-06-23 19:13:38,222 job handler queue started
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="ignore-this">Ignore this‚Ä¶</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.sample_tracking.external_service_types DEBUG 2016-06-23 19:13:38,229 Loaded external_service_type: Simple unknown sequencer 1.0.0
galaxy.sample_tracking.external_service_types DEBUG 2016-06-23 19:13:38,230 Loaded external_service_type: Applied Biosystems SOLiD 1.0.0
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="workflow-scheduler">Workflow Scheduler</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.workflow.scheduling_manager DEBUG 2016-06-23 19:13:38,254 Starting workflow schedulers
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="controllers-1">Controllers</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,347 Enabling 'external_service' controller, class: ExternalService
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,347 Enabling 'requests_common' controller, class: RequestsCommon
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,375 Enabling 'library_common' controller, class: LibraryCommon
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,390 Enabling 'visualization' controller, class: VisualizationController
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,398 Enabling 'page' controller, class: PageController
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,400 Enabling 'async' controller, class: ASync
...
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,728 Enabling 'history_content_tags' API controller, class: HistoryContentTagsController
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,728 Enabling 'history_tags' API controller, class: HistoryTagsController
galaxy.web.framework.base DEBUG 2016-06-23 19:13:38,728 Enabling 'workflow_tags' API controller, class: WorkflowTagsController
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="middleware">Middleware</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,036 Enabling 'httpexceptions' middleware
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,037 Enabling 'recursive' middleware
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,042 Enabling 'error' middleware
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,043 Enabling 'trans logger' middleware
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,044 Enabling 'x-forwarded-host' middleware
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,044 Enabling 'Request ID' middleware
</code>]</p>

<hr />

<p>class: reduce70</p>

<h3 id="static-paths-for-viz">Static Paths for Viz</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,048 added url, path to static middleware: /plugins/visualizations/charts/static, ./config/plugins/visualizations/charts/static
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,048 added url, path to static middleware: /plugins/visualizations/csg/static, ./config/plugins/visualizations/csg/static
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,049 added url, path to static middleware: /plugins/visualizations/graphviz/static, ./config/plugins/visualizations/graphviz/static
galaxy.webapps.galaxy.buildapp DEBUG 2016-06-23 19:13:39,049 added url, path to static middleware: /plugins/visualizations/scatterplot/static, ./config/plugins/visualizations/scatterplot/static
</code>]</p>

<hr />

<p>class: reduce90</p>

<h3 id="it-is-up">It is Up!</h3>

<p>.code[<code class="language-plaintext highlighter-rouge">
galaxy.queue_worker INFO 2016-06-23 19:13:39,049 Binding and starting galaxy control worker for main
Starting server in PID 21102.
serving on http://127.0.0.1:8080
</code>]</p>

<hr />

<h2 id="production-galaxy---usegalaxyorg">Production Galaxy - usegalaxy.org</h2>

<hr />

<p>class: centered</p>

<p>.pull-left[</p>
<h4 id="default">Default</h4>

<p>SQLite</p>

<p>Paste#http</p>

<p>Single process</p>

<p>Single host</p>

<p>Local jobs</p>

<p>]</p>

<p>.pull-right[</p>
<h4 id="production">Production</h4>

<p>PostgreSQL</p>

<p>uWSGI / nginx</p>

<p>Multiple processes</p>

<p>Multiple hosts</p>

<p>Jobs across many clusters
]</p>

<ul>
  <li>https://usegalaxy.org/production *</li>
</ul>

<hr />

<h3 id="postgres">postgres</h3>

<ul>
  <li>Database server can scale way beyond default sqlite</li>
  <li>https://www.postgresql.org/</li>
  <li>github.com/galaxyproject/usegalaxy-playbook -&gt; <code class="language-plaintext highlighter-rouge">roles/galaxyprojectdotorg.postgresql</code></li>
</ul>

<hr />

<h3 id="nginx-or-apache">nginx (or Apache)</h3>

<ul>
  <li>Optimized servers for static content</li>
  <li>https://www.nginx.com/resources/wiki/</li>
  <li>github.com/galaxyproject/usegalaxy-playbook -&gt; <code class="language-plaintext highlighter-rouge">templates/nginx/usegalaxy.j2</code></li>
</ul>

<hr />

<h3 id="multi-processes">Multi-processes</h3>

<p>Threads in Python are limited by the <a href="https://wiki.python.org/moin/GlobalInterpreterLock">GIL</a>.</p>

<p>Running multiple processes of Galaxy and seperate processes for web handling
and job processing works around this.</p>

<p>This used to be an important detail - but uWSGI makes things a lot easier.</p>

<hr />

<p><img src="../../images/cluster_support.svg" alt="Cluster Support" /></p>

<h3 id="cluster-support">Cluster Support</h3>

<hr />

<p><img src="../../images/usegalaxy_webservers.svg" alt="usegalaxy.org web servers" /></p>

<hr />

<p><img src="../../images/usegalaxyorg.svg" alt="usegalaxy.org servers" /></p>

<hr />

<h2 id="q--a">Q &amp; A</h2>

<hr />

<hr />

<h3 id="legacy-client-architecture">Legacy Client Architecture</h3>

<p><span>Speaker Notes</span></p>

<p>Still some backbone and templates here and there, might be better to drop though?</p>

<hr />

<p><img src="../../images/server_client.plantuml.svg" alt="Client-Server Communications" /></p>

<p><span>Speaker Notes</span></p>

<p>Workflow, Data Libraries, Visualization, History, Tool Menu,
Many Grids, User and preference management.</p>

<hr />

<p>class: white</p>

<p><img src="../../images/backbone-model-view.svg" alt="Backbone MVC" /></p>

<h3 id="backbone-mvc">Backbone MVC</h3>

<hr />

<p><img src="../../images/server_client_old.plantuml.svg" alt="Client-Server Communications (old)" /></p>

<p><span>Speaker Notes</span></p>

<p>Admin things, Reports and Tool Shed Web app</p>

<hr />

<p><img src="../../images/wsgi_app.svg" alt="WSGI Application" /></p>

<h3 id="galaxy-wsgi">Galaxy WSGI</h3>

<hr />

<p>class: enlarge150</p>

<h3 id="why-not-just-django">Why not just Django?</h3>

<p>We do build on many of the same standards, concepts, and libraries - the entire stack isn‚Äôt custom code but there is a non-trivial web framework defined in ‚ÄúGalaxy‚Äù.</p>

<p>The Galaxy community likes Django and uses it to build newer webapps, Galaxy simply predates it and has evolved its own framework.</p>


	<hr />


<h2>Key Points</h2>

<ul>

<li>Galaxy runs out of the box and fetches all needed dependencies.</li>

<li>Running Galaxy in production requires configuration.</li>

<li>The architecture is designed to be pluggable and extensible.</li>

<li>Learn more about different Galaxy aspects in our [development section](/topics/dev/).</li>

</ul>







<h2>Thank you!</h2>

This material is the result of a collaborative work. Thanks to the <a href="https://training.galaxyproject.org" aria-label="Visit the GTN">Galaxy Training Network</a> and all the contributors!




<img src="/training-material/assets/images/GTN.png" alt="Galaxy Training Network" style="height: 100px;"/>


This material is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</section>

        </div>
        
            <footer>
    <div class="container">
        <br><br>
        <p>
            The <a href="https://galaxyproject.org/teach/gtn/">Galaxy Training Network</a>
            provides researchers with online training materials, connects them with local trainers, and helps promoting open data analysis practices worldwide.
        </p>
        <p>
The content of the tutorials is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. The website and infrastructure is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>.
</p>
        <p>This is revision <a href="https://github.com/galaxyproject/training-material/commit/b2e71ef908d4ec335aa82cc51a8eda70ef39e230">b2e71ef908d4ec335aa82cc51a8eda70ef39e230</a></p>
    </div>
</footer>

        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
