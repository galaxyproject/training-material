<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Downstream Single-cell RNA analysis with RaceID</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Training material for all kinds of transcriptomics analysis." />
        <meta property="og:title" content="Galaxy Training: Downstream Single-cell RNA analysis with RaceID" />
        <meta property="og:description" content="Training material for all kinds of transcriptomics analysis." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<!-- Gitter -->


<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'Galaxy-Training-Network/galaxy-single-cell'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/transcriptomics" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">topic</span> Transcriptomics
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Language Selector">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Language
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                Fran√ßais
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                Êó•Êú¨Ë™û
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                Espa√±ol
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                Portugu√™s
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Ftranscriptomics%2Ftutorials%2Fscrna-raceid%2Ftutorial.html&edit-text=&act=url" title="">
                                And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>

        <div class="dropdown-item">
            <div>
                Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
            </div>

        </div>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/transcriptomics/tutorials/scrna-raceid/tutorial.md">
                            <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Downstream Single-cell RNA analysis with RaceID",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Transcriptomics",
    "description": "Training material for all kinds of transcriptomics analysis.",
    "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/"
  },
  "courseCode": "transcriptomics / scrna-raceid / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Downstream Single-cell RNA analysis with RaceID' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/tutorials/scrna-raceid/tutorial.html",
  "timeRequired": "PT3H",
  "keywords": "single-cell",
  "description": "The questions this  addresses are:\n - What is normalisation and why is it necessary?\n - How many types of unwanted variation are there?\n - How are biological phenotypes clustered?\n - What is the difference between PCA and tSNE?\n - What is the difference between cell trajectory and cell fate?\n\n\\nThe objectives are:\n - Filtering, normalising, and clustering cells in a matrix\n - Assessing the quality of individual clusters\n - Inferring cell type lineages\n - Examining gene expression\n - Determining the top most expressive genes per cluster\n - Correcting for unwanted variation\n\n",
  "coursePrerequisites": [
    {
      "@type": "CreativeWork",
      "url": "https://training.galaxyproject.org//training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/sequence-analysis/tutorials/quality-control/slides.html",
      "name": "Quality Control",
      "description": "Slides for 'Quality Control' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html",
      "name": "Quality Control",
      "description": "Hands-on for 'Quality Control' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/sequence-analysis/tutorials/mapping/slides.html",
      "name": "Mapping",
      "description": "Slides for 'Mapping' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html",
      "name": "Mapping",
      "description": "Hands-on for 'Mapping' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/tutorials/scrna-plates-batches-barcodes/slides.html",
      "name": "Plates, Batches, and Barcodes",
      "description": "Slides for 'Plates, Batches, and Barcodes' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/tutorials/scrna-umis/tutorial.html",
      "name": "Understanding Barcodes",
      "description": "Hands-on for 'Understanding Barcodes' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/tutorials/scrna-preprocessing/slides.html",
      "name": "Dealing with Cross-Contamination in Fixed Barcode Protocols",
      "description": "Slides for 'Dealing with Cross-Contamination in Fixed Barcode Protocols' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/tutorials/scrna-preprocessing/tutorial.html",
      "name": "Pre-processing of Single-Cell RNA Data",
      "description": "Hands-on for 'Pre-processing of Single-Cell RNA Data' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Mehmet Tekman"
    },
    {
      "@type": "Person",
      "name": "Alex Ostrovsky"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Mehmet Tekman"
    },
    {
      "@type": "Person",
      "name": "Alex Ostrovsky"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Transcriptomics",
      "description": "Training material for all kinds of transcriptomics analysis.",
      "url": "https://training.galaxyproject.org//training-material/topics/transcriptomics/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/topic_3308",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "topic_3308",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_3308"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Downstream Single-cell RNA analysis with RaceID</h1>
        

        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame/mtekman/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/mtekman" alt="Mehmet Tekman">Mehmet Tekman</a>, <a href="/training-material/hall-of-fame/astrovsky01/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/astrovsky01" alt="Alex Ostrovsky">Alex Ostrovsky</a>

</div>

        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li><p>What is normalisation and why is it necessary?</p>
</li>
            
            <li><p>How many types of unwanted variation are there?</p>
</li>
            
            <li><p>How are biological phenotypes clustered?</p>
</li>
            
            <li><p>What is the difference between PCA and tSNE?</p>
</li>
            
            <li><p>What is the difference between cell trajectory and cell fate?</p>
</li>
            
            </ul>

            <strong><i class="fas fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li><p>Filtering, normalising, and clustering cells in a matrix</p>
</li>
            
            <li><p>Assessing the quality of individual clusters</p>
</li>
            
            <li><p>Inferring cell type lineages</p>
</li>
            
            <li><p>Examining gene expression</p>
</li>
            
            <li><p>Determining the top most expressive genes per cluster</p>
</li>
            
            <li><p>Correcting for unwanted variation</p>
</li>
            
            </ul>

            
            <strong><i class="fas fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

    <li>
    
        
        
        <a href="/training-material/topics/sequence-analysis">Sequence analysis</a>
        
            <ul>
                
                    
                        
                    
                        
                            
                            <li> Quality Control:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                
                    
                        
                            
                            <li> Mapping:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/mapping/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            
    <li>
    
        
        
        <a href="/training-material/topics/transcriptomics">Transcriptomics</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Plates, Batches, and Barcodes:
                            
                                <a href="/training-material/topics/transcriptomics/tutorials/scrna-plates-batches-barcodes/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Understanding Barcodes:
                            
                            
                                
                                     <a href="/training-material/topics/transcriptomics/tutorials/scrna-umis/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Pre-processing of Single-Cell RNA Data:
                            
                                <a href="/training-material/topics/transcriptomics/tutorials/scrna-preprocessing/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/transcriptomics/tutorials/scrna-preprocessing/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            </ul>
            

            
            <p><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 3 hours</p>
            

            

            
            

            
            <p id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></p>
            <ul>
                <div class="supporting_material">
                
                    <li class="btn btn-default supporting_material"><a href="/training-material/topics/transcriptomics/slides/introduction.html" title="Topic Overview slides">
                        <i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Topic Overview slides
                    </a></li>
                

                
                    <li class="btn btn-default supporting_material">
<a class="topic-icon" href="https://zenodo.org/record/1511582">
    <i class="far fa-copy" aria-hidden="true"></i><span class="visually-hidden">zenodo_link</span> Datasets
</a>

</li>
                

                
                    <li class="btn btn-default supporting_material">
    <a class="topic-icon" href="/training-material/topics/transcriptomics/tutorials/scrna-raceid/workflows/" title="Workflows" alt="Downstream Single-cell RNA analysis with RaceID workflows">
        <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> Workflows
    </a>

</li>
                

                

                
                    <li class="btn btn-default supporting_material">

    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span> Available on these Galaxies
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/transcriptomics/docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://africa.usegalaxy.eu/" title="Galaxy Africa">
            Galaxy Africa
        </a>
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://galaxy.genouest.org" title="Galaxy@GenOuest">
            Galaxy@GenOuest
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://humancellatlas.usegalaxy.eu/" title="Human Cell Atlas">
            Human Cell Atlas
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://singlecell.usegalaxy.eu/" title="Single Cell Omics workbench">
            Single Cell Omics workbench
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.be/" title="UseGalaxy.be">
            UseGalaxy.be
        </a>
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.eu" title="UseGalaxy.eu">
            UseGalaxy.eu
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.no/" title="UseGalaxy.no">
            UseGalaxy.no
        </a>
        
    
        
    
        
    
        
    
    </ul>


</li>
                
                </div>
            </ul>
            

            <p><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Jan 6, 2021 </p>
        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <!-- TODO: Subset analysis to validate prior cell labelling -->
<!-- TODO: Replace sort/unique with datamash -->

<h1 class="no_toc" id="introduction">Introduction</h1>

<p>The data provided here as part of this tutorial analyses <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span>-seq data from a study published by <a href="https://doi.org/10.1016/j.stem.2016.05.010">Gr√ºn et.al</a> in 2016. The data was used to cluster cells from <em>Lgr5</em>-positive intestinal stem cells of C57BL6/J mice, with the aim of discovering distinct cell sub-populations and deriving a lineage tree between them to find out how these sub-populations relate (or are derived from) one another.</p>

<p>The input data consists of a single count matrix consisting of ~21,000 genes (rows) and ~400 cells (columns) in tidy data format, generated via <a href="/training-material/topics/transcriptomics/tutorials/scrna-preprocessing/tutorial.html">sc<span class="notranslate">RNA</span> pre-processing methods</a> using the <a href="/training-material/topics/transcriptomics/tutorials/scrna-umis/tutorial.html">CelSeq2 protocol</a>.</p>

<blockquote class="comment">
  <h3 id="comment-comment-tidy-data"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment: Tidy Data</h3>
  <p>The <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidy data</a> convention prevalent amongst the R data analysis community assigns every value to a variable and an observation. The values are the number of <span class="notranslate">reads</span> which are assigned to a particular gene (a variable) that was measured within a specific cell (an observation).</p>

</blockquote>

<blockquote class="details">
  <h3 id="details-details-count-correction"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Count Correction</h3>
  <p>Normally a count matrix consists of integers, but this matrix has undergone an UMI-to-transcript <a href="https://www.nature.com/articles/nmeth.2930#methods">count alteration</a> to correct against UMI errors, yielding decimal values instead. This correction is not that necessary in most datasets but it is used here.</p>

</blockquote>

<p>This tutorial will perform cell clustering and lineage construction, as well as exploring some genes of interest.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will cover:</p>

<ol id="markdown-toc">
  <li><a href="#initial-count-matrix" id="markdown-toc-initial-count-matrix">Initial Count Matrix</a>    <ol>
      <li><a href="#get-data" id="markdown-toc-get-data">Get data</a></li>
      <li><a href="#inspecting-the-cell-labelling" id="markdown-toc-inspecting-the-cell-labelling">Inspecting the Cell Labelling</a></li>
      <li><a href="#inspecting-the-quality-of-the-count-matrix" id="markdown-toc-inspecting-the-quality-of-the-count-matrix">Inspecting the Quality of the Count Matrix</a></li>
    </ol>
  </li>
  <li><a href="#normalising-and-clustering-cells" id="markdown-toc-normalising-and-clustering-cells">Normalising and Clustering Cells</a>    <ol>
      <li><a href="#biological-variation" id="markdown-toc-biological-variation">Biological Variation</a></li>
      <li><a href="#technical-variation" id="markdown-toc-technical-variation">Technical Variation</a></li>
      <li><a href="#performing-the-clustering" id="markdown-toc-performing-the-clustering">Performing the Clustering</a></li>
      <li><a href="#outlier-detection" id="markdown-toc-outlier-detection">Outlier Detection</a></li>
      <li><a href="#heatmaps" id="markdown-toc-heatmaps">Heatmaps</a></li>
      <li><a href="#visualising-all-clusters" id="markdown-toc-visualising-all-clusters">Visualising All Clusters</a></li>
    </ol>
  </li>
  <li><a href="#individual-cluster-inspection" id="markdown-toc-individual-cluster-inspection">Individual Cluster Inspection</a>    <ol>
      <li><a href="#differential-gene-analysis-between-two-clusters" id="markdown-toc-differential-gene-analysis-between-two-clusters">Differential Gene Analysis Between Two Clusters</a></li>
      <li><a href="#differential-gene-expression-across-all-clusters" id="markdown-toc-differential-gene-expression-across-all-clusters">Differential Gene <span class="notranslate">Expression</span> Across All Clusters</a></li>
    </ol>
  </li>
  <li><a href="#trajectory-and-lineage-analysis" id="markdown-toc-trajectory-and-lineage-analysis">Trajectory and Lineage Analysis</a>    <ol>
      <li><a href="#computing-the-lineage-tree" id="markdown-toc-computing-the-lineage-tree">Computing the Lineage Tree</a></li>
      <li><a href="#specific-trajectory-lineage-analysis-stemid" id="markdown-toc-specific-trajectory-lineage-analysis-stemid">Specific Trajectory Lineage Analysis (StemID)</a></li>
      <li><a href="#specific-trajectory-fate-analysis-fateid" id="markdown-toc-specific-trajectory-fate-analysis-fateid">Specific Trajectory Fate Analysis (FateID)</a></li>
    </ol>
  </li>
</ol>

</blockquote>

<h1 id="initial-count-matrix">Initial Count Matrix</h1>

<p>Every <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span> analysis begins with a count matrix, which contains the raw data required for the <span class="notranslate">downstream</span> analysis. Annotation data such as cell phenotype or gene annotations are often used to enrich and validate the analysis. Cell annotations can sometimes be encoded directly in the cell labelling, as we will later explore in this count matrix.</p>

<p>First, let‚Äôs setup our history and initial dataset.</p>

<h2 id="get-data">Get data</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-data-upload"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Data upload</h3>

  <ol>
    <li>
      <p>Create a new history for this tutorial and name it ‚ÄúRaceID on sc<span class="notranslate">RNA</span>‚Äù</p>

      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-history"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new history</h3>

        <p>Click the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel</p>

        <p>If the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>
        <ol>
          <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>
          <li>Select the option <strong>Create New</strong> from the menu</li>
        </ol>
      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-renaming-a-history"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Renaming a history</h3>

        <ol>
          <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>
          <li>Type the new name</li>
          <li>Press <kbd>Enter</kbd></li>
        </ol>
      </blockquote>
    </li>
    <li>
      <p>Import the file from <a href="https://zenodo.org/record/1511582">Zenodo</a> or from the shared data library</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/1511582/files/intestinalData.tsv
</code></pre></div>      </div>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-via-links"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data via links</h3>

        <ul>
          <li>Copy the link location</li>
          <li>
            <p>Open the <span class="notranslate">Galaxy</span> Upload Manager (<i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-upload</span> on the top-right of the tool panel)</p>
          </li>
          <li>Select <strong>Paste/Fetch Data</strong></li>
          <li>
            <p>Paste the link into the text field</p>
          </li>
          <li>
            <p>Press <strong>Start</strong></p>
          </li>
          <li><strong>Close</strong> the window</li>
        </ul>

        <p>By default, <span class="notranslate">Galaxy</span> uses the URL as the name, so rename the files with a more useful name.</p>

      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-from-a-data-library"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data from a data library</h3>

        <p>As an alte<span class="notranslate">rna</span>tive to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>

        <ul>
          <li>
            <p>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></p>
          </li>
          <li>
            <p>Find the correct folder (ask your instructor)</p>
          </li>
          <li>Select the desired files</li>
          <li>Click on the <strong>To History</strong> button near the top and select <strong>as Datasets</strong> from the dropdown menu</li>
          <li>In the pop-up window, select the history you want to import the files to (or create a new one)</li>
          <li>Click on <strong>Import</strong></li>
        </ul>
      </blockquote>
    </li>
    <li>Rename the dataset to <em>‚Äúintestinal‚Äù</em></li>
    <li>
      <p>Check that the datatype is a tab-separated file</p>

      <blockquote class="tip">

        <h3 id="tip-tip-changing-the-datatype"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Changing the datatype</h3>
        <ul>
          <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>
          <li>In the central panel, click on the <i class="fas fa-database" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-chart-select-data</span> <strong>Datatypes</strong> tab on the top</li>
          <li>Select <code class="language-plaintext highlighter-rouge">tabular</code></li>
          <li>Click the <strong>Change datatype</strong> button</li>
        </ul>
      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many genes are in the count matrix?</li>
    <li>How many cells?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>A summary of our dataset is given by expanding the file preview window by clicking on the file name.</p>

    <ol>
      <li>20,269 lines, where lines/rows denote our genes.</li>
      <li>Scroll the mini-preview window to the right to see that the number of cells are 431</li>
    </ol>

  </blockquote>

</blockquote>

<h2 id="inspecting-the-cell-labelling">Inspecting the Cell Labelling</h2>

<p>Cell labels usually encode which plate, batch, or cell barcode was used to delineate cell. Sometimes all three sources of information are used, which can be valuable information to have when looking for batch effects.</p>

<p>We can inspect the labels of this dataset by clicking on the <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-eye</span> symbol. Immediately we can see that the header of this file contains cell names, following a naming convention that separates the cells into 5 batches: <em>I5d, II5d, III5d, IV5d</em>, and <em>V5d</em></p>

<p>Is each batch equally populated? We can investigate this ourselves by extracting the headers, and reformatting them to see how many unique types we can detect:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-task-description"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Task description</h3>

  <ol>
    <li><strong>Select first</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúFile to select‚Äù</em>: imported tabular file</li>
        <li><em>‚ÄúOperation‚Äù</em>: <code class="language-plaintext highlighter-rouge">Keep first lines</code></li>
        <li><em>‚ÄúNumber of lines‚Äù</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
      </ul>
    </li>
    <li><strong>Transpose</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput tabular dataset‚Äù</em>: output of <strong>Select first</strong></li>
      </ul>

      <blockquote class="question">
        <h3 id="question-questions-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <p>What did this transpose step do? Why is it necessary?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>The sole purpose of the Transpose tool is to switch columns with rows (and vice versa), which will make it easier to inspect and sort data.</p>
        </blockquote>
      </blockquote>
    </li>
    <li><strong>Text transformation</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúFile to process‚Äù</em>: output of <strong>Transpose</strong></li>
        <li>
          <p><em>‚ÄúSED Program‚Äù</em>: <code class="language-plaintext highlighter-rouge">s/_[0-9]+//</code></p>

          <p>The above text is a regular <span class="notranslate">expression</span> used to match on anything that contains a <code class="language-plaintext highlighter-rouge">_</code> followed by a number, and removing it.</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Inspect the generated file and verify that we have the 5 phenotypes without <code class="language-plaintext highlighter-rouge">_</code> followed by a number</p>

      <blockquote class="question">
        <h3 id="question-questions-2"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <p>How many rows remain after the <strong>Text transformation</strong> step?</p>
        <blockquote class="solution">
          <h3 id="solution-solution-2"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>The number of rows has not changed since the last step, but the cell names have lost their numbering and are identified purely by their phenotype.</p>
        </blockquote>
      </blockquote>
    </li>
    <li><strong>Datamash</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput tabular dataset‚Äù</em>: output of <strong>Text transformation</strong></li>
        <li><em>‚ÄúGroup by fields‚Äù</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
        <li><em>‚ÄúInput file has a header line‚Äù</em> : <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>‚ÄúPrint header line‚Äù</em>:<code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúSort input‚Äù</em>:<code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>‚ÄúPrint all fields from input file‚Äù</em>:<code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúIgnore case when grouping‚Äù</em>:<code class="language-plaintext highlighter-rouge">No</code></li>
        <li>In <em>‚ÄúOperation to perform on each group‚Äù</em>
          <ul>
            <li>In <em>‚Äú1: Operation to perform on each group‚Äù</em>
              <ul>
                <li><em>‚ÄúType‚Äù</em>: <code class="language-plaintext highlighter-rouge">count</code></li>
                <li><em>‚ÄúOn column‚Äù</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-3"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many unique cell phenotypes were identified in the cell headers?</li>
    <li>Which cell phenotype is least represented in the count matrix?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-3"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>There are 5 types of cells in our count matrix: <em>I5d</em>, <em>II5d</em>, <em>III5d</em>, <em>IV5d</em>, and <em>V5d</em>.</li>
      <li>There are only 48 <em>IV5d</em> cells compared to the other types which have 95 or 96.</li>
    </ol>
  </blockquote>

</blockquote>

<p>With these types already labelled in the header of our data, we can validate the clustering that we will perform later. Ideally, the cells described by these 5 different labels should group into 5 separate clusters, with varying degrees of proximity to one another.</p>

<h2 id="inspecting-the-quality-of-the-count-matrix">Inspecting the Quality of the Count Matrix</h2>

<p>Low quality cells and genes are often caught at the pre-processing stage and removed, but sometimes more filtering is required to remove unwanted noise from the data.</p>

<p>A gene with a low number of total counts across multiple cells might be differentially expressed across those cells, however differential gene <span class="notranslate">expression</span> and log fold change do not necessarily denote significant change. 1 count in CellA and 10 counts in CellB yields an LFC of 10, but is not as significant as an LFC of 10 from 100 counts in CellA vs 1000 counts in CellB.</p>

<p>We can refine filtering thresholds by examining how much a histogram of our plots change before and after filtering using standard parameters.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-unique-cell-types"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Unique Cell Types</h3>

  <ol>
    <li><strong>Filtering, Normalisation, and Confounder Removal using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúCount Matrix‚Äù</em>: <code class="language-plaintext highlighter-rouge">intestinal</code> (Input dataset)</li>
        <li>In <em>‚ÄúFiltering‚Äù</em>:
          <ul>
            <li><em>‚ÄúMin Transcripts‚Äù</em>: <code class="language-plaintext highlighter-rouge">3000</code></li>
            <li><em>‚ÄúMin <span class="notranslate">Expression</span>‚Äù</em>: <code class="language-plaintext highlighter-rouge">5</code></li>
            <li><em>‚ÄúMin Cells‚Äù</em>: <code class="language-plaintext highlighter-rouge">5</code></li>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>The tool provides metrics on the library size and the number of detected features.</p>

<blockquote class="details">
  <h3 id="details-details-library-size-and-number-of-features-definitions"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Library Size and Number of Features (Definitions)</h3>

  <figure id="figure-1"><img src="/training-material/topics/transcriptomics/images/raceid_libsize.svg" alt="Library Size and Detected Genes" /><figcaption><span class="figcaption-prefix">Figure 1:</span> Library Size and Number of Features</figcaption></figure>

  <ul>
    <li><strong>Library Size</strong>: The total number of transcripts in a cell, or a column sum. <em>The minimum threshold for this can be set by ‚ÄúMin Transcripts‚Äù (= 3000)</em>.</li>
    <li><strong>Gene Transcripts</strong>: The total number of transcripts for a gene, or a row sum.</li>
    <li><strong>Detectability</strong>: This is how many values above a certain threshold exist in a given row/column.
      <ul>
        <li><strong>Number of Features</strong>: The number of genes detected above a certain threshold.
          <ul>
            <li><em>&gt;0</em>: This is the default threshold when the term <em>Number of Features</em> is used, because it counts any genes with non-zero counts for that cell, and are therefore ‚Äòdetected‚Äô during sequencing.</li>
            <li><em>&gt;N</em>: Depending on how lowly sequenced the cells are, sometimes it is useful to set a higher threshold of detectability to guard against sequencing errors or other noise-related factors. <em>The minimum threshold for this can be set by ‚ÄúMin <span class="notranslate">Expression</span>‚Äù (= 5)</em>.</li>
          </ul>
        </li>
        <li><strong>Number of Cells</strong>:
          <ul>
            <li><em>&gt;0</em>: This is the default threshold when the term <em>Detected in X number of Cells</em> is used, because it counts any cells with non-zero counts for that gene.</li>
            <li><em>&gt;N</em>: This raises the detectability threshold to any cell count above N. <em>The minimum threshold for this can be set by ‚ÄúMin Cells‚Äù (= 5)</em>.</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>Four histograms are generated with the top line giving the raw <span class="notranslate">expression</span> data fed into the tool, and the bottom line giving the filtered data (cells with at least 3,000 transcripts in total and genes with at least 5 transcripts in at least 5 cells).</p>

<figure id="figure-2"><img src="/training-material/topics/transcriptomics/images/raceid_filter_plots.png" alt="Histograms of raw and filtered data" /><figcaption><span class="figcaption-prefix">Figure 2:</span> RaceID Histograms of raw and filtered data</figcaption></figure>

<ul>
  <li>
    <p>(Top-Left) Library Size (total number of transcripts per cell)</p>
  </li>
  <li>
    <p>(Top-Right) Feature Set (total number of detectable genes per cell)</p>
  </li>
  <li>
    <p>(Bottom-Left) Filtered Library Size (minimum 3000 transcripts per cell)</p>
  </li>
  <li>
    <p>(Bottom-Right) Filtered Feature Set</p>
  </li>
</ul>

<blockquote class="details">
  <h3 id="details-details-raceid-histograms"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: RaceID Histograms</h3>

  <p>The top row shows the count distributions of the Library Size and Number of Features of the raw data using a Log scale on the x-axis (e.g. 2.5 on the Log10 x-axis = \(10^{2.5}\) = 316 counts).</p>

  <ul>
    <li>
      <p>(Top-Left) A lower-tail heavy distribution centred around 3-4 Log10 (~3000) counts per cell , with a few cells having library sizes containing a handful of counts (0-1000).</p>
    </li>
    <li>
      <p>(Top-Right) Another lower-tail heavy distribution with a peak centred around \(10^{3.5}\) counts. Cells with a low number of features are hard to compare with other cells due to incomplete data. It is possible that these low feature cells (&lt; 100 genes) are rare types and that we should impute their missing values, but it is often more likely the case that these are simply just low-quality cells that will add noise to the clustering.</p>
    </li>
  </ul>

  <p>The bottom row shows the count distributions of the Library Size and Number of Features of the filtered data</p>

  <ul>
    <li>
      <p>(Bottom-Left) The lower-tail of our previous distribution has been trimmed off, which gives an even normal-looking distribution centred around \(10^{3.4}\) transcripts per cell.</p>
    </li>
    <li>
      <p>(Bottom-Right) Instead of a distribution we have a single bar that indicates that all of our cells have the exact number of features. The red line displays the number of features across all cells (~ \(10^{3.3}\)).</p>
    </li>
  </ul>

</blockquote>

<blockquote class="comment">
  <h3 id="comment-comment-choosing-filtering-thresholds"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment: Choosing Filtering Thresholds</h3>

  <p>The minimum total filtering threshold of 3000 chosen for this dataset is derived from analysing the <em>Cross-Contamination Plots</em> from the <a href="/training-material/topics/transcriptomics/tutorials/scrna-preprocessing/tutorial.html">Pre-processing of <span class="notranslate">Single-Cell</span> <span class="notranslate">RNA</span> Data</a>.</p>

  <p>This threshold is dependent primarily on the capture efficiency of the cells that were sequenced, with some cell types being easier to capture than others. For example, neuron cells would have a lower filtering threshold of ~1500 compared to the ~3000 used for hematopoietic cells.</p>

</blockquote>

<blockquote class="details">
  <h3 id="details-details-why-the-same-number-of-features"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Why the Same Number of Features?</h3>

  <ul>
    <li>
      <p>RaceID normalises the data to compare all cells using the same set of features. Selected features must be <em>meaningful</em>, describing or contributing to the biological variation in the data. Therefore features should be the most differentially expressed genes across different cells.</p>
    </li>
    <li>
      <p>The cells that still remain after filtering will have some genes with count values of zero. In some cases this will give a median value of zero, which can make normalisation strategies difficult (e.g. dividing by the median value of a gene may require dividing by zero). For this reason, a value of 0.1 is added to the count data so that these features are not lost during the analysis.</p>
    </li>
    <li>
      <p>It should be noted that this then assumes that the gene <em>is</em> detectable for that cell (i.e. no errors during sequencing), but that the transcript was very lowly expressed.</p>
    </li>
    <li>
      <p>The flat square plot (bottom-right) for the post-filtered number of features is square because it shows that the dataset is still a rectangular matrix with C number of cells and G number of genes. For a more ‚Äòrealistic‚Äô distribution of features, re-run the tool with <em>‚ÄúCount filtered features greater than or equal to 1‚Äù</em> enabled.</p>
    </li>
  </ul>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-4"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many cells remain after filtering?</li>
    <li>How many genes remain after filtering?</li>
    <li>Are these numbers to be expected?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-4"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>The answer to the first two questions can be seen in log file generated <strong>Filtering, Normalisation, and Confounder Removal using RaceID</strong></p>

    <ol>
      <li>287 cells remain (66%)</li>
      <li>2089 genes remain (10%)</li>
      <li><strong>Yes</strong>
        <ul>
          <li><em>Cells:</em>
These are the observations of your dataset, and the more observations you have, the better the model will be. At minimum, 60% of your initial cells should be retained, though this will depend on the quality of your dataset.</li>
          <li><em>Genes:</em>
As the variables of the dataset, the more genes included, the more complex the model. Discovering the few variables that are relevant to the final model, then,  is the aim. Genes <em>not</em> differentially expressed between cells will not affect the final model, but serve as stable background metrics against which to measure significantly differentially expressed genes in the initial matrix. It is perfectly acceptable to perform a <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span>-seq analysis with as few as 500 (differentially expressed) genes.</li>
        </ul>
      </li>
    </ol>

  </blockquote>

</blockquote>

<p>The filtered distributions are what are expected of a properly filtered and normalised dataset (i.e. a count matrix with all observations having roughly the same number of transcripts, but distributed differently across different sets of common features). With this we can now perform initial clustering to see whether we can cluster any of our cells into distinct cell types.</p>

<h1 id="normalising-and-clustering-cells">Normalising and Clustering Cells</h1>

<p>Normalisation permits the comparison of different samples by refactoring out uninformative variability relating to the size of sample, and other sources of unwanted variability. Clustering, which groups or categorises cells based on their similarity, and is a crucial stage in the analysis after normalisation.</p>

<p>The effectiveness of the clustering relies on the normalisation. The ideal method to normalise <span class="notranslate">single cell</span> <span class="notranslate">RNA</span>-seq data is still a field of active research as  it is not a straightforward process due to two potential sources of uncertainty: technological and biological variability.</p>

<h2 id="biological-variation">Biological Variation</h2>

<figure id="figure-3"><img src="/training-material/topics/transcriptomics/images/raceid_cellcycle.svg" alt="Sources of variation" /><figcaption><span class="figcaption-prefix">Figure 3:</span> Sources of unwanted biological variation: (Left) Transcriptional Bursting, and (Right) Cell-cycle Variation</figcaption></figure>

<p>Transcriptional bursting is a stochastic model for the transcription process in a cell, where transcription does not occur as a smooth or continuous process but occurs in spontaneous and discrete ‚Äòbursts‚Äô thought to be only loosely associated with chromatin conformation/availability. It is an effect that is not seen in bulk <span class="notranslate">RNA</span>-seq due to the smoothing effect of measuring average gene <span class="notranslate">expression</span> across a tissue. The effect is more pronounced in <span class="notranslate">single-cell</span> and is hard to model against.</p>

<p>On the other hand, cell-cycle variation is well defined and can be modelled against. As the cell grows from the G1 to the M phase, the amount of m<span class="notranslate">RNA</span> transcribed grows, meaning that cells in the later stages of their cycle are more likely to produce more transcripts of a given gene. Such differences can give false variation that would cluster two cells of the same type but at different time-points separately. Fortunately, there are a well-defined set of genes whose <span class="notranslate">expression</span> is known  to co-vary with the cell-cycle, thus this effect can be modelled out.</p>

<h2 id="technical-variation">Technical Variation</h2>

<figure id="figure-4"><img src="/training-material/topics/transcriptomics/images/raceid_technical_variation.svg" alt="Sources of variation" /><figcaption><span class="figcaption-prefix">Figure 4:</span> Sources of unwanted technical variation</figcaption></figure>

<p>Technical variation appears in three main forms: <em>Library size variation</em>, <em>Amplification bias</em>, and <em>Dropout events</em>.</p>

<blockquote class="details">
  <h3 id="details-details-technical-variation"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Technical Variation</h3>
  <ol>
    <li>
      <p><strong>Library size variation</strong> occurs where two cells of the same cell type may produce a different amount of total transcripts than one another (e.g. due to cell-cycle effects, or differing capture efficiencies), but have a similar <em>proportion</em> of transcripts for specific genes. For example, a neural cell with 10 counts of SOX2 and a library size of 100 and one with 20 counts and a library size of 200 have the same proportion of SOX2. The two cells have different library sizes, but harbour the same <span class="notranslate">expression</span> for that gene because they are of the same cell type.</p>
    </li>
    <li>
      <p><strong>Amplification bias</strong> stems from an uneven amplification of certain transcripts of a cell over others, giving a false number of <span class="notranslate">reads</span> for the number of m<span class="notranslate">RNA</span> molecules actually observed in the cell. Unique Molecular Identifiers can significantly reduce this bias, and are covered more extensively in the <a href="/training-material/topics/transcriptomics/tutorials/scrna-umis/tutorial.html"><em>Understanding Barcodes</em></a> hands-on.</p>
    </li>
    <li>
      <p><strong>Dropout events</strong> are the zero counts that are prevalent in the data due to the reduced sequencing sensitivity in detecting <span class="notranslate">reads</span>, which yields many false negatives in the detection of genes, often resulting in over 80% of the count values in the count matrix being zero. A major point to take into account is that some of these zeroes are <em>real</em> (i.e. no transcripts of that gene were detected in that cell) and some of these are <em>false</em> (i.e. the transcripts were never captured due to the low sequencing depth). Modelling this duality in the data and mitigating against it is one of the biggest challenges of normalising <span class="notranslate">single-cell</span> data.</p>
    </li>
  </ol>

</blockquote>

<h2 id="performing-the-clustering">Performing the Clustering</h2>

<p>We will attempt to perform some normalisation and clustering using the recommended default settings to see if we can detect different cell types.</p>

<p>Here we assume that there is no unwanted technical or biological variability in the data and that the cells will cluster purely based on their phenotypes. This assumption is not completely without merit, since often the biological signal is strong enough to counter the lesser unwanted variation.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-task-description-1"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Task description</h3>

  <ol>
    <li><strong>Clustering using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RaceID RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Filtering, Normalisation, and Confounder Removal using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>‚ÄúClustering‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
        <li>In <em>‚ÄúOutliers‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
        <li>In <em>‚ÄútSNE and FR‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="details">
  <h3 id="details-clustering-on-a-distance-matrix"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Clustering on a Distance Matrix</h3>

  <p>In order to perform clustering, the proximity of cells to one another are first defined by a distance metric
such as <a href="https://en.wikipedia.org/wiki/Metric_(mathematics)">Euclidean distance or other</a>.</p>

  <figure id="figure-5"><img src="/training-material/topics/transcriptomics/images/raceid_distance.svg" alt="Distances" /><figcaption><span class="figcaption-prefix">Figure 5:</span> Euclidean distance between three points (R, P, V) across three features (G1, G2, G3)</figcaption></figure>

  <p>The clustering then tries to find groupings of cells using this distance matrix.</p>

  <blockquote class="question">
    <h3 id="question-questions-5"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

    <ol>
      <li>Why are there zeroes along the diagonal of the above example distance matrix?</li>
      <li>Is there any symmetry in this matrix?</li>
    </ol>

    <blockquote class="solution">
      <h3 id="solution-solution-5"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

      <ol>
        <li>The distance between a point to itself is - nothing!</li>
        <li>The distance between point <em>a</em> to point <em>b</em> is the same as the distance between point <em>b</em> to point <em>a</em> using the Euclidean distance metric.</li>
      </ol>

    </blockquote>

  </blockquote>

</blockquote>

<p>The first three plots in the PDF report tell us about the stability/reliability of our clusters, and are more important indicators for the quality of our clustering than any of the resultant graph projections, such as PCA or tSNE.</p>

<figure id="figure-6"><img src="/training-material/topics/transcriptomics/images/raceid_sat_jacc.png" alt="Stability Plots" /><figcaption><span class="figcaption-prefix">Figure 6:</span> RaceID Saturation and Jaccard Distance Plots</figcaption></figure>

<ul>
  <li>
    <p>(Top-Left) Dispersion within each cluster for given K values, with mean change in dispersion for said K value overlayed.</p>
  </li>
  <li>
    <p>(Top-Right) Same as top-left, but with the actual dispersion plotted instead of the relative change of dispersion.</p>
  </li>
  <li>
    <p>(Bottom-Left) Stability for each cluster using <a href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a>.</p>
  </li>
</ul>

<blockquote class="details">
  <h3 id="details-details-raceid-plots"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: RaceID Plots</h3>
  <ul>
    <li>
      <p>The first plot measures the levels of dispersion within each cluster and displays the mean dispersion over all clusters for each k value. The grey points indicate the mean change in dispersion for that k values, and the red bars show this dispersion as a box plot, which get smaller and smaller until a ‚Äúsaturation point‚Äù (blue) is reached where the change in dispersion no longer decreases for an increase in k.</p>
    </li>
    <li>
      <p>For example, if <em>k=2</em>, then all cells will be sorted into 2 clusters, and the variance of the gene <span class="notranslate">expression</span> in each cluster will be measured and averaged to give a score for the clustering at that k value. Certain values of <em>k</em> may cluster the cells of the same type better, with the expectation that the average dispersion of <span class="notranslate">expression</span> values across all clusters will be minimised for some value of <em>k</em>. As <em>k</em> increases, the reduction in this dispersion is measured for each increase of <em>k</em> until the change in the mean within-cluster dispersion no longer changes. Here we can see that reduction saturates at <em>k=12</em>, which is chosen to the be the number of clusters detected in our data for all further analysis.</p>
    </li>
    <li>
      <p>The third plot measures the direct stability of each of the derived (in this case, 12) clusters using the Jaccard distance, which is a fractional quantity that measures the dissimilarity between two sets as measured by overlap divided by the union of both sets.</p>
    </li>
  </ul>

</blockquote>

<blockquote class="details">
  <h3 id="details-details-jaccard-distance"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Jaccard Distance</h3>

  <p>Jaccard distance is measured by the intersection of the two or more sets divided by the union of those sets.</p>

  <p>\(d_J(X,Y) = 1 - J(X,Y) = \frac{|X \cup  Y| - |X \cap Y|}{|X \cup Y|}\)
<!-- This seems to be visible when collapsed...? --></p>

  <p>In the case of <span class="notranslate">single-cell</span> data, sets are defined as the cells contained within a given cluster, and the Jaccard similarity score provides a quantitative measure for how distinct a given cluster is, based on its similarity to other sets.</p>

  <figure id="figure-7"><img src="/training-material/topics/transcriptomics/images/raceid_jaccard.svg" alt="Jaccard" /><figcaption><span class="figcaption-prefix">Figure 7:</span> Example Jaccard Distance calculation</figcaption></figure>

</blockquote>

<p>Here, for each of the 12 clusters, the (top N) genes expressed by the cells in each cluster are intersected with the (top N) genes expressed by the cells in all other clusters to measure how unique the <span class="notranslate">expression</span> profile is to that specific cluster. The scales given by the plot are actually measuring the dissimilarity between sets, which is one minus the index, therefore a higher y-value is better.</p>

<p>Ideally the Jaccard distance should have above 0.6 in most clusters, but it is acceptable to have one or two more poorly defined clusters.</p>

<h2 id="outlier-detection">Outlier Detection</h2>

<p>Outlier detection attempts to refine the initially detected clusters to find smaller (sub-)clusters that could be used to define rarer cell types.</p>

<p>The next three plots attempts to do this by describing the variation of the gene <span class="notranslate">expression</span>, given by; a Background plot, a Sensitivity plot, and an Outlier probability plot.</p>

<figure id="figure-8"><img src="/training-material/topics/transcriptomics/images/raceid_gexpr.png" alt="Gene Expression Plots" /><figcaption><span class="figcaption-prefix">Figure 8:</span> RaceID Gene <span class="notranslate">Expression</span> Plots</figcaption></figure>

<ul>
  <li>
    <p>(Top-Left) Outlier identification via background model based on distribution of transcript counts within a cluster.</p>
  </li>
  <li>
    <p>(Top-Right) Outlier cells are detected if the probability for that cell \(c\) that a minimum number of genes \(G_{min}\) of observing total counts \(T_{G_{min}}\) is less than a specific threshold \(P_{thr}\), as given by the red dotted line.</p>
  </li>
  <li>
    <p>(Bottom-Left) Outlier probabilities of all cells in all clusters.</p>
  </li>
</ul>

<blockquote class="details">
  <h3 id="details-details-raceid-outlier-identification"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: RaceID Outlier Identification</h3>
  <ul>
    <li>(Top-Left) A background model is calibrated and outliers are identified based on the distribution of transcript counts within a cluster. The counts for each gene are assumed to follow a negative binomial distribution determined by the average <span class="notranslate">expression</span> of a gene across all cells in a cluster, along with a dispersion parameter.
      <ul>
        <li>The dispersion is derived from the average variance-mean dependence, modelled as a logarithmic second order polynomial under the assumption that:
          <ol>
            <li>Most genes are not differentially expressed between clusters</li>
            <li>True biological variability is located within a handful of genes</li>
          </ol>
        </li>
        <li>In the background model, the upper and lower (violet and red) regression of the variance on the mean (as approximated by a second-order polynomial in logarithmic space) is higher than the variance of most genes (all grey dots below the red curve). This is expected since they are not differentially expressed, and so the genes above the background regression are therefore significant in the detection of outlier cells. The orange line is the local regression (moving average variance per mean) and is used purely for illustrative purposes. <!-- See: https://github.com/dgrun/RaceID3_StemID2_package/blob/master/R/RaceID.R#L280 --></li>
      </ul>
    </li>
    <li>(Top-Right) Outlier cells are detected if the probability for that cell \(c\) that a minimum number of genes \(G_{min}\) of observing total counts \(T_{G_{min}}\) is less than a specific threshold \(P_{thr}\), as given by the red dotted line.
      <ul>
        <li>This is shown in the chart above as the number of outliers as a function of the probability threshold, which is set to \(1 \cdot 10^{-3}\) by default. Ideally, this threshold should be chosen so that the lower tail of the distribution contains as few outliers as possible (i.e. lower than the steep rise in outliers towards the higher end of the plot) to ensure a maximum sensitivity of this method. If the sensitivity of the sequencing was low, then only a few highly expressed genes would be reliably quantified, so the outlier probability threshold would need to be higher (e.g. up to 1).</li>
      </ul>
    </li>
    <li>(Bottom-Left) A bar plot of the outlier probabilities of all cells across all clusters. All outlier cells are merged into their own clusters if their similarity exceeds a quantile threshold of the similarity distribution for all pairs of cells within one of the original clusters. After the outlier cells are merged, then the new cluster centres are defined for the original clusters after removing the outliers. Then, each cell is assigned to the nearest cluster centre using k-partitioning.</li>
  </ul>

</blockquote>

<p>The most differentially expressed genes (below a maximum p-value cutoff) in each of the clusters can be seen in the output file <em>Clustering using RaceID on data: Cluster - Genes per Cluster</em>, with 7 columns describing:</p>

<table>
  <thead>
    <tr>
      <th>Column</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>.</strong></td>
      <td>Gene Name</td>
    </tr>
    <tr>
      <td><strong>n</strong></td>
      <td>Cluster number</td>
    </tr>
    <tr>
      <td><strong>mean.ncl</strong></td>
      <td>Mean <span class="notranslate">expression</span> of gene across cells <em>outside</em> the cluster</td>
    </tr>
    <tr>
      <td><strong>mean.cl</strong></td>
      <td>Mean <span class="notranslate">expression</span> of gene across cells <em>inside</em> the cluster</td>
    </tr>
    <tr>
      <td><strong>fc</strong></td>
      <td>Fold-change of mean <span class="notranslate">expression</span> in the cluster, against all remaining cells</td>
    </tr>
    <tr>
      <td><strong>pv</strong></td>
      <td>Inferred p-value for differential <span class="notranslate">expression</span></td>
    </tr>
    <tr>
      <td><strong>padj</strong></td>
      <td>Adjusted p-value using the Benjami-Hochberg correction for the false discovery rate</td>
    </tr>
  </tbody>
</table>

<blockquote class="question">
  <h3 id="question-questions-6"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>What is the most significant differentially expressed gene in Cluster 5?</li>
    <li>Which cluster has the most genes with a fold-change greater than 30?
      <blockquote class="tip">
        <h3 id="tip-tip"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip</h3>
        <p>One way to answer is this is to scroll through the list and make a mental note of all the genes with a high fold-change value‚Ä¶</p>

        <p>‚Ä¶but a <em>better</em> way is to sort the data in descending order on Column 5 using the <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> <strong>Sort</strong> tool.</p>

      </blockquote>
    </li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-6"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>The <em>Genes per Cluster</em> dataset is already sorted by cluster number and then by the adjusted p-value. Scrolling down to the first gene that is in cluster 5, we see that <em>Dmbt11</em> is the most significant gene in that cluster with an adjusted p-value of <code class="language-plaintext highlighter-rouge">2e-30</code>.</li>
      <li>Cluster 11 appears to have the most genes with a fold-change greater than 30.</li>
    </ol>

  </blockquote>

</blockquote>

<h2 id="heatmaps">Heatmaps</h2>

<p>The remainder of the plots are heatmaps derived from k-medoids clustering, showing the similarity between clusters for both the initial clustering and the final (post outlier detection) clustering.</p>

<blockquote class="details">
  <h3 id="details-details-k-medoids-and-k-means-clustering"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: K-medoids and K-means Clustering</h3>

  <p>The k-medoids algorithm relates to the k-means algorithm of clustering, by which</p>

  <ul>
    <li>Initialise:
      <ol>
        <li>A value of k is chosen, e.g <em>k=3</em>.</li>
        <li>k points are chosen at random in the dataset (or initialised in some rational way)</li>
      </ol>
    </li>
    <li>Step:
      <ol>
        <li>Each datapoint in the dataset is assigned to the closest k point using some distance metric.</li>
        <li>The mean (or in this case, the median) of all points assigned to a specific k point are computed for each k point.</li>
        <li>The k-points take on the new position of the mean (or median) values just computed</li>
        <li>Repeat Step until convergence reached or after N number of iterations</li>
      </ol>
    </li>
  </ul>

  <figure id="figure-9"><img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/K-means_convergence.gif" alt="K-means" /><figcaption><span class="figcaption-prefix">Figure 9:</span> K-means convergence (Wikimedia Commons)</figcaption></figure>

  <p>In terms of <span class="notranslate">single-cell</span> data, for <em>G</em> genes, each datapoint is a G-dimensional cell. The distances between cells are computed using a <a href="#performing-the-clustering">given metric</a>, and the k points are G-dimensional points indicating the centre of cluster. The k points are then updated for each iteration of the algorithm.</p>

  <blockquote class="question">
    <h3 id="question-questions-7"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

    <p>Why use G dimensions?</p>

    <p>Why not use 2 dimensions as given in the graphic above?</p>

    <blockquote class="solution">
      <h3 id="solution-solution-7"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

      <p>Using 2 dimensions will not capture all the variability in the data, and so the clustering will be based on whatever those 2 chosen dimensions are biased towards.</p>

      <p>For example, if we performed a PCA first on the data and used only the first two (most variable) components of the data to perform clustering upon, we might be clustering cells based on cell-cycle variation which might be stronger than the actual biological signal that is perhaps hidden away in the higher PCA components.</p>

    </blockquote>

  </blockquote>

</blockquote>

<figure id="figure-10"><img src="/training-material/topics/transcriptomics/images/raceid_heatmaps.png" alt="Heatmaps" /><figcaption><span class="figcaption-prefix">Figure 10:</span> RaceID Heatmaps for initial and final clusters</figcaption></figure>

<p>The difference shown between the initial and final clustering is sometimes subtle depending which of the clusters the new clusters have been extracted from.</p>

<blockquote class="question">
  <h3 id="question-questions-8"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>Which new clusters have been added?</li>
    <li>From which cells are these new clusters derived from?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-8"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">c13</code> and <code class="language-plaintext highlighter-rouge">c14</code></li>
      <li><code class="language-plaintext highlighter-rouge">c13</code> appears between <code class="language-plaintext highlighter-rouge">c8</code> and <code class="language-plaintext highlighter-rouge">c1</code>, suggesting that the cells in <code class="language-plaintext highlighter-rouge">c13</code> share a closer similarity to the cells in these clusters, which they were most likely extracted from. The other new cluster <code class="language-plaintext highlighter-rouge">c14</code> is between <code class="language-plaintext highlighter-rouge">c11</code> and <code class="language-plaintext highlighter-rouge">c6</code>, suggesting similar points of extraction.</li>
    </ol>

  </blockquote>

</blockquote>

<p>All the following plots are heatmaps for the individual genes expressed in each cluster.</p>

<figure id="figure-11"><img src="/training-material/topics/transcriptomics/images/raceid_geneheatmaps.png" alt="Gene Heatmaps" /><figcaption><span class="figcaption-prefix">Figure 11:</span> RaceID Individual (final) heatmaps for the top 10 significant genes in clusters 1 to 4</figcaption></figure>

<p>The top 10 defining genes from each cluster (above only <code class="language-plaintext highlighter-rouge">c1</code>-<code class="language-plaintext highlighter-rouge">c4</code> are shown) give us an idea of how unique these genes are to the cluster.</p>

<blockquote class="question">
  <h3 id="question-questions-9"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>Which clusters are <em>Gstm3</em>, <em>St3gal4</em>, and <em>Gna11</em> highly expressed in?</li>
    <li>Where is <em>Eef1a1</em> expressed?</li>
    <li>Which cluster is poorly defined?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-9"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>(Top-Left Heatmap) <em>Gstm3</em>, <em>St3gal4</em>, and <em>Gna11</em> are highly expressed in <code class="language-plaintext highlighter-rouge">c1</code> and <code class="language-plaintext highlighter-rouge">c6</code></li>
      <li><em>Eef1a1</em> is highly expressed everywhere, and so is not a very differentially expressed gene.</li>
      <li><code class="language-plaintext highlighter-rouge">c4</code> appears to be a not so well-defined cluster with no genes specifically bound to it.</li>
    </ol>
  </blockquote>

</blockquote>

<h2 id="visualising-all-clusters">Visualising All Clusters</h2>

<p>The previous section produced plots that spoke about the quality of the clustering without really showing us the clusters projected into an understandable 2D space. To perform this, we must feed the clustered data into the cluster inspection tool.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-task-description-2"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Task description</h3>

  <ol>
    <li><strong>Cluster Inspection using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RaceID RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Clustering using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúPlot All Clusters?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>‚ÄúPerform Subset Analysis?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúExamine Genes of Interest‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúDifferential Gene Testing‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-comment"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment</h3>

        <p>This tool can perform multiple different modes of inspection upon clustered sc<span class="notranslate">RNA</span> data, and users are encouraged to explore the different modes.</p>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p>The main issue with visualising this data is that as before, we have C cells that serve as our observations which are described by G genes. Representing G dimensional data in the 2 or 3 dimensional plots that we are more familiar falls under the problem of <a href="https://en.wikipedia.org/wiki/Dimensionality_reduction"><em>dimensional reduction</em></a>.</p>

<blockquote class="details">
  <h3 id="details-details-dimension-reduction"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Dimension Reduction</h3>
  <figure id="figure-12"><img src="/training-material/topics/transcriptomics/images/raceid_dimred.svg" alt="Dim red" /><figcaption><span class="figcaption-prefix">Figure 12:</span> Reducing a set of 4 observations from 3D to 2D space, whilst approximating the 3D relationships</figcaption></figure>

  <p>Dimension reduction aims to preserve the distances and relationship of the higher dimensional (G-dimensional) data in a lower dimensional (usually 2D) space.</p>

</blockquote>

<p>Preserving these higher dimensional distances in lower dimensional space is a complex and ongoing challenge in computer science, but there are various commonly-used methods such as PCA and tSNE often encountered in <span class="notranslate">single cell</span> <span class="notranslate">RNA</span>-seq datasets. For more information, see the box below.</p>

<blockquote class="details">
  <h3 id="details-details-pca-tsne-and-force-directed-graphs"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: PCA, tSNE, and Force-Directed Graphs</h3>

  <ul>
    <li><strong>PCA</strong> (Principle Component Analysis)
      <ul>
        <li>This linearly separates the N-dimensional data into N distinct components (or ‚Äòaxes‚Äô) of variability, sorted in descending order of variability (i.e. the first component explains most of the variation in the data, the second component contributes the second most amount of variation in the data, etc). For more information on how these components are derived, see <a href="https://en.wikipedia.org/wiki/Eigendecomposition_of_a_matrix"><em>Eigendecomposition of a matrix</em></a>.</li>
        <li>PCA has the benefit of being deterministic, uncostly to implement, and usually good enough to find clear differences in the data if the data is not complex.</li>
      </ul>
    </li>
    <li><strong>tSNE</strong> (T-distributed Stochastic Neighbour Embedding)
      <ul>
        <li>PCA rests on the assumption that each of its N components are independent of one another, but this is often rarely the case and data usually exhibits more complexity than that of a linearly separable dataset. In these situations, tSNE outshines PCA, by modelling a more complex relationship between datapoints, and often produces better looking plots with more clearly defined clusters. This is especially the case in <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span>-seq data which tends to describe a continuous blend of cell phenotypes, instead of discrete rigidly-defined types.</li>
      </ul>
    </li>
    <li><strong>Force-Directed</strong> Graphs
      <ul>
        <li>These graphs can be better thought of as particle simulations, instead of performing any dimensional reduction, since all that is required is a connected graph. Forces are added to the connections between the nodes on the graph based on the strength of the connection, and then the whole system simulates the interplay of these forces for a number of iterations or until the system comes to rest. In general, these tend to yield much more nicely separated plots than tSNE, but it is not always the case and so it is always good practice to compare both force-directed and tSNE plots.</li>
      </ul>
    </li>
  </ul>

</blockquote>

<p><strong>RaceID</strong> makes use of tSNE and force-directed (Fruchterman-Reingold) graph layouts to space the clusters in a visually meaningful manner to show the separation and relative proximity of clusters to one another.</p>

<figure id="figure-13"><img src="/training-material/topics/transcriptomics/images/raceid_tsne_fr.png" alt="Clusters" /><figcaption><span class="figcaption-prefix">Figure 13:</span> RaceID Initial and Final clusters using tSNE and F-R projections</figcaption></figure>

<p>The figure above displays the initial (left top/bottom) clusters detected during the clustering stage, as well as the final (right top/bottom) clusters determined during the outlier detection stage, projected using tSNE and Fruchterman-Rheingold graph layouts.</p>

<blockquote class="question">
  <h3 id="question-questions-10"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>What has changed between the initial and final plots?</li>
    <li>Which clusters appear to be well defined? Are they consistent between projections?</li>
    <li>Does this agree with the heatmaps we have seen previously?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-10"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>Two extra clusters are added in the final plots <code class="language-plaintext highlighter-rouge">c13</code> and <code class="language-plaintext highlighter-rouge">c14</code></li>
      <li>For example, <code class="language-plaintext highlighter-rouge">c11</code> appears to be an isolated well-defined cluster of cells, distinct in both projections. At the edge of the main cluster body in both projections lies <code class="language-plaintext highlighter-rouge">c1</code>, but seems to be in closer proximity to <code class="language-plaintext highlighter-rouge">c13</code> in the tSNE map than in the F-R layout. In both projections, <code class="language-plaintext highlighter-rouge">c2</code>, <code class="language-plaintext highlighter-rouge">c3</code>, and <code class="language-plaintext highlighter-rouge">c4</code> are large noisy clusters, but <code class="language-plaintext highlighter-rouge">c2</code> and <code class="language-plaintext highlighter-rouge">c4</code> appear to be closer to one another in the F-R layout.</li>
      <li><code class="language-plaintext highlighter-rouge">c1</code> was better defined by a smaller set of genes than <code class="language-plaintext highlighter-rouge">c2</code>, <code class="language-plaintext highlighter-rouge">c3</code>, or <code class="language-plaintext highlighter-rouge">c4,</code> which listed less differentially expressed genes as their most significant genes.</li>
    </ol>

  </blockquote>

</blockquote>

<h3 id="is-this-expected">Is this expected?</h3>

<p>One pervasive thought when analysing <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span> data, is ‚Äú<em>is this actually good clustering?</em>‚Äù</p>

<p>To answer this question, we must understand the nature of the data which <em>does</em> contain clear cell type phenotypes, but that these cell phenotypes are driven by continuous cell-cycle and cell developmental processes. As a result it is quite normal to see clusters ‚Äòblending‚Äô into one another, since these suggest intermediate cell types that are transitioning from one cell type to another.</p>

<blockquote class="details">
  <h3 id="details-details-continuous-phenotypes-vs-discrete-clustering-methods"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: Continuous Phenotypes vs Discrete Clustering Methods</h3>

  <figure id="figure-14"><img src="/training-material/topics/transcriptomics/images/raceid_contpheno.svg" alt="Continuous Phenotypes" /><figcaption><span class="figcaption-prefix">Figure 14:</span> The continuous phenotypes along a red blood cell development trajectory</figcaption></figure>

  <p>The gene <span class="notranslate">expression</span> profile for Reticulocytes is distinct from the gene <span class="notranslate">expression</span> profile for the mature Red Blood Cells that they will become, but the cells that are actually undergoing this short-lived transition from Reticulocyte to Red Blood Cell will not fit neatly into the two aforementioned gene <span class="notranslate">expression</span> profiles, instead having their own profile which lies somewhere in between.</p>

  <p>As a result it is often false to think of cell clustering as an exercise in classification, but better to be thought of as a desire to find the relatedness between <span class="notranslate">expression</span> profiles. A helpful visual example of this is to not think of assigning cells to different disconnected ‚Äòpeaks‚Äô of <span class="notranslate">expression</span>, but to place cells along an <span class="notranslate">expression</span> peak landscape that describes not only which <span class="notranslate">expression</span> profile they resemble the most, but along which gradient (or development trajectory) they adhere to, allowing transient cell types to be better assigned.</p>

  <figure id="figure-15"><img src="/training-material/topics/transcriptomics/images/raceid_mountains.svg" alt="Discrete vs Continuous" /><figcaption><span class="figcaption-prefix">Figure 15:</span> (Above) Cells assigned to discrete profiles, compared to (Below) Cells placed along a continuous <span class="notranslate">expression</span> profile landscape.</figcaption></figure>

  <p>The clustering of cells with <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span>-seq data, is therefore not a classification problem, but a <em>manifold</em> detection one, where the manifold ultimately describes the topology of the data, and allows us to see relatedness between clusters.</p>

</blockquote>

<h1 id="individual-cluster-inspection">Individual Cluster Inspection</h1>

<p>To really understand the dynamics in the shifting profiles of gene <span class="notranslate">expression</span>s between different clusters, it is often useful to see specifically which genes are differentially expressed, and which clusters and cells they align to or define the most.</p>

<p>There are three ways to do this in RaceID:</p>

<ol>
  <li>
    <p><strong>MA Plot</strong></p>

    <p>Perform a pairwise comparison between two clusters (or two sets of clusters) to see specifically which genes are differentially expressed between them.</p>
  </li>
  <li>
    <p><strong>Subset Cell Analysis</strong></p>

    <p>If the cell headers have names that contain information prior to the clustering about the different cell phenotypes, then it might be interesting to see if the cells do cluster as expected.</p>
  </li>
  <li>
    <p><strong>Specific <span class="notranslate">Expression</span> Plots</strong></p>

    <p>It may be of interest to look at how specific genes which may be markers for a cell type are expressed across different clusters, with the expectation that they are localised to a specific cluster depending on how specific the marker is.</p>
  </li>
</ol>

<h2 id="differential-gene-analysis-between-two-clusters">Differential Gene Analysis Between Two Clusters</h2>

<p>We will generate an <a href="https://en.wikipedia.org/wiki/MA_plot">MA Plot</a> between the two clusters, which looks at the differences between two samples by comparing the <em>M</em> (log ratio) against the <em>A</em> (mean average) of the sets.</p>

<p>Here we will compare how the cells in cluster 1 are differentially expressed compared to the cell of cluster 3.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-ma-plot"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: MA plot</h3>

  <ol>
    <li><strong>Cluster Inspection using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RaceID RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Clustering using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúPlot All Clusters?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúPerform Subset Analysis?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúExamine Genes of Interest‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúDifferential Gene Testing‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code>
          <ul>
            <li>In <em>‚ÄúCells in Set A‚Äù</em>:
              <ul>
                <li><em>‚ÄúName of Set‚Äù</em>: <code class="language-plaintext highlighter-rouge">Cells in 1</code></li>
                <li><em>‚ÄúSelection method‚Äù</em>: <code class="language-plaintext highlighter-rouge">Cluster Numbers</code>
                  <ul>
                    <li><em>‚ÄúList of clusters‚Äù</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>In <em>‚ÄúCells in Set B‚Äù</em>:
              <ul>
                <li><em>‚ÄúName of Set‚Äù</em>: <code class="language-plaintext highlighter-rouge">Cells in 3</code></li>
                <li><em>‚ÄúSelection method‚Äù</em>: <code class="language-plaintext highlighter-rouge">Cluster Numbers</code>
                  <ul>
                    <li><em>‚ÄúList of clusters‚Äù</em>: <code class="language-plaintext highlighter-rouge">3</code></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<figure id="figure-16"><img src="/training-material/topics/transcriptomics/images/raceid_clustinspect_cells.png" alt="Cluster Inspection of Cells" /><figcaption><span class="figcaption-prefix">Figure 16:</span> RaceID MA plot of cells in cluster 1 and cluster 3</figcaption></figure>

<p>The genes shown as grey dots are not labelled because they are not so differentially expressed between the two clusters, but the genes as labelled red dots on the fringes do display significant variability between the clusters.</p>

<blockquote class="question">
  <h3 id="question-questions-11"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How do we interpret this plot?</li>
    <li>Is <em>Gstm3</em> (at position 1.5, -2.7 on the MA plot) more significantly differentially expressed than <em>Ptma</em> (at position 3.6, 1.2)?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-11"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>Interpretation of plot:
        <ul>
          <li>The vertical axis displays the difference between cluster 3 and cluster 1, where the total counts of a gene in cluster 3 are subtracted by the total counts of a gene in cluster 1. Therefore, a gene which is in the negative portion of the vertical axis has more <span class="notranslate">expression</span> in cluster 1.</li>
          <li>The horizontal axis displays the average <span class="notranslate">expression</span> of a gene in both clusters, and so serves as a yardstick to estimate how expressive that gene is overall.</li>
        </ul>
      </li>
      <li><em>Gstm3</em> has a lower average <span class="notranslate">expression</span> in both clusters, than <em>Ptma</em> which is higher on the horizontal axis. However, <em>Gstm3</em> is expressed significantly more in Cluster 1, whereas <em>Ptma</em> is expressed only slightly more in Cluster 3. Overall, <em>Gstm3</em> is more differentially expressed than <em>Ptma</em>, and is up-regulated in Cluster 3, although with fewer total m<span class="notranslate">RNA</span> counts.</li>
    </ol>

  </blockquote>

</blockquote>

<h2 id="differential-gene-expression-across-all-clusters">Differential Gene <span class="notranslate">Expression</span> Across All Clusters</h2>

<p>We will now look at some genes of interest to see how prevalent or unique they are across clusters. Usually known marker genes are used to identify clusters by their cell type and not just a number, but any gene of interest can be used if it is believed to characterise a cluster of cells.</p>

<p>Here we will look at the combined <span class="notranslate">expression</span> of <em>Gstm3</em>, <em>St3gal4</em>, and <em>Gna11</em> which all had adjusted P-values of less than \(1 \cdot 10^{-15}\) in cluster 1.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-task-description-3"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Task description</h3>

  <ol>
    <li><strong>Cluster Inspection using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RaceID RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Clustering using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúPlot All Clusters?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúPerform Subset Analysis?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúExamine Genes of Interest‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code>
          <ul>
            <li><em>‚ÄúGenes to Examine‚Äù</em>: <code class="language-plaintext highlighter-rouge">Gstm3, St3gal4, Gna11</code></li>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
        <li><em>‚ÄúDifferential Gene Testing‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<figure id="figure-17"><img src="/training-material/topics/transcriptomics/images/raceid_goi.png" alt="Expression Plot" /><figcaption><span class="figcaption-prefix">Figure 17:</span> RaceID <span class="notranslate">Expression</span> plot of genes of interest across different cells.</figcaption></figure>

<p>The above figure shows where the combined <span class="notranslate">expression</span> of <em>Gstm3</em>, <em>St3gal4</em>, and <em>Gna11</em> is centred, which from the tSNE plot (top-left) appears to be concentrated in cluster 6. The log <span class="notranslate">expression</span> plot (top-right) changes the scale so that lesser <span class="notranslate">expression</span> in other clusters is still visible. The bottom images provide the same information but using the F-R layout.</p>

<blockquote class="question">
  <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Observe the above <span class="notranslate">expression</span> plot and the clustering plot generated during the ‚Äú<em>Visualising All Clusters</em>‚Äù step.</p>

  <p>Are these genes (the top 3 DE genes from cluster 1) expressed where we expect them to be?</p>

  <blockquote class="tip">

    <h3 id="tip-tip--using-the-scratchbook"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip : Using the Scratchbook</h3>

    <p>Multiple plots can be compared side-by-side by enabling the <em>Scratchbook</em></p>
    <ol>
      <li>Click on the <i class="fas fa-th" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-scratchbook</span> <em>Scratchbook</em> icon</li>
      <li>Click on the <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-eye</span> symbol of the first dataset</li>
      <li>Resize the window of the dataset to desired dimensions</li>
      <li>Click any point in the grey space to close the Scratchbook</li>
      <li>Click on the <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-eye</span> symbol of the second dataset</li>
      <li>Resize both windows to desired dimensions</li>
    </ol>
  </blockquote>

  <blockquote class="solution">
    <h3 id="solution-solution-12"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>They appear to overlap <code class="language-plaintext highlighter-rouge">c6</code> which is in close proximity to <code class="language-plaintext highlighter-rouge">c1</code>. There are two reasons why this might be the case:</p>
    <ol>
      <li><code class="language-plaintext highlighter-rouge">c1</code> is a small cluster and noisy cluster surrounded by more stably defined neighbours.</li>
      <li>The three genes are more differentially expressed in <code class="language-plaintext highlighter-rouge">c1</code> than in <code class="language-plaintext highlighter-rouge">c6</code>, but they are more highly expressed in <code class="language-plaintext highlighter-rouge">c6</code>. That is, their <span class="notranslate">expression</span> is more significant in <code class="language-plaintext highlighter-rouge">c1</code> compared to the rest of the genes in that cluster.</li>
    </ol>

  </blockquote>

</blockquote>

<h1 id="trajectory-and-lineage-analysis">Trajectory and Lineage Analysis</h1>

<p>It was <a href="#details-details-continuous-phenotypes-vs-discrete-clustering-methods">mentioned previously</a> that the clusters displayed are not discrete entities, but are related through some continuous topology as inferred by intermediate cell types.</p>

<p><strong>StemID</strong> is a tool (part of the <strong>RaceID</strong> package) that makes use of this topology to derive a hierarchy of these cell types by constructing a cell lineage tree, rooted at the cluster(s) believed to best describe multipotent progenitor stem cells, and terminating at the clusters which describe more mature cell types. Cell trajectories are identified as a sequence of links between the medoids of different clusters, where the links between clusters are assigned scores that reflect the level of multipotency of the cell type indicated by the cluster.</p>

<h2 id="computing-the-lineage-tree">Computing the Lineage Tree</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on</h3>

  <ol>
    <li><strong>Lineage computation using StemID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Clustering using RaceID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>‚ÄúCompute transcriptome entropy of each cell‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
        <li>In <em>‚ÄúCompute Cell Projections for Randomised Background Distribution‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
        <li>In <em>‚ÄúStemID2 Lineage Graph‚Äù</em>:
          <ul>
            <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

  <blockquote class="comment">
    <h3 id="comment-comment-1"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment</h3>

    <p>This tool has three main functions:</p>
    <ol>
      <li>Estimate the entropy (variability) of a cell</li>
      <li>Estimate links/trajectories between clusters of cells</li>
      <li>Generate a <a href="https://en.wikipedia.org/wiki/Minimum_spanning_tree">minimum spanning tree</a> for the connected graph of links.</li>
    </ol>

    <p>We use the defaults in this section, but leave the fine-tuning of these parameters as an exercise for the more the statistically enthusiastic users.</p>

  </blockquote>

</blockquote>

<figure id="figure-18"><img src="/training-material/topics/transcriptomics/images/raceid_stemid_lineage.png" alt="Lineage Computation Plots" /><figcaption><span class="figcaption-prefix">Figure 18:</span> StemID Lineage Tree and Branches of significance.</figcaption></figure>

<ul>
  <li>
    <p>(Top-Left) Minimum spanning tree showing most likely connections between clusters</p>
  </li>
  <li>
    <p>(Top-Right) Minimum spanning tree with projected time series</p>
  </li>
  <li>
    <p>(Bottom-Left) Significance between clusters</p>
  </li>
  <li>
    <p>(Bottom-Right) Link scores between cluster-cluster pairs</p>
  </li>
</ul>

<blockquote class="details">
  <h3 id="details-details-stemid-lineage-plots"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Details: StemID Lineage Plots</h3>

  <ul>
    <li>(Top-Left) A minimum spanning tree that summarises the most likely connections between clusters.</li>
    <li>(Top-Right) The same tree but with cells projected along the links given by StemID.
      <ul>
        <li>Ordering the cells along each link in such a way to suggest a time series, or <em>pseudo-time</em> analysis of each link. By ordering the cells by lineage pseudo-time we can trace the up/down regulation of a gene as discrete time points. The interval between each time point is hard to accurately determine, but the order of events is still important.</li>
      </ul>
    </li>
    <li>(Bottom-Left) The degree of significance between clusters, with:
      <ol>
        <li>Node Colour, indicating the level of significance between clusters
          <ul>
            <li>Blue: Higher level of cluster entropy (associated with progenitor cell types)</li>
            <li>Red: Lower level of cluster entropy (associated with mature types)</li>
          </ul>
        </li>
        <li>Link Width, indicating the link score computed by <strong>StemID</strong>.
          <ul>
            <li>Indicates the number of cells in the cluster sharing the link to other.</li>
          </ul>
        </li>
        <li>Link Colour, indicating link significance
          <ul>
            <li>Red: Stronger link level</li>
            <li>Green: Weaker link level</li>
          </ul>
        </li>
      </ol>
    </li>
    <li>(Bottom-Right) The link scores between each cluster-cluster pair.</li>
  </ul>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-12"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>Which cluster pairs are likely to be biologically significant?</li>
    <li>Based on the above plots, which cluster is most likely to be the main progenitor of the others?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-13"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>The thick red link between clusters 2-4, 3-5, and 3-1-6 are assumed to have a high level of biological significance.</li>
      <li>
        <p>On first glance, it appears that <code class="language-plaintext highlighter-rouge">c2</code> would be the progenitor, due to the number of links it has and its more central position in the cluster plot.</p>

        <ul>
          <li>
            <p><em>Cluster Tree Diagram:</em></p>

            <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  c2
  ‚îú‚îÄ c4
  ‚îú‚îÄ c9
  ‚îú‚îÄ c8
  ‚îÇ  ‚îú‚îÄ c11
  ‚îÇ  ‚îî‚îÄ c12
  ‚îÇ     ‚îî‚îÄ c10
  ‚îî‚îÄ c3
     ‚îú‚îÄ c5
     ‚îî‚îÄ c1
        ‚îî‚îÄ c6
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ol>

  </blockquote>

</blockquote>

<p>To see how the link score is actually calculated, the image below provides some context:</p>

<figure id="figure-19"><img src="/training-material/topics/transcriptomics/images/raceid_stemid_linkscores.png" alt="Link scores" /><figcaption><span class="figcaption-prefix">Figure 19:</span> StemID Link scores between branches.</figcaption></figure>

<p>The top of the three charts shows the number of links above a threshold that each cluster exhibits to another. The more links a cluster has, the more evidence that the cluster describes a progenitor cell type that gives rise to other more mature types.</p>

<p>The middle chart describes the ‚ÄúDelta-Entropy‚Äù which measures the variability of gene <span class="notranslate">expression</span> values within a cluster as the number of potential states (or cell types) it could produce, where clusters with more variability are less likely to be mature cell types due to the sheer ‚Äúnoise‚Äù that they exhibit that is to be expected of a cell type that could potentially give rise to other types.</p>

<p>The bottom chart is simply the top chart multiplied by the middle chart, which adds both pieces of evidence together to yield the link score.</p>

<blockquote class="question">
  <h3 id="question-questions-13"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p>With this new information, which cluster is now most likely to be the sole progenitor?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-14"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p><code class="language-plaintext highlighter-rouge">c3</code> has both the most number of links as well as the most entropy that one would expect a multipotent progenitor cell type to exhibit, and therefore must be the root of the lineage tree, despite having the same number of links as <code class="language-plaintext highlighter-rouge">c2</code>. The more centred position of <code class="language-plaintext highlighter-rouge">c2</code> in the plots has no bearing on it being the initial progenitor type.</p>

    <ul>
      <li>
        <p><em>Cluster Tree Diagram:</em></p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  c3
  ‚îú‚îÄ c5
  ‚îú‚îÄ c1
  ‚îÇ  ‚îî‚îÄ c6
  ‚îî‚îÄ c2
     ‚îú‚îÄ c4
     ‚îú‚îÄ c9
     ‚îî‚îÄ c8
        ‚îú‚îÄ c11
        ‚îî‚îÄ c12
            ‚îî‚îÄ c10
</code></pre></div>        </div>
      </li>
    </ul>

  </blockquote>

</blockquote>

<!--
<figure id="figure-20"><img src="/training-material/topics/transcriptomics/images/raceid_stemid_other.png" alt="Other link scores" ><figcaption><span class="figcaption-prefix">Figure 20:</span> Other link scores between branches.</figcaption></figure>
-->

<p>In a similar vein to how clusters were explored individually in RaceID, we can also explore individual branches of the lineage tree to see how some genes are up or down regulated.</p>

<h2 id="specific-trajectory-lineage-analysis-stemid">Specific Trajectory Lineage Analysis (StemID)</h2>

<p>Here we will explore one branching point of interest; <code class="language-plaintext highlighter-rouge">c3</code> giving rise to <code class="language-plaintext highlighter-rouge">c1</code> and <code class="language-plaintext highlighter-rouge">c5</code>. Will we be able to find an up or down regulation of genes between these two branches?</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-comparing-trajectory-paths-3-to-1-and-3-to-5"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Comparing trajectory paths 3 to 1, and 3 to 5</h3>

  <ol>
    <li><strong>Lineage Branch Analysis using StemID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Lineage computation using StemID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>‚ÄúStemID Branch Link Examine‚Äù</em>:
          <ul>
            <li><em>‚ÄúPerform StemID?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code>
              <ul>
                <li><em>‚ÄúCluster Number‚Äù</em>: <code class="language-plaintext highlighter-rouge">3</code></li>
                <li><em>‚ÄúTrajectory Path i, j, k‚Äù</em>: <code class="language-plaintext highlighter-rouge">1,3,5</code></li>
                <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>In <em>‚ÄúFateID Branch Link Examine‚Äù</em>:
          <ul>
            <li><em>‚ÄúPerform FateID?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

  <blockquote class="comment">
    <h3 id="comment-comment-2"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment</h3>

    <p>This tool requires trajectories to be numerical order, hence the ‚Äú<em>1,3,5</em>‚Äù ordering.</p>

  </blockquote>

</blockquote>

<figure id="figure-21"><img src="/training-material/topics/transcriptomics/images/raceid_stemid_cells.png" alt="Heatmap Cells" /><figcaption><span class="figcaption-prefix">Figure 21:</span> (Top) StemID Minimal spanning tree of all cells projected along the links between clusters. (Bottom) StemID Heatmap of Cluster 3 cells compared to other clusters.</figcaption></figure>

<p>The vertical names along the heatmap are the cells from <code class="language-plaintext highlighter-rouge">c3</code> being compared to all other clusters.</p>

<blockquote class="question">
  <h3 id="question-questions-14"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How does the heatmap correlate to the minimum spanning tree (MST)?</li>
    <li>How many <code class="language-plaintext highlighter-rouge">c3</code> cells are strongly <em>dissimilar</em> to cells in <code class="language-plaintext highlighter-rouge">c2</code>, <code class="language-plaintext highlighter-rouge">c4</code>, <code class="language-plaintext highlighter-rouge">c9</code>, <code class="language-plaintext highlighter-rouge">c8</code>, and <code class="language-plaintext highlighter-rouge">c11</code>. Where are they plotted on the MST?</li>
    <li>Many <code class="language-plaintext highlighter-rouge">c3</code> cells appear to have stronger (red/orange) correlation to <code class="language-plaintext highlighter-rouge">c2</code> and <code class="language-plaintext highlighter-rouge">c4</code>, instead of the expected <code class="language-plaintext highlighter-rouge">c5</code> and <code class="language-plaintext highlighter-rouge">c1</code> shown in the MST, yet <code class="language-plaintext highlighter-rouge">c2</code> is further away than <code class="language-plaintext highlighter-rouge">c5</code> or <code class="language-plaintext highlighter-rouge">c1</code>. Why is this?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-15"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>Each <code class="language-plaintext highlighter-rouge">c3</code> cell in the heatmap is ‚Äúpulled‚Äù towards different clusters along a straight line in the MST. The degree to which it is pulled is given by the strength of the correlation of that cell to that cluster. For example cell <em>I5d_45</em> has a very strong correlation to <code class="language-plaintext highlighter-rouge">c12</code> and <code class="language-plaintext highlighter-rouge">c10</code>, and so it appears on the MST as a single (3) lying in between the <code class="language-plaintext highlighter-rouge">c3</code>,<code class="language-plaintext highlighter-rouge">c12</code>,<code class="language-plaintext highlighter-rouge">c10</code> triangle.</li>
      <li>10 <code class="language-plaintext highlighter-rouge">c3</code> cells (III5d-53 to I5d-48) show negative (blue) correlation to these clusters, and these same cells have a strong correlation to <code class="language-plaintext highlighter-rouge">c5</code> or <code class="language-plaintext highlighter-rouge">c1</code> clusters. We can see these cells plotted along the links to these two clusters.</li>
      <li>The <code class="language-plaintext highlighter-rouge">c3</code> cells strongly correlated to <code class="language-plaintext highlighter-rouge">c2</code> and <code class="language-plaintext highlighter-rouge">c4</code> are also strongly correlated to <code class="language-plaintext highlighter-rouge">c9</code>, <code class="language-plaintext highlighter-rouge">c8</code>, and <code class="language-plaintext highlighter-rouge">c11</code> - i.e. these cells have noisy profiles and are outliers in <code class="language-plaintext highlighter-rouge">c3</code>. Note that the 10 cells we identified in the previous question are not strongly correlated to other clusters except <code class="language-plaintext highlighter-rouge">c5</code> and <code class="language-plaintext highlighter-rouge">c1</code>, meaning they have very clear trajectories.</li>
    </ol>

  </blockquote>

</blockquote>

<!--  This table is confusing and I doubt anyone will use it.

The *Differential Genes* tabular file provides an ordered list of z-scores indicating the degree of up-regulation from the link 3 to 1 compared to 3 to 5, for `c3` cells.


 | Gene | Z-score |
 |------|---------------------------|
 | Chmp1a | 1.35614489404017 |
 | Prpsap1 | 1.27561406917734 |
 | Cyb5r3 | 1.24373637026355 |
 | St3gal4 | 1.07824983159662 |
 | Atp5g1 | 1.07747110336794 |
 | Abcb1a | 1.06445701695433 |
 | Tlr3 | 1.05483917876983 |
 | Mrpl9 | 1.04546441547305 |
 | Ces2a | 1.03563183389053 |
 | Dgat1 | 0.996275665669355 |

Unsurprisingly, there is a higher score for the 3 to 1 trajectory for `c1` cells.
-->

<h2 id="specific-trajectory-fate-analysis-fateid">Specific Trajectory Fate Analysis (FateID)</h2>

<p>One final trajectory analysis that can be performed uses <strong>FateID</strong>, which tries to quantify the cell fate bias a progenitor type might exhibit to indicate which lineage path it will pursue.</p>

<p>Where <strong>StemID</strong> utilises a bottom-up approach by starting from mature cell types and working up to the multi-potent progenitor, <strong>FateID</strong> uses top-down approach that starts from the progenitor and works its way down.</p>

<p>Here we will see if we can see any pseudo-time dynamics taking place between the branching point (3 to 1, and 3 to 5) that we explored previously.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-1"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on</h3>

  <ol>
    <li><strong>Lineage Branch Analysis using StemID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúInput RDS‚Äù</em>: <code class="language-plaintext highlighter-rouge">outrdat</code> (output of <strong>Lineage computation using StemID</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>‚ÄúStemID Branch Link Examine‚Äù</em>:
          <ul>
            <li><em>‚ÄúPerform StemID?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
          </ul>
        </li>
        <li>In <em>‚ÄúFateID Branch Link Examine‚Äù</em>:
          <ul>
            <li><em>‚ÄúPerform FateID?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code>
              <ul>
                <li><em>‚ÄúCells from Clusters‚Äù</em>: <code class="language-plaintext highlighter-rouge">1,3,5</code></li>
                <li><em>‚ÄúUse Defaults?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
                <li><em>‚ÄúPerform Additional FateID Analysis with Self-Organised Map?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<figure id="figure-22"><img src="/training-material/topics/transcriptomics/images/raceid_fateid.png" alt="Heatmap FateID" /><figcaption><span class="figcaption-prefix">Figure 22:</span> FateID Heatmap</figcaption></figure>

<p>The heatmaps generated depict the same data, but at different ‚Äúheat‚Äù scales to better colourise the map. The genes here are not genes, but are gene <span class="notranslate">expression</span> modules, which can be interpreted as gene motifs that are present in both <code class="language-plaintext highlighter-rouge">c1</code> and <code class="language-plaintext highlighter-rouge">c5</code>, but at different levels of <span class="notranslate">expression</span>.</p>

<blockquote class="question">
  <h3 id="question-questions-15"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>To which trajectory are gene modules 1-17 up regulated?</li>
    <li>Do modules 18-40 exhibit a similar pattern?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-16"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>We can see a significant up-regulation in the <span class="notranslate">expression</span> of the 1-17 modules along the 3 to 1 trajectory, which does not exist in the 3 to 5 trajectory.</li>
      <li>The 18-40 modules are down-regulation in the 3 to 1 trajectory, and constant <span class="notranslate">expression</span> along the 3 to 5 trajectory.</li>
    </ol>
  </blockquote>

</blockquote>

<h1 class="no_toc" id="conclusion">Conclusion</h1>

<p>In this tutorial we have learned to filter, normalise, and cluster cells from heterogeneous <span class="notranslate">single-cell</span> <span class="notranslate">RNA</span>-seq data. We have explored the <span class="notranslate">expression</span> of marker genes and performed a differential gene <span class="notranslate">expression</span> analysis between two sets of clusters. We have also constructed a lineage tree from these clusters, and analysed different branching points of interest to infer a pseudo-time ordering of cells as determined by the regulation of their genes.</p>

<p>The steps of this <span class="notranslate">workflow</span> can be found in the related <span class="notranslate">workflow</span>.</p>

<figure id="figure-23"><img src="/training-material/topics/transcriptomics/images/raceid_workflow.png" alt="Workflow" /><figcaption><span class="figcaption-prefix">Figure 23:</span> RaceID <span class="notranslate">Workflow</span></figcaption></figure>

<p>All steps of the <span class="notranslate">workflow</span> have produced an R Data object (RDS) that serves as an input into the next step, but these objects can also be loaded into an R environment and analysed using any desired library.</p>


                    
                    <blockquote class="key_points">
                        <h3><i class="fas fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>
                        <ul>
                            
                            <li><p>Clustering single-cell RNA-seq data is often noisy</p>
</li>
                            
                            <li><p>RaceID can be used to cluster cells based on the their gene expression profiles</p>
</li>
                            
                            <li><p>StemID describes a hierarchical relationship between clusters to find multipotent progenitor stem cells to provide an understanding of cell development</p>
</li>
                            
                            <li><p>FateID predicts the potential lineages that cells within specific clusters are inclined towards</p>
</li>
                            
                        </ul>
                    </blockquote>
                    

                    
                    <h1 data-toc-skip>Useful literature</h1>
                    <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/transcriptomics#references">here</a>.</p>
                    

                    

                    <h1>Feedback</h1>
                    <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                    <div id="feedback-button">
                        <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                    </div>
                    <div id="feedback-form">
                    </div>
                    <script type="text/javascript">
                        (function (window, document) {
                            function onDocumentReady(fn) {
                                if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                    fn();
                                } else {
                                    document.addEventListener('DOMContentLoaded', fn);
                                }
                            }

                            onDocumentReady(function () {
                                $("#feedback-button").click(function(evt){
                                    var e = $(evt.target)
                                    e.hide();

                                    $("#feedback-form").html(`
                                        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Downstream Single-cell RNA analysis with RaceID (Transcriptomics)">Loading...</iframe>
                                    `)
                                })
                            });
                        })(window, document);
                    </script>



                    <h1>Citing this Tutorial</h1>
                    <p>
                        <ol>
                            <li id="citation-text">Mehmet Tekman, Alex Ostrovsky, 2021 <b>Downstream Single-cell RNA analysis with RaceID (Galaxy Training Materials)</b>. <a href="/training-material/topics/transcriptomics/tutorials/scrna-raceid/tutorial.html">/training-material/topics/transcriptomics/tutorials/scrna-raceid/tutorial.html</a> Online; accessed TODAY
                            </li>
                            <li>
                            Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                            </li>
                        </ol>
                    </p>


                    <blockquote class="details">
                      <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                      <p style="display: none;">

                    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{transcriptomics-scrna-raceid,
    author = "Mehmet Tekman and Alex Ostrovsky",
    title = "Downstream Single-cell RNA analysis with RaceID (Galaxy Training Materials)",
    year = "2021",
    month = "01",
    day = "06"
    url = "\url{/training-material/topics/transcriptomics/tutorials/scrna-raceid/tutorial.html}",
    note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
        doi = {10.1016/j.cels.2018.05.012},
        url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
        year = 2018,
        month = {jun},
        publisher = {Elsevier {BV}},
        volume = {6},
        number = {6},
        pages = {752--758.e1},
        author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
        title = {Community-Driven Data Analysis Training for Biology},
        journal = {Cell Systems}
}</code>
                    </pre></div></div>
                    </p>
                    </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                </div>
            </div>
        </div>

        <h3><i class="far fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Mehmet Tekman, Alex Ostrovsky)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/transcriptomics/tutorials/scrna-raceid/tutorial.md">GitHub</a>.
        </p>
        <p>
    The content of the tutorials and website is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
