<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Mass spectrometry: LC-MS preprocessing - advanced</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="Training material to analyse Mass spectrometry data in Ga..." />
        <meta property="og:title" content="Galaxy Training: Mass spectrometry: LC-MS preprocessing - advanced" />
        <meta property="og:description" content="Training material to analyse Mass spectrometry data in Ga..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/hall-of-fame" title="Hall of Fame">
                           <i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span> Contributors
                        </a>
                        
                    </li>
                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/metabolomics/faqs/" title="Check our FAQs for the Metabolomics topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Translate this page
            </div>

            <div id="lang-selector">
                
                <strong>Automatic Translations</strong>

<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url">
                Fran√ßais
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url">
                Êó•Êú¨Ë™û
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url">
                Espa√±ol
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url">
                Portugu√™s
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url">
                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                </a>
                
                <a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html&edit-text=&act=url" title="">
                And more!
                </a>
            </div>
        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-10-01/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html" title="Version 2021-10-01">2021-10-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-09-01/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html" title="Version 2021-09-01">2021-09-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-08-01/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html" title="Version 2021-08-01">2021-08-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        <section class="tutorial">
	<a href="https://github.com/galaxyproject/training-material/blob/main//topics/metabolomics/tutorials/lcms-preprocessing/slides.html">View markdown source on GitHub</a>
	<h1>Mass spectrometry: LC-MS preprocessing - advanced</h1>
		<h2>Contributors</h2>
		<a href="/training-material/hall-of-fame/jfrancoismartin/" class="contributor-badge contributor-jfrancoismartin"><img src="https://avatars.githubusercontent.com/jfrancoismartin?s=27" alt="Avatar">Jean-Fran√ßois Martin</a> <a href="/training-material/hall-of-fame/melpetera/" class="contributor-badge contributor-melpetera"><img src="https://avatars.githubusercontent.com/melpetera?s=27" alt="Avatar">M√©lanie Petera</a>

		

		

		

		<div><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Aug 10, 2021 </div>

	<hr />


	<p><span id="raw-to-matrix"><i class="fas fa-link" aria-hidden="true"></i> raw-to-matrix
</span></p>
<h2 id="from-raw-files-to-data-matrix">From raw files to data matrix</h2>

<p><img src="../../images/lcmspreproc_slides_1.1.png" alt="Picture representing steps from the raw data to the peak table, each step being linked to the next one by an arrow. Step 1 is a graphic showing a TIC for on sample. Step 2 is a part of an XML file where fields as retention time, base peak m/z, and base peak intensity are noticeable. Step 3 is an example of MS spectrum with the mention that an MS spectrum can be found at each scan. Step 4 (last one) is a part of a spreadsheet table listing ions in lines with 2 &quot;retention time&quot; and &quot;mass&quot; columns, plus columns of intensities (one per sample)." /></p>

<hr />

<h2 id="xcms">XCMS</h2>

<p><img src="../../images/lcmspreproc_slides_1.2.png" alt="Picture to introduce the XCMS R package by providing the reference to the main publications, providing a link to the web documentation https://bioconductor.org/packages/release/bioc/html/xcms.html and highlighting with happy/sad faces some characteristics. Happy face for &quot;R based&quot;, &quot;free&quot; and &quot;sustainable&quot;. Sad face for &quot;a lot of parameters to set&quot;, &quot;no graphical interface&quot;, and &quot;need to write an R script&quot;. A picture from one a the publication is displayed, corresponding to a graphic showing many overlapping line graphs pointing to a single peak." /></p>

<hr />
<p><span id="findchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> findchrompeaks
</span></p>
<h2 id="xcms---findchrompeaks">xcms - findChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_2.1.png" alt="Two graphics are displayed, one representing a MS spectrum in profile mode and the second one representing a MS spectrum in centroid mode. Graphics are completed with the mention that XCMS provides 2 main algorithms for chromatographic peak detection: the &quot;matched filter&quot; one for profile or centroid low resolution MS data, and the &quot;centwave&quot; one for centroid high resolution MS data." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.2.png" alt="On the left, part of an xml file is shown with retention time, base peak m/z and base peak intensity highlighted. On the right there are three graphs having scans as abscissa for the three of them. From top to bottom: m/z values with the note &quot;looking for a region of interest&quot;, delta ppm scan-to-scan with the label &quot;ppm parameter&quot;, and then at the bottom an intensity graph specifying that a continuous wavelet transform is performed. References of Signal/Noise, Noise level, Pre-filter, Range of FWHM (peakwidth) and choice between integration and peak heigh are listed with the bottom graph. This example is given for 1 ion in 1 sample, defined by m/z, retention time and intensity." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-1">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.3.png" alt="Large blob of text next to two plots from one of XCMS publication. First blob: &quot;The algorithm aims to detect mass traces or regions of interest (ROI) which are defined as regions with less than a defined deviation of m/z in consecutive scans. The deviation must be lower than the value of the parameter ppm. The value (unit ppm) has to be set according to MS accuracy. The graph to the right shows a region with some points with low variation along the y axis, and as it goes to the sides of this central region, the variation increases.&quot; Second blob: &quot;ROI mass intensitites are then used to define the chromatographic peak with continuous wavelet transform algorithm. peakwidth(min, max) has to be set for this step. 20.50 for HPLC, 5.25 for UPLC&quot;" /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-2">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.4.png" alt="Figure titled &quot;Range of peak width allows to extract peaks with different shapes&quot;. This is from a paper and shows three peaks. The chromatogram is shown as a jagged line, while a guassian fit shows three ideal guassian distributions overlayed on the chromatogram. Although the peaks are different in width, the three of them are accurately detected with Gaussian fit. " /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-3">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.5.png" alt="Figure titled &quot;Centwave allows to detect peaks without return to the baseline&quot;. This is from a paper and shows four peaks that indeed do not return to the baseline for three of them that are successive, and gaussian fit lines accurately cover the peaks." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-parameters">xcms - findChromPeaks - CentWave parameters</h2>

<p><img src="../../images/lcmspreproc_slides_2.6.png" alt="A reference to a question from the xcms forum, &quot;how to choose peak width?&quot;. It says 'Important: do not choose the minimum peak width too small, it will not increase sensitivity but cause peaks to be split'. There are two example graphs of the same peak. The first one illustrates a peakwidth = c(10, 60), showing that the peak is split in three, each detected as short peaks. The second graph is using peakwidth=c(20,120), keeping the peak as one." /></p>

<hr />

<h2 id="xcms---findchrompeaks---parameters-summary">xcms - findChromPeaks - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ppm</td>
      <td>m/z</td>
      <td>fluctuation of m/z value (ppm) from scan to scan - depends on the mass spectrometer accuracy</td>
      <td>5‚Ä¶</td>
    </tr>
    <tr>
      <td>peakwidth</td>
      <td>retention time</td>
      <td>range of  chromatographic peak width (second)</td>
      <td>UPLC 10,40  /  HPLC 20,120</td>
    </tr>
    <tr>
      <td>mzdiff</td>
      <td>m/z and retention time</td>
      <td>minimum difference of m/z for peaks with overlapping retention time (coeluting peak) - must be negative to allow overlap</td>
      <td>-0.001 or 0.05</td>
    </tr>
    <tr>
      <td>prefilter (k, I)</td>
      <td>Intensity</td>
      <td>a peak must be present in k scans with an intensity greater than I</td>
      <td>k=3,I=1000</td>
    </tr>
    <tr>
      <td>snthresh</td>
      <td>Intensity</td>
      <td>signal/noise ratio threshold</td>
      <td>5‚Ä¶</td>
    </tr>
    <tr>
      <td>noise</td>
      <td>Intensity</td>
      <td>each centroid must be greater than the ‚Äúnoise‚Äù value</td>
      <td>.</td>
    </tr>
  </tbody>
</table>

<hr />
<p><span id="groupchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> groupchrompeaks
</span></p>
<h2 id="xcms---groupchrompeaks">xcms - groupChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_3.1.png" alt="Large set of tables, in three groups, with each time 3 tables representing 3 pools. The top row is labelled &quot;independent peaklists&quot;. The next row of tables is labelled &quot;group ions by m/z&quot;, and the rows in the tables are coloured based on m/z values and lined up by their colours. The third row is labelled &quot;group by retention time&quot;, and the coloured rows are now merged into one big table, each colour on its own row, with this time some blue in two shades (same m/z but different rt). The resulting matrix merges the above, and collapses columns to result in a median m/z, and median retention time, and then the intensity of each pool; &quot;NA&quot; are filled when the line (a given m/z with a given rt) was missing for some pools." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.2.png" alt="Another text blob and image combo. The text: &quot;First, a binning of mass domain is performed. The size of the bin defined by the width of overlapping m/z slices. Then for each m/z bin, all ions of all samples are taken into account on the whole. A kernel density estimator is used to detect regions of retention time with high density ions.&quot; Below, the graph shows an example of plot output from groupChromPeaks which represents peaks found in samples as points along the retention time for one m/z slice." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group-1">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.3.png" alt="Similar text/image combo as the previous slide. The text: &quot;A guassian model groups together peaks with similar retention time, the inclusiveness of ions in a group defined by standard deviation of the model (bandwidth) corresponding to the xcms bw parameter.&quot; The graphic shows the previous plot with added information. A guassian density curve is drawn and vertical dot lines are plotted each time a peak is considered along the rt. A &quot;problem&quot; is highlighted showing an outlier point included in a peak because the bw parameter was too high." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group-2">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.4.png" alt="The previous graph is duplicated, however the density curve of the second one is based on a lower bw value, excluding now the outlier point from the peak boundery. A note says: &quot;Decreasing bw allows to separate these 2 groups. The resulting m/z and retention time of the feature correspond to the median of m/z an RT of all ions groupes together as a single feature.&quot;" /></p>

<hr />

<h2 id="xcms---groupchrompeaks---minfraction-parameter">xcms - groupChromPeaks - minFraction parameter</h2>

<p><img src="../../images/lcmspreproc_slides_3.5.png" alt="A text indicates: &quot;minfraction is the minimum number of samples detected in at least one class to be considered a valid group. A class is defined by the second column of the sample metadata if you uploaded individual sample files and merge in a dataset list, or by the sub folder of the zipfile.&quot; An illustration is provided using two plots modeling a peak from the type of output groupChromPeaks generates. It plots the points in two colours (red and blue), representing groups of samples. There are theoritically 4 samples in each class (=color) and the minFraction parameter is set to 0.5. On the first plot, there are 3 and 4 points in each color, so the peak is kept. On the second plot, there are 1 and 3 points in each color, but the peak is still kept since there are 3 points in at least one group." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---output">xcms - groupChromPeaks - Output</h2>

<p><img src="../../images/lcmspreproc_slides_3.6.png" alt="The picture recaps the groupChromPeaks output by showing the point plot where sometimes peaks are kept and sometimes not. It is written: &quot;Grey vertical strips tag groups ok; they include all samples that are grouped together as a single ion.&quot;" /></p>

<hr />

<h2 id="xcms---groupchrompeaks---output-1">xcms - groupChromPeaks - Output</h2>

<p><img src="../../images/lcmspreproc_slides_3.7.png" alt="A visual recap is done on the importance to set the right bw value not to pull distinct peaks together. Two graphs are shown, one with a large grey stripe labelled &quot;bandwidth = 10 seconds&quot;. Two distinct ions are merged as one group, so the bandwidth is too large. In the right graph bandwidth is 5 seconds, and now two distinct ions are separated and correctly identified." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---parameters-summary">xcms - groupChromPeaks - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>binSize</td>
      <td>m/z</td>
      <td>Size of m/z slices (bins). Range of m/z to be included in a group. Depends on mass spectrometer accuracy.</td>
      <td>¬†</td>
    </tr>
    <tr>
      <td>bw</td>
      <td>retention time</td>
      <td>Standart deviation of the gaussian metapeak that group peaks together.</td>
      <td>HPLC 30s  /  UPLC 5s</td>
    </tr>
    <tr>
      <td>minFraction</td>
      <td>samples</td>
      <td>To be valid, a group must be found in at least minFraction*n samples, with n=number of samples <strong>for each class of samples</strong>. A minFraction=0.5 corresponds to 50%.</td>
      <td>n=10, minFraction=0.5 =&gt; found in at least 5 samples</td>
    </tr>
    <tr>
      <td>max</td>
      <td>number of ions</td>
      <td>Maximum number of groups detected in a single m/z slices.</td>
      <td>10 or 50</td>
    </tr>
  </tbody>
</table>

<hr />
<p><span id="adjustrtime"><i class="fas fa-link" aria-hidden="true"></i> adjustrtime
</span></p>
<h2 id="xcms---adjustrtime">xcms - adjustRtime</h2>

<p><img src="../../images/lcmspreproc_slides_4.1.png" alt="On the left there is a &quot;before/after&quot; plot showing several examples of a gausian peak, first all shifted, but then all aligned. On the right is an example of the graphical output from adjustRtime, representing samples as lines with retention time in abscissa and time deviation on ordinate." /></p>

<hr />

<h2 id="xcms---adjustrtime---peakgroups-algorithm">xcms - adjustRtime - PeakGroups algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_4.2.png" alt="A &quot;blue/red&quot; plot model similar to the one explaining the groupChromPeak minfraction parameter is drawn. This time it shows that with missing=1, well-behaved peaks can be considered even if there are only 3 blue points. The second graph shows that with extra=1, well-behaved peaks can be consider even if there are 5 blue points." /></p>

<hr />

<h2 id="xcms---adjustrtime---peakgroups---parameters-summary">xcms - adjustRtime - PeakGroups - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>smooth method</td>
      <td>retention time</td>
      <td>Regression model to model time deviation among samples (linear or loess).</td>
      <td>linear or loess</td>
    </tr>
    <tr>
      <td>span</td>
      <td>¬†</td>
      <td>Degree of smoothing of the loess model.</td>
      <td>0.2 to 1</td>
    </tr>
    <tr>
      <td>extraPeaks</td>
      <td>samples</td>
      <td>Number of ‚Äúextra‚Äù peaks used to define reference peaks (or well-behaved peaks) for modeling time deviation. Number of Peaks &gt; number of samples.</td>
      <td>default=1</td>
    </tr>
    <tr>
      <td>minFraction (previously missing)</td>
      <td>samples</td>
      <td>Minimum proportion of samples with reference peaks. If blank samples are used, minFraction &lt; (1 - proportion of blanks).</td>
      <td>1 - proportion of blank samples</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="xcms---adjustrtime---obiwrap-algorithm">xcms - adjustRtime - Obiwrap algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_4.3.png" alt="A composed picture from the publication of the &quot;obiwarp&quot; algorithm." /></p>

<hr />
<p><span id="beforeafterrt"><i class="fas fa-link" aria-hidden="true"></i> beforeafterrt
</span></p>
<h2 id="xcms---adjustrtime---output">xcms - adjustRtime - Output</h2>

<p><img src="../../images/lcmspreproc_slides_5.png" alt="A &quot;before/after&quot; picture related to the rt adjustment. In the first graph two messy lines of points are shown. It seems to be two ions, but because there are shifts in rt it is not possible to separate them, whatever the bw value. The graph is labelled with two boxes saying &quot;bandwith (bw) = 8 seconds&quot; and &quot;Effect of retention time correction and BW&quot;. The second graph is after rt ajustment. Now the peaks points line up perfectly into two individual peaks and thus an appropriate bw value allows to separate the two peaks correctly. The graph is labelled with two boxes, saying &quot;Bandwith (bw) = 5 seconds&quot; and &quot;Two distinct ions are separated by decreasing bandwith value. And outliers are not taken into account&quot;." /></p>

<hr />
<p><span id="fillchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> fillchrompeaks
</span></p>
<h2 id="xcms---fillchrompeaks">xcms - fillChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_6.png" alt="A montage of a table with some NA values in intensities and the fillChromPeaks Galaxy tool with a text: &quot;After grouping all ions are not detected in all samples. For each of those ions this step integrates the signal in the region where ions were detected in other samples and creates a new peak. Be careful, if you choose a low minfraction in the group step, you may have a lot of missing data and this can lead to crash this step.&quot; In addition to the text, formulas are represented in a mathematical form for each &quot;Advanced options&quot; of the Galaxy module. There is also a note about the intval parameter saying into=integration, maxo=maximum height and intb=integration with baseline correction." /></p>

<hr />


	<hr />








<h2>Thank you!</h2>

This material is the result of a collaborative work. Thanks to the <a href="https://training.galaxyproject.org" aria-label="Visit the GTN">Galaxy Training Network</a> and all the contributors!




<img src="/training-material/assets/images/GTN.png" alt="Galaxy Training Network" style="height: 100px;"/>


This material is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</section>

        </div>
        
            <footer>
    <div class="container">
        <br><br>
        <p>
            The <a href="https://galaxyproject.org/teach/gtn/">Galaxy Training Network</a>
            provides researchers with online training materials, connects them with local trainers, and helps promoting open data analysis practices worldwide.
        </p>
        <p>
The content of the tutorials is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. The website and infrastructure is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>.
</p>
        <p>This is revision <a href="https://github.com/galaxyproject/training-material/commit/b2e71ef908d4ec335aa82cc51a8eda70ef39e230">b2e71ef908d4ec335aa82cc51a8eda70ef39e230</a></p>
    </div>
</footer>

        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
