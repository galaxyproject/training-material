<!DOCTYPE html>
<html lang="en" dir="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Slides: Mass spectrometry: LC-MS preprocessing - advanced / Mass spectrometry: LC-MS preprocessing with XCMS / Metabolomics</title>
        
            <meta name="google-site-verification" content="9mOXn2JL833-i7-aioCCEuIdG4_tb6qjwUozB5GJnPQ" />

<!-- JavaScript Error Monitoring, and performance tracking. -->
<script
  src="https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js"
  integrity="sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43"
  crossorigin="anonymous"
></script>
<script type="text/javascript">
if(localStorage.getItem('sentry-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Sentry: opt-in");
	Sentry.init({
		dsn: "https://45e0ec6e4373462b92969505df37cf40@sentry.galaxyproject.org/10",
		release: "galaxy-training-network@62278d71c6fca8d63a60269bfa0554a1883631ca",
		integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
		sampleRate: 0.1,
		tracesSampleRate: 0.1,
		// Capture Replay for no sessions by default
		replaysSessionSampleRate: 0.01,
		// plus for 1% of sessions with an error
		replaysOnErrorSampleRate: 0.01,
		// PII OFF
		sendDefaultPii: false, // Off by default but just in case.
		environment: "production",
	});
}
</script>

<!-- Page view tracking -->
<script defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>
<script>
if(localStorage.getItem('plausible-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	localStorage.removeItem("plausible_ignore")
	console.log("Plausible: opt-in");
	window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }
} else {
	// if they're opting-out, or DNT
	// we might get one page by accident but we won't get future ones.
	localStorage.setItem("plausible_ignore", "true")
}
</script>

        
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml">
        <link rel="canonical" href="https://training.galaxyproject.org/training-material/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html">
        <link rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Regular-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Bold-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Italic-102a.woff2" as="font" type="font/woff2" crossorigin>
        
        <link rel="preload" href="/training-material/assets/css/main.css?v=3" as="style">
        <link rel='preload' href='/training-material/assets/js/bundle.theme.f1f2de89.js' as='script'>
<link rel='preload' href='/training-material/assets/js/bundle.main.40d4e218.js' as='script'>
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=3">
        <link rel="manifest" href="/training-material/manifest.json">
        <meta name="theme-color" content="#2c3143"/>
	

        <meta name="DC.identifier" content="https://github.com/galaxyproject/training-material">
<meta name="DC.type" content="text">
<meta name="DC.title" content="Mass spectrometry: LC-MS preprocessing - advanced">
<meta name="DC.publisher" content="Galaxy Training Network">
<meta name="DC.date" content="2023-05-15 16:13:40 +0000">
<meta name="DC.creator" content="Jean-François Martin">
<meta name="DC.creator" content="Mélanie Petera"><meta name="description" content=" raw-to-matrix  ## From raw files to data matrix  ![Picture representing steps from the raw data to the peak table, each step being linked to the next one by an arrow. Step 1 is a graphic showing a TIC for on sample. Step 2 is a part of an XML file where fields as retention time, base peak m/z, and base peak intensity are noticeable. Step 3 is an example of MS spectrum with the mention that an MS spectrum can be found at each scan. Step 4 (last one) is a part of a spreadsheet table listing ions in lines with 2  retention time  and  mass  columns, plus columns of intensities (one per sample).](../../images/lcmspreproc_slides_1.1.png)  ---  ## XCMS  ![Picture to introduce the XCMS R package by providing the reference to the main publications, providing a link to the web documentation https://bioconductor.org/packages/release/bioc/html/xcms.html and highlighting with happy/sad faces some characteristics. Happy face for  R based ,  free  and  sustainable . Sad face for  a lot of paramet...">
        <meta property="og:site_name" content="Galaxy Training Network">
	<meta property="og:title" content="Metabolomics / Mass spectrometry: LC-MS preprocessing with XCMS / Slides: Mass spectrometry: LC-MS preprocessing - advanced">
        <meta property="og:description" content=" raw-to-matrix  ## From raw files to data matrix  ![Picture representing steps from the raw data to the peak table, each step being linked to the next one by an arrow. Step 1 is a graphic showing a TIC for on sample. Step 2 is a part of an XML file where fields as retention time, base peak m/z, and base peak intensity are noticeable. Step 3 is an example of MS spectrum with the mention that an MS spectrum can be found at each scan. Step 4 (last one) is a part of a spreadsheet table listing ions in lines with 2  retention time  and  mass  columns, plus columns of intensities (one per sample).](../../images/lcmspreproc_slides_1.1.png)  ---  ## XCMS  ![Picture to introduce the XCMS R package by providing the reference to the main publications, providing a link to the web documentation https://bioconductor.org/packages/release/bioc/html/xcms.html and highlighting with happy/sad faces some characteristics. Happy face for  R based ,  free  and  sustainable . Sad face for  a lot of paramet...">
        <meta property="og:image" content="https://training.galaxyproject.org/training-material/assets/images/GTNLogo1000.png"></head>
    <body data-spy="scroll" data-target="#toc" data-brightness="auto" data-contrast="auto">
        <script  src='/training-material/assets/js/bundle.theme.f1f2de89.js'></script>
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                
                    Galaxy Training!
                
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
			

                        
                    </li>

                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/learning-pathways" title="Learning Pathways">
                           <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">curriculum</span> Learning Pathways
                        </a>
                        
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
	<a class="dropdown-item" href="/training-material/faqs/index.html" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Matrix
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Settings">
	<i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> Settings
    </a>
    <div class="dropdown-menu dropdown-menu-right">

	<h6 class="dropdown-header">Preferences</h6>

	<a href="/training-material/user/theme.html" class="dropdown-item">
		<i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
	</a>

	<a href="/training-material/user/privacy.html" class="dropdown-item">
		<i class="fas fa-lock" aria-hidden="true"></i><span class="visually-hidden">pref-dataprivate</span> Data Privacy
	</a>

	<div class="dropdown-divider"></div>

	<h6 class="dropdown-header">For Everyone</h6>

        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/./topics/metabolomics/tutorials/lcms-preprocessing/slides.html">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Propose a change or correction
        </a>

	<h6 class="dropdown-header">Instructor Utilities</h6>

        <a class="dropdown-item" href="/training-material/stats.html">
            <i class="fas fa-chart-column" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/metabolomics/tutorials/lcms-preprocessing/slides-plain.html">
            <i class="fas fa-chart-column" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page View Metrics
        </a>

        <!-- link to feedback -->
        
            <a class="dropdown-item" href="/training-material/feedback.html">
                <i class="fas fa-chart-column" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search2">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        
        <div class="container main-content" role="main">
        <section class="tutorial">
	<a href="https://github.com/galaxyproject/training-material/blob/main//topics/metabolomics/tutorials/lcms-preprocessing/slides.html">View markdown source on GitHub</a>
	<h1>Mass spectrometry: LC-MS preprocessing - advanced</h1>
		<h2>Contributors</h2>
<div markdown="0">

	<div class="contributors-line">
		Authors: <a href="/training-material/hall-of-fame/jfrancoismartin/" class="contributor-badge contributor-jfrancoismartin"><img src="https://avatars.githubusercontent.com/jfrancoismartin?s=36" alt="Jean-François Martin avatar" width="36" class="avatar" />
    Jean-François Martin</a><a href="/training-material/hall-of-fame/melpetera/" class="contributor-badge contributor-melpetera"><img src="https://avatars.githubusercontent.com/melpetera?s=36" alt="Mélanie Petera avatar" width="36" class="avatar" />
    Mélanie Petera</a>
	</div>

</div>


		

		

		

		<div><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Published:</strong> Feb 4, 2020 </div>
		<div><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last Updated:</strong> May 15, 2023 </div>

	<hr />


	<p><span id="raw-to-matrix"><i class="fas fa-link" aria-hidden="true"></i> raw-to-matrix
</span></p>
<h2 id="from-raw-files-to-data-matrix">From raw files to data matrix</h2>

<p><img src="../../images/lcmspreproc_slides_1.1.png" alt="Picture representing steps from the raw data to the peak table, each step being linked to the next one by an arrow. Step 1 is a graphic showing a TIC for on sample. Step 2 is a part of an XML file where fields as retention time, base peak m/z, and base peak intensity are noticeable. Step 3 is an example of MS spectrum with the mention that an MS spectrum can be found at each scan. Step 4 (last one) is a part of a spreadsheet table listing ions in lines with 2 &quot;retention time&quot; and &quot;mass&quot; columns, plus columns of intensities (one per sample)." /></p>

<hr />

<h2 id="xcms">XCMS</h2>

<p><img src="../../images/lcmspreproc_slides_1.2.png" alt="Picture to introduce the XCMS R package by providing the reference to the main publications, providing a link to the web documentation https://bioconductor.org/packages/release/bioc/html/xcms.html and highlighting with happy/sad faces some characteristics. Happy face for &quot;R based&quot;, &quot;free&quot; and &quot;sustainable&quot;. Sad face for &quot;a lot of parameters to set&quot;, &quot;no graphical interface&quot;, and &quot;need to write an R script&quot;. A picture from one a the publication is displayed, corresponding to a graphic showing many overlapping line graphs pointing to a single peak." /></p>

<hr />
<p><span id="findchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> findchrompeaks
</span></p>
<h2 id="xcms---findchrompeaks">xcms - findChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_2.1.png" alt="Two graphics are displayed, one representing a MS spectrum in profile mode and the second one representing a MS spectrum in centroid mode. Graphics are completed with the mention that XCMS provides 2 main algorithms for chromatographic peak detection: the &quot;matched filter&quot; one for profile or centroid low resolution MS data, and the &quot;centwave&quot; one for centroid high resolution MS data." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.2.png" alt="On the left, part of an xml file is shown with retention time, base peak m/z and base peak intensity highlighted. On the right there are three graphs having scans as abscissa for the three of them. From top to bottom: m/z values with the note &quot;looking for a region of interest&quot;, delta ppm scan-to-scan with the label &quot;ppm parameter&quot;, and then at the bottom an intensity graph specifying that a continuous wavelet transform is performed. References of Signal/Noise, Noise level, Pre-filter, Range of FWHM (peakwidth) and choice between integration and peak heigh are listed with the bottom graph. This example is given for 1 ion in 1 sample, defined by m/z, retention time and intensity." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-1">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.3.png" alt="Large blob of text next to two plots from one of XCMS publication. First blob: &quot;The algorithm aims to detect mass traces or regions of interest (ROI) which are defined as regions with less than a defined deviation of m/z in consecutive scans. The deviation must be lower than the value of the parameter ppm. The value (unit ppm) has to be set according to MS accuracy. The graph to the right shows a region with some points with low variation along the y axis, and as it goes to the sides of this central region, the variation increases.&quot; Second blob: &quot;ROI mass intensitites are then used to define the chromatographic peak with continuous wavelet transform algorithm. peakwidth(min, max) has to be set for this step. 20.50 for HPLC, 5.25 for UPLC&quot;" /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-2">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.4.png" alt="Figure titled &quot;Range of peak width allows to extract peaks with different shapes&quot;. This is from a paper and shows three peaks. The chromatogram is shown as a jagged line, while a guassian fit shows three ideal guassian distributions overlayed on the chromatogram. Although the peaks are different in width, the three of them are accurately detected with Gaussian fit. " /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-algorithm-3">xcms - findChromPeaks - CentWave algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_2.5.png" alt="Figure titled &quot;Centwave allows to detect peaks without return to the baseline&quot;. This is from a paper and shows four peaks that indeed do not return to the baseline for three of them that are successive, and gaussian fit lines accurately cover the peaks." /></p>

<hr />

<h2 id="xcms---findchrompeaks---centwave-parameters">xcms - findChromPeaks - CentWave parameters</h2>

<p><img src="../../images/lcmspreproc_slides_2.6.png" alt="A reference to a question from the xcms forum, &quot;how to choose peak width?&quot;. It says 'Important: do not choose the minimum peak width too small, it will not increase sensitivity but cause peaks to be split'. There are two example graphs of the same peak. The first one illustrates a peakwidth = c(10, 60), showing that the peak is split in three, each detected as short peaks. The second graph is using peakwidth=c(20,120), keeping the peak as one." /></p>

<hr />

<h2 id="xcms---findchrompeaks---parameters-summary">xcms - findChromPeaks - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ppm</td>
      <td>m/z</td>
      <td>fluctuation of m/z value (ppm) from scan to scan - depends on the mass spectrometer accuracy</td>
      <td>5…</td>
    </tr>
    <tr>
      <td>peakwidth</td>
      <td>retention time</td>
      <td>range of  chromatographic peak width (second)</td>
      <td>UPLC 10,40  /  HPLC 20,120</td>
    </tr>
    <tr>
      <td>mzdiff</td>
      <td>m/z and retention time</td>
      <td>minimum difference of m/z for peaks with overlapping retention time (coeluting peak) - must be negative to allow overlap</td>
      <td>-0.001 or 0.05</td>
    </tr>
    <tr>
      <td>prefilter (k, I)</td>
      <td>Intensity</td>
      <td>a peak must be present in k scans with an intensity greater than I</td>
      <td>k=3,I=1000</td>
    </tr>
    <tr>
      <td>snthresh</td>
      <td>Intensity</td>
      <td>signal/noise ratio threshold</td>
      <td>5…</td>
    </tr>
    <tr>
      <td>noise</td>
      <td>Intensity</td>
      <td>each centroid must be greater than the “noise” value</td>
      <td>.</td>
    </tr>
  </tbody>
</table>

<hr />
<p><span id="groupchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> groupchrompeaks
</span></p>
<h2 id="xcms---groupchrompeaks">xcms - groupChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_3.1.png" alt="Large set of tables, in three groups, with each time 3 tables representing 3 pools. The top row is labelled &quot;independent peaklists&quot;. The next row of tables is labelled &quot;group ions by m/z&quot;, and the rows in the tables are coloured based on m/z values and lined up by their colours. The third row is labelled &quot;group by retention time&quot;, and the coloured rows are now merged into one big table, each colour on its own row, with this time some blue in two shades (same m/z but different rt). The resulting matrix merges the above, and collapses columns to result in a median m/z, and median retention time, and then the intensity of each pool; &quot;NA&quot; are filled when the line (a given m/z with a given rt) was missing for some pools." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.2.png" alt="Another text blob and image combo. The text: &quot;First, a binning of mass domain is performed. The size of the bin defined by the width of overlapping m/z slices. Then for each m/z bin, all ions of all samples are taken into account on the whole. A kernel density estimator is used to detect regions of retention time with high density ions.&quot; Below, the graph shows an example of plot output from groupChromPeaks which represents peaks found in samples as points along the retention time for one m/z slice." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group-1">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.3.png" alt="Similar text/image combo as the previous slide. The text: &quot;A guassian model groups together peaks with similar retention time, the inclusiveness of ions in a group defined by standard deviation of the model (bandwidth) corresponding to the xcms bw parameter.&quot; The graphic shows the previous plot with added information. A guassian density curve is drawn and vertical dot lines are plotted each time a peak is considered along the rt. A &quot;problem&quot; is highlighted showing an outlier point included in a peak because the bw parameter was too high." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---alignment-group-2">xcms - groupChromPeaks - Alignment group</h2>

<p><img src="../../images/lcmspreproc_slides_3.4.png" alt="The previous graph is duplicated, however the density curve of the second one is based on a lower bw value, excluding now the outlier point from the peak boundery. A note says: &quot;Decreasing bw allows to separate these 2 groups. The resulting m/z and retention time of the feature correspond to the median of m/z an RT of all ions groupes together as a single feature.&quot;" /></p>

<hr />

<h2 id="xcms---groupchrompeaks---minfraction-parameter">xcms - groupChromPeaks - minFraction parameter</h2>

<p><img src="../../images/lcmspreproc_slides_3.5.png" alt="A text indicates: &quot;minfraction is the minimum number of samples detected in at least one class to be considered a valid group. A class is defined by the second column of the sample metadata if you uploaded individual sample files and merge in a dataset list, or by the sub folder of the zipfile.&quot; An illustration is provided using two plots modeling a peak from the type of output groupChromPeaks generates. It plots the points in two colours (red and blue), representing groups of samples. There are theoritically 4 samples in each class (=color) and the minFraction parameter is set to 0.5. On the first plot, there are 3 and 4 points in each color, so the peak is kept. On the second plot, there are 1 and 3 points in each color, but the peak is still kept since there are 3 points in at least one group." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---output">xcms - groupChromPeaks - Output</h2>

<p><img src="../../images/lcmspreproc_slides_3.6.png" alt="The picture recaps the groupChromPeaks output by showing the point plot where sometimes peaks are kept and sometimes not. It is written: &quot;Grey vertical strips tag groups ok; they include all samples that are grouped together as a single ion.&quot;" /></p>

<hr />

<h2 id="xcms---groupchrompeaks---output-1">xcms - groupChromPeaks - Output</h2>

<p><img src="../../images/lcmspreproc_slides_3.7.png" alt="A visual recap is done on the importance to set the right bw value not to pull distinct peaks together. Two graphs are shown, one with a large grey stripe labelled &quot;bandwidth = 10 seconds&quot;. Two distinct ions are merged as one group, so the bandwidth is too large. In the right graph bandwidth is 5 seconds, and now two distinct ions are separated and correctly identified." /></p>

<hr />

<h2 id="xcms---groupchrompeaks---parameters-summary">xcms - groupChromPeaks - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>binSize</td>
      <td>m/z</td>
      <td>Size of m/z slices (bins). Range of m/z to be included in a group. Depends on mass spectrometer accuracy.</td>
      <td> </td>
    </tr>
    <tr>
      <td>bw</td>
      <td>retention time</td>
      <td>Standart deviation of the gaussian metapeak that group peaks together.</td>
      <td>HPLC 30s  /  UPLC 5s</td>
    </tr>
    <tr>
      <td>minFraction</td>
      <td>samples</td>
      <td>To be valid, a group must be found in at least minFraction*n samples, with n=number of samples <strong>for each class of samples</strong>. A minFraction=0.5 corresponds to 50%.</td>
      <td>n=10, minFraction=0.5 =&gt; found in at least 5 samples</td>
    </tr>
    <tr>
      <td>max</td>
      <td>number of ions</td>
      <td>Maximum number of groups detected in a single m/z slices.</td>
      <td>10 or 50</td>
    </tr>
  </tbody>
</table>

<hr />
<p><span id="adjustrtime"><i class="fas fa-link" aria-hidden="true"></i> adjustrtime
</span></p>
<h2 id="xcms---adjustrtime">xcms - adjustRtime</h2>

<p><img src="../../images/lcmspreproc_slides_4.1.png" alt="On the left there is a &quot;before/after&quot; plot showing several examples of a gausian peak, first all shifted, but then all aligned. On the right is an example of the graphical output from adjustRtime, representing samples as lines with retention time in abscissa and time deviation on ordinate." /></p>

<hr />

<h2 id="xcms---adjustrtime---peakgroups-algorithm">xcms - adjustRtime - PeakGroups algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_4.2.png" alt="A &quot;blue/red&quot; plot model similar to the one explaining the groupChromPeak minfraction parameter is drawn. This time it shows that with missing=1, well-behaved peaks can be considered even if there are only 3 blue points. The second graph shows that with extra=1, well-behaved peaks can be consider even if there are 5 blue points." /></p>

<hr />

<h2 id="xcms---adjustrtime---peakgroups---parameters-summary">xcms - adjustRtime - PeakGroups - Parameters summary</h2>

<table>
  <thead>
    <tr>
      <th>xcms parameters</th>
      <th>related to</th>
      <th>description</th>
      <th>examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>smooth method</td>
      <td>retention time</td>
      <td>Regression model to model time deviation among samples (linear or loess).</td>
      <td>linear or loess</td>
    </tr>
    <tr>
      <td>span</td>
      <td> </td>
      <td>Degree of smoothing of the loess model.</td>
      <td>0.2 to 1</td>
    </tr>
    <tr>
      <td>extraPeaks</td>
      <td>samples</td>
      <td>Number of “extra” peaks used to define reference peaks (or well-behaved peaks) for modeling time deviation. Number of Peaks &gt; number of samples.</td>
      <td>default=1</td>
    </tr>
    <tr>
      <td>minFraction (previously missing)</td>
      <td>samples</td>
      <td>Minimum proportion of samples with reference peaks. If blank samples are used, minFraction &lt; (1 - proportion of blanks).</td>
      <td>1 - proportion of blank samples</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="xcms---adjustrtime---obiwrap-algorithm">xcms - adjustRtime - Obiwrap algorithm</h2>

<p><img src="../../images/lcmspreproc_slides_4.3.png" alt="A composed picture from the publication of the &quot;obiwarp&quot; algorithm." /></p>

<hr />
<p><span id="beforeafterrt"><i class="fas fa-link" aria-hidden="true"></i> beforeafterrt
</span></p>
<h2 id="xcms---adjustrtime---output">xcms - adjustRtime - Output</h2>

<p><img src="../../images/lcmspreproc_slides_5.png" alt="A &quot;before/after&quot; picture related to the rt adjustment. In the first graph two messy lines of points are shown. It seems to be two ions, but because there are shifts in rt it is not possible to separate them, whatever the bw value. The graph is labelled with two boxes saying &quot;bandwith (bw) = 8 seconds&quot; and &quot;Effect of retention time correction and BW&quot;. The second graph is after rt ajustment. Now the peaks points line up perfectly into two individual peaks and thus an appropriate bw value allows to separate the two peaks correctly. The graph is labelled with two boxes, saying &quot;Bandwith (bw) = 5 seconds&quot; and &quot;Two distinct ions are separated by decreasing bandwith value. And outliers are not taken into account&quot;." /></p>

<hr />
<p><span id="fillchrompeaks"><i class="fas fa-link" aria-hidden="true"></i> fillchrompeaks
</span></p>
<h2 id="xcms---fillchrompeaks">xcms - fillChromPeaks</h2>

<p><img src="../../images/lcmspreproc_slides_6.png" alt="A montage of a table with some NA values in intensities and the fillChromPeaks Galaxy tool with a text: &quot;After grouping all ions are not detected in all samples. For each of those ions this step integrates the signal in the region where ions were detected in other samples and creates a new peak. Be careful, if you choose a low minfraction in the group step, you may have a lot of missing data and this can lead to crash this step.&quot; In addition to the text, formulas are represented in a mathematical form for each &quot;Advanced options&quot; of the Galaxy module. There is also a note about the intval parameter saying into=integration, maxo=maximum height and intb=integration with baseline correction." /></p>

<hr />


	<hr />








<h2>Thank you!</h2>

This material is the result of a collaborative work. Thanks to the <a href="https://training.galaxyproject.org" aria-label="Visit the GTN">Galaxy Training Network</a> and all the contributors!


<img src="/training-material/assets/images/GTNLogo1000.png" alt="Galaxy Training Network" style="height: 100px;"/>


Tutorial Content is licensed under

  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

</section>






        </div>
        <footer>
	<hr />
	<div class="container">
		<div class="row">
			<div class="col-sm-3">
				<span style="font-size: 2em">GTN</span>
				<p>
					The GTN provides researchers with a free, open repository of online training
					materials, with a focus on hands-on training that aims to be directly applicable for learners.
					We aim to connect researchers and learners with local trainers, and events worldwide.
				</p>
				<p>
					We promote FAIR and Open Science practices worldwide, are committed to the accessibility of this platform and training for everyone.
				</p>
			</div>
			<div class="col-sm-3">
				<span style="font-size: 1.3em">About Us</span>
				<ul class="no-bullets">
					<li><a href="/training-material/faqs/gtn/gtn-what-is-it.html">About</a></li>
					<li><a rel="code-of-conduct" href="https://galaxyproject.org/community/coc/">Code of Conduct</a></li>
					<li><a href="/training-material/accessibility.html">Accessibility</a></li>
					<li><a href="/training-material/faqs/gtn/fair_training.html">100% FAIR Training</a></li>
					<li><a href="/training-material/faqs/gtn/collaborative_development.html">Collaborative Development</a></li>
				</ul>
				<span style="font-size: 1.3em">Page</span>
				<ul class="no-bullets">
					

					

					<li>
						<a rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
							Content licensed under Creative Commons Attribution 4.0 International License
						</a>
					</li>
					<li>
						<a href="https://github.com/galaxyproject/training-material/edit/main/./topics/metabolomics/tutorials/lcms-preprocessing/slides.html">
						<i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
						</a>
					</li>
					<li>
						<a href="https://github.com/galaxyproject/training-material/commits/main/./topics/metabolomics/tutorials/lcms-preprocessing/slides.html">
						<i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> View Changes on GitHub
						</a>
					</li>
				</ul>
			</div>
			<div class="col-sm-3">
				<span style="font-size: 1.3em">Support</span>
				<ul class="no-bullets">
					<li><a rel="me" href="/training-material/faqs/galaxy/">Galaxy FAQs</a></li>
					<li><a rel="me" href="https://help.galaxyproject.org">Galaxy Help Forum</a></li>
					<li><a rel="me" href="http://gxy.io/gtn-slack">GTN Slack Chat</a></li>
					<li><a rel="me" href="https://matrix.to/#/%23Galaxy-Training-Network_Lobby%3Agitter.im">GTN Matrix Chat</a></li>
					<li><a rel="me" href="https://matrix.to/#/#galaxyproject_Lobby:gitter.im">Galaxy Matrix Chat</a></li>
				</ul>
				<span style="font-size: 1.3em">Framework</span>
				<ul class="no-bullets">
					<li>Revision <a href="https://github.com/galaxyproject/training-material/commit/62278d71c6fca8d63a60269bfa0554a1883631ca">62278d7</a></li>
					<li><a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a> Licensed</li>
					<li><a href="https://jekyllrb.com/">Jekyll(4.3.2 | production)</a></li>
				</ul>
			</div>
			<div class="col-sm-3">
				<span style="font-size: 1.3em">Follow Us!</span>
				<ul class="no-bullets">
					<li><span style="fill: var(--hyperlink);"><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg   width="1em"   height="1em"   viewBox="0 0 8.4937906 9.1084023"   version="1.1"   id="svg356"   xmlns="http://www.w3.org/2000/svg"   xmlns:svg="http://www.w3.org/2000/svg">  <g     id="layer1"     transform="translate(-70.566217,-144.26757)">    <path       style="fill-opacity:1;stroke:none;stroke-width:0.0179182"       d="m 76.39081,152.24155 c -0.737138,0.20763 -1.554999,0.29101 -2.311453,0.14333 -0.475335,-0.0928 -0.891898,-0.32923 -1.031589,-0.82423 -0.04356,-0.15434 -0.06132,-0.32388 -0.06142,-0.48378 0.353724,0.0457 0.702251,0.1304 1.057176,0.17407 0.701338,0.0864 1.394702,0.0784 2.096434,0.008 0.744056,-0.0745 1.433711,-0.21546 2.060598,-0.64854 0.243974,-0.16855 0.474672,-0.39133 0.603487,-0.66252 0.181421,-0.38195 0.175886,-0.89336 0.204447,-1.30803 0.0923,-1.34029 0.20588,-2.98599 -1.076708,-3.846 -0.499561,-0.33497 -1.208891,-0.39913 -1.791824,-0.45742 -0.987026,-0.0987 -1.971078,-0.0946 -2.956509,0.0338 -0.841146,0.10961 -1.595223,0.31468 -2.1065,1.0443 -0.493296,0.70396 -0.509564,1.52563 -0.509564,2.34729 0,1.37831 -0.05534,2.87744 0.595934,4.13911 0.504703,0.97774 1.498709,1.29589 2.52184,1.41832 0.473239,0.0566 0.96049,0.0849 1.434158,0.0172 0.328853,-0.0471 0.650325,-0.0999 0.966886,-0.20511 0.08957,-0.0298 0.266911,-0.0614 0.322027,-0.14486 0.04089,-0.0618 0.0099,-0.15812 0.0035,-0.22545 -0.01611,-0.16924 -0.02094,-0.34967 -0.02096,-0.51963 m -1.594723,-5.48298 c 0.214822,-0.25951 0.315898,-0.56088 0.60922,-0.75705 0.687899,-0.46006 1.692038,-0.11202 1.992096,0.63161 0.214571,0.5317 0.140174,1.15913 0.140174,1.72017 v 1.03925 c 0,0.0911 0.04009,0.30954 -0.01842,0.38339 -0.04193,0.053 -0.173018,0.0287 -0.232436,0.0287 h -0.698809 v -1.88142 c 0,-0.28413 0.04813,-0.63823 -0.09912,-0.89591 -0.234746,-0.4108 -0.875019,-0.36105 -1.092116,0.0358 -0.123368,0.22555 -0.116792,0.50369 -0.116792,0.75257 v 1.0751 h -0.931726 v -1.05718 c 0,-0.2555 0.0024,-0.53932 -0.121773,-0.77049 -0.21432,-0.39919 -0.857782,-0.44403 -1.090217,-0.0358 -0.147324,0.25871 -0.09604,0.61056 -0.09604,0.89591 v 1.88142 H 72.09042 v -1.98893 c 0,-0.4711 -0.01604,-0.95902 0.233201,-1.3797 0.585269,-0.98786 2.133584,-0.74836 2.472454,0.32253 z"       id="path2318" />  </g></svg></span> <a rel="me" href="https://mstdn.science/@gtn">Mastodon</a></li>
					<li><span style="fill: var(--hyperlink);"><svg  viewBox="0 0 64 57" width="1em" ><path style="fill-opacity:1;stroke:none;stroke-width:0.0179182" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805ZM50.127 3.805C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745Z"></path></svg></span><a rel="me" href="https://bsky.app/profile/galaxytraining.bsky.social"> Bluesky</a></li>
				</ul>
			</div>
		</div>
	</div>
</footer>


        <script  async defer src='/training-material/assets/js/bundle.main.40d4e218.js'></script>

	
	

    </body>
</html>
