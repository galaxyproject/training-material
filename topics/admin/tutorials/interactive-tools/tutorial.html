<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Galaxy Interactive Tools</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Galaxy Interactive Tools" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<!-- Gitter -->


<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">topic</span> Galaxy Server administration
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Language Selector">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Language
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                Fran√ßais
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                Êó•Êú¨Ë™û
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                Espa√±ol
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                Portugu√™s
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Finteractive-tools%2Ftutorial.html&edit-text=&act=url" title="">
                                And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>

        <div class="dropdown-item">
            <div>
                Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
            </div>

        </div>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/admin/tutorials/interactive-tools/tutorial.md">
                            <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Galaxy Interactive Tools",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / interactive-tools / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Galaxy Interactive Tools' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/interactive-tools/tutorial.html",
  "timeRequired": "PT2H",
  "keywords": "ansible",
  "description": "The objectives are:\n - Understand what Galaxy Interactive Tools are and how they work\n - Be aware of the security implications of Interactive Tools\n - Have a basic understanding of the Interactive Tools (GxIT/GIE) Proxy, its purpose, and configuration\n - Be familiar with wildcard SSL certificates and how to get them from Let's Encrypt\n - Configure your Galaxy to serve Interactive Tools using an Ansible Playbook\n - Start, run, and use an Interactive Tool\n\n",
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Hands-on for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Anthony Bretaudeau"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Anthony Bretaudeau"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Galaxy Interactive Tools</h1>
        

        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame/natefoo/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/natefoo" alt="Nate Coraor">Nate Coraor</a>, <a href="/training-material/hall-of-fame/slugger70/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/slugger70" alt="Simon Gladman">Simon Gladman</a>, <a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/hexylena" alt="Helena Rasche">Helena Rasche</a>, <a href="/training-material/hall-of-fame/abretaud/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/abretaud" alt="Anthony Bretaudeau">Anthony Bretaudeau</a>

</div>

        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            </ul>

            <strong><i class="fas fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li><p>Understand what Galaxy Interactive Tools are and how they work</p>
</li>
            
            <li><p>Be aware of the security implications of Interactive Tools</p>
</li>
            
            <li><p>Have a basic understanding of the Interactive Tools (GxIT/GIE) Proxy, its purpose, and configuration</p>
</li>
            
            <li><p>Be familiar with wildcard SSL certificates and how to get them from Let‚Äôs Encrypt</p>
</li>
            
            <li><p>Configure your Galaxy to serve Interactive Tools using an Ansible Playbook</p>
</li>
            
            <li><p>Start, run, and use an Interactive Tool</p>
</li>
            
            </ul>

            
            <strong><i class="fas fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
            
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation with Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Connecting Galaxy to a compute cluster:
                            
                                <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            </ul>
            

            
            <p><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 2 hours</p>
            

            

            
            

            
            <p id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></p>
            <ul>
                <div class="supporting_material">
                
                    <li class="btn btn-default"><a href="/training-material/topics/admin/tutorials/interactive-tools/slides.html" title="Slides for this tutorial">
                        <i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Slides
                    </a></li>
                

                

                

                

                
                </div>
            </ul>
            

            <p><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Jan 6, 2021 </p>
        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <blockquote class="warning">
  <h3 id="warning-evolving-topic"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i><span class="visually-hidden">warning</span> Evolving Topic</h3>
  <p><span class="notranslate">Galaxy</span> Interactive Tools are a <strong>new feature</strong> and there are some rough edges. Work to improve the experience of deploying and using them is ongoing.</p>
</blockquote>

<h1 class="no_toc" id="overview">Overview</h1>

<p><span class="notranslate">Galaxy</span> Interactive Tools (GxITs) are a method to run containerized tools that are interactive in nature. Interactive Tools typically run a persistent service accessed on a specific port and run until terminated by the user. One common example of such a tool is <a href="https://jupyter.org/">Jupyter Notebook</a>. <span class="notranslate">Galaxy</span> Interactive Tools are similar in purpose to <a href="https://docs.galaxyproject.org/en/release_19.09/admin/special_topics/interactive_environments.html"><span class="notranslate">Galaxy</span> Interactive Environments</a> (GIEs), but are implemented in a significantly different manner. Most notably, instead of directly invoking containers on the <span class="notranslate">Galaxy</span> server, dedicated Docker node, or as a Docker Swarm service (as is done for GIEs), Interactive Tools are submitted through <span class="notranslate">Galaxy</span>‚Äôs job management system and thus are scheduled the same as any other <span class="notranslate">Galaxy</span> tool - on a Slurm cluster, for instance. <span class="notranslate">Galaxy</span> Interactive Tools were introduced in <span class="notranslate">Galaxy</span> Release 19.09.</p>

<blockquote class="warning">
  <h3 id="warning-before-you-continue"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i><span class="visually-hidden">warning</span> Before You Continue</h3>
  <p>If you are <em>not</em> completing this tutorial as part of a <a href="https://github.com/galaxyproject/dagobah-training"><span class="notranslate">Galaxy</span> Admin Training</a> course, <strong>you will need a wildcard DNS record for your <span class="notranslate">Galaxy</span> server and a method for obtaining a wildcard SSL certificate for your <span class="notranslate">Galaxy</span> server</strong>.</p>

  <p><br /></p>

  <p><span class="notranslate">Galaxy</span> Interactive Tools require a <a href="https://en.wikipedia.org/wiki/Wildcard_certificate">wildcard SSL certificate</a>. Because the <strong><span class="notranslate">Galaxy</span> Installation with Ansible</strong> tutorial fetches <a href="https://letsencrypt.org/">Let‚Äôs Encrypt</a> certificates, this tutorial fetches Let‚Äôs Encrypt wildcard certificates. However, this process is only valid for <span class="notranslate">Galaxy</span> Admin Training courses, because Let‚Äôs Encrypt wildcard certificates <a href="https://letsencrypt.org/docs/faq/">can only be fetched using the DNS-01 challenge method</a>, which requires control of a <a href="https://en.wikipedia.org/wiki/Dynamic_DNS">dynamic DNS</a> server (which we have preconfigured for use at training courses). Configuring your DNS service for dynamic updates is outside the scope of this tutorial, but it will show you how to request certificates using DNS-01, which can be adapted for your site.</p>

  <p><br /></p>

  <p>If you are using Let‚Äôs Encrypt, <a href="https://certbot.eff.org/docs/using.html#dns-plugins">a list of available DNS plugins for Certbot</a> can be found in the Certbot documentation. If you are not using Let‚Äôs Encrypt, please consult your certificate vendor‚Äôs documentation for information on how to obtain a wildcard certificate. You will need a certificate with (at least) the <a href="https://en.wikipedia.org/wiki/Subject_Alternative_Name">subject alte<span class="notranslate">rna</span>tive name</a>s <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.example.org</code> and <code class="language-plaintext highlighter-rouge">*.interactivetoolentrypoint.interactivetool.<span class="notranslate">galaxy</span>.example.org</code> (where <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.example.org</code> is the hostname of your <span class="notranslate">Galaxy</span> server).</p>

  <p><br /></p>

  <p>You will also need a wildcard DNS <code class="language-plaintext highlighter-rouge">CNAME</code> record for <code class="language-plaintext highlighter-rouge">*.interactivetoolentrypoint.interactivetool.<span class="notranslate">galaxy</span>.example.org</code>. You can verify that your <span class="notranslate">Galaxy</span> server has such a record using the <code class="language-plaintext highlighter-rouge">host</code> or <code class="language-plaintext highlighter-rouge">dig</code> command line tools like so:</p>

  <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   $</span><span class="w"> </span>host <span class="nt">-t</span> cname foo.interactivetoolentrypoint.interactivetool.live.use<span class="notranslate">galaxy</span>.eu
<span class="go">   foo.interactivetoolentrypoint.interactivetool.live.use<span class="notranslate">galaxy</span>.eu is an alias for use<span class="notranslate">galaxy</span>.eu.
</span><span class="gp">   $</span><span class="w"> </span>host <span class="nt">-t</span> cname bar.interactivetoolentrypoint.interactivetool.live.use<span class="notranslate">galaxy</span>.eu
<span class="go">   bar.interactivetoolentrypoint.interactivetool.live.use<span class="notranslate">galaxy</span>.eu is an alias for use<span class="notranslate">galaxy</span>.eu.
</span></code></pre></div>  </div>

  <p>Please consult your DNS server software or cloud provider‚Äôs documentation for information on how to set up a wildcard record.</p>
</blockquote>

<p>There are two sections to this exercise. The first shows you how to use Ansible to setup and configure <span class="notranslate">Galaxy</span> Interactive Tools. The second shows you how to do everything manually. It is recommended that you use the Ansible method. The manual method is included here mainly for a more in depth understanding of what is happening.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#configuring-galaxy-interactive-tools-using-ansible" id="markdown-toc-configuring-galaxy-interactive-tools-using-ansible">Configuring <span class="notranslate">Galaxy</span> Interactive Tools using Ansible</a>    <ol>
      <li><a href="#installing-ansible-roles" id="markdown-toc-installing-ansible-roles">Installing Ansible Roles</a></li>
      <li><a href="#installing-docker" id="markdown-toc-installing-docker">Installing Docker</a></li>
      <li><a href="#installing-the-interactive-tools-proxy" id="markdown-toc-installing-the-interactive-tools-proxy">Installing the Interactive Tools Proxy</a></li>
      <li><a href="#proxying-the-proxy" id="markdown-toc-proxying-the-proxy">Proxying the Proxy</a></li>
      <li><a href="#getting-a-wildcard-ssl-certificate" id="markdown-toc-getting-a-wildcard-ssl-certificate">Getting a Wildcard SSL Certificate</a></li>
      <li><a href="#enabling-interactive-tools-in-galaxy" id="markdown-toc-enabling-interactive-tools-in-galaxy">Enabling Interactive Tools in <span class="notranslate">Galaxy</span></a></li>
      <li><a href="#run-an-interactive-tool" id="markdown-toc-run-an-interactive-tool">Run an Interactive Tool</a></li>
      <li><a href="#securing-interactive-tools" id="markdown-toc-securing-interactive-tools">Securing Interactive Tools</a></li>
    </ol>
  </li>
  <li><a href="#final-notes" id="markdown-toc-final-notes">Final Notes</a></li>
</ol>

</blockquote>

<h1 id="configuring-galaxy-interactive-tools-using-ansible">Configuring <span class="notranslate">Galaxy</span> Interactive Tools using Ansible</h1>

<p>If the terms ‚ÄúAnsible,‚Äù ‚Äúrole,‚Äù and ‚Äúplaybook‚Äù mean nothing to you, please checkout <a href="/training-material/topics/admin/tutorials/ansible/slides.html">the Ansible introduction slides</a> and <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html">the Ansible introduction tutorial</a>.</p>

<p><strong>This section of the tutorial builds upon the work in the <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><span class="notranslate">Galaxy</span> Installation with Ansible</a> tutorial, please ensure that you have completed that tutorial first.</strong></p>

<blockquote class="comment">
  <h3 id="comment-ansible-best-practices"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Ansible Best Practices</h3>
  <p>If you‚Äôve set up your <span class="notranslate">Galaxy</span> server using the <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><span class="notranslate">Galaxy</span> Installation with Ansible</a> tutorial, you will have created a <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>servers</code> group in your inventory file, <code class="language-plaintext highlighter-rouge">hosts</code>, and placed your variables in <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>. Although for the purposes of this tutorial, the <span class="notranslate">Galaxy</span> server and cluster node are one and the same, in a real world deployment they are very likely to be different hosts. We will continue to use the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>servers</code> group for simplicity, but in your own deployment you should consider creating an additional group for cluster nodes.</p>
</blockquote>

<h2 id="installing-ansible-roles">Installing Ansible Roles</h2>

<p>We will use several Ansible roles for this tutorial. In order to avoid repetetively adding them to <code class="language-plaintext highlighter-rouge">requirements.yml</code> and installing them, we can simply install them all before getting started. Each role will be discussed in further detail later in the tutorial.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-new-ansible-roles"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing New Ansible Roles</h3>

  <ol>
    <li>
      <p>In your working directory, add the docker role to your <code class="language-plaintext highlighter-rouge">requirements.yml</code>:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">geerlingguy.docker</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">2.6.0</span>
<span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">use<span class="notranslate">galaxy</span>_eu.gie_proxy</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">0.0.2</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Install the requirements with <code class="language-plaintext highlighter-rouge">ansible-<span class="notranslate">galaxy</span></code>:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-<span class="notranslate">galaxy</span> role install -p roles -r requirements.yml
</code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<h2 id="installing-docker">Installing Docker</h2>

<p>Currently, <span class="notranslate">Galaxy</span> Interactive Tools must be run in Docker containers. It may be possible to run them in Singularity or other types of containers in the future. Thus, the first step is ensuring that the <em>nodes</em> where <span class="notranslate">Galaxy</span> will run have Docker installed. Both the <span class="notranslate">Galaxy</span> Project and <span class="notranslate">Galaxy</span> Project EU organizations have their own docker roles, but these are not published to Ansible <span class="notranslate">Galaxy</span> because they were mostly developed for inte<span class="notranslate">rna</span>l purposes. For now, we will use the <a href="https://galaxy.ansible.com/geerlingguy/docker">docker role</a> by the prolific Ansible <span class="notranslate">Galaxy</span> publisher, <a href="https://galaxy.ansible.com/geerlingguy">Jeff Geerling (geerlingguy)</a>. Have a look at the geerlingguy.docker <a href="https://github.com/geerlingguy/ansible-role-docker/blob/master/README.md">README</a> and <a href="https://github.com/geerlingguy/ansible-role-docker/blob/master/defaults/main.yml">defaults/main.yml</a> to get an understanding of what variables are used to control the role.</p>

<blockquote class="question">
  <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>What variables might be relevant to using this role?</p>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>The <code class="language-plaintext highlighter-rouge">docker_users</code> variable (a <em>list</em>) controls which users are able to interact with the Docker daemon, which our <span class="notranslate">Galaxy</span> user will need to do. Additionally, Docker Compose is configured by default, which we do not need, so it can be disabled with <code class="language-plaintext highlighter-rouge">docker_install_compose: false</code>.</p>

  </blockquote>

</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-docker-with-ansible"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing Docker with Ansible</h3>

  <ol>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <p>The relevant variables to set for this role are:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">docker_users</code></td>
            <td>list of strings</td>
            <td>List of users to be added to the <code class="language-plaintext highlighter-rouge">docker</code> group</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">docker_install_compose</code></td>
            <td>boolean</td>
            <td>Whether to install and configure Docker Compose</td>
          </tr>
        </tbody>
      </table>

      <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Interactive Tools</span>
<span class="na">docker_install_compose</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">docker_users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_user.name</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div>      </div>

      <blockquote class="question">
        <h3 id="question-question-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>Why is <code class="language-plaintext highlighter-rouge">"{{ <span class="notranslate">galaxy</span>_user.name }}"</code> specified instead of just the user <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code>?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>Duplicating values is never a good idea. If we needed to change the <span class="notranslate">Galaxy</span> user down the line or wanted to reuse this playbook on another host where the <span class="notranslate">Galaxy</span> use<span class="notranslate">rna</span>me was different, we would have to change the value in multiple locations.</p>

        </blockquote>

      </blockquote>
    </li>
    <li>
      <p>Add the new role to the list of roles under the <code class="language-plaintext highlighter-rouge">roles</code> key in your playbook, <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s"><span class="notranslate">galaxy</span>servers</span>
  <span class="na">become</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="c1"># ... existing roles ...</span>
    <span class="pi">-</span> <span class="s">geerlingguy.docker</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<p>Congratulations, you‚Äôve set up Docker. Verify the installation using the <code class="language-plaintext highlighter-rouge">docker info</code> command (but keep in mind: what users did we authorize to interact with Docker?).</p>

<h2 id="installing-the-interactive-tools-proxy">Installing the Interactive Tools Proxy</h2>

<p>When an Interactive Tool‚Äôs Docker container starts, it will be assigned a random port. In order to connect clients to the Interactive Tool, <span class="notranslate">Galaxy</span> needs to determine this port (and the node on which the tool is running) and configure a <em>proxy</em> from <span class="notranslate">Galaxy</span> to the GxIT‚Äôs host and port. Consider the following example of running the Jupyter Notebook Interactive Tool, shown in Figure 1 below:</p>

<ul>
  <li>nginx listens for requests from the client on <strong>port 443</strong> (https)</li>
  <li>Requests for <span class="notranslate">Galaxy</span> are delivered from nginx to <span class="notranslate">Galaxy</span> over a UNIX domain socket (uWSGI protocol)</li>
  <li>Requests for Interactive Tools are delivered from nginx to the Interactive Tools Proxy over (by default) <strong>port 8000</strong> (http)
    <ul>
      <li>GxIT http requests are forwarded by the proxy to Docker on the node on the container‚Äôs (randomly assigned) <strong>port 32768</strong></li>
      <li>GxIT http requests are again forwarded by Docker to Jupyter on its in-container ‚Äúpublished‚Äù <strong>port 8888</strong></li>
    </ul>
  </li>
</ul>

<figure id="figure-1"><img src="../../images/interactive-tools/gxit-proxy-diagram.png" alt="Galaxy Interactive Tools Proxy Diagram" /><figcaption><span class="figcaption-prefix">Figure 1:</span> <span class="notranslate">Galaxy</span> Interactive Tools Proxy Diagram</figcaption></figure>

<p>As you can see, the client only ever speaks to nginx on the <span class="notranslate">Galaxy</span> server running on the standard https port (443), never directly to the interactive tool (which may be running on a node that does not even have a public IP address). The <span class="notranslate">mapping</span> of GxIT invocation and its corresponding host/port is kept in a SQLite database known as the <em>Interactive Tools Session Map</em>, and the path to this database is important, since both <span class="notranslate">Galaxy</span> and the proxy need access to it.</p>

<p>The GIE Proxy is written in <a href="https://nodejs.org/">Node.js</a> and requires some configuration. Thankfully there is an Ansible role, <a href="https://galaxy.ansible.com/usegalaxy_eu/gie_proxy">use<span class="notranslate">galaxy</span>_eu.gie_proxy</a>, that can install the proxy and its dependencies, and configure it for you. As usual, have a look through the <a href="https://github.com/usegalaxy-eu/ansible-gie-proxy/blob/master/README.md">README</a> and <a href="https://github.com/usegalaxy-eu/ansible-gie-proxy/blob/master/defaults/main.yml">defaults</a> to investigate which variables you might need to set before continuing.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-the-proxy-with-ansible"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing the Proxy with Ansible</h3>

  <ol>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <p>The relevant variables to set for this role are:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_dir</code></td>
            <td>path (string)</td>
            <td>Path of directory into which the proxy application will be installed</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_git_version</code></td>
            <td>string</td>
            <td>Git reference to clone</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_setup_nodejs</code></td>
            <td>string</td>
            <td>Whether to install Node.js, options are <code class="language-plaintext highlighter-rouge">package</code> and <code class="language-plaintext highlighter-rouge">nodeenv</code></td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_virtualenv_command</code></td>
            <td>string</td>
            <td>Command to create virtualenv when using <code class="language-plaintext highlighter-rouge">nodeenv</code> method</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_nodejs_version</code></td>
            <td>string</td>
            <td>Version of Node.js to install if using <code class="language-plaintext highlighter-rouge">nodeenv</code> method</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_virtualenv</code></td>
            <td>path (string)</td>
            <td>Path of virtualenv into which nodeenv/Node.js/npm will be installed</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_setup_service</code></td>
            <td>string</td>
            <td>Whether to configure the proxy as a service, only option is <code class="language-plaintext highlighter-rouge">systemd</code></td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">gie_proxy_sessions_path</code></td>
            <td>path (string)</td>
            <td>Path of Interactive Tools sessions map</td>
          </tr>
        </tbody>
      </table>

      <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">gie_proxy_dir</span><span class="pi">:</span> <span class="s">/srv/<span class="notranslate">galaxy</span>/gie-proxy/proxy</span>
<span class="na">gie_proxy_git_version</span><span class="pi">:</span> <span class="s">master</span>
<span class="na">gie_proxy_setup_nodejs</span><span class="pi">:</span> <span class="s">nodeenv</span>
<span class="na">gie_proxy_virtualenv_command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">pip_virtualenv_command</span><span class="nv"> </span><span class="s">}}"</span>
<span class="na">gie_proxy_nodejs_version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.13.0"</span>
<span class="na">gie_proxy_virtualenv</span><span class="pi">:</span> <span class="s">/srv/<span class="notranslate">galaxy</span>/gie-proxy/venv</span>
<span class="na">gie_proxy_setup_service</span><span class="pi">:</span> <span class="s">systemd</span>
<span class="na">gie_proxy_sessions_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_mutable_data_dir</span><span class="nv"> </span><span class="s">}}/interactivetools_map.sqlite"</span>
</code></pre></div>      </div>

      <p>We have chosen to install Node.js using <a href="https://github.com/ekalinin/nodeenv">nodeenv</a> because the version in the training image‚Äôs package manager is fairly old.</p>
    </li>
    <li>
      <p>Add the new role to <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s"><span class="notranslate">galaxy</span>servers</span>
  <span class="na">become</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="c1"># ... existing roles ...</span>
    <span class="pi">-</span> <span class="s">geerlingguy.docker</span>
    <span class="pi">-</span> <span class="s">use<span class="notranslate">galaxy</span>_eu.gie_proxy</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-question-2"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>What did running the playbook change?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-2"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>A new Python venv was created at <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/gie-proxy/venv</code></li>
      <li>Node.js version 10.13.0 was installed in to the venv</li>
      <li>The proxy was cloned to <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/gie-proxy/proxy</code></li>
      <li>The proxy‚Äôs Node dependencies were installed to <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/gie-proxy/proxy/node_modules</code> using the venv‚Äôs <code class="language-plaintext highlighter-rouge">npm</code></li>
      <li>A systemd service unit was installed at <code class="language-plaintext highlighter-rouge">/etc/systemd/system/<span class="notranslate">galaxy</span>-gie-proxy.service</code></li>
      <li>The systemd daemon was reloaded to read this new service unit</li>
      <li>The service was set to start on boot and started</li>
    </ol>

  </blockquote>

</blockquote>

<p>Because the proxy runs as a systemd service, you can inspect the log of the service using <code class="language-plaintext highlighter-rouge">jou<span class="notranslate">rna</span>lctl</code>. The service name is <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>-gie-proxy</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>jou<span class="notranslate">rna</span>lctl <span class="nt">-eu</span> <span class="notranslate">galaxy</span>-gie-proxy
<span class="go">Feb 14 17:38:49 gcc-4 systemd[1]: Started <span class="notranslate">Galaxy</span> IE/IT Proxy.
Feb 14 17:38:49 gcc-4 node[3679]: Watching path /srv/<span class="notranslate">galaxy</span>/var/interactivetools_map.sqlite
</span></code></pre></div></div>

<blockquote class="comment">
  <h3 id="comment-note"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note</h3>

  <p>You can ignore errors about failing to read the sessions map file for now - <span class="notranslate">Galaxy</span> will create it when it‚Äôs needed.</p>

</blockquote>

<h2 id="proxying-the-proxy">Proxying the Proxy</h2>

<p>As explained in the previous section, we will proxy the Interactive Tools Proxy with nginx so that it can serve requests on the standard HTTPS port, 443. Because we‚Äôve configured nginx with Ansible, this is relatively simple.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-the-proxy-with-ansible-1"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing the Proxy with Ansible</h3>

  <ol>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> and add a new item to the <strong>existing</strong> <code class="language-plaintext highlighter-rouge">nginx_ssl_servers</code> so it matches:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">nginx_ssl_servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s"><span class="notranslate">galaxy</span></span>
  <span class="pi">-</span> <span class="s"><span class="notranslate">galaxy</span>-gie-proxy</span>
</code></pre></div>      </div>

      <p>The nginx configuration <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>-gie-proxy</code> doesn‚Äôt exist yet, but we‚Äôll create it in a moment.</p>
    </li>
    <li>
      <p>Create <code class="language-plaintext highlighter-rouge">templates/nginx/<span class="notranslate">galaxy</span>-gie-proxy.j2</code> with the following contents:</p>

      <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="c1"># Listen on port 443</span>
    <span class="kn">listen</span>       <span class="s">*:443</span> <span class="s">ssl</span><span class="p">;</span>
    <span class="c1"># Match all requests for the interactive tools subdomain</span>
    <span class="kn">server_name</span>  <span class="s">*.interactivetool.</span><span class="p">{</span><span class="err">{</span> <span class="kn">inventory_hostname</span> <span class="err">}}</span><span class="p">;</span>

    <span class="c1"># Our log files will go here.</span>
    <span class="kn">access_log</span>  <span class="n">/var/log/nginx/<span class="notranslate">galaxy</span>-gie-proxy-access.log</span><span class="p">;</span>
    <span class="kn">error_log</span>   <span class="n">/var/log/nginx/<span class="notranslate">galaxy</span>-gie-proxy-error.log</span><span class="p">;</span>

    <span class="c1"># Proxy all requests to the GIE Proxy application</span>
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">"upgrade"</span><span class="p">;</span>
        <span class="kn">proxy_pass</span> <span class="s">http://localhost:</span><span class="p">{</span><span class="err">{</span> <span class="kn">gie_proxy_port</span> <span class="err">}}</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
  </ol>

</blockquote>

<h2 id="getting-a-wildcard-ssl-certificate">Getting a Wildcard SSL Certificate</h2>

<p>During the <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><span class="notranslate">Galaxy</span> Installation with Ansible</a> tutorial, we acquired an SSL certificate for our <span class="notranslate">Galaxy</span> server from <a href="https://letsencrypt.org/">Let‚Äôs Encrypt</a>. This certificate was issued for the hostname of your <span class="notranslate">Galaxy</span> server (e.g. <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.example.org</code>). SSL certificates are valid <em>only for the name to which they were issued</em>. This presents a problem for us due to the way that <span class="notranslate">Galaxy</span> Interactive Tools work.</p>

<p>In order to ensure each Interactive Tool‚Äôs cookies are unique, and to provide each tool with a unique entry point, they are served from a subdomain of your <span class="notranslate">Galaxy</span> server (e.g. <code class="language-plaintext highlighter-rouge">&lt;unique-id&gt;.interactivetoolentrypoint.interactivetool.<span class="notranslate">galaxy</span>.example.org</code>). Your SSL cert is not valid for this subdomain. Further, in order to support the random <code class="language-plaintext highlighter-rouge">&lt;unique-id&gt;</code> in the hostname, we need a <em>wildcard certificate</em> for <code class="language-plaintext highlighter-rouge">*.interactivetoolentrypoint.interactivetool.<span class="notranslate">galaxy</span>.example.org</code>. Let‚Äôs Encrypt wildcard certificates <a href="https://letsencrypt.org/docs/faq/">can only be generated using the DNS-01 challenge method</a>, which works by issuing a <a href="https://en.wikipedia.org/wiki/Dynamic_DNS">dynamic DNS</a> update to set the requested domain‚Äôs <code class="language-plaintext highlighter-rouge">TXT</code> record. As a result, this process is highly dependent on your site; specifically, your SSL certificate vendor, and your DNS server software or cloud provider.</p>

<p>If you are completing this tutorial as part of a <a href="https://github.com/galaxyproject/dagobah-training"><span class="notranslate">Galaxy</span> Admin Training</a> course, we have precreated a dynamic DNS server that you will use for this step. The <em>TSIG key</em> that allows you to perform dynamic DNS updates will be provided to you. Your instructor will also tell you which option to follow (1 or 2), depending on the DNS provider that was chosen for this course.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-requesting-a-wildcard-certificate-with-certbot-using-ansible---option-1-rfc2136"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Requesting a Wildcard Certificate with Certbot using Ansible - Option 1 (rfc2136)</h3>

  <p>This method uses a DNS provider hosted by the <span class="notranslate">Galaxy</span> Project.</p>

  <ol>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <p>The relevant variables to set for this role are:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_domains</code></td>
            <td>list</td>
            <td>List of domains to include as subject alte<span class="notranslate">rna</span>tive names (the first will also be the certificate‚Äôs <em>common name</em>)</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_dns_provider</code></td>
            <td>string</td>
            <td>Name of <a href="https://certbot.eff.org/docs/using.html#dns-plugins">Certbot DNS plugin</a> to use</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_dns_credentials</code></td>
            <td>dictionary</td>
            <td>Plugin-specific credentials for performing dynamic DNS updates</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_expand</code></td>
            <td>boolean</td>
            <td>Whether to ‚Äúexpand‚Äù an existing certificate (add new domain names to it)</td>
          </tr>
        </tbody>
      </table>

      <ul>
        <li>
          <p>Add a new item to the <strong>existing</strong> <code class="language-plaintext highlighter-rouge">certbot_domains</code> list so it matches:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">certbot_domains</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*.interactivetoolentrypoint.interactivetool.{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div>          </div>
        </li>
        <li>
          <p>Comment out the existing <code class="language-plaintext highlighter-rouge">certbot_auth_method</code> like so:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#certbot_auth_method: --webroot</span>
</code></pre></div>          </div>

          <p>Although this is not explicitly required (setting <code class="language-plaintext highlighter-rouge">cerbot_dns_provider</code> as we do overrides this setting), doing so is less confusing in the future, since it makes it clear that the ‚Äúwebroot‚Äù method for Let‚Äôs Encrypt WEB-01 challenges is no longer in use for this server.</p>
        </li>
        <li>
          <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">certbot_dns_provider</span><span class="pi">:</span> <span class="s">rfc2136</span>
<span class="na">certbot_dns_credentials</span><span class="pi">:</span>
  <span class="na">server</span><span class="pi">:</span> <span class="s">ns-training.<span class="notranslate">galaxy</span>project.org</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">53</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">certbot-training.</span>
  <span class="na">secret</span><span class="pi">:</span> <span class="s">&lt;SECRET PROVIDED BY INSTRUCTOR&gt;</span>
  <span class="na">algorithm</span><span class="pi">:</span> <span class="s">HMAC-SHA512</span>
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p>Run the playbook <strong>with <code class="language-plaintext highlighter-rouge">certbot_expand</code></strong>:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml -e certbot_expand=true
</code></pre></div>      </div>

      <blockquote class="question">
        <h3 id="question-question-3"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What is the <code class="language-plaintext highlighter-rouge">-e</code> flag to <code class="language-plaintext highlighter-rouge">ansible-playbook</code> and why did we use it?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-3"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

          <p>As per <code class="language-plaintext highlighter-rouge">ansible-playbook --help</code>:</p>

          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -e EXTRA_VARS, --extra-vars EXTRA_VARS
                        set additional variables as key=value or YAML/JSON, if
                        filename prepend with @
</code></pre></div>          </div>

          <p>We used this flag because <code class="language-plaintext highlighter-rouge">certbot_expand</code> only needs to be set <em>once</em>, when we are adding a new domain to the certificate. It should not be enabled on subsequent runs of the playbook, or else we would request a new certificate on each run! Thus, it does not make sense to add it to a vars file.</p>

        </blockquote>

      </blockquote>

      <p>Be patient! The certificate request step can take time due to the time allowed for DNS propagation to occur.</p>
    </li>
  </ol>

</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-requesting-a-wildcard-certificate-with-certbot-using-ansible---option-2-route53"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Requesting a Wildcard Certificate with Certbot using Ansible - Option 2 (route53)</h3>

  <p>This method uses route53, the Amazon Web Services DNS provider. To manage connection to AWS, we will first install a specific role.</p>

  <ol>
    <li>
      <p>In your working directory, add the aws_cli role to your <code class="language-plaintext highlighter-rouge">requirements.yml</code>:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">use<span class="notranslate">galaxy</span>_eu.aws_cli</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">0.0.1</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Install the requirements with <code class="language-plaintext highlighter-rouge">ansible-<span class="notranslate">galaxy</span></code>:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-<span class="notranslate">galaxy</span> role install -p roles -r requirements.yml
</code></pre></div>      </div>
    </li>
    <li>
      <p>Open <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> with your text editor to add the role <code class="language-plaintext highlighter-rouge">use<span class="notranslate">galaxy</span>_eu.aws_cli</code> just before the nginx role:</p>

      <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/<span class="notranslate">galaxy</span>.yml b/<span class="notranslate">galaxy</span>.yml
</span><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -21,6 +21,7 @@</span>
       become: true
       become_user: <span class="notranslate">galaxy</span>
     - use<span class="notranslate">galaxy</span>_eu.<span class="notranslate">galaxy</span>_systemd
<span class="gi">+    - use<span class="notranslate">galaxy</span>_eu.aws_cli
</span>     - <span class="notranslate">galaxy</span>project.nginx
     - geerlingguy.docker
     - use<span class="notranslate">galaxy</span>_eu.gie_proxy
</code></pre></div>      </div>
    </li>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <p>The relevant variables to set for this role are:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_domains</code></td>
            <td>list</td>
            <td>List of domains to include as subject alte<span class="notranslate">rna</span>tive names (the first will also be the certificate‚Äôs <em>common name</em>)</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_dns_provider</code></td>
            <td>string</td>
            <td>Name of <a href="https://certbot.eff.org/docs/using.html#dns-plugins">Certbot DNS plugin</a> to use</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_dns_credentials</code></td>
            <td>dictionary</td>
            <td>Plugin-specific credentials for performing dynamic DNS updates</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">certbot_expand</code></td>
            <td>boolean</td>
            <td>Whether to ‚Äúexpand‚Äù an existing certificate (add new domain names to it)</td>
          </tr>
        </tbody>
      </table>

      <ul>
        <li>
          <p>Add a new item to the <strong>existing</strong> <code class="language-plaintext highlighter-rouge">certbot_domains</code> list so it matches:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">certbot_domains</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*.interactivetoolentrypoint.interactivetool.{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div>          </div>
        </li>
        <li>
          <p>Comment out the existing <code class="language-plaintext highlighter-rouge">certbot_auth_method</code> like so:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#certbot_auth_method: --webroot</span>
</code></pre></div>          </div>

          <p>Although this is not explicitly required (setting <code class="language-plaintext highlighter-rouge">cerbot_dns_provider</code> as we do overrides this setting), doing so is less confusing in the future, since it makes it clear that the ‚Äúwebroot‚Äù method for Let‚Äôs Encrypt WEB-01 challenges is no longer in use for this server.</p>
        </li>
        <li>
          <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file:</p>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">certbot_dns_provider</span><span class="pi">:</span> <span class="s">route53</span>
<span class="na">aws_cli_credentials</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;SECRET</span><span class="nv"> </span><span class="s">PROVIDED</span><span class="nv"> </span><span class="s">BY</span><span class="nv"> </span><span class="s">INSTRUCTOR&gt;"</span>
    <span class="na">secret_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;SECRET</span><span class="nv"> </span><span class="s">PROVIDED</span><span class="nv"> </span><span class="s">BY</span><span class="nv"> </span><span class="s">INSTRUCTOR&gt;"</span>
    <span class="na">homedir</span><span class="pi">:</span> <span class="s">/root</span>
    <span class="na">owner</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">root</span>
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p>Run the playbook <strong>with <code class="language-plaintext highlighter-rouge">certbot_expand</code></strong>:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml -e certbot_expand=true
</code></pre></div>      </div>

      <blockquote class="question">
        <h3 id="question-question-4"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What is the <code class="language-plaintext highlighter-rouge">-e</code> flag to <code class="language-plaintext highlighter-rouge">ansible-playbook</code> and why did we use it?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-4"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

          <p>As per <code class="language-plaintext highlighter-rouge">ansible-playbook --help</code>:</p>

          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -e EXTRA_VARS, --extra-vars EXTRA_VARS
                        set additional variables as key=value or YAML/JSON, if
                        filename prepend with @
</code></pre></div>          </div>

          <p>We used this flag because <code class="language-plaintext highlighter-rouge">certbot_expand</code> only needs to be set <em>once</em>, when we are adding a new domain to the certificate. It should not be enabled on subsequent runs of the playbook, or else we would request a new certificate on each run! Thus, it does not make sense to add it to a vars file.</p>

        </blockquote>

      </blockquote>
    </li>
  </ol>

</blockquote>

<p>You can verify that your certificate has been expanded using your browser‚Äôs developer tools:</p>

<figure id="figure-2"><img src="../../images/interactive-tools/wildcard-cert.png" alt="Wildcard Certificate Dialog" /><figcaption><span class="figcaption-prefix">Figure 2:</span> Wildcard Certificate Dialog</figcaption></figure>

<h2 id="enabling-interactive-tools-in-galaxy">Enabling Interactive Tools in <span class="notranslate">Galaxy</span></h2>

<p>A few Interactive Tool wrappers are provided with <span class="notranslate">Galaxy</span>, but they are <a href="https://github.com/galaxyproject/galaxy/blob/9d788cb144a18570e7e5e948ac1f7bc04fec4e75/lib/galaxy/config/sample/tool_conf.xml.sample#L126">commented out in <span class="notranslate">Galaxy</span>‚Äôs default tool config file</a>. As a result, we need to instruct the <a href="https://github.com/galaxyproject/ansible-galaxy"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> role</a> to install a tool panel configuration file containing at least one of these tools in order to try them out. For the purposes of this tutorial, a good choice is the <a href="https://ethercalc.net/">EtherCalc</a> GxIT, because it has a relatively small <a href="https://hub.docker.com/r/shiltemann/ethercalc-galaxy-ie">Docker image</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-enabling-interactive-tools-in-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Enabling Interactive Tools in <span class="notranslate">Galaxy</span></h3>

  <ol>
    <li>
      <p>Rather than modifying the default tool configuration file, we‚Äôll add a new one that only references the Interactive Tools. This way, the default set of tools will still load without us having to incorporate the entire default tool config into our playbook.</p>

      <p>If the folder does not exist, create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config</code> next to your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> (<code class="language-plaintext highlighter-rouge">mkdir -p templates/<span class="notranslate">galaxy</span>/config/</code>)</p>

      <p>Create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/tool_conf_interactive.xml.j2</code> with the following contents:</p>

      <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;toolbox</span> <span class="na">monitor=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"interactivetools"</span> <span class="na">name=</span><span class="s">"Interactive Tools"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tool</span> <span class="na">file=</span><span class="s">"interactive/interactivetool_ethercalc.xml"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
<span class="nt">&lt;/toolbox&gt;</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>We need to modify <code class="language-plaintext highlighter-rouge">job_conf.xml</code> to instruct <span class="notranslate">Galaxy</span> on how run Interactive Tools (and specifically, how to run them in Docker). We will begin with a basic job conf:</p>

      <p>Create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</code> with the following contents:</p>

      <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;job_conf&gt;</span>
    <span class="nt">&lt;plugins</span> <span class="na">workers=</span><span class="s">"4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">id=</span><span class="s">"local"</span> <span class="na">type=</span><span class="s">"runner"</span> <span class="na">load=</span><span class="s">"<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;destinations&gt;</span>
        <span class="nt">&lt;destination</span> <span class="na">id=</span><span class="s">"local"</span> <span class="na">runner=</span><span class="s">"local"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/destinations&gt;</span>
<span class="nt">&lt;/job_conf&gt;</span>
</code></pre></div>      </div>

      <blockquote class="comment">
        <h3 id="comment-note-1"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note</h3>
        <p>Depending on the order in which you are completing this tutorial in relation to other tutorials, you may have already created the <code class="language-plaintext highlighter-rouge">job_conf.xml.j2</code> file, as well as defined <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code> and set the <code class="language-plaintext highlighter-rouge">job_config_file</code> option in <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> (step 4). If this is the case, be sure to <strong>merge the changes in this section with your existing playbook</strong>.</p>
      </blockquote>
    </li>
    <li>
      <p>Next, we need to configure the interactive tools destination. First, we explicitly set the destination to the default <code class="language-plaintext highlighter-rouge">local</code> destination since there will now be two destinations defined. Then we add a destination for submitting jobs as docker containers using the <a href="https://github.com/galaxyproject/galaxy/blob/6622ad1acb91866febb3d2f229de7cfb8af3a9f6/lib/galaxy/config/sample/job_conf.xml.sample_advanced#L410">advanced sample job configuration</a> as a guide. Finally, use the <a href="https://github.com/galaxyproject/galaxy/blob/6622ad1acb91866febb3d2f229de7cfb8af3a9f6/tools/interactive/interactivetool_ethercalc.xml">EtherCalc GxIT‚Äôs</a> tool ID to route executions of the EtherCalc GxIT to the newly created destination:</p>

      <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span>     &lt;plugins workers="4"&gt;
         &lt;plugin id="local" type="runner" load="<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"/&gt;
     &lt;/plugins&gt;
<span class="gd">-    &lt;destinations&gt;
</span><span class="gi">+    &lt;destinations default="local"&gt;
</span>         &lt;destination id="local" runner="local"/&gt;
<span class="gi">+        &lt;destination id="interactive_local" runner="local"&gt;
+            &lt;param id="docker_enabled"&gt;true&lt;/param&gt;
+            &lt;param id="docker_volumes"&gt;$defaults&lt;/param&gt;
+            &lt;param id="docker_sudo"&gt;false&lt;/param&gt;
+            &lt;param id="docker_net"&gt;bridge&lt;/param&gt;
+            &lt;param id="docker_auto_rm"&gt;true&lt;/param&gt;
+            &lt;param id="docker_set_user"&gt;&lt;/param&gt;
+            &lt;param id="require_container"&gt;true&lt;/param&gt;
+        &lt;/destination&gt;
</span>     &lt;/destinations&gt;
<span class="gi">+    &lt;tools&gt;
+        &lt;tool destination="interactive_local" id="interactive_tool_ethercalc" /&gt;
+    &lt;/tools&gt;
</span> &lt;/job_conf&gt;
</code></pre></div>      </div>

      <p>Of considerable note is the <code class="language-plaintext highlighter-rouge">docker_volumes</code> param: the variable expansions are explained in the <a href="https://github.com/galaxyproject/galaxy/blob/6622ad1acb91866febb3d2f229de7cfb8af3a9f6/lib/galaxy/config/sample/job_conf.xml.sample_advanced#L410">advanced sample job configuration</a>.  We‚Äôll use this volume configuration for now but it has some considerable data security problems. We‚Äôll discuss a better solution at the end of this tutorial.</p>
    </li>
    <li>
      <p>Inform <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> of what tool configuration files to load in your group variables (<code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>):</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_tool_config_files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_server_dir</span><span class="nv"> </span><span class="s">}}/config/tool_conf.xml.sample"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv"> </span><span class="s">}}/tool_conf_interactive.xml"</span>
</code></pre></div>      </div>

      <p>Next, inform <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> of where you would like the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> to reside, that GxITs should be enabled, and where the GxIT map database can be found:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config</span><span class="pi">:</span>
  <span class="na"><span class="notranslate">galaxy</span></span><span class="pi">:</span>
    <span class="c1"># ... existing configuration options in the `<span class="notranslate">galaxy</span>` section ...</span>
    <span class="na">job_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv"> </span><span class="s">}}/job_conf.xml"</span>
    <span class="na">interactivetools_enable</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">interactivetools_map</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">gie_proxy_sessions_path</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div>      </div>

      <p>And then deploy the new config templates using the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code> var in your group vars:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config_templates</span><span class="pi">:</span>
  <span class="c1"># ... possible existing config file definitions</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/tool_conf_interactive.xml.j2</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv"> </span><span class="s">}}/tool_conf_interactive.xml"</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.job_config_file</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
    <li>
      <p>Follow the <span class="notranslate">Galaxy</span> logs with <code class="language-plaintext highlighter-rouge">jou<span class="notranslate">rna</span>lctl -f -u <span class="notranslate">galaxy</span></code></p>
    </li>
  </ol>

</blockquote>

<h2 id="run-an-interactive-tool">Run an Interactive Tool</h2>

<p>You should now be ready to run an Interactive Tool in <span class="notranslate">Galaxy</span>!</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-running-an-interactive-tool"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Running an Interactive Tool</h3>

  <ol>
    <li>Ensure that you are logged in to your <span class="notranslate">Galaxy</span> server by checking the <strong>User</strong> menu in the masthead.</li>
    <li>
      <p>We‚Äôll need an input for our test GxIT (EtherCalc). Any tabular file can be used, such as <span class="notranslate">Galaxy</span>‚Äôs <a href="https://raw.githubusercontent.com/galaxyproject/galaxy/release_20.01/test-data/1.tabular">1.tabular</a> test data. Copy this file‚Äôs URL:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/<span class="notranslate">galaxy</span>project/<span class="notranslate">galaxy</span>/release_20.01/test-data/1.tabular
</code></pre></div>      </div>
    </li>
    <li>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-upload</span> <strong>Upload</strong> at the top of the tool panel (on the left side of the <span class="notranslate">Galaxy</span> UI).</li>
    <li>In the resulting modal dialog, click the <strong>Paste/Fetch data</strong> button.</li>
    <li>Paste the URL in the <strong>text field</strong> that has just appeared.</li>
    <li>Give the new dataset a name such as <code class="language-plaintext highlighter-rouge">tabular</code>, if you like.</li>
    <li>Click <strong>Start</strong> and then <strong>Close</strong>.</li>
    <li>From the tool menu, click the <strong>Interactive Tools</strong> section, then click <strong>EtherCalc</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>.</li>
    <li>Ensure that your newly uploaded tabular dataset is selected as the input <strong>Some tabular dataset</strong>, then click <strong>Execute</strong>.</li>
    <li>
      <p>Monitor the blue <strong>info box</strong> on the next page, which will inform you when the Interactive Tool is accessible and provide you with a link to access it.</p>

      <p><br /></p>

      <p>If you navigate away from this page, you can view your running Interactive Tools from the <strong>Active InteractiveTools</strong> menu item in the <strong>User</strong> menu.</p>
    </li>
    <li>Click the <strong>click here to display</strong> link.</li>
  </ol>

</blockquote>

<p>If everything has worked correctly, your browser will load EtherCalc with your tabular data preloaded. Once you‚Äôre done working with the data, return to <span class="notranslate">Galaxy</span> and stop EtherCalc by deleting its output dataset from your history, or stopping it via the interface from the <strong>Active InteractiveTools</strong> menu item in the <strong>User</strong> menu.</p>

<h2 id="securing-interactive-tools">Securing Interactive Tools</h2>

<p>Inspecting the Docker container of a running Interactive Tool shows the volume configuration expanded from <code class="language-plaintext highlighter-rouge">$<span class="notranslate">galaxy</span>_root</code> in the job destination‚Äôs <code class="language-plaintext highlighter-rouge">docker_volumes</code> param:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker inspect <span class="si">$(</span>docker ps <span class="nt">-q</span><span class="si">)</span> | jq <span class="s1">'.[0].HostConfig.Binds'</span>
<span class="go">[
</span><span class="gp">  "/srv/<span class="notranslate">galaxy</span>/server:/srv/<span class="notranslate">galaxy</span>/server:ro",                                     #</span><span class="w"> </span><span class="notranslate">Galaxy</span> server <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/server/tools/interactive:/srv/<span class="notranslate">galaxy</span>/server/tools/interactive:ro", #</span><span class="w"> </span>EtherCalc tool wrapper parent <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/000/1:/srv/<span class="notranslate">galaxy</span>/jobs/000/1:ro",                             #</span><span class="w"> </span>Per-job root <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/000/1/outputs:/srv/<span class="notranslate">galaxy</span>/jobs/000/1/outputs:rw",             #</span><span class="w"> </span>Job outputs <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/000/1/configs:/srv/<span class="notranslate">galaxy</span>/jobs/000/1/configs:rw",             #</span><span class="w"> </span>Job config files <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/000/1/working:/srv/<span class="notranslate">galaxy</span>/jobs/000/1/working:rw",             #</span><span class="w"> </span>Job working <span class="o">(</span>cwd<span class="o">)</span> <span class="nb">dir</span>
<span class="gp">  "/data:/data:rw",                                                               #</span><span class="w"> </span><span class="notranslate">GALAXY</span> USER DATASETS DIR <span class="o">(</span>RW!<span class="o">)</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/server/tool-data:/srv/<span class="notranslate">galaxy</span>/server/tool-data:ro"                  #</span><span class="w"> </span><span class="notranslate">Galaxy</span> reference data <span class="nb">dir</span>
<span class="go">]
</span></code></pre></div></div>

<p>As hinted earlier, there is a concerning state here: The directory containing <strong>all</strong> of the the user-generated data in <span class="notranslate">Galaxy</span> (not just the data for this job) has been mounted <strong>read-write</strong> in to the container. <strong>This configuration grants users running interactive tools full access to all the data in <span class="notranslate">Galaxy</span>, which is a very bad idea.</strong> Unlike standard <span class="notranslate">Galaxy</span> tools, where the tool‚Äôs design prevents users from writing to arbitrary paths, Interactive Tools are fully user controllable. Although EtherCalc does not provide a mechanism for writing to this path, other Interactive Tools (such as Jupyter Notebook) do.</p>

<p>Two solutions are discussed in the <a href="https://github.com/galaxyproject/galaxy/blob/6622ad1acb91866febb3d2f229de7cfb8af3a9f6/lib/galaxy/config/sample/job_conf.xml.sample_advanced#L410">advanced sample job configuration</a>:</p>

<ol>
  <li>Use the <code class="language-plaintext highlighter-rouge">outputs_to_working_directory</code> job configuration option, which allows you to mount datasets read-only: this prevents manipulation, but still allows GxIT users to read any dataset in your <span class="notranslate">Galaxy</span> server.</li>
  <li>Use <a href="https://github.com/galaxyproject/pulsar">Pulsar</a>, <span class="notranslate">Galaxy</span>‚Äôs remote job execution engine, to provide full job isolation: this avoids all access to <span class="notranslate">Galaxy</span> data, with the performance penalty of copying input dataset(s) to the job directory.</li>
</ol>

<p>Because we want to maintain dataset privacy, Pulsar is the better choice here. And in fact, we don‚Äôt even need to set up a Pulsar server: because we only need Pulsar‚Äôs input staging and isolation features, we can use <a href="https://github.com/galaxyproject/galaxy/blob/6622ad1acb91866febb3d2f229de7cfb8af3a9f6/lib/galaxy/config/sample/job_conf.xml.sample_advanced#L106">Embedded Pulsar</a>, which runs a Pulsar server within the <span class="notranslate">Galaxy</span> application to perform these tasks. Embedded Pulsar can even interface with your distributed resource manager (aka cluster scheduler) of choice, as long as your <span class="notranslate">Galaxy</span> server and cluster both have access to a common filesystem (otherwise, you will need to use Pulsar in standalone mode; see the <a href="/training-material/topics/admin/tutorials/pulsar/tutorial.html">Running Jobs on Remote Resources with Pulsar</a> tutorial).</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-running-interactive-tools-with-embedded-pulsar"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Running Interactive Tools with Embedded Pulsar</h3>

  <ol>
    <li>
      <p>Create a configuration file <em>template</em> for the Pulsar application at <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/pulsar_app.yml.j2</code>.</p>

      <p><br /></p>

      <p>If the folder does not exist, create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config</code> next to your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> (<code class="language-plaintext highlighter-rouge">mkdir -p templates/<span class="notranslate">galaxy</span>/config/</code>).</p>

      <p><br /></p>

      <p>Add the following contents to the template:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>

<span class="c1"># The path where per-job directories will be created</span>
<span class="na">staging_directory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_job_working_directory</span><span class="nv"> </span><span class="s">}}/_interactive"</span>

<span class="c1"># Where Pulsar state information will be stored (e.g. currently active jobs)</span>
<span class="na">persistence_directory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_mutable_data_dir</span><span class="nv"> </span><span class="s">}}/pulsar"</span>

<span class="c1"># Where to find <span class="notranslate">Galaxy</span> tool dependencies</span>
<span class="na">tool_dependency_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_tool_dependency_dir</span><span class="nv"> </span><span class="s">}}"</span>

<span class="c1"># How to run jobs (see https://pulsar.readthedocs.io/en/latest/job_managers.html)</span>
<span class="na">managers</span><span class="pi">:</span>
  <span class="na">_default_</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">queued_python</span>
    <span class="na">num_concurrent_jobs</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Modify the job configuration file, <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</code>, to configure Interactive Tools to use the embedded Pulsar runner.</p>

      <p><br /></p>

      <p><strong>Add</strong> the embedded Pulsar runner plugin to the <code class="language-plaintext highlighter-rouge">&lt;plugins&gt;</code> section of the config:</p>

      <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin</span> <span class="na">id=</span><span class="s">"pulsar_embedded"</span> <span class="na">type=</span><span class="s">"runner"</span> <span class="na">load=</span><span class="s">"<span class="notranslate">galaxy</span>.jobs.runners.pulsar:PulsarEmbeddedJobRunner"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">id=</span><span class="s">"pulsar_config"</span><span class="nt">&gt;</span>/srv/<span class="notranslate">galaxy</span>/config/pulsar_app.yml<span class="nt">&lt;/param&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-tip-ansible-best-practices"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Ansible Best Practices</h3>
        <p>We have used a bit of bad practice here: hardcoding the Pulsar config file path in to the job config file. At this point, we should convert the job config file to a template (in the same manner as the Pulsar config template). The reason we don‚Äôt do it in this tutorial is to maintain compatibility with other tutorials, but you may do so by following the same pattern as is used for the Pulsar config template.</p>
      </blockquote>

      <p>Next, <strong>modify</strong> the <code class="language-plaintext highlighter-rouge">interactive_local</code> destination to use the new runner and set the new parameter <code class="language-plaintext highlighter-rouge">container_monitor_result</code> to <code class="language-plaintext highlighter-rouge">callback</code> (explained in more detail in the next step):</p>

      <blockquote class="warning">
        <h3 id="warning-warning-untrusted-ssl-certificates"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i><span class="visually-hidden">warning</span> Warning: Untrusted SSL Certificates</h3>
        <p>If you are completing this tutorial as part of a <a href="https://github.com/galaxyproject/dagobah-training"><span class="notranslate">Galaxy</span> Admin Training</a> course, you will also need the <code class="language-plaintext highlighter-rouge">&lt;env&gt;</code> setting shown below to prevent problems with the untrusted SSL certificates in use during the course. <span class="notranslate">Galaxy</span> servers with valid SSL certificates <em>do not need this option</em>.</p>
      </blockquote>

      <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span>     &lt;destinations default="local"&gt;
         &lt;destination id="local" runner="local"/&gt;
<span class="gd">-        &lt;destination id="interactive_local" runner="local"&gt;
</span><span class="gi">+        &lt;destination id="interactive_local" runner="pulsar_embedded"&gt;
</span>             &lt;param id="docker_enabled"&gt;true&lt;/param&gt;
             &lt;param id="docker_volumes"&gt;$defaults&lt;/param&gt;
             &lt;param id="docker_sudo"&gt;false&lt;/param&gt;
             &lt;param id="docker_net"&gt;bridge&lt;/param&gt;
             &lt;param id="docker_auto_rm"&gt;true&lt;/param&gt;
             &lt;param id="docker_set_user"&gt;&lt;/param&gt;
             &lt;param id="require_container"&gt;true&lt;/param&gt;
<span class="gi">+            &lt;param id="container_monitor_result"&gt;callback&lt;/param&gt;
+            &lt;env id="REQUESTS_CA_BUNDLE"&gt;/etc/ssl/certs/ca-certificates.crt&lt;/env&gt;
</span>         &lt;/destination&gt;
     &lt;/destinations&gt;
</code></pre></div>      </div>
    </li>
    <li>
      <p>Open your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>servers</code> group variables file and instruct <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> to install the Pulsar configuration file:</p>

      <blockquote class="comment">
        <h3 id="comment-note-2"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note</h3>
        <p>Depending on the order in which you are completing this tutorial in relation to other tutorials, you may have already defined <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code>. If this is the case, be sure to <strong>merge the changes in this step with your existing playbook</strong>.</p>
      </blockquote>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config_templates</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/pulsar_app.yml.j2</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv"> </span><span class="s">}}/pulsar_app.yml"</span>
</code></pre></div>      </div>

      <p>Additionally, you will need to set the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_infrastructure_url</code> config option:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config</span><span class="pi">:</span>
  <span class="na"><span class="notranslate">galaxy</span></span><span class="pi">:</span>
    <span class="c1"># ... existing configuration options in the `<span class="notranslate">galaxy</span>` section ...</span>
    <span class="na"><span class="notranslate">galaxy</span>_infrastructure_url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}/"</span>
</code></pre></div>      </div>

      <blockquote class="details">
        <h3 id="details-detail-infrastructure-urlcallback"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Detail: Infrastructure URL/Callback</h3>
        <p><span class="notranslate">Galaxy</span> must be made aware of the randomly selected port Docker has assigned after the GxIT begins operating, in order to update the proxy map. By default, this is done by writing a JSON file in the job directory. This method does not work with Pulsar since Pulsar uses a different job directory from the <span class="notranslate">Galaxy</span> job directory. As a result, Pulsar jobs use the <code class="language-plaintext highlighter-rouge">callback</code> method configured in the previous step to make a request to <span class="notranslate">Galaxy</span>‚Äôs API, the URL for which is set in <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_infrastructure_url</code>.</p>
      </blockquote>
    </li>
    <li>
      <p>Run the playbook:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
  </ol>

</blockquote>

<p>Once the playbook run is complete and your <span class="notranslate">Galaxy</span> server has restarted, run the EtherCalc Interactive Tool again.</p>

<blockquote class="question">
  <h3 id="question-question-5"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Once EtherCalc is running, check the mounts of its container. What do you observe?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-5"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker inspect <span class="si">$(</span>docker ps <span class="nt">-q</span><span class="si">)</span> | jq <span class="s1">'.[0].HostConfig.Binds'</span>
<span class="go">[
</span><span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2:/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2:ro",                       #</span><span class="w"> </span>Per-job root <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/tool_files:/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/tool_files:ro", #</span><span class="w"> </span>EtherCalc tool wrapper parent <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/outputs:/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/outputs:rw",       #</span><span class="w"> </span>Job outputs <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/working:/srv/<span class="notranslate">galaxy</span>/jobs/_interactive/2/working:rw",       #</span><span class="w"> </span>Job working <span class="o">(</span>cwd<span class="o">)</span> <span class="nb">dir</span>
<span class="gp">  "/srv/<span class="notranslate">galaxy</span>/server/tool-data:/srv/<span class="notranslate">galaxy</span>/server/tool-data:ro"                              #</span><span class="w"> </span><span class="notranslate">Galaxy</span> reference data <span class="nb">dir</span>
<span class="go">]
</span></code></pre></div>    </div>

    <p>Of note, the user data directory, <code class="language-plaintext highlighter-rouge">/data</code>, is no longer mounted in the container!</p>

  </blockquote>

</blockquote>

<h1 id="final-notes">Final Notes</h1>

<p>As mentioned at the beginning of this tutorial, <span class="notranslate">Galaxy</span> Interactive Tools are a relatively new and rapidly evolving feature. At the time of writing, there is no official documentation for Interactive Tools. Please watch the <a href="https://docs.galaxyproject.org/en/master/releases/index.html"><span class="notranslate">Galaxy</span> Release Notes</a> for updates, changes, new documentation, and bug fixes.</p>



                    
                    <blockquote class="key_points">
                        <h3><i class="fas fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>
                        <ul>
                            
                            <li><p>Galaxy Interactive Tools run as jobs in largely the same manner as any other Galaxy job</p>
</li>
                            
                            <li><p>nginx routes GxIT requests to the GxIT(/GIE) Proxy, which routes them to the node/port on which the GxIT is running</p>
</li>
                            
                            <li><p>GxITs require wildcard SSL certificates</p>
</li>
                            
                            <li><p>GxITs expose your Galaxy server‚Äôs user datasets unless configured to use Pulsar</p>
</li>
                            
                        </ul>
                    </blockquote>
                    

                    

                    

                    <h1>Feedback</h1>
                    <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                    <div id="feedback-button">
                        <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                    </div>
                    <div id="feedback-form">
                    </div>
                    <script type="text/javascript">
                        (function (window, document) {
                            function onDocumentReady(fn) {
                                if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                    fn();
                                } else {
                                    document.addEventListener('DOMContentLoaded', fn);
                                }
                            }

                            onDocumentReady(function () {
                                $("#feedback-button").click(function(evt){
                                    var e = $(evt.target)
                                    e.hide();

                                    $("#feedback-form").html(`
                                        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Galaxy Interactive Tools (Galaxy Server administration)">Loading...</iframe>
                                    `)
                                })
                            });
                        })(window, document);
                    </script>



                    <h1>Citing this Tutorial</h1>
                    <p>
                        <ol>
                            <li id="citation-text">Nate Coraor, Simon Gladman, Helena Rasche, Anthony Bretaudeau, 2021 <b>Galaxy Interactive Tools (Galaxy Training Materials)</b>. <a href="/training-material/topics/admin/tutorials/interactive-tools/tutorial.html">/training-material/topics/admin/tutorials/interactive-tools/tutorial.html</a> Online; accessed TODAY
                            </li>
                            <li>
                            Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                            </li>
                        </ol>
                    </p>


                    <blockquote class="details">
                      <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                      <p style="display: none;">

                    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{admin-interactive-tools,
    author = "Nate Coraor and Simon Gladman and Helena Rasche and Anthony Bretaudeau",
    title = "Galaxy Interactive Tools (Galaxy Training Materials)",
    year = "2021",
    month = "01",
    day = "06"
    url = "\url{/training-material/topics/admin/tutorials/interactive-tools/tutorial.html}",
    note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
        doi = {10.1016/j.cels.2018.05.012},
        url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
        year = 2018,
        month = {jun},
        publisher = {Elsevier {BV}},
        volume = {6},
        number = {6},
        pages = {752--758.e1},
        author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
        title = {Community-Driven Data Analysis Training for Biology},
        journal = {Cell Systems}
}</code>
                    </pre></div></div>
                    </p>
                    </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                </div>
            </div>
        </div>

        <h3><i class="far fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Nate Coraor, Simon Gladman, Helena Rasche, Anthony Bretaudeau)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/admin/tutorials/interactive-tools/tutorial.md">GitHub</a>.
        </p>
        <p>
    The content of the tutorials and website is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
