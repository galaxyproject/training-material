<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Running Jobs on Remote Resources with Pulsar</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Running Jobs on Remote Resources with Pulsar" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Galaxy Server administration
                        </a>
                        
                    </li>
                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/admin/faqs/" title="Check our FAQs for the Galaxy Server administration topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/pulsar/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/admin/tutorials/pulsar/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Translate this page
            </div>

            <div id="lang-selector">
                
                <strong>Automatic Translations</strong>

<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url">
                Fran√ßais
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url">
                Êó•Êú¨Ë™û
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url">
                Espa√±ol
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url">
                Portugu√™s
                </a>
                
<a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url">
                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                </a>
                
                <a class="btn btn-info" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/pulsar/tutorial.html&edit-text=&act=url" title="">
                And more!
                </a>
            </div>
        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-10-01/topics/admin/tutorials/pulsar/tutorial.html" title="Version 2021-10-01">2021-10-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-09-01/topics/admin/tutorials/pulsar/tutorial.html" title="Version 2021-09-01">2021-09-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2021-08-01/topics/admin/tutorials/pulsar/tutorial.html" title="Version 2021-08-01">2021-08-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        











<!-- Gitter -->




<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<script type="application/ld+json">
    


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:33:41 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Running Jobs on Remote Resources with Pulsar",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / pulsar / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Running Jobs on Remote Resources with Pulsar' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/pulsar/tutorial.html",
  "timeRequired": "PT60M",
  "keywords": "jobs",
  "description": "The questions this  addresses are:\n - How does pulsar work?\n - How can I deploy it?\n\n\\nThe objectives are:\n - Have an understanding of what Pulsar is and how it works\n - Install and configure a RabbitMQ message queueing server\n - Install and configure a Pulsar server on a remote linux machine\n - Be able to get Galaxy to send jobs to a remote Pulsar server\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Hands-on for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/job-destinations/tutorial.html",
      "name": "Mapping Jobs to Destinations",
      "description": "Hands-on for 'Mapping Jobs to Destinations' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/cvmfs/slides.html",
      "name": "Reference Data with CVMFS",
      "description": "Slides for 'Reference Data with CVMFS' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/cvmfs/tutorial.html",
      "name": "Reference Data with CVMFS",
      "description": "Hands-on for 'Reference Data with CVMFS' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/cvmfs/slides.html",
      "name": "Reference Data with CVMFS",
      "description": "Slides for 'Reference Data with CVMFS' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    "A server/VM on which to deploy Pulsar"
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Marius van den Beek"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Gianmauro Cuccuru"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Marius van den Beek"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Gianmauro Cuccuru"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
</script>

<section class="tutorial topic-admin">
    <h1 data-toc-skip>Running Jobs on Remote Resources with Pulsar</h1>
    

    <div class="contributors-line">Authors: <a href="/training-material/hall-of-fame/natefoo/" class="contributor-badge contributor-natefoo"><img src="https://avatars.githubusercontent.com/natefoo?s=27" alt="Avatar">Nate Coraor</a><a href="/training-material/hall-of-fame/slugger70/" class="contributor-badge contributor-slugger70"><img src="https://avatars.githubusercontent.com/slugger70?s=27" alt="Avatar">Simon Gladman</a><a href="/training-material/hall-of-fame/mvdbeek/" class="contributor-badge contributor-mvdbeek"><img src="https://avatars.githubusercontent.com/mvdbeek?s=27" alt="Avatar">Marius van den Beek</a><a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a><a href="/training-material/hall-of-fame/gmauro/" class="contributor-badge contributor-gmauro"><img src="https://avatars.githubusercontent.com/gmauro?s=27" alt="Avatar">Gianmauro Cuccuru</a></div>

    <blockquote class="overview">
        <h3>Overview</h3>
        
        <img alt="Creative Commons License" class="float-right" style="border-width:0; display: inline-block; margin:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" aria-hidden="true" />
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How does pulsar work?</p>
</li>
        
        <li><p>How can I deploy it?</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Have an understanding of what Pulsar is and how it works</p>
</li>
        
        <li><p>Install and configure a RabbitMQ message queueing server</p>
</li>
        
        <li><p>Install and configure a Pulsar server on a remote linux machine</p>
</li>
        
        <li><p>Be able to get Galaxy to send jobs to a remote Pulsar server</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
        
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation with Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Connecting Galaxy to a compute cluster:
                            
                                <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Mapping Jobs to Destinations:
                            
                            
                                
                                     <a href="/training-material/topics/admin/tutorials/job-destinations/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Reference Data with CVMFS:
                            
                                <a href="/training-material/topics/admin/tutorials/cvmfs/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/cvmfs/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

    <li>
    
        A server/VM on which to deploy Pulsar
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 60 minutes</div>
        

        

        
        

        
        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            
                <li class="btn btn-default"><a href="/training-material/topics/admin/tutorials/pulsar/slides.html" title="Slides for this tutorial">
                    <i class="fab fa-slideshare" aria-hidden="true"></i> Slides
                </a></li>
            

            

            

            

            

            
            
            

            
        </ul>
        

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Jul 2, 2021 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>
            
            <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">The GTN Framework is licensed under MIT</a>
        </div>
    </blockquote>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                

                <h1 class="no_toc" id="overview">Overview</h1>

<p>Pulsar is the <span class="notranslate">Galaxy</span> Project‚Äôs remote job running system. It was written by John Chilton (<a href="https://github.com/jmchilton">@jmchilton</a>) of the <span class="notranslate">Galaxy</span> Project. It is a python server application that can accept jobs from a <span class="notranslate">Galaxy</span> server, submit them to a local resource and then send the results back to the originating <span class="notranslate">Galaxy</span> server.</p>

<p>More details on Pulsar can be found at:</p>

<ul>
  <li><a href="https://pulsar.readthedocs.io/en/latest/index.html">Pulsar‚Äôs Documentation</a></li>
  <li><a href="https://github.com/galaxyproject/pulsar">Pulsar‚Äôs Github Repository</a></li>
  <li><a href="https://github.com/galaxyproject/ansible-pulsar">Pulsar Ansible Role</a></li>
</ul>

<p>Transport of data, tool information and other metadata can be configured as a web application via a RESTful interface or using a message passing system such as RabbitMQ.</p>

<p>At the <span class="notranslate">Galaxy</span> end, it is configured within the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file and uses one of two special <span class="notranslate">Galaxy</span> job runners.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.jobs.runners.pulsar:PulsarRESTJobRunner</code> for the RESTful interface</li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.jobs.runners.pulsar:PulsarMQJobRunner</code> for the message passing interface.</li>
</ul>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#overview-1" id="markdown-toc-overview-1">Overview</a></li>
  <li><a href="#install-and-configure-a-message-queueing-system" id="markdown-toc-install-and-configure-a-message-queueing-system">Install and configure a message queueing system</a>    <ol>
      <li><a href="#installing-the-roles" id="markdown-toc-installing-the-roles">Installing the roles</a></li>
      <li><a href="#configuring-rabbitmq" id="markdown-toc-configuring-rabbitmq">Configuring RabbitMQ</a></li>
      <li><a href="#add-rabbitmq-configuration-to-galaxy-vm" id="markdown-toc-add-rabbitmq-configuration-to-galaxy-vm">Add RabbitMQ configuration to <span class="notranslate">Galaxy</span> VM.</a></li>
    </ol>
  </li>
  <li><a href="#installing-and-configuring-pulsar-on-a-remote-machine" id="markdown-toc-installing-and-configuring-pulsar-on-a-remote-machine">Installing and configuring Pulsar on a remote machine</a>    <ol>
      <li><a href="#configuring-pulsar" id="markdown-toc-configuring-pulsar">Configuring Pulsar</a></li>
    </ol>
  </li>
  <li><a href="#configuring-galaxy-to-use-pulsar-as-a-job-destination" id="markdown-toc-configuring-galaxy-to-use-pulsar-as-a-job-destination">Configuring <span class="notranslate">Galaxy</span> to use Pulsar as a job destination</a></li>
  <li><a href="#testing-pulsar" id="markdown-toc-testing-pulsar">Testing Pulsar</a></li>
  <li><a href="#retries-of-the-staging-actions" id="markdown-toc-retries-of-the-staging-actions">Retries of the staging actions</a></li>
  <li><a href="#pulsar-in-production" id="markdown-toc-pulsar-in-production">Pulsar in Production</a>    <ol>
      <li><a href="#australia" id="markdown-toc-australia">Australia</a></li>
      <li><a href="#europe" id="markdown-toc-europe">Europe</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ol>

</blockquote>

<p><strong>This tutorial assumes that:</strong></p>

<ul>
  <li>You have a VM or machine where you will install Pulsar, and a directory in which the installation will be done. This tutorial assumes it is <code class="language-plaintext highlighter-rouge">/mnt</code></li>
  <li>You have completed the ‚Äú<span class="notranslate">Galaxy</span> Installation with Ansible‚Äù, ‚ÄúConnecting <span class="notranslate">Galaxy</span> to a Compute Cluster‚Äù, and the ‚ÄúCVMFS‚Äù tutorials</li>
  <li>You have access to the VM/computer where it is installed.</li>
</ul>

<blockquote class="tip">
  <h3 id="tip-this-is-not-intended-as-a-standalone-pulsar-guide"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> This is NOT intended as a standalone Pulsar guide</h3>
  <p>This tutorial is not intended to be a standalone Pulsar setup guide. If you read carefully and understand Ansible, it is likely you can figure out which portions are required to just setup Pulsar.</p>
</blockquote>

<h1 id="overview-1">Overview</h1>

<p>We will be installing the RabbitMQ server daemon onto the <span class="notranslate">Galaxy</span> server to act as an intermediary message passing system between <span class="notranslate">Galaxy</span> and the remote Pulsar. The figure below shows a schematic representation of the system.</p>

<figure id="figure-1"><img src="../../images/pulsar_amqp_schema.png" alt="Schematic diagram of Galaxy communicating with a Pulsar server via the RabbitMQ server. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 1:</span> Schematic diagram of <span class="notranslate">Galaxy</span> communicating with a Pulsar server via the RabbitMQ server. Red arrows represent AMQP communications and blue represent file transfers (initiated by the Pulsar server.)</figcaption></figure>

<p><strong>How it will work:</strong></p>

<ol>
  <li><span class="notranslate">Galaxy</span> will send a message to the RabbitMQ server on the Pulsar server‚Äôs particular queue saying that there is a job to be run and then will monitor the queue for job status updates.</li>
  <li>The Pulsar server monitors this queue and when the job appears it will take control of it.</li>
  <li>The Pulsar server will then download the required data etc. from the <span class="notranslate">Galaxy</span> server using <code class="language-plaintext highlighter-rouge">curl</code>.</li>
  <li>The Pulsar server will install any required tools/tool dependencies using Conda.</li>
  <li>The Pulsar server will start running the job using it‚Äôs local mechanism and will send a message to the ‚Äúqueue‚Äù stating that the job has started.</li>
  <li>Once the job has finished running, the Pulsar server will send a message to the queue stating that the job has finished.</li>
  <li>Pulsar then sends the output data etc. back to the <span class="notranslate">Galaxy</span> server by <code class="language-plaintext highlighter-rouge">curl</code> again.</li>
  <li>The <span class="notranslate">Galaxy</span> server acknowledges the job status and closes the job.</li>
</ol>

<p><strong>Some notes:</strong></p>

<ul>
  <li>RabbitMQ uses the Advanced Message Queueing Protocol (AMQP) to communicate with both the <span class="notranslate">Galaxy</span> server and the remote Pulsar VM.</li>
  <li>Transport of files, meta-data etc. occur via <code class="language-plaintext highlighter-rouge">curl</code> from the Pulsar end.</li>
  <li>RabbitMQ is written in erlang and does not add much overhead to the <span class="notranslate">Galaxy</span> VM, although in larger installations, RabbitMQ is commonly installed on a separate VM to <span class="notranslate">Galaxy</span>. e.g. <span class="notranslate">Galaxy</span> Europe, <span class="notranslate">Galaxy</span> Main and <span class="notranslate">Galaxy</span> Australia.</li>
</ul>

<blockquote class="tip">
  <h3 id="tip-tip-other-file-transport-methods-for-pulsar"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Other file transport methods for Pulsar</h3>

  <p>Pulsar can use a variety of file transport methods including:</p>
  <ul>
    <li>Default: <span class="notranslate">Galaxy</span> initiates file transfer and stages files to Pulsar via http transfer.
      <ul>
        <li>This requires that a http transfer port be open on the remote Pulsar.</li>
      </ul>
    </li>
    <li>Remote transfer: Pulsar initiates file transfer. This can use a variety of lso available and can use a variety of methods:
      <ul>
        <li>Curl</li>
        <li>Rsync</li>
        <li>Http</li>
      </ul>
    </li>
  </ul>

  <p>We use remote transfer using <strong>Curl</strong> here so we don‚Äôt need an open port on the Pulsar server and tranfer robustness respectively.</p>

</blockquote>

<blockquote class="details">
  <h3 id="details-why-are-we-using-pulsar-in-mq-mode-here-and-not-the-restful-interface"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Why are we using Pulsar in MQ mode here and not the RESTful interface?</h3>
  <p>We are teaching you to install Pulsar and configure it in MQ mode in this tutorial. Configuring Pulsar in RESTful mode is also possible and is quite useful in certain situations. However, in the most common situation MQ mode is preferable for a number of reasons:</p>
  <ul>
    <li>When running Pulsar in RESTful mode, all of the job control and data transfer is controlled by the <span class="notranslate">Galaxy</span> server usually using http transfers. This can place a limit on the size of files that can be transferred without constant configuring of the webserver.</li>
    <li>When running in RESTful mode, Pulsar also needs to have an https server such as nginx, including securing it, configuring it, getting certificates and opening ports. This can be very difficult to do if you are attempting to submit jobs to an institutional HPC where the admins probably won‚Äôt let you do any of these things.</li>
    <li>In MQ mode, you only need to open a port for the RabbitMQ server on a machine you are more likely to control. The HPC side running Pulsar can just connect back to you.</li>
  </ul>

  <p>See the <a href="https://pulsar.readthedocs.io/en/latest/">Pulsar documentation</a> for details.</p>
</blockquote>

<h1 id="install-and-configure-a-message-queueing-system">Install and configure a message queueing system</h1>

<p>In this section we will install the RabbitMQ server on your <span class="notranslate">Galaxy</span> server VM.</p>

<p>RabbitMQ is an AMQP server that can queue messages between systems for all sorts of reasons. Here, we will be using the queue so that <span class="notranslate">Galaxy</span> and Pulsar can communicate jobs, job status and job metadata between them easily and robustly. More information on RabbitMQ can be found <a href="https://www.rabbitmq.com/">on their website</a>.</p>

<h2 id="installing-the-roles">Installing the roles</h2>

<p>Firstly we will add and configure another <em>role</em> to our <span class="notranslate">Galaxy</span> playbook - we maintain a slightly modified version of <code class="language-plaintext highlighter-rouge">jasonroyle.rabbitmq</code> to support python3 and other minor updates. Additionally we will use the <span class="notranslate">Galaxy</span> community role for deploying Pulsar</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-install-the-ansible-roles"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Install the Ansible roles</h3>

  <ol>
    <li>
      <p>From your ansible working directory, edit the <code class="language-plaintext highlighter-rouge">requirements.yml</code> file and add the following lines:</p>

      <div data-commit="Add requirements" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/requirements.yml
</span><span class="gi">+++ b/requirements.yml
</span><span class="p">@@ -22,3 +22,7 @@</span>
   version: 0.0.2
 - src: <span class="notranslate">galaxy</span>project.slurm
   version: 0.1.3
<span class="gi">+- name: use<span class="notranslate">galaxy</span>_eu.rabbitmq
+  version: 0.1.0
+- src: <span class="notranslate">galaxy</span>project.pulsar
+  version: 1.0.8
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Now install it with:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-<span class="notranslate">galaxy</span> <span class="nb">install</span> <span class="nt">-p</span> roles <span class="nt">-r</span> requirements.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="configuring-rabbitmq">Configuring RabbitMQ</h2>

<p>We need to configure RabbitMQ to be able to handle Pulsar messages. To do this we will need to create some queues, Rabbit users, some queue vhosts and set some passwords. We also need to configure rabbit to listen on various interfaces and ports.</p>

<h3 id="defining-virtual-hosts">Defining Virtual Hosts</h3>

<p>Each set of queues in RabbitMQ are grouped and accessed via virtual hosts. We need to create one of these for the transactions between the <span class="notranslate">Galaxy</span> server and Pulsar server. They are set as an array under the <code class="language-plaintext highlighter-rouge">rabbitmq_vhosts</code> variable.</p>

<h3 id="defining-users">Defining users</h3>

<p>Users need to be defined, given passwords and access to the various queues. We will need to create a user that can access this vhost. We will also create an admin user. The queue will need access to the Pulsar queue vhost. They are set as an array under the <code class="language-plaintext highlighter-rouge">rabbitmq_users</code> variable with the following structure:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">rabbitmq_users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">user</span><span class="pi">:</span> <span class="s">use<span class="notranslate">rna</span>me</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">somelongpasswordstring</span>
    <span class="na">vhost</span><span class="pi">:</span> <span class="s">/vhostname</span>
</code></pre></div></div>

<p>Optional: You can add tags to each user if required. e.g. For an admin user it could be useful to add in a <em>administrator</em> tag. These tags allow you to grant permissions to every user with a specific tag.</p>

<h3 id="rabbitmq-server-config">RabbitMQ server config</h3>

<p>We also need to set some RabbitMQ server configuration variables. Such as where its security certificates are and which ports to listen on (both via localhost and network).</p>

<blockquote class="tip">
  <h3 id="tip-port-accessibility-is-important"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Port accessibility is important!</h3>
  <p>We will need to make sure that the RabbitMQ default port is open and accessible on the server we are installing RabbitMQ onto. (In our case this is the <span class="notranslate">Galaxy</span> server). Default port number is: <code class="language-plaintext highlighter-rouge">5671</code></p>
</blockquote>

<p>More information about the rabbitmq ansible role can be found <a href="https://github.com/usegalaxy-eu/ansible-role-rabbitmq">in the repository</a>.</p>

<h2 id="add-rabbitmq-configuration-to-galaxy-vm">Add RabbitMQ configuration to <span class="notranslate">Galaxy</span> VM.</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-add-rabbitmq-settings-to-galaxy-vm-groupvars-file"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Add RabbitMQ settings to <span class="notranslate">Galaxy</span> VM groupvars file.</h3>

  <ol>
    <li>
      <p>Edit your <code class="language-plaintext highlighter-rouge">group_vars/secret.yml</code> and define some random passwords:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-1"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-vault edit group_vars/secret.yml
</code></pre></div>        </div>
      </blockquote>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">vault_rabbitmq_password_vhost</span><span class="pi">:</span> <span class="s2">"</span><span class="s">a-really-long-password-here"</span>
<span class="na">vault_rabbitmq_admin_password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">a-different-really-long-password"</span>
</code></pre></div>      </div>

      <!-- Ignore this, just for the gat-automation. Vaults are ugly to work with :(

   
```diff
--- a/group_vars/secret.yml
+++ b/group_vars/secret.yml
@@ -1,7 +1,13 @@
 $ANSIBLE_VAULT;1.1;AES256
-32653961383866636531396135663630386630346237333333653633313436663439643535323964
-6363626330336430363332643638646262316338313937320a666566306539373462386266383166
-30326165393863633463353234613561393939326164376432633732316264636464313061383161
-3532373937656138320a616361343664353264613332616236623231326137316635323465623562
-66656539346130353639623736633034653932373438663330646436656336666637313933666264
-3636313438626533633831323239373461373538646635613637
+62346261323266656232393034396134316636376533376139666437363535393562663838613938
+6336666266633563346337623265353935646361326337610a393834333233313461346439376438
+63383338346530656561636631666134373238366364363164313166346461383736613162653237
+3461363334323431370a656132303965653262386130353332623937376261396530393761353834
+38336565666437666436643163363831633331333766653266356163613138393734656465323634
+39366362383433366437353534663134313330316337393335383962613961386665633261616237
+35366635373063313631323939396164336330356361393464326636353037336461323531336434
+35613933303333623031353936393265636130363335376533393335663266313863376135383338
+36613464373231623938373434306266373234633036343636633963353361356631363533353066
+39323064336237646432323530313065303331326636353334343862373330313133326363363063
+38383564636161396435666164643334656435393533643163393434623434656238633631633939
+33353232666432376661
   
```
{: data-commit="Add rabbitmq passwords to the vault"}

-->

      <p>This is going in the vault as they are secrets we need to set. Both of our services, <span class="notranslate">Galaxy</span> and Pulsar, need these variables, so we‚Äôll need to make sure they‚Äôre in both playbooks. Both <span class="notranslate">Galaxy</span> in the job configuration, and Pulsar in its configuration.</p>

      <p>Replace both with long random (or not) string.</p>
    </li>
    <li>
      <p>From your ansible working directory, edit the <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file and add make the following changes.</p>

      <div data-commit="Configure RabbitMQ" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -126,8 +126,10 @@</span> certbot_environment: staging
 certbot_well_known_root: /srv/nginx/_well-known_root
 certbot_share_key_users:
   - nginx
<span class="gi">+  - rabbitmq
</span> certbot_post_renewal: |
     systemctl restart nginx || true
<span class="gi">+    systemctl restart rabbitmq-server || true
</span> certbot_domains:
  - "{{ inventory_hostname }}"
 certbot_agree_tos: --agree-tos
<span class="p">@@ -160,3 +162,31 @@</span> slurm_config:
   SlurmdParameters: config_overrides   # Ignore errors if the host actually has cores != 2
   SelectType: select/cons_res
   SelectTypeParameters: CR_CPU_Memory  # Allocate individual cores/memory instead of entire node
<span class="gi">+
+# RabbitMQ
+rabbitmq_version: 3.8.16-1
+rabbitmq_plugins: rabbitmq_management
+
+rabbitmq_config:
+- rabbit:
+  - tcp_listeners:
+    - "'127.0.0.1'": 5672
+  - ssl_listeners:
+    - "'0.0.0.0'": 5671
+  - ssl_options:
+     - cacertfile: /etc/ssl/certs/fullchain.pem
+     - certfile: /etc/ssl/certs/cert.pem
+     - keyfile: /etc/ssl/user/privkey-rabbitmq.pem
+     - fail_if_no_peer_cert: 'false'
+
+rabbitmq_vhosts:
+  - /pulsar/<span class="notranslate">galaxy</span>_au
+
+rabbitmq_users:
+  - user: admin
+    password: "{{ vault_rabbitmq_admin_password }}"
+    tags: administrator
+    vhost: /
+  - user: <span class="notranslate">galaxy</span>_au
+    password: "{{ vault_rabbitmq_password_vhost }}"
+    vhost: /pulsar/<span class="notranslate">galaxy</span>_au
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Update the <span class="notranslate">Galaxy</span> playbook to include the <em>use<span class="notranslate">galaxy</span>_eu.rabbitmq</em> role.</p>

      <div data-commit="Add role" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -29,5 +29,6 @@</span>
     - role: uchida.miniconda
       become: true
       become_user: "{{ <span class="notranslate">galaxy</span>_user.name }}"
<span class="gi">+    - use<span class="notranslate">galaxy</span>_eu.rabbitmq
</span>     - <span class="notranslate">galaxy</span>project.nginx
     - <span class="notranslate">galaxy</span>project.cvmfs
   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-why-is-this-at-the-end"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Why is this at the end?</h3>
        <p>This is one of the constant problems with Ansible, how do you order everything correctly? Does an ordering exist such that a single run of the playbook will have everything up and working? We encounter one such instance of this problem now.</p>

        <p>Here are the dependencies between the roles:</p>

        <table>
          <thead>
            <tr>
              <th>From</th>
              <th>To</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>nginx</td>
              <td><span class="notranslate">galaxy</span></td>
              <td>The nginx templates depend on variables only available after the <span class="notranslate">Galaxy</span> role is run</td>
            </tr>
            <tr>
              <td>SSL certificates</td>
              <td>nginx</td>
              <td>A running nginx is required</td>
            </tr>
            <tr>
              <td>RabbitMQ</td>
              <td>SSL certificates</td>
              <td>RabbitMQ will silently start with incorrect configuration if SSL certificates are not present at boot time.</td>
            </tr>
            <tr>
              <td><span class="notranslate">Galaxy</span></td>
              <td>RabbitMQ</td>
              <td><span class="notranslate">Galaxy</span> needs the RabbitMQ available to submit jobs.</td>
            </tr>
          </tbody>
        </table>

        <p>And as you can see there is a circular dependency. <span class="notranslate">Galaxy</span> requires RabbitMQ, but RabbitMQ depends on a long chain of things that depends finally on <span class="notranslate">Galaxy</span>.</p>

        <p>There are some mitigating factors, some software will start with incomplete configuration. We can rely on <span class="notranslate">Galaxy</span> retrying access to RabbitMQ if it isn‚Äôt already present. Additionally on first run, <span class="notranslate">Galaxy</span> is restarted by a handler which runs at the end. (Except that the nginx role triggers all pending handlers as part of the SSL certificate deployment.)</p>

        <p>We try to present the optimal version here but due to these interdependencies and Ansible specifics, sometimes it is not possible to determine a good ordering of roles, and multiple runs might be required.</p>

      </blockquote>
    </li>
    <li>
      <p>Run the playbook.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-2"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

  <p>The rabbitmq server daemon will have been installed on your <span class="notranslate">Galaxy</span> VM. Check that it‚Äôs running now:</p>

  <blockquote class="code-in">
    <h3 id="code-in-input-bash-3"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status rabbitmq-server
</code></pre></div>    </div>
  </blockquote>

  <blockquote class="code-out code-max-300">
    <h3 id="code-out-output-bash"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

    <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚óè</span> <span class="err">rabbitmq-server.service</span> <span class="err">-</span> <span class="err">RabbitMQ</span> <span class="err">broker</span>
     <span class="err">Loaded:</span> <span class="err">loaded</span> <span class="err">(/lib/systemd/system/rabbitmq-server.service</span><span class="c">; enabled; vendor preset: enabled)
</span>     <span class="err">Active:</span> <span class="err">active</span> <span class="err">(running)</span> <span class="err">since</span> <span class="err">Fri</span> <span class="err">2020-12-18</span> <span class="err">13:52:14</span> <span class="err">UTC</span><span class="c">; 8min ago
</span>   <span class="err">Main</span> <span class="err">PID:</span> <span class="err">533733</span> <span class="err">(beam.smp)</span>
     <span class="err">Status:</span> <span class="err">"Initialized"</span>
      <span class="err">Tasks:</span> <span class="err">163</span> <span class="err">(limit:</span> <span class="err">19175)</span>
     <span class="err">Memory:</span> <span class="err">105.3M</span>
     <span class="err">CGroup:</span> <span class="err">/system.slice/rabbitmq-server.service</span>
             <span class="err">‚îú‚îÄ533733</span> <span class="err">/usr/lib/erlang/erts-11.1.4/bin/beam.smp</span> <span class="err">-W</span> <span class="err">w</span> <span class="err">-K</span> <span class="err">true</span> <span class="err">-A</span> <span class="err">128</span> <span class="err">-MBas</span> <span class="err">ageffcbf</span> <span class="err">-MHas</span> <span class="err">ageffcbf</span> <span class="err">-MBlmbcs</span> <span class="err">512</span> <span class="err">-MHlmbcs</span> <span class="err">512</span> <span class="err">-MMmcs</span> <span class="err">30</span> <span class="err">-P</span> <span class="err">1048576</span> <span class="err">-t</span> <span class="err">5000000</span> <span class="err">-stbt</span> <span class="err">db</span> <span class="err">-zdbbl</span> <span class="err">1280&gt;</span>
             <span class="err">‚îú‚îÄ533923</span> <span class="err">erl_child_setup</span> <span class="err">32768</span>
             <span class="err">‚îú‚îÄ533969</span> <span class="err">/usr/lib/erlang/erts-11.1.4/bin/epmd</span> <span class="err">-daemon</span>
             <span class="err">‚îú‚îÄ534002</span> <span class="err">inet_gethost</span> <span class="err">4</span>
             <span class="err">‚îî‚îÄ534003</span> <span class="err">inet_gethost</span> <span class="err">4</span>

<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="c">##########  Licensed under the MPL 2.0. Website: https://rabbitmq.com
</span><span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Doc</span> <span class="err">guides:</span> <span class="err">https://rabbitmq.com/documentation.html</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Support:</span>    <span class="err">https://rabbitmq.com/contact.html</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Tutorials:</span>  <span class="err">https://rabbitmq.com/getstarted.html</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Monitoring:</span> <span class="err">https://rabbitmq.com/monitoring.html</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Logs:</span> <span class="err">/var/log/rabbitmq/rabbit@gat-0.log</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>         <span class="err">/var/log/rabbitmq/rabbit@gat-0_upgrade.log</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:10</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Config</span> <span class="err">file(s):</span> <span class="err">(none)</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:14</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">rabbitmq-server</span><span class="nn">[533733]</span><span class="err">:</span>   <span class="err">Starting</span> <span class="err">broker...</span> <span class="err">completed</span> <span class="err">with</span> <span class="err">0</span> <span class="err">plugins.</span>
<span class="err">Dec</span> <span class="err">18</span> <span class="err">13:52:14</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">systemd</span><span class="nn">[1]</span><span class="err">:</span> <span class="err">Started</span> <span class="err">RabbitMQ</span> <span class="err">broker.</span>
</code></pre></div>    </div>
  </blockquote>

  <p>But this doesn‚Äôt tell the whole story, so run the diagnostics command to
   check that the interfaces are setup and listening. RabbitMQ has a bad
   habit of silently failing when processing the configuration, without any
   logging information If RabbitMQ has any problem reading the configuration
   file, it falls back to the default configuration (listens <em>without</em> ssl on
   <code class="language-plaintext highlighter-rouge">tcp/5672</code>) so be sure to check that everything is OK before continuing.</p>

  <blockquote class="code-in">
    <h3 id="code-in-input-bash-4"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>rabbitmq-diagnostics status
</code></pre></div>    </div>
  </blockquote>

  <blockquote class="code-out code-max-300">
    <h3 id="code-out-output-bash-1"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

    <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>

<span class="err">Listeners</span>

<span class="err">Interface:</span> <span class="nn">[::]</span><span class="err">,</span> <span class="err">port:</span> <span class="err">15672,</span> <span class="err">protocol:</span> <span class="err">http,</span> <span class="err">purpose:</span> <span class="err">HTTP</span> <span class="err">API</span>
<span class="err">Interface:</span> <span class="nn">[::]</span><span class="err">,</span> <span class="err">port:</span> <span class="err">25672,</span> <span class="err">protocol:</span> <span class="err">clustering,</span> <span class="err">purpose:</span> <span class="err">inter-node</span> <span class="err">and</span> <span class="err">CLI</span> <span class="err">tool</span> <span class="err">communication</span>
<span class="err">Interface:</span> <span class="nn">[::]</span><span class="err">,</span> <span class="err">port:</span> <span class="err">5672,</span> <span class="err">protocol:</span> <span class="err">amqp,</span> <span class="err">purpose:</span> <span class="err">AMQP</span> <span class="err">0-9-1</span> <span class="err">and</span> <span class="err">AMQP</span> <span class="err">1.0</span>
<span class="err">Interface:</span> <span class="err">0.0.0.0,</span> <span class="err">port:</span> <span class="err">5671,</span> <span class="err">protocol:</span> <span class="err">amqp/ssl,</span> <span class="err">purpose:</span> <span class="err">AMQP</span> <span class="err">0-9-1</span> <span class="err">and</span> <span class="err">AMQP</span> <span class="err">1.0</span> <span class="err">over</span> <span class="err">TLS</span>
</code></pre></div>    </div>
  </blockquote>

  <p>But wait! There are more ways it can go wrong. To be extra sure, run a quick <code class="language-plaintext highlighter-rouge">curl</code> command.</p>

  <blockquote class="code-in">
    <h3 id="code-in-input-bash-5"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost:5672
curl <span class="nt">-k</span> https://localhost:5671
</code></pre></div>    </div>
  </blockquote>

  <blockquote class="code-out code-max-300">
    <h3 id="code-out-output-bash-2"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

    <p>These should <em>both</em> report the same response:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">curl: (1) Received HTTP/0.9 when not allowed
</span></code></pre></div>    </div>

    <p>if they don‚Äôt, consider the following debugging steps:</p>

    <ol>
      <li>Restarting RabbitMQ</li>
      <li>Check that the configuration looks correct (ssl private key path looks valid)</li>
      <li>Check that the private key is shared correctly with the rabbitmq user</li>
    </ol>
  </blockquote>

</blockquote>

<h1 id="installing-and-configuring-pulsar-on-a-remote-machine">Installing and configuring Pulsar on a remote machine</h1>

<p>Now that we have a message queueing system running on our <span class="notranslate">Galaxy</span> VM, we need to install and configure Pulsar on our remote compute VM. To do this we need to create a new ansible playbook to install Pulsar.</p>

<h2 id="configuring-pulsar">Configuring Pulsar</h2>

<p>From the <a href="https://github.com/galaxyproject/ansible-pulsar#role-variables"><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.pulsar</code> ansible role documentation</a>, we need to specify some variables.</p>

<p>There is one required variable:</p>

<p><code class="language-plaintext highlighter-rouge">pulsar_server_dir</code> - The location in which to install pulsar</p>

<p>Then there are a lot of optional variables. They are listed here for information. We will set some for this tutorial but not all.</p>

<table>
  <thead>
    <tr>
      <th>Variable Name</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_yaml_config</code></td>
      <td>a YAML dictionary whose contents will be used to create Pulsar‚Äôs <code class="language-plaintext highlighter-rouge">app.yml</code></td>
      <td>¬†</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_venv_dir</code></td>
      <td>The role will create a virtualenv from which Pulsar will run</td>
      <td><code class="language-plaintext highlighter-rouge">&lt;pulsar_server_dir&gt;/venv</code> if installing via pip, <code class="language-plaintext highlighter-rouge">&lt;pulsar_server_dir&gt;/.venv</code> if not.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_config_dir</code></td>
      <td>Directory that will be used for Pulsar configuration files.</td>
      <td><code class="language-plaintext highlighter-rouge">&lt;pulsar_server_dir&gt;/config</code> if installing via pip, <code class="language-plaintext highlighter-rouge">&lt;pulsar_server_dir&gt;</code> if not</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_optional_dependencies</code></td>
      <td>List of optional dependency modules to install, depending on which features you are enabling.</td>
      <td><code class="language-plaintext highlighter-rouge">None</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_install_environments</code></td>
      <td>Installing dependencies may require setting certain environment variables to compile successfully.</td>
      <td>¬†</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_create_user</code></td>
      <td>Should a user be created for running pulsar?</td>
      <td>¬†</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pulsar_user</code></td>
      <td>Define the user details</td>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<p>Some of the other options we will be using are:</p>

<ul>
  <li>
    <p>We will set the tool dependencies to rely on <strong>conda</strong> for tool installs.</p>
  </li>
  <li>
    <p>You will need to know the FQDN or IP address of the <span class="notranslate">Galaxy</span> server VM that you installed RabbitMQ on.</p>
  </li>
</ul>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-configure-pulsar-group-variables"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Configure pulsar group variables</h3>

  <ol>
    <li>
      <p>Create a new file in <code class="language-plaintext highlighter-rouge">group_vars</code> called <code class="language-plaintext highlighter-rouge">pulsarservers.yml</code> and set some of the above variables as well as some others.</p>

      <div data-commit="Add pulsar group variables" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/group_vars/pulsarservers.yml
</span><span class="p">@@ -0,0 +1,51 @@</span>
<span class="gi">+<span class="notranslate">galaxy</span>_server_hostname: "" # Important!!!
+# Put your <span class="notranslate">Galaxy</span> server's fully qualified domain name (FQDN) (or the FQDN of the RabbitMQ server) above.
+
+pulsar_root: /mnt/pulsar
+
+pulsar_pip_install: true
+pulsar_pycurl_ssl_library: openssl
+pulsar_systemd: true
+pulsar_systemd_runner: webless
+
+pulsar_create_user: true
+pulsar_user: {name: pulsar, shell: /bin/bash}
+
+pulsar_optional_dependencies:
+  - pyOpenSSL
+  # For remote transfers initiated on the Pulsar end rather than the <span class="notranslate">Galaxy</span> end
+  - pycurl
+  # drmaa required if connecting to an exte<span class="notranslate">rna</span>l DRM using it.
+  - drmaa
+  # kombu needed if using a message queue
+  - kombu
+  # amqp 5.0.3 changes behaviour in an unexpected way, pin for now.
+  - 'amqp==5.0.2'
+  # psutil and pylockfile are optional dependencies but can make Pulsar
+  # more robust in small ways.
+  - psutil
+
+pulsar_yaml_config:
+  staging_directory: "{{ pulsar_staging_dir }}"
+  persistence_directory: "{{ pulsar_persistence_dir }}"
+  tool_dependency_dir: "{{ pulsar_dependencies_dir }}"
+  # The following are the settings for the pulsar server to contact the message queue with related timeouts etc.
+  message_queue_url: "pyamqp://<span class="notranslate">galaxy</span>_au:{{ vault_rabbitmq_password_vhost }}@{{ <span class="notranslate">galaxy</span>_server_hostname }}:5671//pulsar/<span class="notranslate">galaxy</span>_au?ssl=1"
+  min_polling_interval: 0.5
+  amqp_publish_retry: True
+  amqp_publish_retry_max_retries: 5
+  amqp_publish_retry_interval_start: 10
+  amqp_publish_retry_interval_step: 10
+  amqp_publish_retry_interval_max: 60
+  # We also need to create the dependency resolvers configuration so pulsar knows how to find and install dependencies
+  # for the tools we ask it to run. The simplest method which covers 99% of the use cases is to use conda auto installs
+  # similar to how <span class="notranslate">Galaxy</span> works.
+  dependency_resolution:
+    resolvers:
+      - type: conda
+        auto_init: true
+        auto_install: true
+
+# Pulsar should use the same job metrics plugins as <span class="notranslate">Galaxy</span>. This will automatically set `job_metrics_config_file` in
+# `pulsar_yaml_config` and create `{{ pulsar_config_dir }}/job_metrics_conf.yml`.
+pulsar_job_metrics_plugins: "{{ <span class="notranslate">galaxy</span>_job_metrics_plugins }}"
</span>   
</code></pre></div>      </div>

      <blockquote class="details">
        <h3 id="details-running-non-conda-tools"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Running non-conda tools</h3>
        <p>If the tool you want to run on Pulsar doesn‚Äôt have a conda package, you will need to make alte<span class="notranslate">rna</span>tive arrangements! This is complex and beyond our scope here. See the <a href="https://pulsar.readthedocs.io/en/latest/">Pulsar documentation</a> for details.</p>
      </blockquote>
    </li>
    <li>
      <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">hosts</code> file:</p>

      <div data-commit="Add pulsar host" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/hosts
</span><span class="gi">+++ b/hosts
</span><span class="p">@@ -1,2 +1,4 @@</span>
 [<span class="notranslate">galaxy</span>servers]
 gat-0.eu.training.<span class="notranslate">galaxy</span>project.eu ansible_connection=local ansible_user=ubuntu
<span class="gi">+[pulsarservers]
+gat-0.au.training.<span class="notranslate">galaxy</span>project.eu ansible_user=ubuntu
</span>   
</code></pre></div>      </div>
    </li>
  </ol>

</blockquote>

<p>We will now write a new playbook for the pulsar installation as we are going to install it on a separate VM. We will also install the CVMFS client and the <span class="notranslate">Galaxy</span> CVMFS repos on this machine so Pulsar has the same access to reference data that <span class="notranslate">Galaxy</span> does.</p>

<p>We need to include a couple of pre-tasks to install virtualenv, git, etc.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-creating-the-playbook"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Creating the playbook</h3>

  <ol>
    <li>
      <p>Create a <code class="language-plaintext highlighter-rouge">pulsar.yml</code> file with the following contents:</p>

      <div data-commit="Add pulsar playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/pulsar.yml
</span><span class="p">@@ -0,0 +1,20 @@</span>
<span class="gi">+- hosts: pulsarservers
+  vars_files:
+    - group_vars/secret.yml
+  pre_tasks:
+    - name: Install some packages
+      package:
+        name:
+          - build-essential
+          - git
+          - python3-dev
+          - libcurl4-openssl-dev
+          - libssl-dev
+          - virtualenv
+        state: present
+        update_cache: yes
+      become: yes
+  roles:
+    - role: <span class="notranslate">galaxy</span>project.cvmfs
+      become: yes
+    - <span class="notranslate">galaxy</span>project.pulsar
</span>   
</code></pre></div>      </div>

      <p>There are a couple of <em>pre-tasks</em> here. This is because we need to install some base packages on these very vanilla ubuntu instances as well as give ourselves ownership of the directory we are installing into.</p>
    </li>
  </ol>

</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-run-the-playbook"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Run the Playbook</h3>

  <ol>
    <li>
      <p>Run the playbook.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-6"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook pulsar.yml
</code></pre></div>        </div>
      </blockquote>

      <p>After the script has run, pulsar will be installed on the remote machines!</p>

      <blockquote class="tip">
        <h3 id="tip-connection-issues"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Connection issues?</h3>
        <p>If your remote pulsar machine uses a different key, you may need to supply the <code class="language-plaintext highlighter-rouge">ansible-playbook</code> command with the private key for the connection using the <code class="language-plaintext highlighter-rouge">--private-key key.pem</code> option.</p>
      </blockquote>
    </li>
    <li>
      <p>Log in to the machines and have a look in the <code class="language-plaintext highlighter-rouge">/mnt/pulsar</code> directory. You will see the venv and config directories. All the config files created by Ansible can be perused.</p>
    </li>
    <li>
      <p>Run <code class="language-plaintext highlighter-rouge">jou<span class="notranslate">rna</span>lctl -f -u pulsar</code></p>

      <p>A log will now start scrolling, showing the startup of pulsar. You‚Äôll notice that it will be initializing and installing conda. Once this is completed, Pulsar will be listening on the assigned port.</p>
    </li>
  </ol>

</blockquote>

<h1 id="configuring-galaxy-to-use-pulsar-as-a-job-destination">Configuring <span class="notranslate">Galaxy</span> to use Pulsar as a job destination</h1>

<p>Now we have a Pulsar server up and running, we need to tell our <span class="notranslate">Galaxy</span> about it.</p>

<p><span class="notranslate">Galaxy</span> talks to the Pulsar server via it‚Äôs <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file. We need to let <span class="notranslate">Galaxy</span> know about Pulsar there and make sure <span class="notranslate">Galaxy</span> has loaded the requisite job runner, and has a destination set up.</p>

<p>There are three things we need to do here:</p>

<ul>
  <li>Create a job runner which uses the  <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.jobs.runners.pulsar:PulsarMQJobRunner</code> code.</li>
  <li>Create a job destination referencing the above job runner.</li>
  <li>Tell <span class="notranslate">Galaxy</span> which tools to send to this job destination.</li>
</ul>

<p>For this tutorial, we will configure <span class="notranslate">Galaxy</span> to run the BWA and BWA-MEM tools on Pulsar.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-configure-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Configure <span class="notranslate">Galaxy</span></h3>

  <ol>
    <li>
      <p>In your <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</code> file add the following job runner to the <code class="language-plaintext highlighter-rouge">&lt;plugins&gt;</code> section:</p>

      <div data-commit="Add pulsar plugin" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="p">@@ -2,6 +2,16 @@</span>
     &lt;plugins workers="4"&gt;
         &lt;plugin id="local_plugin" type="runner" load="<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"/&gt;
         &lt;plugin id="slurm" type="runner" load="<span class="notranslate">galaxy</span>.jobs.runners.slurm:SlurmJobRunner"/&gt;
<span class="gi">+        &lt;plugin id="pulsar_runner" type="runner" load="<span class="notranslate">galaxy</span>.jobs.runners.pulsar:PulsarMQJobRunner" &gt;
+            &lt;param id="amqp_url"&gt;pyamqp://<span class="notranslate">galaxy</span>_au:{{ vault_rabbitmq_password_vhost }}@localhost:5671/{{ rabbitmq_vhosts[0] }}?ssl=1&lt;/param&gt;
+            &lt;param id="amqp_ack_republish_time"&gt;1200&lt;/param&gt;
+            &lt;param id="amqp_acknowledge"&gt;True&lt;/param&gt;
+            &lt;param id="amqp_consumer_timeout"&gt;2.0&lt;/param&gt;
+            &lt;param id="amqp_publish_retry"&gt;True&lt;/param&gt;
+            &lt;param id="amqp_publish_retry_max_retries"&gt;60&lt;/param&gt;
+            &lt;param id="<span class="notranslate">galaxy</span>_url"&gt;https://{{ inventory_hostname }}&lt;/param&gt;
+            &lt;param id="manager"&gt;_default_&lt;/param&gt;
+        &lt;/plugin&gt;
</span>     &lt;/plugins&gt;
     &lt;destinations default="slurm"&gt;
         &lt;destination id="local_destination" runner="local_plugin"/&gt;
   
</code></pre></div>      </div>

      <p>Add the following to the <code class="language-plaintext highlighter-rouge">&lt;destinations&gt;</code> section of your <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file:</p>

      <div data-commit="Add pulsar destination" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="p">@@ -15,6 +15,16 @@</span>
     &lt;/plugins&gt;
     &lt;destinations default="slurm"&gt;
         &lt;destination id="local_destination" runner="local_plugin"/&gt;
<span class="gi">+        &lt;destination id="pulsar" runner="pulsar_runner" &gt;
+            &lt;param id="default_file_action"&gt;remote_transfer&lt;/param&gt;
+            &lt;param id="dependency_resolution"&gt;remote&lt;/param&gt;
+            &lt;param id="jobs_directory"&gt;/mnt/pulsar/files/staging&lt;/param&gt;
+            &lt;param id="persistence_directory"&gt;/mnt/pulsar/files/persisted_data&lt;/param&gt;
+            &lt;param id="remote_metadata"&gt;False&lt;/param&gt;
+            &lt;param id="rewrite_parameters"&gt;True&lt;/param&gt;
+            &lt;param id="transport"&gt;curl&lt;/param&gt;
+            &lt;param id="outputs_to_working_directory"&gt;False&lt;/param&gt;
+        &lt;/destination&gt;
</span>         &lt;destination id="slurm" runner="slurm"&gt;
             &lt;param id="singularity_enabled"&gt;true&lt;/param&gt;
             &lt;env id="LC_ALL"&gt;C&lt;/env&gt;
   
</code></pre></div>      </div>

      <p>You‚Äôll notice we need to know a lot about the configuration of the remote end, this is an unfortunate requirement with pulsar. Changes to e.g. the staging directory need to be coordinated between Pulsar and <span class="notranslate">Galaxy</span>. That‚Äôs fine if both are under your administration, but for a completely remote Pulsar it can be difficult.</p>

      <p>Notably we also override <code class="language-plaintext highlighter-rouge">outputs_to_working_directory</code>, as this option is incompatible with running Pulsar, and, unnecessary. Pulsar already provides the same job isolation and safety that we request when we set that option by default in <span class="notranslate">Galaxy</span>‚Äôs configuration.</p>
    </li>
    <li>
      <p>Install the BWA and BWA-MEM tools, if needed.</p>

      <!--SNIPPET-->
      <blockquote class="tip">  <h3 data-toc-skip="" id="-tip-install-tools-via-the-admin-ui"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden"></span> Tip: Install tools via the Admin UI</h3>  <ol>  <li>Open <span class="notranslate">Galaxy</span> in your browser and type <code class="language-plaintext highlighter-rouge">bwa</code> in the tool search box on the left. If ‚ÄúMap with BWA-MEM‚Äù is among the search results, you can skip the following steps.</li>  <li>Access the Admin menu from the top bar (you need to be logged-in with an email specified in the <code class="language-plaintext highlighter-rouge">admin_users</code> setting)</li>  <li>Click ‚ÄúInstall and Uninstall‚Äù, which can be found on the left, under ‚ÄúTool Management‚Äù</li>  <li>Enter <code class="language-plaintext highlighter-rouge">bwa</code> in the search interface</li>  <li>Click on the first hit, having <code class="language-plaintext highlighter-rouge">devteam</code> as owner</li>  <li>Click the ‚ÄúInstall‚Äù button for the latest revision</li>  <li>Enter ‚Äú<span class="notranslate">Mapping</span>‚Äù as the target section and click ‚ÄúOK‚Äù.</li></ol></blockquote>
    </li>
    <li>
      <p>We now need to tell <span class="notranslate">Galaxy</span> to send BWA and BWA-MEM jobs to the <code class="language-plaintext highlighter-rouge">pulsar</code> destination. We specify this in the <code class="language-plaintext highlighter-rouge">&lt;tools&gt;</code> section of the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file.</p>

      <p>Add the following to the end of the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file (inside the <code class="language-plaintext highlighter-rouge">&lt;tools&gt;</code> section if it exists or create it if it doesn‚Äôt.)</p>

      <div data-commit="Send bwa and bwa-mem to pulsar" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="p">@@ -64,5 +64,7 @@</span>
     &lt;/resources&gt;
     &lt;tools&gt;
         &lt;tool id="testing" destination="dynamic_cores_time" resources="testing" /&gt;
<span class="gi">+        &lt;tool id="bwa" destination="pulsar"/&gt;
+        &lt;tool id="bwa_mem" destination="pulsar"/&gt;
</span>     &lt;/tools&gt;
 &lt;/job_conf&gt;
   
</code></pre></div>      </div>

      <p>Note that here we are using the short tool IDs. If you want to run only a specific version of a tool in Pulsar, you have to use the full tool ID (e.g. <code class="language-plaintext highlighter-rouge"><span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/devteam/bwa/bwa/0.7.17.4</code>) instead. The full tool ID can be found inside the <code class="language-plaintext highlighter-rouge">integrated_tool_panel.xml</code> file in the <code class="language-plaintext highlighter-rouge">mutable-config</code> directory.</p>
    </li>
    <li>
      <p>Finally run the <span class="notranslate">Galaxy</span> playbook in order to deploy the updated job configuration, and to restart <span class="notranslate">Galaxy</span>.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-7"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1-pulsar.sh
</code></pre></div>  </div>
</blockquote>

<h1 id="testing-pulsar">Testing Pulsar</h1>

<p>Now we will upload a small set of data to run bwa-mem with.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-testing-the-pulsar-destination"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Testing the Pulsar destination</h3>

  <ol>
    <li>
      <p>Upload the following files from zenodo.</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/582600/files/mutant_R1.fastq
https://zenodo.org/record/582600/files/mutant_R2.fastq
</code></pre></div>      </div>
    </li>
    <li>
      <p><strong>Map with BWA-MEM</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters</p>
      <ul>
        <li><em>‚ÄúWill you select a reference genome from your history or use a built-in index‚Äù</em>: <code class="language-plaintext highlighter-rouge">Use a built-in genome index</code></li>
        <li><em>‚ÄúUsing reference genome‚Äù</em>: <code class="language-plaintext highlighter-rouge">Escherichia coli (str. K-12 substr MG1655): eschColi_K12</code></li>
        <li><em>‚ÄúSingle or Paired-end <span class="notranslate">reads</span>‚Äù</em>: <code class="language-plaintext highlighter-rouge">Paired end</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSelect first set of <span class="notranslate">reads</span>‚Äù</em>: <code class="language-plaintext highlighter-rouge">mutant_R1.fastq</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSelect second set of <span class="notranslate">reads</span>‚Äù</em>: <code class="language-plaintext highlighter-rouge">mutant_R2.fastq</code></li>
      </ul>

      <p>As soon as you press <em>execute</em> <span class="notranslate">Galaxy</span> will send the job to the pulsar server. You can watch the log in <span class="notranslate">Galaxy</span> using:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jou<span class="notranslate">rna</span>lctl -fu <span class="notranslate">galaxy</span>
</code></pre></div>      </div>

      <p>You can watch the log in Pulsar by ssh‚Äôing to it and tailing the log file with:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jou<span class="notranslate">rna</span>lctl -fu pulsar
</code></pre></div>      </div>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2-run-job.sh
</code></pre></div>  </div>
</blockquote>

<p>You‚Äôll notice that the Pulsar server has received the job (all the way in Australia!) and now should be installing bwa-mem via conda. Once this is complete (which may take a while - first time only) the job will run. When it starts running it will realise it needs the <em>E. coli</em> genome from CVMFS and fetch that, and then results will be returned to <span class="notranslate">Galaxy</span>!</p>

<p>How awesome is that? Pulsar in another continent with reference data automatically from CVMFS :)</p>

<!--SNIPPET-->
<blockquote class="comment">  <h3 data-toc-skip="" id="-got-lost-along-the-way"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden"></span> Got lost along the way?</h3>  <p>If you missed any steps, you can compare against the <a href="https://github.com/hexylena/git-gat/tree/step-8">reference files</a>, or see what changed since <a href="https://github.com/hexylena/git-gat/compare/step-7...step-8#files_bucket">the previous tutorial</a>.</p></blockquote>

<h1 id="retries-of-the-staging-actions">Retries of the staging actions</h1>

<p>When the staging actions are carried out by the Pulsar server itself (like in the case when driving Pulsar by message queue), there are some parameters that can be tweaked to ensure reliable communication between the <span class="notranslate">Galaxy</span> server and the remote Pulsar server.
The aim of these parameters is to control the retrying of staging actions in the event of a failure.</p>

<p>For each action (preprocess/input or postprocess/output), you can specify:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> - *_action_max_retries    - the maximum number of retries before giving up
 - *_action_interval_start - how long start sleeping between retries (in seconds)
 - *_action_interval_step  - by how much the interval is increased for each retry (in seconds)
 - *_action_interval_max   - the maximum number of seconds to sleep between retries
</code></pre></div></div>
<p>substitute the * with <code class="language-plaintext highlighter-rouge">preprocess</code> or <code class="language-plaintext highlighter-rouge">postprocess</code></p>

<p>In the following box, as an example, we have collected the values adopted in a Pulsar site with an unreliable network connection:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">preprocess_action_max_retries</span><span class="pi">:</span> <span class="m">30</span>
<span class="na">preprocess_action_interval_start</span><span class="pi">:</span> <span class="m">2</span>
<span class="na">preprocess_action_interval_step</span><span class="pi">:</span> <span class="m">10</span>
<span class="na">preprocess_action_interval_max</span><span class="pi">:</span> <span class="m">300</span>
<span class="na">postprocess_action_max_retries</span><span class="pi">:</span> <span class="m">30</span>
<span class="na">postprocess_action_interval_start</span><span class="pi">:</span> <span class="m">2</span>
<span class="na">postprocess_action_interval_step</span><span class="pi">:</span> <span class="m">10</span>
<span class="na">postprocess_action_interval_max</span><span class="pi">:</span> <span class="m">300</span>

</code></pre></div></div>
<p>In this case, for both actions, Pulsar will try to carry out the staging action 30 times, sleeping 2 secs after the first retry and adding 10 secs more to each next retries, until a maximum of 300 seconds between retries.</p>

<p>We hope you never have to experience a situation like this one, but if needed just adapt the numbers to your case and add the parameters in the <code class="language-plaintext highlighter-rouge">pulsar_yaml_config</code> section of your <code class="language-plaintext highlighter-rouge">pulsarservers.yml</code> file.</p>

<h1 id="pulsar-in-production">Pulsar in Production</h1>

<p>If you want to make use of Pulsar on a Supercomputer, you only need access to a submit node, and you will need to run Pulsar there. We recommend that if you need to run a setup with Pulsar, that you deploy an AMQP server (e.g. RabbitMQ) alongside your <span class="notranslate">Galaxy</span>. That way, you can run Pulsar on any submit nodes, and it can connect directly to the AMQP and <span class="notranslate">Galaxy</span>. Other Pulsar deployment options require exposing ports wherever Pulsar is running, and this requires significant more coordination effort.</p>

<p>For each new Pulsar server, you will need to add:</p>
<ol>
  <li>In the RabbitMQ config:
    <ul>
      <li>A vhost</li>
      <li>A user - configured with a password and the new vhost</li>
    </ul>
  </li>
  <li>In the <span class="notranslate">Galaxy</span> job_conf.xml:
    <ul>
      <li>A new job runner with the new connection string</li>
      <li>A new destination or multiple destinations for the new runner.</li>
    </ul>
  </li>
</ol>

<p>Pulsar servers can be the head node of a cluster. You can create a cluster and use your favourite job scheduler such as Slurm or PBS to schedule jobs. You can have many destinations in your <span class="notranslate">Galaxy</span> job_conf.xml file that change the number of cpus, amount of RAM etc. It can get quite complex and flexible if you like.</p>

<h2 id="australia">Australia</h2>

<p>You can also create multiple queues on your RabbitMQ server for multiple Pulsar servers. On <span class="notranslate">Galaxy</span> Australia, we run 5 different Pulsar servers spread out all around the country. They all communicate with <span class="notranslate">Galaxy</span> via the one RabbitMQ server.</p>

<p><img src="../../images/pulsar_australia.png" alt="Map of australia with 6 pulsar nodes marked around the country." loading="lazy" /></p>

<h2 id="europe">Europe</h2>

<p><span class="notranslate">Galaxy</span> Europe has taken Pulsar and built <a href="https://pulsar-network.readthedocs.io/en/latest">The Pulsar Network</a>. This provides a framework for easily deploying Pulsar clusters in the cloud, something needed to support compute centers which might not have as much experience. This way they get an easy package they can deploy and the European <span class="notranslate">Galaxy</span> team can manage.</p>

<p><img src="https://pulsar-network.readthedocs.io/en/latest/_images/nodes.png" alt="Map of europe with pulsar nodes marked in many countries. An inset shows australia with a node there too." loading="lazy" /></p>

<p>The main purpose of this network is to support the workload of the Use<span class="notranslate">Galaxy</span>.eu instance by distributing it across several European data centers and clusters. If you‚Äôre interested in setting up something similar, they <a href="https://pulsar-network.readthedocs.io/en/latest/introduction.html">provide documentation</a> on how to install and configure a Pulsar network endpoint on a cloud infrastructure and how to connect it to your server.</p>

<h1 id="conclusion">Conclusion</h1>

<p>You‚Äôre ready to ship your <span class="notranslate">Galaxy</span> jobs around the world! Now wherever you have compute space, you know how to setup a Pulsar node and connect it to <span class="notranslate">Galaxy</span>. Let us know if you come up with creative places to run your <span class="notranslate">Galaxy</span> jobs (coworker‚Äôs laptops, your IoT fridge, the sky is the limit if it‚Äôs x86 and has python)</p>


                
                <blockquote class="key_points">
                    <h3><i class="fas fa-key" aria-hidden="true"></i> Key points</h3>
                    <ul>
                        
                        <li><p>Pulsar allows you to easily add geographically distributed compute resources into your Galaxy instance</p>
</li>
                        
                        <li><p>It also works well in situations where the compute resources cannot share storage pools.</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the  <a href="/training-material/topics/admin/faqs/">FAQ page for the Galaxy Server administration topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                <div id="feedback-button">
                    <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                </div>
                <div id="feedback-form">
                </div>
                <script type="text/javascript">
                    (function (window, document) {
                        function onDocumentReady(fn) {
                            if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                fn();
                            } else {
                                document.addEventListener('DOMContentLoaded', fn);
                            }
                        }

                        onDocumentReady(function () {
                            $("#feedback-button").click(function(evt){
                                var e = $(evt.target)
                                e.hide();

                                $("#feedback-form").html(`
                                    <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Running Jobs on Remote Resources with Pulsar (Galaxy Server administration)">Loading...</iframe>
                                `)
                            })
                        });
                    })(window, document);
                </script>



                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">Nate Coraor, Simon Gladman, Marius van den Beek, Helena Rasche, Gianmauro Cuccuru, 2021 <b>Running Jobs on Remote Resources with Pulsar (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/pulsar/tutorial.html">https://training.galaxyproject.org/training-material/topics/admin/tutorials/pulsar/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>


                <blockquote class="details">
                  <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                  <p style="display: none;">

                <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{admin-pulsar,
author = "Nate Coraor and Simon Gladman and Marius van den Beek and Helena Rasche and Gianmauro Cuccuru",
title = "Running Jobs on Remote Resources with Pulsar (Galaxy Training Materials)",
year = "2021",
month = "07",
day = "02"
url = "\url{https://training.galaxyproject.org/training-material/topics/admin/tutorials/pulsar/tutorial.html}",
note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
    doi = {10.1016/j.cels.2018.05.012},
    url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
    year = 2018,
    month = {jun},
    publisher = {Elsevier {BV}},
    volume = {6},
    number = {6},
    pages = {752--758.e1},
    author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
    title = {Community-Driven Data Analysis Training for Biology},
    journal = {Cell Systems}
}</code>
                </pre></div></div>
                </p>
                </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                <h3><i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!</h3>

                

                

            </div>
        </div>
    </div>
</section>
<br/>
<br/>
<br/>

        </div>
        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
