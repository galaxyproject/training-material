<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Mapping Jobs to Destinations</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />
        <link rel="canonical" href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/job-destinations/tutorial.html" />
        <link rel="license" href="https://creativecommons.org/licenses/by/4.0/" />

        <meta name="DC.identifier" content="https://github.com/galaxyproject/training-material" />
<meta name="DC.type" content="text" />
<meta name="DC.title" content="Mapping Jobs to Destinations" />
<meta name="DC.publisher" content="Galaxy Training Network" />
<meta name="DC.date" content="2023-01-24 14:21:57 +0000" />
<meta name="DC.creator" content="Nate Coraor" />
<meta name="DC.creator" content="Bj√∂rn Gr√ºning" />
<meta name="DC.creator" content="Helena Rasche" />

        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:site_name" content="Galaxy Training Network" />
        <meta property="og:title" content="Galaxy Training: Mapping Jobs to Destinations" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />

        
        <script type="application/ld+json">
            


{
  "@context": "http://schema.org",
  "@type": "LearningResource",
  "http://purl.org/dc/terms/conformsTo": {
    "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
    "@type": "CreativeWork"
  },
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "Students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "2023-01-24 14:21:57 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Mapping Jobs to Destinations",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "identifier": "https://github.com/galaxyproject/training-material",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "The text aims to be as accessible as possible. Image descriptions will vary per tutorial, from images being completely inaccessible, to images with good descriptions for non-visual users.",
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org/training-material/topics/admin/"
  },
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Mapping Jobs to Destinations' tutorial",
  "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/job-destinations/tutorial.html",
  "timeRequired": "PT2H",
  "keywords": "admin, ansible, jobs, git-gat",
  "description": "The questions this  addresses are:\n - How can I configure job dependent resources, like cores, memory for my DRM?\n - How can I map jobs to resources and destinations\n\n\nThe objectives are:\n - Know how to map tools to job destinations\n - Be able to use the dynamic job runner to make arbitrary destination mappings\n - Understand the job resource selector config and dynamic rule creation\n - The various ways in which tools can be mapped to destinations, both statically and dynamically\n - How to write a dynamic tool destination (DTD)\n - How to write a dynamic python function destination\n - How to use the job resource parameter selection feature\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "competencyRequired": [
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Hands-on for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "author": [
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/natefoo/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/natefoo/",
      "name": "Nate Coraor",
      "image": "https://avatars.githubusercontent.com/natefoo",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-8083-2963",
      "orcid": "https://orcid.org/0000-0001-8083-2963"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/bgruening/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/bgruening/",
      "name": "Bj√∂rn Gr√ºning",
      "image": "https://avatars.githubusercontent.com/bgruening",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-3079-6586",
      "orcid": "https://orcid.org/0000-0002-3079-6586"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/",
      "name": "Helena Rasche",
      "image": "https://avatars.githubusercontent.com/hexylena",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-9760-8992",
      "orcid": "https://orcid.org/0000-0001-9760-8992"
    }
  ],
  "contributor": [
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/natefoo/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/natefoo/",
      "name": "Nate Coraor",
      "image": "https://avatars.githubusercontent.com/natefoo",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-8083-2963",
      "orcid": "https://orcid.org/0000-0001-8083-2963"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/bgruening/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/bgruening/",
      "name": "Bj√∂rn Gr√ºning",
      "image": "https://avatars.githubusercontent.com/bgruening",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-3079-6586",
      "orcid": "https://orcid.org/0000-0002-3079-6586"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.2-DRAFT-2019_07_19",
        "@type": "Person"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/hexylena/",
      "name": "Helena Rasche",
      "image": "https://avatars.githubusercontent.com/hexylena",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-9760-8992",
      "orcid": "https://orcid.org/0000-0001-9760-8992"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/"
    }
  ]
}
        </script>
        
    </head>
    <body data-spy="scroll" data-target="#toc">
        <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Galaxy Server administration
                        </a>
                        
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Languages">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Languages
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            
                              <strong class="dropdown-header">Automatic Translations</strong>
            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url">
                            Fran√ßais
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url">
                            Êó•Êú¨Ë™û
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url">
                            Espa√±ol
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url">
                            Portugu√™s
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url">
                            ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/job-destinations/tutorial.html&edit-text=&act=url" title="">
                            And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        
        <a class="dropdown-item" href="/training-material/topics/admin/faqs/" title="Check our FAQs for the Galaxy Server administration topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/job-destinations/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/admin/tutorials/job-destinations/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        <!-- link to feedback -->
        
            
            
                <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
                </a>
            
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                    <button class="btn" data-theme="default">Default</button>
                    <button class="btn" data-theme="night">Night</button>
                    <button class="btn" data-theme="midnight">Midnight</button>
                    <button class="btn" data-theme="rainbow">Rainbow</button>
                    <button class="btn" data-theme="blm">‚úäüèø</button>
                    <button class="btn" data-theme="progress" >üè≥Ô∏è‚Äçüåà</button>
                    <button class="btn" data-theme="halloween">üéÉ</button>
                    <button class="btn" data-theme="straya">üá¶üá∫</button>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2023-02-01/topics/admin/tutorials/job-destinations/tutorial.html" title="Version 2023-02-01">2023-02-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2023-01-01/topics/admin/tutorials/job-destinations/tutorial.html" title="Version 2023-01-01">2023-01-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2022-12-01/topics/admin/tutorials/job-destinations/tutorial.html" title="Version 2022-12-01">2022-12-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        











<!-- Gitter -->




<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<section class="tutorial topic-admin">
    <h1 data-toc-skip>Mapping Jobs to Destinations</h1>
    

    <div markdown="0">

	<div class="contributors-line">
		Authors: <a href="/training-material/hall-of-fame/natefoo/" class="contributor-badge contributor-natefoo"><img src="/training-material/assets/images/orcid.png" alt="orcid logo"/><img src="https://avatars.githubusercontent.com/natefoo?s=27" alt="Avatar">Nate Coraor</a><a href="/training-material/hall-of-fame/bgruening/" class="contributor-badge contributor-bgruening"><img src="/training-material/assets/images/orcid.png" alt="orcid logo"/><img src="https://avatars.githubusercontent.com/bgruening?s=27" alt="Avatar">Bj√∂rn Gr√ºning</a><a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="/training-material/assets/images/orcid.png" alt="orcid logo"/><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a>
	</div>

</div>


    <blockquote class="overview">
        <div class="box-title" aria-label="overview box">Overview</div>
        
        <img alt="Creative Commons License" class="float-right" style="border-width:0; display: inline-block; margin:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" aria-hidden="true" />
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How can I configure job dependent resources, like cores, memory for my DRM?</p>
</li>
        
        <li><p>How can I map jobs to resources and destinations</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Know how to map tools to job destinations</p>
</li>
        
        <li><p>Be able to use the dynamic job runner to make arbitrary destination mappings</p>
</li>
        
        <li><p>Understand the job resource selector config and dynamic rule creation</p>
</li>
        
        <li><p>The various ways in which tools can be mapped to destinations, both statically and dynamically</p>
</li>
        
        <li><p>How to write a dynamic tool destination (DTD)</p>
</li>
        
        <li><p>How to write a dynamic python function destination</p>
</li>
        
        <li><p>How to use the job resource parameter selection feature</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
        
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation with Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Connecting Galaxy to a compute cluster:
                            
                                <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 2 hours</div>
        

        

        
        

        
        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            

            

            

            

            

            
            
            
                 <li class="btn btn-default supporting_material">
    <a class="topic-icon" href="/training-material/topics/admin/tutorials/job-destinations/faqs/" title="Frequently Asked Questions" alt="Tutorial FAQs">
        <i class="far fa-question-circle" aria-hidden="true"></i> FAQs
    </a>
  </li>


            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            













  
  <li class="btn btn-default supporting_material">
    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Latest recordings of this tutorial in the GTN Video Library">
        <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span>&nbsp;Recordings
    </a>
    <ul class="dropdown-menu">
        
        

        
        
        

        <li>
            <a class="dropdown-item" href="https://gallantries.github.io/video-library/videos/admin/job-destinations/tutorial" title="View GTN Video Library for this Tutorial">
                <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Tutorial (February 2021)
            </a>
        </li>
        
        
        
        
    </ul>
   </li>
   



            
        </ul>
        

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Jan 24, 2023 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>
            
            <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">The GTN Framework is licensed under MIT</a>
        </div>
    </blockquote>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <p>This tutorial heavily builds on the <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html">Connecting <span class="notranslate">Galaxy</span> to a compute cluster</a> and it‚Äôs expected you have completed this tutorial first.</p>

<p>Now that you have a working scheduler, we will start configuring which jobs are sent to which destinations.</p>

<!--SNIPPET-->
<blockquote class="comment">   <div class="box-title comment-title" id="comment-results-may-vary" aria-label="comment box: Results may vary"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden"></span> Comment: Results may vary</div>   <p>Your results may be slightly different from the ones presented in this tutorial due to differing versions of tools, reference data, exte<span class="notranslate">rna</span>l databases, or because of stochastic processes in the algorithms.</p> </blockquote>

<blockquote class="agenda">
  <div class="box-title agenda-title" id="agenda" aria-label="agenda box: ">Agenda</div>

<ol id="markdown-toc">
  <li><a href="#galaxy-and-slurm---statically-mapping-a-job" id="markdown-toc-galaxy-and-slurm---statically-mapping-a-job"><span class="notranslate">Galaxy</span> and Slurm - Statically <span class="notranslate">Mapping</span> a Job</a>    <ol>
      <li><a href="#writing-a-testing-tool" id="markdown-toc-writing-a-testing-tool">Writing a testing tool</a></li>
      <li><a href="#running-with-more-resources" id="markdown-toc-running-with-more-resources">Running with more resources</a></li>
    </ol>
  </li>
  <li><a href="#dynamic-job-destinations" id="markdown-toc-dynamic-job-destinations">Dynamic Job Destinations</a></li>
  <li><a href="#dynamically-map-a-tool-to-a-job-destination" id="markdown-toc-dynamically-map-a-tool-to-a-job-destination">Dynamically map a tool to a job destination</a>    <ol>
      <li><a href="#writing-a-dynamic-tool-destination" id="markdown-toc-writing-a-dynamic-tool-destination">Writing a Dynamic Tool Destination</a></li>
      <li><a href="#testing-the-dtd" id="markdown-toc-testing-the-dtd">Testing the DTD</a></li>
    </ol>
  </li>
  <li><a href="#job-resource-selectors" id="markdown-toc-job-resource-selectors">Job Resource Selectors</a>    <ol>
      <li><a href="#a-dynamic-destination" id="markdown-toc-a-dynamic-destination">A dynamic destination</a></li>
      <li><a href="#further-reading" id="markdown-toc-further-reading">Further Reading</a></li>
    </ol>
  </li>
</ol>

</blockquote>

<!--SNIPPET-->
<blockquote class="comment">   <div class="box-title comment-title" id="comment-galaxy-admin-training-path" aria-label="comment box: Galaxy Admin Training Path"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden"></span> Comment: <span class="notranslate">Galaxy</span> Admin Training Path</div>   <p>The yearly <span class="notranslate">Galaxy</span> Admin Training follows a specific ordering of tutorials. Use this timeline to help keep track of where you are in <span class="notranslate">Galaxy</span> Admin Training.</p>   <ol id="git-gat-timeline">     <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html">     <li class="disabled">         <span>Step 1</span>         <span>ansible-<span class="notranslate">galaxy</span></span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/tus/tutorial.html">     <li class="disabled">         <span>Step 2</span>         <span>tus</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/cvmfs/tutorial.html">     <li class="disabled">         <span>Step 3</span>         <span>cvmfs</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/singularity/tutorial.html">     <li class="disabled">         <span>Step 4</span>         <span>singularity</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/tool-management/tutorial.html">     <li class="disabled">         <span>Step 5</span>         <span>tool-management</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/data-library/tutorial.html">     <li class="disabled">         <span>Step 6</span>         <span>data-library</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html">     <li class="disabled">         <span>Step 7</span>         <span>connect-to-compute-cluster</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/job-destinations/tutorial.html">     <li class="active">         <span>Step 8</span>         <span>job-destinations</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/pulsar/tutorial.html">     <li class="">         <span>Step 9</span>         <span>pulsar</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/gxadmin/tutorial.html">     <li class="">         <span>Step 10</span>         <span>gxadmin</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/monitoring/tutorial.html">     <li class="">         <span>Step 11</span>         <span>monitoring</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/tiaas/tutorial.html">     <li class="">         <span>Step 12</span>         <span>tiaas</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/reports/tutorial.html">     <li class="">         <span>Step 13</span>         <span>reports</span>     </li>          </a>          <span aria-hidden="true">         <i class="fas fa-arrow-right" aria-hidden="true"></i>     </span>          <a href="/training-material/topics/admin/tutorials/ftp/tutorial.html">     <li class="">         <span>Step 14</span>         <span>ftp</span>     </li>          </a>      </ol>   <style type="text/css"> #git-gat-timeline {     display: flex;     flex-direction: row;     flex-wrap: wrap; } #git-gat-timeline li  {     display: flex;     flex-direction: column;     border: 1px solid black;     border-radius: 5px;     padding: 0.5em;     margin: 0.5em; } #git-gat-timeline li.active {     background: #86d486;     color: black; } #git-gat-timeline li.disabled {     background: #eee; } #git-gat-timeline span {     align-self: center; } </style> </blockquote>

<h1 id="galaxy-and-slurm---statically-mapping-a-job"><span class="notranslate">Galaxy</span> and Slurm - Statically <span class="notranslate">Mapping</span> a Job</h1>

<p>We don‚Äôt want to overload our training VMs trying to run real tools, so to demonstrate how to map a multicore tool to a multicore destination, we‚Äôll create a fake tool.</p>

<h2 id="writing-a-testing-tool">Writing a testing tool</h2>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-deploying-a-tool" aria-label="hands-on box: Deploying a Tool"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Deploying a Tool</div>

  <ol>
    <li>
      <p>Create the directory <code class="language-plaintext highlighter-rouge">files/<span class="notranslate">galaxy</span>/tools/</code> if it doesn‚Äôt exist and edit a new file in <code class="language-plaintext highlighter-rouge">files/<span class="notranslate">galaxy</span>/tools/testing.xml</code> with the following contents:</p>

      <div data-commit="Add testing tool" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/files/<span class="notranslate">galaxy</span>/tools/testing.xml
</span><span class="p">@@ -0,0 +1,11 @@</span>
<span class="gi">+&lt;tool id="testing" name="Testing Tool"&gt;
+    &lt;command&gt;
+        &lt;![CDATA[echo "Running with '\${<span class="notranslate">GALAXY</span>_SLOTS:-1}' th<span class="notranslate">reads</span>" &gt; "$output1"]]&gt;
+    &lt;/command&gt;
+    &lt;inputs&gt;
+        &lt;param name="input1" type="data" format="txt" label="Input Dataset"/&gt;
+    &lt;/inputs&gt;
+    &lt;outputs&gt;
+        &lt;data name="output1" format="txt" /&gt;
+    &lt;/outputs&gt;
+&lt;/tool&gt;
</span>   
</code></pre></div>      </div>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-how-to-read-a-diff"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-how-to-read-a-diff-contents" aria-expanded="true" aria-label="Toggle tip box: How to read a Diff"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden"></span> Tip: How to read a Diff<span role="button" class="fold-unfold fa fa-minus-square"></span></button></div>   <p>If you haven‚Äôt worked with diffs before, this can be something quite new or different.</p>   <p>If we have two files, let‚Äôs say a grocery list, in two files. We‚Äôll call them ‚Äòa‚Äô and ‚Äòb‚Äô.</p>   <blockquote class="code-2col">   <blockquote class="code-in">     <div class="box-title code-in-title" id="code-in-old" aria-label="code-in box: Old"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Old</div>     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat old<br />üçé<br />üçê<br />üçä<br />üçã<br />üçí<br />ü•ë<br /></code></pre></div>    </div>   </blockquote>   <blockquote class="code-out">     <div class="box-title code-out-title" id="code-out-new" aria-label="code-out box: New"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden"></span> Output: New</div>     <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat new<br />üçé<br />üçê<br />üçä<br />üçã<br />üçç<br />ü•ë<br /></code></pre></div>    </div>   </blockquote> </blockquote>   <p>We can see that they have some different entries. We‚Äôve removed üçí because they‚Äôre awful, and replaced them with an üçç</p>   <p>Diff lets us compare these files</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff old new<br />5c5<br />&lt; üçí<br /><span class="nt">---</span><br /><span class="o">&gt;</span> üçç<br /></code></pre></div></div>   <p>Here we see that üçí is only in a, and üçç is only in b. But otherwise the files are identical.</p>   <p>There are a couple different formats to diffs, one is the ‚Äòunified diff‚Äô</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff <span class="nt">-U2</span> old new<br /><span class="nt">---</span> old	2022-02-16 14:06:19.697132568 +0100<br />+++ new	2022-02-16 14:06:36.340962616 +0100<br />@@ <span class="nt">-3</span>,4 +3,4 @@<br /> üçä<br /> üçã<br />-üçí<br />+üçç<br /> ü•ë<br /></code></pre></div></div>   <p>This is basically what you see in the training materials which gives you a lot of context about the changes:</p>   <ul>   <li><code class="language-plaintext highlighter-rouge">--- old</code> is the ‚Äòold‚Äô file in our view</li>   <li><code class="language-plaintext highlighter-rouge">+++ new</code> is the ‚Äònew‚Äô file</li>   <li>@@ these lines tell us where the change occurs and how many lines are added or removed.</li>   <li>Lines starting with a - are removed from our ‚Äònew‚Äô file</li>   <li>Lines with a + have been added.</li> </ul>   <p>So when you go to apply these diffs to your files in the training:</p>   <ol>   <li>Ignore the header</li>   <li>Remove lines starting with - from your file</li>   <li>Add lines starting with + to your file</li> </ol>   <p>The other lines (üçä/üçã and ü•ë) above just provide ‚Äúcontext‚Äù, they help you know where a change belongs in a file, but <strong>should not be edited</strong> when you‚Äôre making the above change. Given the above diff, you would find a line with a üçí, and replace it with a üçç</p>   <h4 id="added--removed-lines">Added &amp; Removed Lines</h4>   <p>Removals are very easy to spot, we just have removed lines</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---</span> old	2022-02-16 14:06:19.697132568 +0100<br />+++ new	2022-02-16 14:10:14.370722802 +0100<br />@@ <span class="nt">-4</span>,3 +4,2 @@<br /> üçã<br /> üçí<br />-ü•ë<br /></code></pre></div></div>   <p>And additions likewise are very easy, just add a new line, between the other lines in your file.</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---</span> old	2022-02-16 14:06:19.697132568 +0100<br />+++ new	2022-02-16 14:11:11.422135393 +0100<br />@@ <span class="nt">-1</span>,3 +1,4 @@<br /> üçé<br />+üçç<br /> üçê<br /> üçä<br /></code></pre></div></div>   <h4 id="completely-new-files">Completely new files</h4>   <p>Completely new files look a bit different, there the ‚Äúold‚Äù file is <code class="language-plaintext highlighter-rouge">/dev/null</code>, the empty file in a Linux machine.</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff <span class="nt">-U2</span> /dev/null old<br /><span class="nt">---</span> /dev/null	2022-02-15 11:47:16.100000270 +0100<br />+++ old	2022-02-16 14:06:19.697132568 +0100<br />@@ <span class="nt">-0</span>,0 +1,6 @@<br />+üçé<br />+üçê<br />+üçä<br />+üçã<br />+üçí<br />+ü•ë<br /></code></pre></div></div>   <p>And removed files are similar, except with the new file being /dev/null</p>   <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---</span> old	2022-02-16 14:06:19.697132568 +0100<br />+++ /dev/null	2022-02-15 11:47:16.100000270 +0100<br />@@ <span class="nt">-1</span>,6 +0,0 @@<br />-üçé<br />-üçê<br />-üçä<br />-üçã<br />-üçí<br />-ü•ë<br /></code></pre></div></div> </blockquote>
    </li>
    <li>
      <p>Add the tool to the <span class="notranslate">Galaxy</span> group variables under the new item <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_local_tools</code> :</p>

      <div data-commit="Deploy testing tool" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -96,6 +96,9 @@</span> <span class="notranslate">galaxy</span>_config_templates:
   - src: templates/<span class="notranslate">galaxy</span>/config/dependency_resolvers_conf.xml
     dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.dependency_resolvers_config_file }}"
    
<span class="gi">+<span class="notranslate">galaxy</span>_local_tools:
+- testing.xml
+
</span> # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: true
 <span class="notranslate">galaxy</span>_systemd_env: [DRMAA_LIBRARY_PATH="/usr/lib/slurm-drmaa/lib/libdrmaa.so.1"]
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the <span class="notranslate">Galaxy</span> playbook.</p>

      <blockquote class="code-in">
        <div class="box-title code-in-title" id="code-in-bash" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Reload <span class="notranslate">Galaxy</span> in your browser and the new tool should now appear in the tool panel. If you have not already created a dataset in your history, upload a random text dataset. Once you have a dataset, click the tool‚Äôs name in the tool panel, then click Execute.</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question" aria-label="question box: "><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden"></span> Question</div>

        <p>What is the tool‚Äôs output?</p>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-contents" aria-expanded="true" aria-label="Toggle solution box: "><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"></span> Solution<span role="button" class="fold-unfold fa fa-minus-square"></span></button></div>

          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running with '1' th<span class="notranslate">reads</span>
</code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
  </ol>
</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.sh
</code></pre></div>  </div>
</blockquote>

<p>Of course, this tool doesn‚Äôt actually <em>use</em> the allocated number of cores. In a real tool, you would call the tools‚Äôs underlying command with whatever flag that tool provides to control the number of th<span class="notranslate">reads</span> or processes it starts, such as <code class="language-plaintext highlighter-rouge">samtools sort -@ \${<span class="notranslate">GALAXY</span>_SLOTS:-1}</code>.</p>

<h2 id="running-with-more-resources">Running with more resources</h2>

<p>We want our tool to run with more than one core. To do this, we need to instruct Slurm to allocate more cores for this job. This is done in the job configuration file.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-allocating-more-resources" aria-label="hands-on box: Allocating more resources"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Allocating more resources</div>

  <ol>
    <li>
      <p>Edit your <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2</code> and add the following destination. Then, map the new tool to the new destination using the tool ID (<code class="language-plaintext highlighter-rouge">&lt;tool id="testing"&gt;</code>) and destination id (<code class="language-plaintext highlighter-rouge">&lt;destination id="slurm-2c"&gt;</code>) by adding a new section to the job config, <code class="language-plaintext highlighter-rouge">&lt;tools&gt;</code>, below the destinations:</p>

      <div data-commit="Configure testing tool in job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -20,6 +20,17 @@</span> execution:
         value: /tmp/singularity
       - name: SINGULARITY_TMPDIR
         value: /tmp
<span class="gi">+    slurm-2c:
+      runner: slurm
+      singularity_enabled: true
+      native_specification: --nodes=1 --ntasks=1 --cpus-per-task=2
+      env:
+      - name: LC_ALL
+        value: C
+      - name: SINGULARITY_CACHEDIR
+        value: /tmp/singularity
+      - name: SINGULARITY_TMPDIR
+        value: /tmp
</span>     singularity:
       runner: local_runner
       singularity_enabled: true
<span class="p">@@ -37,3 +48,5 @@</span> execution:
 tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   environment: local_dest
<span class="gi">+- id: testing
+  environment: slurm-2c
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the <span class="notranslate">Galaxy</span> playbook. Because we modified <code class="language-plaintext highlighter-rouge">job_conf.yml</code>, <span class="notranslate">Galaxy</span> will be restarted to reread its config files.</p>

      <blockquote class="code-in">
        <div class="box-title code-in-title" id="code-in-bash-1" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Click the rerun button on the last history item, or click <strong>Testing Tool</strong> in the tool panel, and then click the tool‚Äôs Run Tool button.</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-1" aria-label="question box: "><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden"></span> Question</div>

        <p>What is the tool‚Äôs output?</p>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-1"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-1-contents" aria-expanded="true" aria-label="Toggle solution box: "><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"></span> Solution<span role="button" class="fold-unfold fa fa-minus-square"></span></button></div>

          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running with '2' th<span class="notranslate">reads</span>
</code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.sh
</code></pre></div>  </div>
</blockquote>

<h1 id="dynamic-job-destinations">Dynamic Job Destinations</h1>

<p>Dynamic destinations allow you to write custom python code to dispatch jobs based on whatever rules you like. For example, Use<span class="notranslate">Galaxy</span>.eu at one point used a very complex custom dispatching configuration to handle sorting jobs between multiple clusters. <span class="notranslate">Galaxy</span> has <a href="https://docs.galaxyproject.org/en/latest/admin/jobs.html#dynamic-destination-mapping-python-method">extensive documentation</a> on how to write these sort of destinations.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-writing-a-dynamic-job-destination" aria-label="hands-on box: Writing a dynamic job destination"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Writing a dynamic job destination</div>

  <ol>
    <li>
      <p>Create and open <code class="language-plaintext highlighter-rouge">files/<span class="notranslate">galaxy</span>/dynamic_job_rules/my_rules.py</code></p>

      <div data-commit="Add my rules python script" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/files/<span class="notranslate">galaxy</span>/dynamic_job_rules/my_rules.py
</span><span class="p">@@ -0,0 +1,10 @@</span>
<span class="gi">+from <span class="notranslate">galaxy</span>.jobs import JobDestination
+from <span class="notranslate">galaxy</span>.jobs.mapper import Job<span class="notranslate">Mapping</span>Exception
+import os
+
+def admin_only(app, user_email):
+    # Only allow the tool to be executed if the user is an admin
+    admin_users = app.config.get( "admin_users", "" ).split( "," )
+    if user_email not in admin_users:
+        raise Job<span class="notranslate">Mapping</span>Exception("Unauthorized.")
+    return JobDestination(runner="slurm")
</span>   
</code></pre></div>      </div>

      <p>This destination will check that the <code class="language-plaintext highlighter-rouge">user_email</code> is in the set of <code class="language-plaintext highlighter-rouge">admin_users</code> from your config file.</p>

      <blockquote class="tip">
        <div class="box-title tip-title" id="tip-debugging-dynamic-destinations"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-debugging-dynamic-destinations-contents" aria-expanded="true" aria-label="Toggle tip box: Debugging dynamic destinations"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden"></span> Tip: Debugging dynamic destinations<span role="button" class="fold-unfold fa fa-minus-square"></span></button></div>
        <p>You can use <code class="language-plaintext highlighter-rouge">pdb</code> for more advanced debugging, but it requires some configuration. <code class="language-plaintext highlighter-rouge">print()</code> statements are usually sufficient and easier.</p>
      </blockquote>
    </li>
    <li>
      <p>As usual, we need to instruct <span class="notranslate">Galaxy</span> of where to find this file:</p>

      <p>Edit your group variables file and add the following:</p>

      <div data-commit="Deploy my_rules dynamic rule" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -98,6 +98,8 @@</span> <span class="notranslate">galaxy</span>_config_templates:
    
 <span class="notranslate">galaxy</span>_local_tools:
 - testing.xml
<span class="gi">+<span class="notranslate">galaxy</span>_dynamic_job_rules:
+- my_rules.py
</span>    
 # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: true
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>We next need to configure this plugin in our job configuration:</p>

      <div data-commit="Add dynamic admin only destination" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -44,6 +44,9 @@</span> execution:
       # Singularity uses a temporary directory to build the squashfs filesystem
       - name: SINGULARITY_TMPDIR
         value: /tmp
<span class="gi">+    dynamic_admin_only:
+      runner: dynamic
+      function: admin_only
</span>    
 tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   
</code></pre></div>      </div>

      <p>This is a <strong>Python function dynamic destination</strong>. <span class="notranslate">Galaxy</span> will load all python files in the <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_dynamic_rule_dir }}</code>, and all functions defined in those will be available <code class="language-plaintext highlighter-rouge">my_rules.py</code> to be used in the <code class="language-plaintext highlighter-rouge">job_conf.yml</code></p>
    </li>
    <li>
      <p>Finally, in <code class="language-plaintext highlighter-rouge">job_conf.yml</code>, update the <code class="language-plaintext highlighter-rouge">&lt;tool&gt;</code> definition and point it to this destination:</p>

      <div data-commit="Send testing tool to the dynamic admin only destination." class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -52,4 +52,4 @@</span> tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   environment: local_dest
 - id: testing
<span class="gd">-  environment: slurm-2c
</span><span class="gi">+  environment: dynamic_admin_only
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the <span class="notranslate">Galaxy</span> playbook.</p>

      <blockquote class="code-in">
        <div class="box-title code-in-title" id="code-in-bash-2" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Try running the tool as both an admin user and a non-admin user, non-admins should not be able to run it. You can start a private browsing session to test as a non-admin, anonymous user. Anonymous users were enabled in your <span class="notranslate">Galaxy</span> configuration.</p>
    </li>
  </ol>

  <p><img src="../../images/unauthorized.png" alt="Unauthorized. " loading="lazy" /></p>

</blockquote>

<p>You can imagine extending this to <a href="https://galaxyproject.org/admin/config/access-control/">complex logic for permissions</a>, or for destination <span class="notranslate">mapping</span> depending on numerous factors. We did not cover it, but in the documentation you can add additional variables to your function signature, and they will be automatically supplied. Some useful variables are <code class="language-plaintext highlighter-rouge">tool</code>, <code class="language-plaintext highlighter-rouge">user</code>, <code class="language-plaintext highlighter-rouge">job</code>, and <code class="language-plaintext highlighter-rouge">app</code> if you need to load configuration information, and more <a href="https://docs.galaxyproject.org/en/master/admin/jobs.html#dynamic-destination-mapping-python-method">can be found in the documentation</a>.</p>

<h1 id="dynamically-map-a-tool-to-a-job-destination">Dynamically map a tool to a job destination</h1>

<p>If you don‚Äôt want to write dynamic destinations yourself, Dynamic Tool Destinations (DTDs) utilize the dynamic job runner to provide dynamic job <span class="notranslate">mapping</span> functionality without having to explicitly write code to perform the <span class="notranslate">mapping</span>. The <span class="notranslate">mapping</span> functionality is mostly limited to input sizes, but often input size is the most important factor in deciding what resources to allocate for a job.</p>

<h2 id="writing-a-dynamic-tool-destination">Writing a Dynamic Tool Destination</h2>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-writing-a-dtd" aria-label="hands-on box: Writing a DTD"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Writing a DTD</div>

  <ol>
    <li>
      <p>Dynamic tool destinations are configured via a YAML file. As before, we‚Äôll use a fake example but this is extremely useful in real-life scenarios. Create the file <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/tool_destinations.yml</code> with the following contents:</p>

      <div data-commit="Add tool destinations conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/tool_destinations.yml
</span><span class="p">@@ -0,0 +1,11 @@</span>
<span class="gi">+---
+tools:
+  testing:
+    rules:
+      - rule_type: file_size
+        lower_bound: 16
+        upper_bound: Infinity
+        destination: slurm-2c
+    default_destination: slurm
+default_destination: slurm
+verbose: True
</span>   
</code></pre></div>      </div>

      <p>The rule says:</p>
      <ul>
        <li>If the tool has ID <code class="language-plaintext highlighter-rouge">testing</code>:
          <ul>
            <li>If the input dataset is &gt;=16 bytes, run on the destination <code class="language-plaintext highlighter-rouge">slurm-2c</code></li>
            <li>If the input dataset is &lt;16 bytes, run on the destination <code class="language-plaintext highlighter-rouge">slurm</code></li>
          </ul>
        </li>
        <li>Else, run on the destination <code class="language-plaintext highlighter-rouge">slurm</code></li>
      </ul>
    </li>
    <li>
      <p>We also need to inform <span class="notranslate">Galaxy</span> of the path to the file we‚Äôve just created, which is done using the <code class="language-plaintext highlighter-rouge">tool_destinations_config_file</code> in <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> &gt; <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code>. Additionally we need to add a <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code> entry to ensure it is deployed.</p>

      <div data-commit="Deploy tool destinations config file" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -29,6 +29,7 @@</span> miniconda_manage_dependencies: false
    
 <span class="notranslate">galaxy</span>_config:
   <span class="notranslate">galaxy</span>:
<span class="gi">+    tool_destinations_config_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/tool_destinations.yml"
</span>     library_import_dir: /libraries/admin
     user_library_import_dir: /libraries/user
     dependency_resolvers_config_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/dependency_resolvers_conf.xml"
<span class="p">@@ -95,6 +96,8 @@</span> <span class="notranslate">galaxy</span>_config_templates:
     dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.containers_resolvers_config_file }}"
   - src: templates/<span class="notranslate">galaxy</span>/config/dependency_resolvers_conf.xml
     dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.dependency_resolvers_config_file }}"
<span class="gi">+  - src: templates/<span class="notranslate">galaxy</span>/config/tool_destinations.yml
+    dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.tool_destinations_config_file }}"
</span>    
 <span class="notranslate">galaxy</span>_local_tools:
 - testing.xml
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>We need to update <span class="notranslate">Galaxy</span>‚Äôs job configuration to use this rule. Open <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2</code> and add a DTD destination.
Also, comment out or remove the previous <code class="language-plaintext highlighter-rouge">&lt;tool&gt;</code> definition for the <code class="language-plaintext highlighter-rouge">testing</code> tool, and replace it with a <span class="notranslate">mapping</span> to the dtd destination like so:</p>

      <div data-commit="Configure dtd in job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -47,9 +47,12 @@</span> execution:
     dynamic_admin_only:
       runner: dynamic
       function: admin_only
<span class="gi">+    dtd:
+      runner: dynamic
+      type: dtd
</span>    
 tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   environment: local_dest
 - id: testing
<span class="gd">-  environment: dynamic_admin_only
</span><span class="gi">+  environment: dtd
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the <span class="notranslate">Galaxy</span> playbook.</p>

      <blockquote class="code-in">
        <div class="box-title code-in-title" id="code-in-bash-3" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="testing-the-dtd">Testing the DTD</h2>

<p>Our rule specified that any invocation of the <code class="language-plaintext highlighter-rouge">testing</code> tool with an input dataset with size &lt;16 bytes would run on the 1 core destination, whereas any with &gt;= 16 bytes would run on the 2 core destination.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-testing-the-dtd" aria-label="hands-on box: Testing the DTD"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Testing the DTD</div>

  <ol>
    <li>
      <p>Create a dataset using the upload paste tool with a few (&lt;16) characters</p>
    </li>
    <li>
      <p>Create a dataset using the upload paste tool with &gt;16 characters</p>
    </li>
    <li>
      <p>Run the <code class="language-plaintext highlighter-rouge">Testing Tool</code> on both datasets.</p>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.sh
</code></pre></div>  </div>
</blockquote>

<p>You can imagine using this to run large blast jobs on compute hardware with more resources, or giving them more CPU cores. Some tools require more memory as job inputs increase, you can use this to run tools with a larger memory limit, if you know it will need it to process a certain size of inputs.</p>

<h1 id="job-resource-selectors">Job Resource Selectors</h1>

<p>You may find that certain tools can benefit from having form elements added to them to allow for controlling certain job parameters, so that users can select based on their own knowledge. For example, a user might know that a particular set of parameters and inputs to a certain tool needs a larger memory allocation than the standard amount for a given tool. This of course assumes that your users are well behaved enough not to choose the maximum whenever available, although such concerns can be mitigated somewhat by the use of concurrency limits on larger memory destinations.</p>

<p>Such form elements can be added to tools without modifying each tool‚Äôs configuration file through the use of the <strong>job resource parameters configuration file</strong></p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-configuring-a-resource-selector" aria-label="hands-on box: Configuring a Resource Selector"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Configuring a Resource Selector</div>

  <ol>
    <li>
      <p>Create and open <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_resource_params_conf.xml.j2</code></p>

      <div data-commit="Add job resource params configuration" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_resource_params_conf.xml.j2
</span><span class="p">@@ -0,0 +1,7 @@</span>
<span class="gi">+&lt;parameters&gt;
+    &lt;param label="Cores" name="cores" type="select" help="Number of cores to run job on."&gt;
+        &lt;option value="1"&gt;1 (default)&lt;/option&gt;
+        &lt;option value="2"&gt;2&lt;/option&gt;
+    &lt;/param&gt;
+  &lt;param label="Time" name="time" type="integer" size="3" min="1" max="24" value="1" help="Maximum job time in hours, 'walltime' value (1-24). Leave blank to use default value." /&gt;
+&lt;/parameters&gt;
</span>   
</code></pre></div>      </div>

      <p>This defines two resource fields, a select box where users can choose between 1 and 2 cores, and a text entry field where users can input an integer value from 1-24 to set the walltime for a job.</p>
    </li>
    <li>
      <p>As usual, we need to instruct <span class="notranslate">Galaxy</span> of where to find this file:</p>

      <div data-commit="Deploy job resource params configuration" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -90,6 +90,8 @@</span> <span class="notranslate">galaxy</span>_config:
           - <span class="notranslate">workflow</span>-scheduler
    
 <span class="notranslate">galaxy</span>_config_templates:
<span class="gi">+  - src: templates/<span class="notranslate">galaxy</span>/config/job_resource_params_conf.xml.j2
+    dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.job_resource_params_file }}"
</span>   - src: templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
     dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.job_config_file }}"
   - src: templates/<span class="notranslate">galaxy</span>/config/container_resolvers_conf.xml.j2
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Next, we define a new section in <code class="language-plaintext highlighter-rouge">job_conf.yml</code>: <code class="language-plaintext highlighter-rouge">&lt;resources&gt;</code>. This groups together parameters that should appear together on a tool form. Add the following section to your <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2</code>:</p>

      <div data-commit="Configure resources in job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -51,6 +51,12 @@</span> execution:
       runner: dynamic
       type: dtd
    
<span class="gi">+resources:
+  default: default
+  groups:
+    default: []
+    testing: [cores, time]
+
</span> tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   environment: local_dest
   
</code></pre></div>      </div>

      <p>The group ID will be used to map a tool to job resource parameters, and the text value of the <code class="language-plaintext highlighter-rouge">&lt;group&gt;</code> tag is a comma-separated list of <code class="language-plaintext highlighter-rouge">name</code>s from <code class="language-plaintext highlighter-rouge">job_resource_params_conf.xml</code> to include on the form of any tool that is mapped to the defined <code class="language-plaintext highlighter-rouge">&lt;group&gt;</code>.</p>
    </li>
    <li>
      <p>Finally, in <code class="language-plaintext highlighter-rouge">job_conf.yml</code>, move the previous <code class="language-plaintext highlighter-rouge">&lt;tool&gt;</code> definition for the <code class="language-plaintext highlighter-rouge">testing</code> tool into the comment and define a new <code class="language-plaintext highlighter-rouge">&lt;tool&gt;</code> that defines the <code class="language-plaintext highlighter-rouge">resources</code> for the tool:</p>

      <div data-commit="Configure resources in job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -61,4 +61,5 @@</span> tools:
 - class: local # these special tools that aren't parameterized for remote execution - <span class="notranslate">expression</span> tools, upload, etc
   environment: local_dest
 - id: testing
<span class="gd">-  environment: dtd
</span><span class="gi">+  environment: dynamic_cores_time
+  resources: testing
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>We have assigned the <code class="language-plaintext highlighter-rouge">testing</code> tool to a new destination: <code class="language-plaintext highlighter-rouge">dynamic_cores_time</code>, but this destination does not exist. We need to create it. Add the following destination in your job conf:</p>

      <div data-commit="Add dynamic_cores_time destination" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.yml.j2
</span><span class="p">@@ -50,6 +50,9 @@</span> execution:
     dtd:
       runner: dynamic
       type: dtd
<span class="gi">+    dynamic_cores_time:
+      runner: dynamic
+      function: dynamic_cores_time
</span>    
 resources:
   default: default
   
</code></pre></div>      </div>

      <p>This will be another dynamic destination. <span class="notranslate">Galaxy</span> will load all python files in the <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_dynamic_rule_dir }}</code>, and all functions defined in those will be available <code class="language-plaintext highlighter-rouge">dynamic_cores_time</code> to be used in the <code class="language-plaintext highlighter-rouge">job_conf.yml</code></p>
    </li>
  </ol>

</blockquote>

<p>This will set everything up to use the function. We have:</p>

<ul>
  <li>A set of ‚Äújob resources‚Äù defined which will let the user select the number of cores and walltime.</li>
  <li>A job configuration which says:
    <ul>
      <li>that our testing tool should allow selection of the cores and time parameters</li>
      <li>directs it to use a new, <code class="language-plaintext highlighter-rouge">dynamic_cores_time</code> destination</li>
      <li>and a has a new destination, <code class="language-plaintext highlighter-rouge">dynamic_cores_time</code>, which is defined as a dynamic destination which will call a python function we will load.</li>
    </ul>
  </li>
</ul>

<p>This is a lot but we‚Äôre still missing the last piece for it to work:</p>

<h2 id="a-dynamic-destination">A dynamic destination</h2>

<p>Lastly, we need to write the rule that will read the value of the job resource parameter form fields and decide how to submit the job.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-writing-a-dynamic-destination" aria-label="hands-on box: Writing a dynamic destination"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Writing a dynamic destination</div>

  <ol>
    <li>
      <p>Create and edit <code class="language-plaintext highlighter-rouge">files/<span class="notranslate">galaxy</span>/dynamic_job_rules/map_resources.py</code>. Create it with the following contents:</p>

      <div data-commit="Add map_resources python" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/files/<span class="notranslate">galaxy</span>/dynamic_job_rules/map_resources.py
</span><span class="p">@@ -0,0 +1,42 @@</span>
<span class="gi">+import logging
+from <span class="notranslate">galaxy</span>.jobs.mapper import Job<span class="notranslate">Mapping</span>Exception
+
+log = logging.getLogger(__name__)
+
+DESTINATION_IDS = {
+    1 : 'slurm',
+    2 : 'slurm-2c'
+}
+FAILURE_MESSAGE = 'This tool could not be run because of a misconfiguration in the <span class="notranslate">Galaxy</span> job running system, please report this error'
+
+
+def dynamic_cores_time(app, tool, job, user_email):
+    destination = None
+    destination_id = 'slurm'
+
+    # build the param dictionary
+    param_dict = job.get_param_values(app)
+
+    if param_dict.get('__job_resource', {}).get('__job_resource__select') != 'yes':
+        log.info("Job resource parameters not seleted, returning default destination")
+        return destination_id
+
+    # handle job resource parameters
+    try:
+        # validate params
+        cores = int(param_dict['__job_resource']['cores'])
+        time = int(param_dict['__job_resource']['time'])
+        destination_id = DESTINATION_IDS[cores]
+        destination = app.job_config.get_destination(destination_id)
+        # set walltime
+        if 'nativeSpecification' not in destination.params:
+            destination.params['nativeSpecification'] = ''
+        destination.params['nativeSpecification'] += ' --time=%s:00:00' % time
+    except:
+        # resource param selector not sent with tool form, job_conf.yml misconfigured
+        log.warning('(%s) error, keys were: %s', job.id, param_dict.keys())
+        raise Job<span class="notranslate">Mapping</span>Exception(FAILURE_MESSAGE)
+
+    log.info('returning destination: %s', destination_id)
+    log.info('native specification: %s', destination.params.get('nativeSpecification'))
+    return destination or destination_id
</span>   
</code></pre></div>      </div>

      <p>It is important to note that <strong>you are responsible for parameter validation, including the job resource selector</strong>. This function only handles the job resource parameter fields, but it could do many other things - examine inputs, job queues, other tool parameters, etc.</p>
    </li>
    <li>
      <p>As usual, we need to instruct <span class="notranslate">Galaxy</span> of where to find this file:</p>

      <div data-commit="Deploy map_resources.py" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -29,6 +29,7 @@</span> miniconda_manage_dependencies: false
    
 <span class="notranslate">galaxy</span>_config:
   <span class="notranslate">galaxy</span>:
<span class="gi">+    job_resource_params_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/job_resource_params_conf.xml"
</span>     tool_destinations_config_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/tool_destinations.yml"
     library_import_dir: /libraries/admin
     user_library_import_dir: /libraries/user
<span class="p">@@ -105,6 +106,7 @@</span> <span class="notranslate">galaxy</span>_local_tools:
 - testing.xml
 <span class="notranslate">galaxy</span>_dynamic_job_rules:
 - my_rules.py
<span class="gi">+- map_resources.py
</span>    
 # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: true
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the <span class="notranslate">Galaxy</span> playbook.</p>

      <blockquote class="code-in">
        <div class="box-title code-in-title" id="code-in-bash-4" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Run the <strong>Testing Tool</strong> with various resource parameter selections</p>

      <ul>
        <li>Use default job resource parameters</li>
        <li>Specify job resource parameters:
          <ul>
            <li>1 core</li>
            <li>2 cores</li>
            <li>Some value for walltime from 1-24</li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>The cores parameter can be verified from the output of the tool. The walltime can be verified with <code class="language-plaintext highlighter-rouge">scontrol</code>:</p>

<blockquote class="code-in">
  <div class="box-title code-in-title" id="code-in-bash-5" aria-label="code-in box: Bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden"></span> Input: Bash</div>
  <p>Your job number may be different.</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scontrol show job 24
</code></pre></div>  </div>
</blockquote>

<blockquote class="code-out">
  <div class="box-title code-out-title" id="code-out" aria-label="code-out box: "><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden"></span> Output</div>
  <p>Your output may look slightly different. Note that the <code class="language-plaintext highlighter-rouge">TimeLimit</code> for this job (which I gave a 12 hour time limit) was set to <code class="language-plaintext highlighter-rouge">12:00:00</code>.</p>
  <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">JobId=24 JobName=g24_multi_anonymous_10_0_2_2
   UserId=<span class="notranslate">galaxy</span>(999) GroupId=<span class="notranslate">galaxy</span>(999)
   Priority=4294901747 Nice=0 Account=(null) QOS=(null)
   JobState=COMPLETED Reason=None Dependency=(null)
   Requeue=1 Restarts=0 BatchFlag=1 Reboot=0 ExitCode=0:0
   RunTime=00:00:05 TimeLimit=12:00:00 TimeMin=N/A
   SubmitTime=2016-11-05T22:01:09 EligibleTime=2016-11-05T22:01:09
   StartTime=2016-11-05T22:01:09 EndTime=2016-11-05T22:01:14
   PreemptTime=None SuspendTime=None SecsPreSuspend=0
   Partition=debug AllocNode:Sid=gat2016:1860
   ReqNodeList=(null) ExcNodeList=(null)
   NodeList=localhost
   BatchHost=localhost
   NumNodes=1 NumCPUs=1 CPUs/Task=1 ReqB:S:C:T=0:0:*:*
   TRES=cpu=1,node=1
   Socks/Node=* NtasksPerN:B:S:C=0:0:*:* CoreSpec=*
   MinCPUsNode=1 MinMemoryNode=0 MinTmpDiskNode=0
   Features=(null) Gres=(null) Reservation=(null)
   Shared=OK Contiguous=0 Licenses=(null) Network=(null)
   Command=(null)
   WorkDir=/srv/<span class="notranslate">galaxy</span>/server/database/jobs/000/24
   StdErr=/srv/<span class="notranslate">galaxy</span>/server/database/jobs/000/24/<span class="notranslate">galaxy</span>_24.e
   StdIn=StdIn=/dev/null
   StdOut=/srv/<span class="notranslate">galaxy</span>/server/database/jobs/000/24/<span class="notranslate">galaxy</span>_24.o
   Power= SICP=0
</span></code></pre></div>  </div>
</blockquote>

<!--SNIPPET-->
<blockquote class="comment">   <div class="box-title comment-title" id="comment-got-lost-along-the-way" aria-label="comment box: Got lost along the way?"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden"></span> Comment: Got lost along the way?</div>   <p>If you missed any steps, you can compare against the <a href="https://github.com/hexylena/git-gat/tree/step-8">reference files</a>, or see what changed since <a href="https://github.com/hexylena/git-gat/compare/step-7...step-8#files_bucket">the previous tutorial</a>.</p>   <p>If you‚Äôre using <code class="language-plaintext highlighter-rouge">git</code> to track your progress, remember to add your changes and commit with a good commit message!</p> </blockquote>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li>The <a href="https://github.com/galaxyproject/galaxy/blob/dev/config/tool_destinations.yml.sample">sample dynamic tool destination config file</a> fully describes the configuration language</li>
  <li><a href="https://docs.galaxyproject.org/en/latest/admin/jobs.html">Dynamic destination documentation</a></li>
  <li>Job resource parameters are not as well documented as they could be, but the <a href="https://github.com/galaxyproject/usegalaxy-playbook/blob/master/env/test/files/galaxy/config/job_resource_params_conf.xml">sample configuration file</a> shows some of the possibilities.</li>
  <li><a href="https://github.com/galaxyproject/usegalaxy-playbook/blob/master/env/common/templates/galaxy/config/job_conf.yml.j2">use<span class="notranslate">galaxy</span>.org‚Äôs job_conf.yml</a> is publicly available for reference.</li>
  <li><a href="https://github.com/usegalaxy-eu/infrastructure-playbook/search?l=YAML&amp;q=galaxy_jobconf">use<span class="notranslate">galaxy</span>.eu‚Äôs job_conf.xml</a> is likewise (see the <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>.yml</code> result)</li>
</ul>


                
                <blockquote class="key_points">
                    <div class="box-title" aria-label="key-points box"><i class="fas fa-key" aria-hidden="true"></i> Key points</div>
                    <ul>
                        
                        <li><p>Dynamic Tool Destinations are a convenient way to map</p>
</li>
                        
                        <li><p>Job resource parameters can allow you to give your users control over job resource requirements, if they are knowledgeable about the tools and compute resources available to them.</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the <a href="faqs/">tutorial FAQ page</a> or the  <a href="/training-material/topics/admin/faqs/">FAQ page for the Galaxy Server administration topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                


                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <div id="feedback-button">
                    <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                </div>
                <div id="feedback-form">
                </div>
                <script type="text/javascript">
                    (function (window, document) {
                        function onDocumentReady(fn) {
                            if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                fn();
                            } else {
                                document.addEventListener('DOMContentLoaded', fn);
                            }
                        }

                        onDocumentReady(function () {
                            $("#feedback-button").click(function(evt){
                                var e = $(evt.target)
                                e.hide();

                                $("#feedback-form").html(`
                                    <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Mapping Jobs to Destinations (Galaxy Server administration)">Loading...</iframe>
                                `)
                            })
                        });
                    })(window, document);
                </script>

                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">
                            Nate Coraor, Bj√∂rn Gr√ºning, Helena Rasche,  <b>Mapping Jobs to Destinations (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/job-destinations/tutorial.html">https://training.galaxyproject.org/training-material/topics/admin/tutorials/job-destinations/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>

                <!-- collapsible boxcontaining the BibTeX-formatted citation -->
                <blockquote class="details">

                  <div id="citation-bibtex" class="box-title">
                    <button type="button" aria-controls="citation-bibtex" aria-expanded="false" aria-label="Toggle details box: BibTeX for citing this tutorial">
                      <i class="fas fa-info-circle" aria-hidden="true"></i>
                      <span class="visually-hidden"></span> BibTeX<span role="button" class="fold-unfold fa fa-minus-square" aria-hidden="true"></span>
                    </button>
                   </div>
                   <p style="display: none;">

                   <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">


<code id="citation-code">@misc{admin-job-destinations,
author = "Nate Coraor and Bj√∂rn Gr√ºning and Helena Rasche",
title = "Mapping Jobs to Destinations (Galaxy Training Materials)",
year = "",
month = "",
day = ""
url = "\url{https://training.galaxyproject.org/training-material/topics/admin/tutorials/job-destinations/tutorial.html}",
note = "[Online; accessed TODAY]"
}
@article{Hiltemann_2023,
	doi = {10.1371/journal.pcbi.1010752},
	url = {https://doi.org/10.1371%2Fjournal.pcbi.1010752},
	year = 2023,
	month = {jan},
	publisher = {Public Library of Science ({PLoS})},
	volume = {19},
	number = {1},
	pages = {e1010752},
	author = {Saskia Hiltemann and Helena Rasche and Simon Gladman and Hans-Rudolf Hotz and Delphine Larivi{\`{e}}re and Daniel Blankenberg and Pratik D. Jagtap and Thomas Wollmann and Anthony Bretaudeau and Nadia Gou{\'{e}} and Timothy J. Griffin and Coline Royaux and Yvan Le Bras and Subina Mehta and Anna Syme and Frederik Coppens and Bert Droesbeke and Nicola Soranzo and Wendi Bacon and Fotis Psomopoulos and Crist{\'{o}}bal Gallardo-Alba and John Davis and Melanie Christine F√∂ll and Matthias Fahrner and Maria A. Doyle and Beatriz Serrano-Solano and Anne Claire Fouilloux and Peter van Heusden and Wolfgang Maier and Dave Clements and Florian Heyl and Bj√∂rn Gr√ºning and B{\'{e}}r{\'{e}}nice Batut and},
	editor = {Francis Ouellette},
	title = {Galaxy Training: A powerful framework for teaching!},
	journal = {PLoS Comput Biol} Computational Biology}
}
</code>
                   </pre></div></div>
                   </p>
                </blockquote>

                


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                <i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!

                

                

            </div>
        </div>
    </div>
</section>
<br/>
<br/>
<br/>

        </div>
        
        <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
        <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
        <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
        <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
        <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
        <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
        <script type="text/javascript">
        var snippets=document.querySelectorAll('div.highlight');
        [].forEach.call(snippets,function(snippet){
            snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
        });

        var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
            target:function(trigger){return trigger.nextElementSibling;
        }});
        </script>
        

        <script type="text/javascript">
            if(window.location.hostname === "galaxyproject.github.io") {
                // Redirect
                var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
                $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

                window.setTimeout(function(){
                    window.location.href = redirect;
                }, 5000)

            }
        </script>
    </body>
</html>