<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Reference Data with CVMFS</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Reference Data with CVMFS" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<!-- Gitter -->


<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">topic</span> Galaxy Server administration
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Language Selector">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Language
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                Fran√ßais
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                Êó•Êú¨Ë™û
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                Espa√±ol
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                Portugu√™s
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fcvmfs%2Ftutorial.html&edit-text=&act=url" title="">
                                And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>

        <div class="dropdown-item">
            <div>
                Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
            </div>

        </div>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/admin/tutorials/cvmfs/tutorial.md">
                            <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Reference Data with CVMFS",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / cvmfs / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Reference Data with CVMFS' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/cvmfs/tutorial.html",
  "timeRequired": "PT1H",
  "description": "The objectives are:\n - Have an understanding of what CVMFS is and how it works\n - Install and configure the CVMFS client on a linux machine and mount the Galaxy reference data repository\n - Configure your Galaxy to use these reference genomes and indices\n - Use an Ansible playbook for all of the above.\n\n",
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Reference Data with CVMFS</h1>
        

        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame/slugger70/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/slugger70" alt="Simon Gladman">Simon Gladman</a>, <a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/hexylena" alt="Helena Rasche">Helena Rasche</a>

</div>

        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            </ul>

            <strong><i class="fas fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li><p>Have an understanding of what CVMFS is and how it works</p>
</li>
            
            <li><p>Install and configure the CVMFS client on a linux machine and mount the Galaxy reference data repository</p>
</li>
            
            <li><p>Configure your Galaxy to use these reference genomes and indices</p>
</li>
            
            <li><p>Use an Ansible playbook for all of the above.</p>
</li>
            
            </ul>

            
            <strong><i class="fas fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
            
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation with Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            </ul>
            

            
            <p><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 1 hour</p>
            

            

            
            

            
            <p id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></p>
            <ul>
                <div class="supporting_material">
                
                    <li class="btn btn-default"><a href="/training-material/topics/admin/tutorials/cvmfs/slides.html" title="Slides for this tutorial">
                        <i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Slides
                    </a></li>
                

                

                

                

                
                </div>
            </ul>
            

            <p><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Jan 6, 2021 </p>
        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <h1 class="no_toc" id="overview">Overview</h1>

<p>The CernVM-FS is a distributed filesystem perfectly designed for sharing readonly data across the globe. We use it in the <a href="https://galaxyproject.org"><span class="notranslate">Galaxy</span> Project</a> for sharing things that a lot of <span class="notranslate">Galaxy</span> servers need. Namely:</p>
<ul>
  <li><strong>Reference Data</strong>
    <ul>
      <li>Genome sequences for hundreds of useful species.</li>
      <li>Indices for the genome sequences</li>
      <li>Various bioinformatic tool indices for the available genomes</li>
    </ul>
  </li>
  <li><strong>Tool containers</strong>
    <ul>
      <li><a href="https://www.sylabs.io/">Singularity</a> containers of everything stored in <a href="https://biocontainers.pro/">Biocontainers</a> (A bioinformatic tool container repository.) You get these for free every time you build a <a href="https://bioconda.github.io/">Bioconda</a> recipe/package for a tool.</li>
    </ul>
  </li>
  <li>Others too..</li>
</ul>

<p>From the Cern website:</p>

<blockquote class="quote">
  <p>The CernVM File System provides a scalable, reliable and low-maintenance software distribution service. It was developed to assist High Energy Physics (HEP) collaborations to deploy software on the worldwide-distributed computing infrastructure used to run data processing applications. CernVM-FS is implemented as a POSIX read-only file system in user space (a FUSE module). Files and directories are hosted on standard web servers and mounted in the universal namespace /cvmfs.‚Äù</p>

  <p>‚Äì <a href="https://cernvm.cern.ch/portal/filesystem">https://cernvm.cern.ch/portal/filesystem</a></p>
</blockquote>

<p>A slideshow presentation on this subject can be found <a href="slides.html">here</a>. More details on the use<span class="notranslate">galaxy</span>.org (<span class="notranslate">Galaxy</span> Main‚Äôs) reference data setup and CVMFS system can be found <a href="https://galaxyproject.org/admin/reference-data-repo/#usegalaxyorg-reference-data">here</a></p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#ansible-cvmfs-and-galaxy" id="markdown-toc-ansible-cvmfs-and-galaxy">Ansible-CVMFS and <span class="notranslate">Galaxy</span></a>    <ol>
      <li><a href="#installing-and-configuring-galaxys-cvmfs-reference-data-with-ansible" id="markdown-toc-installing-and-configuring-galaxys-cvmfs-reference-data-with-ansible">Installing and configuring <span class="notranslate">Galaxy</span>‚Äôs CVMFS reference data with Ansible</a></li>
      <li><a href="#exploring-the-cvmfs-installation" id="markdown-toc-exploring-the-cvmfs-installation">Exploring the CVMFS Installation</a></li>
      <li><a href="#configuring-galaxy-to-use-the-cvmfs-references" id="markdown-toc-configuring-galaxy-to-use-the-cvmfs-references">Configuring <span class="notranslate">Galaxy</span> to use the CVMFS references.</a></li>
    </ol>
  </li>
  <li><a href="#other-aspects" id="markdown-toc-other-aspects">Other Aspects</a>    <ol>
      <li><a href="#development" id="markdown-toc-development">Development</a></li>
      <li><a href="#automation" id="markdown-toc-automation">Automation</a></li>
      <li><a href="#access-control" id="markdown-toc-access-control">Access Control</a></li>
      <li><a href="#proxying-recap" id="markdown-toc-proxying-recap">Proxying Recap</a></li>
      <li><a href="#plant-data" id="markdown-toc-plant-data">Plant Data</a></li>
    </ol>
  </li>
</ol>

</blockquote>

<h1 id="ansible-cvmfs-and-galaxy">Ansible-CVMFS and <span class="notranslate">Galaxy</span></h1>

<p>The <span class="notranslate">Galaxy</span> project supports a few CVMFS repositories.</p>

<table>
  <thead>
    <tr>
      <th>Repository</th>
      <th>Repository Address</th>
      <th>Contents</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Reference Data and Indices</td>
      <td><code class="language-plaintext highlighter-rouge">data.<span class="notranslate">galaxy</span>project.org</code></td>
      <td>Genome sequences and their tool indices, <span class="notranslate">Galaxy</span> <code class="language-plaintext highlighter-rouge">.loc</code> files for them as well</td>
    </tr>
    <tr>
      <td>Singularity Containers</td>
      <td><code class="language-plaintext highlighter-rouge">singularity.<span class="notranslate">galaxy</span>project.org</code></td>
      <td>Singularity containers for everything in Biocontainers for use in <span class="notranslate">Galaxy</span> systems</td>
    </tr>
    <tr>
      <td><span class="notranslate">Galaxy</span> Main Configuration</td>
      <td><code class="language-plaintext highlighter-rouge">main.<span class="notranslate">galaxy</span>project.org</code></td>
      <td>The configuration files etc for <span class="notranslate">Galaxy</span> Main (use<span class="notranslate">galaxy</span>.org)</td>
    </tr>
  </tbody>
</table>

<p>You can browse the contents of <code class="language-plaintext highlighter-rouge">data.<span class="notranslate">galaxy</span>project.org</code> at the <a href="http://datacache.galaxyproject.org/">datacache</a>.</p>

<h2 id="installing-and-configuring-galaxys-cvmfs-reference-data-with-ansible">Installing and configuring <span class="notranslate">Galaxy</span>‚Äôs CVMFS reference data with Ansible</h2>

<p>Luckily for us, the <span class="notranslate">Galaxy</span> Project has a lot of experience with using and configuring CVMFS and we are going to leverage off that. To get CVMFS working on our <span class="notranslate">Galaxy</span> server, we will use the Ansible role for CVMFS written by the <span class="notranslate">Galaxy</span> Project. Firstly, we need to install the role and then write a playbook for using it.</p>

<p>If the terms ‚ÄúAnsible‚Äù, ‚Äúrole‚Äù and ‚Äúplaybook‚Äù mean nothing to you, please checkout <a href="/training-material/topics/admin/tutorials/ansible/slides.html">the Ansible introduction slides</a> and <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html">the Ansible introduction tutorial</a></p>

<blockquote class="tip">
  <h3 id="tip-tip-running-ansible-on-your-remote-machine"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Running Ansible on your remote machine</h3>
  <p>It is possible to have ansible installed on the remote machine and run it there, not just from your local machine connecting to the remote machine.</p>

  <p>Your hosts file will need to use <code class="language-plaintext highlighter-rouge">localhost</code>,  and whenever you run playbooks with <code class="language-plaintext highlighter-rouge">ansible-playbook -i hosts playbook.yml</code>, you will need to add <code class="language-plaintext highlighter-rouge">-c local</code> to your command.</p>

  <p>Be <strong>certain</strong> that the playbook that you‚Äôre writing on the remote machine is stored somewhere safe, like your user home directory, or backed up on your local machine. The cloud can be unreliable and things can disappear at any time.</p>
</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-cvmfs-with-ansible"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing CVMFS with Ansible</h3>

  <ol>
    <li>
      <p>In your working directory, add the CVMFS role to your <code class="language-plaintext highlighter-rouge">requirements.yml</code></p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s"><span class="notranslate">galaxy</span>project.cvmfs</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">0.2.13</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Install the requirements with <code class="language-plaintext highlighter-rouge">ansible-<span class="notranslate">galaxy</span></code>:</p>

      <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ansible-<span class="notranslate">galaxy</span> role install -p roles -r requirements.yml
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Edit the group variables file, <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <p><br /></p>

      <p>The variables available in this role are:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">cvmfs_role</code></td>
            <td>string</td>
            <td>Type of CVMFS host: <code class="language-plaintext highlighter-rouge">client</code>, <code class="language-plaintext highlighter-rouge">stratum0</code>, <code class="language-plaintext highlighter-rouge">stratum1</code>, or <code class="language-plaintext highlighter-rouge">localproxy</code>. Controls what packages are installed and what configuration is performed.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">cvmfs_keys</code></td>
            <td>list of dicts</td>
            <td>Keys to install on hosts of all types.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">cvmfs_server_urls</code></td>
            <td>list of dicts</td>
            <td>CVMFS server URLs, the value of <code class="language-plaintext highlighter-rouge">CVMFS_SERVER_URL</code> in <code class="language-plaintext highlighter-rouge">/etc/cvmfs/domain.d/&lt;domain&gt;.conf</code>.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">cvmfs_repositories</code></td>
            <td>list of dicts</td>
            <td>CVMFS repository configurations, <code class="language-plaintext highlighter-rouge">CVMFS_REPOSITORIES</code> in <code class="language-plaintext highlighter-rouge">/etc/cvmfs/default.local</code> plus additional settings in <code class="language-plaintext highlighter-rouge">/etc/cvmfs/repositories.d/&lt;repository&gt;/{client,server}.conf</code>.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">cvmfs_quota_limit</code></td>
            <td>integer in MB</td>
            <td>Size of CVMFS client cache. Default is <code class="language-plaintext highlighter-rouge">4000</code>.</td>
          </tr>
        </tbody>
      </table>

      <p><br /></p>

      <p>But, luckily for us, the <span class="notranslate">Galaxy</span> Project CVMFS role has a lot of defaults for these variables which we can use by just setting <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_cvmfs_repos_enabled</code> to <code class="language-plaintext highlighter-rouge">config-repo</code>. We will also set the <code class="language-plaintext highlighter-rouge">cvmfs_quota_limit</code> to something sensible (500MB) as we have relatively small disks on our instances. In a production setup, you should size this appropriately for the client.</p>

      <p><br /></p>

      <p>Add the following lines to your <code class="language-plaintext highlighter-rouge">group_vars/all.yml</code> file, creating it if it doesn‚Äôt exist:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CVMFS vars</span>
<span class="na">cvmfs_role</span><span class="pi">:</span> <span class="s">client</span>
<span class="na"><span class="notranslate">galaxy</span>_cvmfs_repos_enabled</span><span class="pi">:</span> <span class="s">config-repo</span>
<span class="na">cvmfs_quota_limit</span><span class="pi">:</span> <span class="m">500</span>
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-why-allyml"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Why all.yml?</h3>
        <p>We‚Äôve integrated the cvmfs and pulsar tutorials better, such that CVMFS will be used for Pulsar as well, this configuration will be needed on all of our machines. This mirrors real life where you want CVMFS on every node that does computation.</p>
      </blockquote>
    </li>
    <li>
      <p>Add the new role to the list of roles under the <code class="language-plaintext highlighter-rouge">roles</code> key in your playbook, <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>:</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s"><span class="notranslate">galaxy</span>servers</span>
  <span class="na">become</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="c1"># ... existing roles ...</span>
    <span class="pi">-</span> <span class="s"><span class="notranslate">galaxy</span>project.cvmfs</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<p>Congratulations, you‚Äôve set up CVMFS.</p>

<h2 id="exploring-the-cvmfs-installation">Exploring the CVMFS Installation</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-exploring-cvmfs"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Exploring CVMFS</h3>

  <ol>
    <li>
      <p>SSH into your machine</p>
    </li>
    <li>
      <p>Change directory into <code class="language-plaintext highlighter-rouge">/cvmfs/</code> and list the files in that folder</p>

      <blockquote class="question">
        <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>You should see nothing, as CVMFS uses <code class="language-plaintext highlighter-rouge">autofs</code> in order to mount paths only upon request. Once you <code class="language-plaintext highlighter-rouge">cd</code> into the directory, autofs will automatically mount the repository and files will be listed.</p>

        </blockquote>

      </blockquote>
    </li>
    <li>
      <p>Change directory into <code class="language-plaintext highlighter-rouge">/cvmfs/data.<span class="notranslate">galaxy</span>project.org/</code>. Have a browse through the contents. You‚Äôll see <code class="language-plaintext highlighter-rouge">.loc</code> files, genomes and indices.</p>

      <p>And just like that we all have access to all the reference genomes and associated tool indices thanks to the <span class="notranslate">Galaxy</span> Project‚Äôs and mostly Nate‚Äôs hard work!</p>
    </li>
  </ol>

</blockquote>

<h2 id="configuring-galaxy-to-use-the-cvmfs-references">Configuring <span class="notranslate">Galaxy</span> to use the CVMFS references.</h2>

<p>Now that we have mounted the CVMFS repository we need to tell <span class="notranslate">Galaxy</span> how to find it and use it.</p>

<p>There are two primary directories in the reference data repository:</p>

<table>
  <thead>
    <tr>
      <th>Directory</th>
      <th>Contents</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/managed</code></td>
      <td>Data generated with <span class="notranslate">Galaxy</span> Data Managers, organized by data table (index format), then by genome build.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/byhand</code></td>
      <td>Data generated prior to the existence/use of Data Managers, manually curated. (For legacy reasons, this directory is shared as <code class="language-plaintext highlighter-rouge">/indexes</code> on the HTTP and rsync servers.)</td>
    </tr>
  </tbody>
</table>

<p>These directories have somewhat different structures:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/managed</code> is organized by index type, then by genome build (<span class="notranslate">Galaxy</span> dbkey)</li>
  <li><code class="language-plaintext highlighter-rouge">/byhand</code> is organzied by genome build, then by index type</li>
</ul>

<p>Both directories contain a location subdirectory, and each of these contain a <code class="language-plaintext highlighter-rouge">tool_data_table_conf.xml</code> file:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/managed/location/tool_data_table_conf.xml</code></li>
  <li><code class="language-plaintext highlighter-rouge">/byhand/location/tool_data_table_conf.xml</code></li>
</ul>

<p><span class="notranslate">Galaxy</span> consumes these <code class="language-plaintext highlighter-rouge">tool_data_table_conf.xml</code> files and the <code class="language-plaintext highlighter-rouge">.loc</code> ‚Äúlocation‚Äù files they reference. The paths contained in these files are valid if the data is mounted via CVMFS.</p>

<p>Examples of data include:</p>

<ul>
  <li>twoBit (<code class="language-plaintext highlighter-rouge">.2bit</code>) and FASTA (<code class="language-plaintext highlighter-rouge">.fa</code>) sequence files</li>
  <li>Bowtie 2 and BWA indexes</li>
  <li>Mutation Annotation Format (<code class="language-plaintext highlighter-rouge">.maf</code>) files</li>
  <li>SAMTools FASTA indexes (<code class="language-plaintext highlighter-rouge">.fai</code>)</li>
</ul>

<p>Now all we need to do is tell <span class="notranslate">Galaxy</span> how to find it! This tutorial assumes that you have run the tutorial in the requirements, <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><span class="notranslate">Galaxy</span> Installation with Ansible</a>. The hands-on below will use the <span class="notranslate">Galaxy</span> Project Ansible role to configure everything.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-configuring-galaxy-to-use-cvmfs"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Configuring <span class="notranslate">Galaxy</span> to use CVMFS</h3>

  <ol>
    <li>
      <p>Edit the <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file and add a <code class="language-plaintext highlighter-rouge">tool_data_table_config_path</code> entry under the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code> key of the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> section in the <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file. This new entry should be a list containing the paths to both <code class="language-plaintext highlighter-rouge">tool_data_table_conf.xml</code> files referenced above.</p>

      <blockquote class="question">
        <h3 id="question-question-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>How does your final configuration look?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config</span><span class="pi">:</span>
  <span class="na"><span class="notranslate">galaxy</span></span><span class="pi">:</span>
    <span class="c1"># ... existing configuration options in the `<span class="notranslate">galaxy</span>` section ...</span>
    <span class="na">tool_data_table_config_path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/cvmfs/data.<span class="notranslate">galaxy</span>project.org/byhand/location/tool_data_table_conf.xml</span>
      <span class="pi">-</span> <span class="s">/cvmfs/data.<span class="notranslate">galaxy</span>project.org/managed/location/tool_data_table_conf.xml</span>
</code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
    <li>
      <p>Re-run the playbook (<code class="language-plaintext highlighter-rouge">ansible-playbook <span class="notranslate">galaxy</span>.yml</code>)</p>
    </li>
    <li>
      <p>In your <span class="notranslate">Galaxy</span> interface, open the <strong>BWA</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>, <strong>BWA-MEM</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> or <strong>Bowtie2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool interface (whichever you may have installed). Now check that there are a lot more Genomes available for use!</p>

      <p><img src="../../images/available_genomes.png" alt="available_genomes.png" /></p>
    </li>
    <li>
      <p>Login to <span class="notranslate">Galaxy</span> as the admin user, and go to <strong>Admin ‚Üí Data Tables ‚Üí bwa_mem indexes</strong></p>

      <p><img src="../../images/bwa_mem_indices.png" alt="bwa_mem_indices.png" /></p>
    </li>
  </ol>

</blockquote>

<h1 id="other-aspects">Other Aspects</h1>

<h2 id="development">Development</h2>

<p>If you are developing a new tool, and want to add a reference genome, we recommend you <a href="https://gitter.im/galaxy-iuc/iuc">talk to us on Gitter</a>. You can also look at one of the tools that uses reference data, and try and copy from that. If you‚Äôre developing the location files completely new, you need to write the data manager.</p>

<h2 id="automation">Automation</h2>

<p>You can automate the process of installing and setting up data managers and data with ephemeris. We‚Äôre working in the <a href="https://github.com/galaxyproject/idc">IDC</a> to democratise this CVMFS repository, and make this a community-controlled resource. You can also look here for ideas on automating your data management.</p>

<h2 id="access-control">Access Control</h2>

<p>It is not easily possible to filter access to reference data depending on the user‚Äôs role or group.</p>

<p>You could set up a tool per user/group, <a href="https://galaxyproject.org/admin/config/access-control/">secure access to running this tool</a>, and then allow this private tool to access a private tool data table. But you will not get tool updates, you will have to copy and edit this tool every time it gets updated. Or write more advanced job control rules to reject specific jobs which use specific datasets.</p>

<h2 id="proxying-recap">Proxying Recap</h2>

<p>The client talks directly to the stratum 1 (or to a proxy), and manages the data, and exposes it to the user. The proxy stores an opaque cache, that can‚Äôt really be used, except as a proxy to a stratum 1.</p>

<h2 id="plant-data">Plant Data</h2>

<p>If you are working with plants, you can find separate reference data here: <a href="https://github.com/frederikcoppens/galaxy_data_management">frederikcoppens/<span class="notranslate">galaxy</span>_data_management</a></p>


                    

                    

                    

                    <h1>Feedback</h1>
                    <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                    <div id="feedback-button">
                        <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                    </div>
                    <div id="feedback-form">
                    </div>
                    <script type="text/javascript">
                        (function (window, document) {
                            function onDocumentReady(fn) {
                                if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                    fn();
                                } else {
                                    document.addEventListener('DOMContentLoaded', fn);
                                }
                            }

                            onDocumentReady(function () {
                                $("#feedback-button").click(function(evt){
                                    var e = $(evt.target)
                                    e.hide();

                                    $("#feedback-form").html(`
                                        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Reference Data with CVMFS (Galaxy Server administration)">Loading...</iframe>
                                    `)
                                })
                            });
                        })(window, document);
                    </script>



                    <h1>Citing this Tutorial</h1>
                    <p>
                        <ol>
                            <li id="citation-text">Simon Gladman, Helena Rasche, 2021 <b>Reference Data with CVMFS (Galaxy Training Materials)</b>. <a href="/training-material/topics/admin/tutorials/cvmfs/tutorial.html">/training-material/topics/admin/tutorials/cvmfs/tutorial.html</a> Online; accessed TODAY
                            </li>
                            <li>
                            Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                            </li>
                        </ol>
                    </p>


                    <blockquote class="details">
                      <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                      <p style="display: none;">

                    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{admin-cvmfs,
    author = "Simon Gladman and Helena Rasche",
    title = "Reference Data with CVMFS (Galaxy Training Materials)",
    year = "2021",
    month = "01",
    day = "06"
    url = "\url{/training-material/topics/admin/tutorials/cvmfs/tutorial.html}",
    note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
        doi = {10.1016/j.cels.2018.05.012},
        url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
        year = 2018,
        month = {jun},
        publisher = {Elsevier {BV}},
        volume = {6},
        number = {6},
        pages = {752--758.e1},
        author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
        title = {Community-Driven Data Analysis Training for Biology},
        journal = {Cell Systems}
}</code>
                    </pre></div></div>
                    </p>
                    </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                </div>
            </div>
        </div>

        <h3><i class="far fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Simon Gladman, Helena Rasche)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/admin/tutorials/cvmfs/tutorial.md">GitHub</a>.
        </p>
        <p>
    The content of the tutorials and website is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
