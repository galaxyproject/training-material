<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>16S Microbial Analysis with mothur (extended)</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Metagenomics is a discipline that enables the genomic stu..." />
        <meta property="og:title" content="Galaxy Training: 16S Microbial Analysis with mothur (extended)" />
        <meta property="og:description" content="Metagenomics is a discipline that enables the genomic stu..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<!-- Gitter -->


<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'Galaxy-Training-Network/Lobby'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/metagenomics" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">topic</span> Metagenomics
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Language Selector">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Language
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                Fran√ßais
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                Êó•Êú¨Ë™û
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                Espa√±ol
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                Portugu√™s
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fmetagenomics%2Ftutorials%2Fmothur-miseq-sop%2Ftutorial.html&edit-text=&act=url" title="">
                                And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>

        <div class="dropdown-item">
            <div>
                Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
            </div>

        </div>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.md">
                            <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "16S Microbial Analysis with mothur (extended)",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Metagenomics",
    "description": "Metagenomics is a discipline that enables the genomic study of uncultured microorganisms",
    "url": "https://training.galaxyproject.org//training-material/topics/metagenomics/"
  },
  "courseCode": "metagenomics / mothur-miseq-sop / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for '16S Microbial Analysis with mothur (extended)' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.html",
  "timeRequired": "PT6H",
  "description": "The questions this  addresses are:\n - What is the effect of normal variation in the gut microbiome on host health?\n\n\\nThe objectives are:\n - Analyze of 16S rRNA sequencing data using the mothur toolsuite in Galaxy\n - Using a mock community to assess the error rate of your sequencing experiment\n - Visualize sample diversity using Krona and Phinch\n\n",
  "coursePrerequisites": [
    {
      "@type": "CreativeWork",
      "url": "https://training.galaxyproject.org//training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    },
    {
      "@type": "Person",
      "name": "B√©r√©nice Batut"
    },
    {
      "@type": "Person",
      "name": "Dave Clements"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    },
    {
      "@type": "Person",
      "name": "B√©r√©nice Batut"
    },
    {
      "@type": "Person",
      "name": "Dave Clements"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Metagenomics",
      "description": "Metagenomics is a discipline that enables the genomic study of uncultured microorganisms",
      "url": "https://training.galaxyproject.org//training-material/topics/metagenomics/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/topic_3174",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "topic_3174",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_3174"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>16S Microbial Analysis with mothur (extended)</h1>
        

        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame/shiltemann/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/shiltemann" alt="Saskia Hiltemann">Saskia Hiltemann</a>, <a href="/training-material/hall-of-fame/bebatut/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/bebatut" alt="B√©r√©nice Batut">B√©r√©nice Batut</a>, <a href="/training-material/hall-of-fame/tnabtaf/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/tnabtaf" alt="Dave Clements">Dave Clements</a>

</div>

        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li><p>What is the effect of normal variation in the gut microbiome on host health?</p>
</li>
            
            </ul>

            <strong><i class="fas fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li><p>Analyze of 16S rRNA sequencing data using the mothur toolsuite in Galaxy</p>
</li>
            
            <li><p>Using a mock community to assess the error rate of your sequencing experiment</p>
</li>
            
            <li><p>Visualize sample diversity using Krona and Phinch</p>
</li>
            
            </ul>

            
            <strong><i class="fas fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

            
            </ul>
            

            
            <p><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 6 hours</p>
            

            

            
            

            
            <p id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></p>
            <ul>
                <div class="supporting_material">
                
                    <li class="btn btn-default supporting_material"><a href="/training-material/topics/metagenomics/slides/introduction.html" title="Topic Overview slides">
                        <i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Topic Overview slides
                    </a></li>
                

                
                    <li class="btn btn-default supporting_material">
<a class="topic-icon" href="https://doi.org/10.5281/zenodo.800651">
    <i class="far fa-copy" aria-hidden="true"></i><span class="visually-hidden">zenodo_link</span> Datasets
</a>

</li>
                

                
                    <li class="btn btn-default supporting_material">
    <a class="topic-icon" href="/training-material/topics/metagenomics/tutorials/mothur-miseq-sop/workflows/" title="Workflows" alt="16S Microbial Analysis with mothur (extended) workflows">
        <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> Workflows
    </a>

</li>
                

                
                    <li class="btn btn-default supporting_material">
<a class="topic-icon" href="https://github.com/galaxyproject/training-material/tree/master/topics/metagenomics/tutorials/mothur-miseq-sop/tours/">
    <i class="fas fa-magic" aria-hidden="true"></i><span class="visually-hidden">interactive_tour</span> Tours
</a>

</li>
                

                
                    <li class="btn btn-default supporting_material">

    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span> Available on these Galaxies
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/metagenomics/docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://africa.usegalaxy.eu/" title="Galaxy Africa">
            Galaxy Africa
        </a>
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://ecology.usegalaxy.eu/" title="Galaxy for Ecology">
            Galaxy for Ecology
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://galaxy.genouest.org" title="Galaxy@GenOuest">
            Galaxy@GenOuest
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.eu" title="UseGalaxy.eu">
            UseGalaxy.eu
        </a>
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.fr/" title="UseGalaxy.fr">
            UseGalaxy.fr
        </a>
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.no/" title="UseGalaxy.no">
            UseGalaxy.no
        </a>
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.org" title="UseGalaxy.org (Main)">
            UseGalaxy.org (Main)
        </a>
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.org.au" title="UseGalaxy.org.au">
            UseGalaxy.org.au
        </a>
        
    
        
    
    </ul>


</li>
                
                </div>
            </ul>
            

            <p><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Jan 6, 2021 </p>
        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    
<h1 class="no_toc" id="overview">Overview</h1>

<p>In this tutorial we will perform an analysis based on the
<a href="https://www.mothur.org/wiki/MiSeq_SOP">Standard Operating Procedure (SOP) for MiSeq data</a>, developed by the <a href="http://www.schlosslab.org/">Schloss lab</a>, the creators of the mothur software package <a class="citation" href="#Schloss2009">Schloss <i>et al.</i> 2009</a>.</p>

<blockquote class="comment">
  <h3 id="comment-note-two-versions-of-this-tutorial"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note: Two versions of this tutorial</h3>

  <p>Because this tutorial consists of many steps, we have made two versions of it, one long and one short.</p>

  <p>This is the <strong>extended version</strong>. We will run every tool manually and discuss the results in detail.
If you would like to run through the tutorial a bit quicker and use workflows to run groups of
analysis steps (e.g. data cleaning) at once, please see the <a href="/training-material/topics/metagenomics/tutorials/mothur-miseq-sop-short/tutorial.html">shorter version of this tutorial</a></p>

  <p>You can also <strong>switch</strong> between the long and short version at the start of any section.</p>
</blockquote>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will cover:</p>

<ol id="markdown-toc">
  <li><a href="#obtaining-and-preparing-data" id="markdown-toc-obtaining-and-preparing-data">Obtaining and preparing data</a>    <ol>
      <li><a href="#understanding-our-input-data" id="markdown-toc-understanding-our-input-data">Understanding our input data</a></li>
      <li><a href="#importing-the-data-into-galaxy" id="markdown-toc-importing-the-data-into-galaxy">Importing the data into <span class="notranslate">Galaxy</span></a></li>
    </ol>
  </li>
  <li><a href="#quality-control" id="markdown-toc-quality-control">Quality Control</a>    <ol>
      <li><a href="#create-contigs-from-paired-end-reads" id="markdown-toc-create-contigs-from-paired-end-reads">Create contigs from paired-end <span class="notranslate">reads</span></a></li>
      <li><a href="#data-cleaning" id="markdown-toc-data-cleaning">Data Cleaning</a></li>
      <li><a href="#optimize-files-for-computation" id="markdown-toc-optimize-files-for-computation">Optimize files for computation</a></li>
    </ol>
  </li>
  <li><a href="#sequence-alignment" id="markdown-toc-sequence-alignment">Sequence Alignment</a>    <ol>
      <li><a href="#more-data-cleaning" id="markdown-toc-more-data-cleaning">More Data Cleaning</a></li>
      <li><a href="#chimera-removal" id="markdown-toc-chimera-removal">Chimera Removal</a></li>
    </ol>
  </li>
  <li><a href="#taxonomic-classification" id="markdown-toc-taxonomic-classification">Taxonomic Classification</a>    <ol>
      <li><a href="#removal-of-non-bacterial-sequences" id="markdown-toc-removal-of-non-bacterial-sequences">Removal of non-bacterial sequences</a></li>
    </ol>
  </li>
  <li><a href="#optional-calculate-error-rates-based-on-our-mock-community" id="markdown-toc-optional-calculate-error-rates-based-on-our-mock-community">Optional: Calculate error rates based on our mock community</a></li>
  <li><a href="#otu-clustering" id="markdown-toc-otu-clustering">OTU Clustering</a></li>
  <li><a href="#diversity-analysis" id="markdown-toc-diversity-analysis">Diversity Analysis</a>    <ol>
      <li><a href="#alpha-diversity" id="markdown-toc-alpha-diversity">Alpha diversity</a></li>
      <li><a href="#beta-diversity" id="markdown-toc-beta-diversity">Beta diversity</a></li>
    </ol>
  </li>
  <li><a href="#visualisations" id="markdown-toc-visualisations">Visualisations</a>    <ol>
      <li><a href="#krona" id="markdown-toc-krona">Krona</a></li>
      <li><a href="#phinch" id="markdown-toc-phinch">Phinch</a></li>
    </ol>
  </li>
</ol>

</blockquote>

<blockquote class="comment">
  <h3 id="comment-note-results-may-vary"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note: results may vary</h3>

  <p>Your results may be slightly different from the ones presented in this tutorial
due to differing versions of tools, reference data, exte<span class="notranslate">rna</span>l databases, or
because of stochastic processes in the algorithms.</p>

</blockquote>

<h1 id="obtaining-and-preparing-data">Obtaining and preparing data</h1>

<p>In this tutorial we use 16S r<span class="notranslate">RNA</span> data, but similar pipelines can be used for WGS data.</p>

<blockquote class="comment">
  <h3 id="comment-background-the-16s-ribosomal-rna-gene"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: The 16S ribosomal <span class="notranslate">RNA</span> gene</h3>
  <p><img src="../../images/16S_gene.png" alt="The 16S ribosomal RNA gene" /> <br /><br /></p>

  <p>The 16S r<span class="notranslate">RNA</span> gene has several properties that make it ideally suited for our purposes</p>

  <ol>
    <li>Present in all prokaryotes</li>
    <li>Highly conserved + highly variable regions</li>
    <li>Huge reference databases</li>
  </ol>

  <p><img src="../../images/16S_variableregions.jpg" alt="16S Variable regions" /></p>

  <p>The highly conserved regions make it easy to target the gene across different organisms,
while the highly variable regions allow us to distinguish between different species.</p>

  <p>(slide credit <a href="https://www.slideshare.net/beiko/ccbc-tutorial-beiko">https://www.slideshare.net/beiko/ccbc-tutorial-beiko</a>)</p>
</blockquote>

<h2 id="understanding-our-input-data">Understanding our input data</h2>

<p>In this tutorial we use the <a href="https://mothur.org/wiki/Analysis_examples">dataset generated by the Schloss lab</a> to illustrate
<a href="https://www.mothur.org/wiki/MiSeq_SOP">their MiSeq SOP</a>.</p>

<p>They <a href="https://www.mothur.org/wiki/MiSeq_SOP#Logistics">describe the experiment</a> as follows:</p>

<p><em>‚ÄúThe Schloss lab is interested in understanding the effect of normal variation in the gut microbiome on host health. To that end,
we collected fresh feces from mice on a daily basis for 365 days post weaning. During the first 150 days post weaning (dpw),
nothing was done to our mice except allow them to eat, get fat, and be merry. We were curious whether the rapid change in
weight observed during the first 10 dpw affected the stability microbiome compared to the microbiome observed between days
140 and 150.‚Äù</em></p>

<p><img src="../../images/experiment_setup.png" alt="Experiment setup" /></p>

<p>To speed up analysis for this tutorial, we will use only a subset of this data. We will look at a single mouse at 10 different
time points (5 early, 5 late). In order to assess the error rate of the analysis pipeline and experimental setup, the Schloss lab
additionally sequenced a mock community with a known composition (genomic <span class="notranslate">DNA</span> from 21 bacterial strains). The sequences used
for this mock sample are contained in the file <code class="language-plaintext highlighter-rouge">HMP_MOCK.v35.fasta</code></p>

<blockquote class="comment">
  <h3 id="comment-dataset-naming-scheme"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Dataset naming scheme</h3>
  <p>For this tutorial, you are given 10 pairs of files. For example, the following pair of files:<br />
 <code class="language-plaintext highlighter-rouge">F3D0_S188_L001_R1_001.fastq</code><br />
 <code class="language-plaintext highlighter-rouge">F3D0_S188_L001_R2_001.fastq</code></p>

  <p>The first part of the file name indicates the sample; <code class="language-plaintext highlighter-rouge">F3D0</code> here signifies that this sample was obtained from Female 3 on Day 0.
The rest of the file name is identical, except for <code class="language-plaintext highlighter-rouge">_R1</code> and <code class="language-plaintext highlighter-rouge">_R2</code>, this is used to indicate the forward and reverse <span class="notranslate">reads</span>
respectively.</p>
</blockquote>

<!-- note: mothur does not include day 4 in their SOP example data, therefore this description and results
in this document differ slightly from the description on their website -->

<h2 id="importing-the-data-into-galaxy">Importing the data into <span class="notranslate">Galaxy</span></h2>

<p>Now that we know what our input data is, let‚Äôs get it into our <span class="notranslate">Galaxy</span> history:</p>

<p>All data required for this tutorial has been made available from Zenodo <a href="https://doi.org/10.5281/zenodo.800651"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.800651.svg" alt="DOI" /></a></p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-obtaining-our-data"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Obtaining our data</h3>

  <ol>
    <li>
      <p>Make sure you have an empty analysis history. Give it a name.</p>

      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-history"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new history</h3>

        <p>Click the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel</p>

        <p>If the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>
        <ol>
          <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>
          <li>Select the option <strong>Create New</strong> from the menu</li>
        </ol>
      </blockquote>
    </li>
    <li><strong>Import Sample Data.</strong>
      <ul>
        <li>Import the sample FASTQ files to your history, either from a shared data library (if available), or from Zenodo
using the URLs listed in the box below (click <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> to expand):</li>
      </ul>

      <blockquote class="solution">
        <h3 id="solution-list-of-zenodo-urls"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> List of Zenodo URLs</h3>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/800651/files/F3D0_R1.fastq
https://zenodo.org/record/800651/files/F3D0_R2.fastq
https://zenodo.org/record/800651/files/F3D141_R1.fastq
https://zenodo.org/record/800651/files/F3D141_R2.fastq
https://zenodo.org/record/800651/files/F3D142_R1.fastq
https://zenodo.org/record/800651/files/F3D142_R2.fastq
https://zenodo.org/record/800651/files/F3D143_R1.fastq
https://zenodo.org/record/800651/files/F3D143_R2.fastq
https://zenodo.org/record/800651/files/F3D144_R1.fastq
https://zenodo.org/record/800651/files/F3D144_R2.fastq
https://zenodo.org/record/800651/files/F3D145_R1.fastq
https://zenodo.org/record/800651/files/F3D145_R2.fastq
https://zenodo.org/record/800651/files/F3D146_R1.fastq
https://zenodo.org/record/800651/files/F3D146_R2.fastq
https://zenodo.org/record/800651/files/F3D147_R1.fastq
https://zenodo.org/record/800651/files/F3D147_R2.fastq
https://zenodo.org/record/800651/files/F3D148_R1.fastq
https://zenodo.org/record/800651/files/F3D148_R2.fastq
https://zenodo.org/record/800651/files/F3D149_R1.fastq
https://zenodo.org/record/800651/files/F3D149_R2.fastq
https://zenodo.org/record/800651/files/F3D150_R1.fastq
https://zenodo.org/record/800651/files/F3D150_R2.fastq
https://zenodo.org/record/800651/files/F3D1_R1.fastq
https://zenodo.org/record/800651/files/F3D1_R2.fastq
https://zenodo.org/record/800651/files/F3D2_R1.fastq
https://zenodo.org/record/800651/files/F3D2_R2.fastq
https://zenodo.org/record/800651/files/F3D3_R1.fastq
https://zenodo.org/record/800651/files/F3D3_R2.fastq
https://zenodo.org/record/800651/files/F3D5_R1.fastq
https://zenodo.org/record/800651/files/F3D5_R2.fastq
https://zenodo.org/record/800651/files/F3D6_R1.fastq
https://zenodo.org/record/800651/files/F3D6_R2.fastq
https://zenodo.org/record/800651/files/F3D7_R1.fastq
https://zenodo.org/record/800651/files/F3D7_R2.fastq
https://zenodo.org/record/800651/files/F3D8_R1.fastq
https://zenodo.org/record/800651/files/F3D8_R2.fastq
https://zenodo.org/record/800651/files/F3D9_R1.fastq
https://zenodo.org/record/800651/files/F3D9_R2.fastq
https://zenodo.org/record/800651/files/Mock_R1.fastq
https://zenodo.org/record/800651/files/Mock_R2.fastq
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-via-links"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data via links</h3>

        <ul>
          <li>Copy the link location</li>
          <li>
            <p>Open the <span class="notranslate">Galaxy</span> Upload Manager (<i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-upload</span> on the top-right of the tool panel)</p>
          </li>
          <li>Select <strong>Paste/Fetch Data</strong></li>
          <li>
            <p>Paste the link into the text field</p>
          </li>
          <li>
            <p>Press <strong>Start</strong></p>
          </li>
          <li><strong>Close</strong> the window</li>
        </ul>

        <p>By default, <span class="notranslate">Galaxy</span> uses the URL as the name, so rename the files with a more useful name.</p>

      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-from-a-data-library"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data from a data library</h3>

        <p>As an alte<span class="notranslate">rna</span>tive to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>

        <ul>
          <li>
            <p>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></p>
          </li>
          <li>
            <p>Find the correct folder (ask your instructor)</p>
          </li>
          <li>Select the desired files</li>
          <li>Click on the <strong>To History</strong> button near the top and select <strong>as Datasets</strong> from the dropdown menu</li>
          <li>In the pop-up window, select the history you want to import the files to (or create a new one)</li>
          <li>Click on <strong>Import</strong></li>
        </ul>
      </blockquote>
    </li>
    <li><strong>Import Reference Data</strong>
      <ul>
        <li>Import the following reference datasets
          <ul>
            <li><code class="language-plaintext highlighter-rouge">silva.v4.fasta</code></li>
            <li><code class="language-plaintext highlighter-rouge">HMP_MOCK.v35.fasta</code></li>
            <li><code class="language-plaintext highlighter-rouge">trainset9_032012.pds.fasta</code></li>
            <li><code class="language-plaintext highlighter-rouge">trainset9_032012.pds.tax</code></li>
          </ul>
        </li>
      </ul>

      <blockquote class="solution">
        <h3 id="solution-list-of-zenodo-urls-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> List of Zenodo URLs</h3>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/800651/files/HMP_MOCK.v35.fasta
https://zenodo.org/record/800651/files/silva.v4.fasta
https://zenodo.org/record/800651/files/trainset9_032012.pds.fasta
https://zenodo.org/record/800651/files/trainset9_032012.pds.tax
https://zenodo.org/record/800651/files/mouse.dpw.metadata
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>
</blockquote>

<p>Now that‚Äôs a lot of files to manage. Luckily <span class="notranslate">Galaxy</span> can make life a bit easier by allowing us to create
<strong>dataset collections</strong>. This enables us to easily run tools on multiple datasets at once.</p>

<p>Since we have <strong>paired-end</strong> data, each sample consist of two separate fastq files, one containing the
forward <span class="notranslate">reads</span>, and one containing the reverse <span class="notranslate">reads</span>. We can recognize the pairing from the file names,
which will differ only by <code class="language-plaintext highlighter-rouge">_R1</code> or <code class="language-plaintext highlighter-rouge">_R2</code> in the filename. We can tell <span class="notranslate">Galaxy</span> about this paired naming
convention, so that our tools will know which files belong together. We do this by building a <strong>List of Dataset Pairs</strong></p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-organizing-our-data-into-a-paired-collection"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Organizing our data into a paired collection</h3>

  <ol>
    <li>
      <p>Click on the <strong>checkmark icon</strong> <i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">param-check</span> at top of your history.</p>
    </li>
    <li>Select all the FASTQ files (40 in total)
      <ul>
        <li><strong>Tip:</strong> type <code class="language-plaintext highlighter-rouge">fastq</code> in the search bar at the top of your history to filter only the FASTQ files; you can now use the <code class="language-plaintext highlighter-rouge">All</code> button at the top instead of having to individually select all 40 input files.</li>
        <li>Click on <strong>for all selected..</strong></li>
        <li>Select <strong>Build List of Dataset Pairs</strong> from the dropdown menu</li>
      </ul>

      <p>In the next dialog window you can create the list of pairs. By default <span class="notranslate">Galaxy</span> will look for pairs
of files that differ only by a <code class="language-plaintext highlighter-rouge">_1</code> and <code class="language-plaintext highlighter-rouge">_2</code> part in their names. In our case however, these
should be <code class="language-plaintext highlighter-rouge">_R1</code> and <code class="language-plaintext highlighter-rouge">_R2</code>.</p>
    </li>
    <li>Change these values accordingly
      <ul>
        <li>Change <code class="language-plaintext highlighter-rouge">_1</code> to <code class="language-plaintext highlighter-rouge">_R1</code> in the text field on the top left</li>
        <li>Change <code class="language-plaintext highlighter-rouge">_2</code> to <code class="language-plaintext highlighter-rouge">_R2</code> om the text field on the top right</li>
      </ul>

      <p>You should now see a list of pairs suggested by <span class="notranslate">Galaxy</span>:
<img src="../../images/create_collection.png" alt="List of suggested paired datasets" /> <br /><br /></p>
    </li>
    <li>
      <p>Click on <strong>auto-pair</strong> to create the suggested pairs.</p>

      <p><img src="../../images/create_collection2.png" alt="The result of pairing" /> <br /><br /></p>
    </li>
    <li><strong>Name the pairs</strong>
      <ul>
        <li>The middle segment is the name for each pair.</li>
        <li>These names will be used as sample names in the <span class="notranslate">downstream</span> analysis, so always make sure they are informative!</li>
        <li><strong>Check</strong> that the pairs are named <code class="language-plaintext highlighter-rouge">F3D0</code>-<code class="language-plaintext highlighter-rouge">F3D9</code>, <code class="language-plaintext highlighter-rouge">F3D141</code>-<code class="language-plaintext highlighter-rouge">F3D150</code> and <code class="language-plaintext highlighter-rouge">Mock</code>.
          <ul>
            <li>If needed, the names can be edited by clicking on them</li>
            <li><strong>Important:</strong> On older <span class="notranslate">Galaxy</span> versions, if the files were imported via URL, they may have the full URL as sample name;
please remove everything except the sample name for each pair!</li>
          </ul>
        </li>
      </ul>
    </li>
    <li><strong>Name your collection</strong> at the bottom right of the screen</li>
    <li>Click the <strong>Create List</strong> button. A new dataset collection item will now appear in your history</li>
  </ol>
</blockquote>

<h1 id="quality-control">Quality Control</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#quality-control"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<p>For more information on the topic of quality control, please see our training materials
<a href="/training-material/topics/sequence-analysis/">here</a>.</p>

<p>Before starting any analysis, it is always a good idea to assess the quality of your input data and improve it
where possible by trimming and filtering <span class="notranslate">reads</span>. The mothur toolsuite contains several tools to assist with this task.
We will begin by merging our <span class="notranslate">reads</span> into contigs, followed by filtering and trimming of <span class="notranslate">reads</span> based on quality score
and several other metrics.</p>

<h2 id="create-contigs-from-paired-end-reads">Create contigs from paired-end <span class="notranslate">reads</span></h2>

<p>In this experiment, paired-end sequencing of the ~253 bp V4 region of the 16S r<span class="notranslate">RNA</span> gene was performed.
The sequencing was done from either end of each fragment. Because the <span class="notranslate">reads</span> are about 250 bp in length, this results in a
significant overlap between the forward and reverse <span class="notranslate">reads</span> in each pair. We will combine these pairs of <span class="notranslate">reads</span> into <em>contigs</em>.</p>

<p><img src="../../images/16S_merge_contigs.png" alt="Merging into contigs" /></p>

<p>The <strong>Make.contigs</strong> tool creates the contigs, and uses the paired collection as input. <strong>Make.contigs</strong>
will look at each pair, take the reverse complement reverse read, and then determine the overlap between the
two sequences. Where an overlapping base call differs between the two <span class="notranslate">reads</span>, the quality score is used to determine
the consensus base call. A new quality score is derived by combining the two original quality scores in both of
the <span class="notranslate">reads</span> for all the overlapping positions.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-combine-forward-and-reverse-reads-into-contigs"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Combine forward and reverse <span class="notranslate">reads</span> into contigs</h3>

  <ul>
    <li><strong>Make.contigs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>‚ÄúWay to provide files‚Äù</em>: <code class="language-plaintext highlighter-rouge">Multiple pairs - Combo mode</code></li>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúFastq pairs‚Äù</em>: the collection you just created</li>
        <li>Leave all other parameters to the default settings</li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>This step combined the forward and reverse <span class="notranslate">reads</span> for each sample, and also combined
the resulting contigs from all samples into a single file. So we have gone from a paired
collection of 20x2 FASTQ files, to a single FASTA file. In order to retain information about
which <span class="notranslate">reads</span> originated from which samples, the tool also output a <em>group file</em>. View that
file now, it should look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M00967_43_000000000-A3JHG_1_1101_10011_3881     F3D0
M00967_43_000000000-A3JHG_1_1101_10050_15564    F3D0
M00967_43_000000000-A3JHG_1_1101_10051_26098    F3D0
[..]
</code></pre></div></div>

<p>Here the first column contains the read name, and the second column contains the sample name.</p>

<h2 id="data-cleaning">Data Cleaning</h2>

<p>As the next step, we want to improve the quality of our data. But first, let‚Äôs get a feel of our dataset:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-summarize-data"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Summarize data</h3>

  <ul>
    <li><strong>Summary.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">trim.contigs.fasta</code> file created by <strong>Make.contigs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚ÄúOutput logfile?‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">summary</code> output files give information per read. The <code class="language-plaintext highlighter-rouge">logfile</code> outputs also contain some summary
statistics:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             Start    End        NBases     Ambigs   Polymer  NumSeqs
Minimum:     1        248        248        0        3        1
2.5%-tile:   1        252        252        0        3        3810
25%-tile:    1        252        252        0        4        38091
Median:      1        252        252        0        4        76181
75%-tile:    1        253        253        0        5        114271
97.5%-tile:  1        253        253        6        6        148552
Maximum:     1        502        502        249      243      152360
Mean:        1        252.811    252.811    0.70063  4.44854
 # of Seqs:   152360
</code></pre></div></div>

<p>In this dataset:</p>

<ul>
  <li>Almost all of the <span class="notranslate">reads</span> are between 248 and 253 bases long.</li>
  <li>2,5% or more of our <span class="notranslate">reads</span> had ambiguous base calls (<code class="language-plaintext highlighter-rouge">Ambigs</code> column).</li>
  <li>The longest read in the dataset is 502 bases.</li>
  <li>There are 152,360 sequences.</li>
</ul>

<p>Our region of interest, the V4 region of the 16S gene, is only around 250 bases long. Any <span class="notranslate">reads</span> significantly longer than this expected value likely did not
assemble well in the <strong>Make.contigs</strong> step. Furthermore, we see that 2,5% of our <span class="notranslate">reads</span> had between 6 and 249
ambiguous base calls (<code class="language-plaintext highlighter-rouge">Ambigs</code> column). In the next steps we will clean up our data by removing these
problematic <span class="notranslate">reads</span>.</p>

<p>We do this data cleaning using the <code class="language-plaintext highlighter-rouge">Screen.seqs</code> tool, which removes</p>

<ol>
  <li>sequences with ambiguous bases (<code class="language-plaintext highlighter-rouge">maxambig</code>) and</li>
  <li>contigs longer than a given threshold (<code class="language-plaintext highlighter-rouge">maxlength</code>).</li>
</ol>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-filter-reads-based-on-quality-and-length"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Filter <span class="notranslate">reads</span> based on quality and length</h3>

  <ul>
    <li><strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">trim.contigs.fasta</code> file created by <strong>Make.contigs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúgroup‚Äù</em>: the group file created in the <strong>Make.contigs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> step</li>
        <li><em>‚Äúmaxlength‚Äù</em>: <code class="language-plaintext highlighter-rouge">275</code></li>
        <li><em>‚Äúmaxambig‚Äù</em>: <code class="language-plaintext highlighter-rouge">0</code></li>
      </ul>
    </li>
  </ul>

  <blockquote class="question">
    <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many <span class="notranslate">reads</span> were removed in this screening step? (Hint: run the summary.seqs tool again)</p>

    <blockquote class="solution">
      <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>23,488.</p>

      <p>This can be determined by looking at the number of lines in bad.accnos output of screen.seqs
or by comparing the total number of seqs between of the summary log before and after this screening
step</p>
    </blockquote>
  </blockquote>
</blockquote>

<h2 id="optimize-files-for-computation">Optimize files for computation</h2>

<p>Microbiome samples typically contain a large numbers of the same organism, and therefore we expect
to find many identical sequences in our data. In order to speed up computation, we first determine
the unique <span class="notranslate">reads</span>, and then record how many times each of these different <span class="notranslate">reads</span> was observed in
the original dataset. We do this by using the <strong>Unique.seqs</strong> tool.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-remove-duplicate-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Remove duplicate sequences</h3>

  <ul>
    <li><strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">good.fasta</code> output from <strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúoutput format‚Äù</em>: <code class="language-plaintext highlighter-rouge">Name File</code></li>
      </ul>
    </li>
  </ul>

  <blockquote class="question">
    <h3 id="question-question-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many sequences were unique? How many duplicates were removed?</p>

    <blockquote class="solution">
      <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>16,426 unique sequences and 112,446 duplicates.</p>

      <p>This can be determined from the number of lines in the fasta (or names) output, compared to the
number of lines in the fasta file before this step.</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Here we see that this step has greatly reduced the size of our sequence file; not only will this speed up further computational
steps, it will also greatly reduce the amount of disk space (and your <span class="notranslate">Galaxy</span> quota) needed to store all the intermediate files generated during
this analysis. This <strong>Unique.seqs</strong> tool created two files, one is a FASTA file containing only the unique sequences,
and the second is a so-called <em>names file</em>. This names file consists of two columns, the first contains the sequence names
for each of the unique sequences, and the second column contains all other sequence names that are identical to the representative
sequence in the first column.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name          representatives
read_name1    read_name2,read_name,read_name5,read_name11
read_name4    read_name6,read_name,read_name10
read_name7    read_name8
...
</code></pre></div></div>

<p>To recap, we now have the following files:</p>

<ul>
  <li>a FASTA file containing every distinct sequence in our dataset (the <em>representative</em> sequences)</li>
  <li>a <em>names file</em> containing the list of duplicate sequences</li>
  <li>a <em>group file</em> containing information about the samples each read originated from</li>
</ul>

<p>To further reduce file sizes and streamline analysis, we can use the <strong>Count.seqs</strong> tool to combine
the <em>group file</em> and the <em>names file</em> into a single <em>count table</em>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-generate-count-table"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Generate count table</h3>

  <ul>
    <li><strong>Count.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúname‚Äù</em>: the <code class="language-plaintext highlighter-rouge">names</code> output from <strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚ÄúUse a Group file‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúgroup‚Äù</em>: the <code class="language-plaintext highlighter-rouge">group file</code> we created using the <strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>Have a look at the <em>count_table</em> output from the <strong>Count.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>, it summarizes the number of times each unique sequence was observed across each of the samples. It will look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Representative_Sequence                      total   F3D0   F3D1  F3D141  F3D142  ...
M00967_43_000000000-A3JHG_1_1101_14069_1827  4402    370    29    257     142
M00967_43_000000000-A3JHG_1_1101_18044_1900  28      1      0     1       0
M00967_43_000000000-A3JHG_1_1101_13234_1983  10522   425    281   340     205
...
</code></pre></div></div>

<p>The first column contains the read names of the representative sequences, and the subsequent columns contain
the number of duplicates of this sequence observed in each sample.</p>

<blockquote class="comment">
  <h3 id="comment-representative-sequences-vs-total-sequences"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Representative sequences vs Total sequences</h3>
  <p>From now on, we will only work with the set of <em>unique sequences</em>, but it‚Äôs important to remember that these represent a larger
number of <em>total sequences</em>, which we keep track of in the <em>count table</em>.</p>

  <p>The <strong>Summary.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool will
report both the number of unique <em>representative sequences</em> as well as the <em>total sequences</em> they represent.</p>
</blockquote>

<h1 id="sequence-alignment">Sequence Alignment</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#sequence-alignment"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<p>For more information on the topic of alignment, please see our training materials
<a href="/training-material/topics/sequence-analysis/">here</a></p>

<p>We are now ready to align our sequences to the reference. This is an important
step to improve the clustering of your OTUs <a class="citation" href="#Schloss2012">Schloss 2012</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-align-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Align sequences</h3>

  <ol>
    <li><strong>Align.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúreference‚Äù</em>: <code class="language-plaintext highlighter-rouge">silva.v4.fasta</code> reference file from your history
<br /><br /></li>
      </ul>

      <blockquote class="question">
        <h3 id="question-question-2"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>Have a look at the alignment output, what do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-2"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>At first glance, it might look like there is not much information there. We see our read names, but only period <code class="language-plaintext highlighter-rouge">.</code> characters below it.</p>
          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;M00967_43_000000000-A3JHG_1_1101_14069_1827
............................................................................
&gt;M00967_43_000000000-A3JHG_1_1101_18044_1900
............................................................................
</code></pre></div>          </div>
          <p>This is because the V4 region is located further down our reference database and nothing aligns to the start of it. If you scroll to right you will start seeing some more informative bits:</p>
          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.....T-------AC---GG-AG-GAT------------
</code></pre></div>          </div>
          <p>Here we start seeing how our sequences align to the reference database.
There are different alignment characters in this output:</p>
          <ul>
            <li><code class="language-plaintext highlighter-rouge">.</code>: terminal gap character (before the first or after the last base in our query sequence)</li>
            <li><code class="language-plaintext highlighter-rouge">-</code>: gap character within the query sequence</li>
          </ul>

          <p>We will cut out only the V4 region in a later step (<strong>Filter.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</p>
        </blockquote>
      </blockquote>
    </li>
    <li><strong>Summary.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">align</code> output from <strong>Align.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: <code class="language-plaintext highlighter-rouge">count_table</code> output from <strong>Count.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚ÄúOutput logfile?‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>Have a look at the summary output (log file):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            Start    End      NBases  Ambigs   Polymer  NumSeqs
Minimum:    1250     10693    250     0        3        1
2.5%-tile:  1968     11550    252     0        3        3222
25%-tile:   1968     11550    252     0        4        32219
Median:     1968     11550    252     0        4        64437
75%-tile:   1968     11550    253     0        5        96655
97.5%-tile: 1968     11550    253     0        6        125651
Maximum:    1982     13400    270     0        12       128872
Mean:       1967.99  11550    252.462 0        4.36693
# of unique seqs:   16426
total # of seqs:    128872
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Start</code> and <code class="language-plaintext highlighter-rouge">End</code> columns tell us that the majority of <span class="notranslate">reads</span> aligned between positions 1968 and 11550,
which is what we expect to find given the reference file we used. However, some <span class="notranslate">reads</span> align to very different positions,
which could indicate insertions or deletions at the terminal ends of the alignments or other complicating factors.</p>

<p>Also notice the <code class="language-plaintext highlighter-rouge">Polymer</code> column in the output table. This indicates the average homopolymer length. Since we know that
our reference database does not contain any homopolymer stretches longer than 8 <span class="notranslate">reads</span>, any <span class="notranslate">reads</span> containing such
long stretches are likely the result of PCR errors and we would be wise to remove them.</p>

<p>Next we will clean our data further by removing poorly aligned sequences and any sequences with long
homopolymer stretches.</p>

<h2 id="more-data-cleaning">More Data Cleaning</h2>

<p>To ensure that all our <span class="notranslate">reads</span> overlap our region of interest, we will:</p>

<ol>
  <li>Remove any <span class="notranslate">reads</span> not overlapping the region V4 region (position 1968 to 11550) using <strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>.</li>
  <li>Remove any overhang on either end of the V4 region to ensure our sequences overlap <em>only</em> the V4 region, using <strong>Filter.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>.</li>
  <li>Clean our alignment file by removing any columns that have a gap character (<code class="language-plaintext highlighter-rouge">-</code>, or <code class="language-plaintext highlighter-rouge">.</code> for terminal gaps) at that position in every sequence (also using <strong>Filter.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>).</li>
  <li>Group near-identical sequences together with <strong>Pre.cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>. Sequences that only differ by one or two bases at this point are likely to represent sequencing errors rather than true biological variation, so we will cluster such sequences together.</li>
</ol>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-remove-poorly-aligned-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Remove poorly aligned sequences</h3>

  <ol>
    <li><strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the aligned fasta file from <strong>Align.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äústart‚Äù</em>: <code class="language-plaintext highlighter-rouge">1968</code></li>
        <li><em>‚Äúend‚Äù</em>: <code class="language-plaintext highlighter-rouge">11550</code></li>
        <li><em>‚Äúmaxhomop‚Äù</em>: <code class="language-plaintext highlighter-rouge">8</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> file from <strong>Count.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>

      <p><strong>Note:</strong> we supply the count table so that it can be updated for the sequences we‚Äôre removing.</p>

      <blockquote class="question">
        <h3 id="question-question-3"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>How many sequences were removed in this step?</p>
        <blockquote class="solution">
          <h3 id="solution-solution-3"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>128 sequences were removed. This is the number of lines in the bad.accnos output.</p>
        </blockquote>
      </blockquote>

      <p>Next, we will remove any overhang on either side of the V4 region, and</p>
    </li>
    <li><strong>Filter.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: <code class="language-plaintext highlighter-rouge">good.fasta</code> output from the latest <strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúvertical‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
        <li><em>‚Äútrump‚Äù</em>: <code class="language-plaintext highlighter-rouge">.</code></li>
        <li><em>‚ÄúOutput logfile‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>Your resulting alignment (<code class="language-plaintext highlighter-rouge">filtered fasta</code> output) should look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;M00967_43_000000000-A3JHG_1_1101_14069_1827
TAC--GG-AG-GAT--GCG-A-G-C-G-T-T--AT-C-CGG-AT--TT-A-T-T--GG-GT--TT-A-AA-GG-GT-GC-G-TA-GGC-G-G-C-CT-G-C-C-AA-G-T-C-A-G-C-G-G--TA-A-AA-TT-G-C-GG-GG--CT-C-AA-C-C-C-C-G-T-A--CA-G-C-CGTT-GAAAC-TG-C-CGGGC-TCGA-GT-GG-GC-GA-G-A---AG-T-A-TGCGGAATGCGTGGTGT-AGCGGT-GAAATGCATAG-AT-A-TC-AC-GC-AG-AACCCCGAT-TGCGAAGGCA------GC-ATA-CCG-G-CG-CC-C-T-ACTGACG-CTGA-GGCA-CGAAA-GTG-CGGGG-ATC-AAACAGG
&gt;M00967_43_000000000-A3JHG_1_1101_18044_1900
TAC--GG-AG-GAT--GCG-A-G-C-G-T-T--GT-C-CGG-AA--TC-A-C-T--GG-GC--GT-A-AA-GG-GC-GC-G-TA-GGC-G-G-T-TT-A-A-T-AA-G-T-C-A-G-T-G-G--TG-A-AA-AC-T-G-AG-GG--CT-C-AA-C-C-C-T-C-A-G-CCT-G-C-CACT-GATAC-TG-T-TAGAC-TTGA-GT-AT-GG-AA-G-A---GG-A-G-AATGGAATTCCTAGTGT-AGCGGT-GAAATGCGTAG-AT-A-TT-AG-GA-GG-AACACCAGT-GGCGAAGGCG------AT-TCT-CTG-G-GC-CA-A-G-ACTGACG-CTGA-GGCG-CGAAA-GCG-TGGGG-AGC-AAACAGG
&gt;M00967_43_000000000-A3JHG_1_1101_13234_1983
TAC--GG-AG-GAT--GCG-A-G-C-G-T-T--AT-C-CGG-AT--TT-A-T-T--GG-GT--TT-A-AA-GG-GT-GC-G-CA-GGC-G-G-A-AG-A-T-C-AA-G-T-C-A-G-C-G-G--TA-A-AA-TT-G-A-GA-GG--CT-C-AA-C-C-T-C-T-T-C--GA-G-C-CGTT-GAAAC-TG-G-TTTTC-TTGA-GT-GA-GC-GA-G-A---AG-T-A-TGCGGAATGCGTGGTGT-AGCGGT-GAAATGCATAG-AT-A-TC-AC-GC-AG-AACTCCGAT-TGCGAAGGCA------GC-ATA-CCG-G-CG-CT-C-A-ACTGACG-CTCA-TGCA-CGAAA-GTG-TGGGT-ATC-GAACAGG
</code></pre></div></div>

<p>These are all our representative <span class="notranslate">reads</span> again, now with additional alignment information.</p>

<p>In the log file of the <strong>Filter.seqs</strong> step we see the following additional information:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Length of filtered alignment: 376
Number of columns removed: 13049
Length of the original alignment: 13425
Number of sequences used to construct filter: 16298
</code></pre></div></div>

<p>From this log file we see that while our initial alignment was 13425 positions wide, after filtering the overhangs
(<code class="language-plaintext highlighter-rouge">trump</code> parameter) and removing positions that had a gap in every aligned read (<code class="language-plaintext highlighter-rouge">vertical</code> parameter), we have
trimmed our alignment down to a length of 376.</p>

<p>Because any filtering step we perform might lead to sequences no longer being unique, we deduplicate our data by re-running
the <strong>Unique.seqs</strong> tool:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-re-obtain-unique-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Re-obtain unique sequences</h3>

  <ul>
    <li><strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">filtered fasta</code> output from <strong>Filter.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúname file or count table‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from the last <strong>Screen.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ul>

  <blockquote class="question">
    <h3 id="question-question-4"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many duplicate sequences did our filter step produce?</p>

    <blockquote class="solution">
      <h3 id="solution-solution-4"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>3: The number of unique sequences was reduced from 16298 to 16295</p>
    </blockquote>
  </blockquote>
</blockquote>

<h3 id="pre-clustering">Pre-clustering</h3>

<p>The next step in cleaning our data, is to merge near-identical sequences together. Sequences that only differ
by around 1 in every 100 bases are likely to represent sequencing errors, not true biological variation. Because
our contigs are ~250 bp long, we will set the threshold to 2 mismatches.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-perform-preliminary-clustering-of-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Perform preliminary clustering of sequences</h3>

  <ul>
    <li><strong>Pre.cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from the last <strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> run</li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúname file or count table‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from the last <strong>Unique.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúdiffs‚Äù</em>: <code class="language-plaintext highlighter-rouge">2</code></li>
      </ul>
    </li>
  </ul>

  <blockquote class="question">
    <h3 id="question-question-5"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many unique sequences are we left with after this clustering of highly similar sequences?</p>
    <blockquote class="solution">
      <h3 id="solution-solution-5"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>5720: This is the number of lines in the fasta output</p>
    </blockquote>
  </blockquote>
</blockquote>

<h2 id="chimera-removal">Chimera Removal</h2>

<p>We have now thoroughly cleaned our data and removed as much sequencing error as we can. Next, we will look
at a class of sequencing artefacts known as <em>chimeras</em>.</p>

<p>During PCR amplification, it is possible that two unrelated templates are combined to form a sort of hybrid sequence,
also called a <em>chimera</em>. Needless to say, we do not want such sequencing artefacts confounding our results. We‚Äôll do
this chimera removal using the <code class="language-plaintext highlighter-rouge">VSEARCH</code> algorithm <a class="citation" href="#Rognes2016">Rognes <i>et al.</i> 2016</a> that is called within mothur, using the
<strong>Chimera.vsearch</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool.</p>

<blockquote class="comment">
  <h3 id="comment-background-chimeras"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Chimeras</h3>
  <p><img src="../../images/chimeras.jpg" alt="Chemirec sequence" />
(slide credit: <a href="http://slideplayer.com/slide/4559004/">http://slideplayer.com/slide/4559004/ </a>)</p>
</blockquote>

<p>This command will split the data by sample and check for chimeras. The recommended
way of doing this is to use the abundant sequences as our reference.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-remove-chimeric-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Remove chimeric sequences</h3>

  <ol>
    <li><strong>Chimera.vsearch</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Pre.cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>‚ÄúSelect Reference Template from‚Äù</em>: <code class="language-plaintext highlighter-rouge">Self</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from the last <strong>Pre.cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">param-check</span> ‚Äúdereplicate‚Äù to Yes</li>
      </ul>

      <p>Running <strong>Chimera.vsearch</strong> with the count file will remove the chimeric sequences from the count table, but we
 still need to remove those sequences from the fasta file as well. We do this using <strong>Remove.seqs</strong>:</p>
    </li>
    <li><strong>Remove.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúaccnos‚Äù</em>: the <code class="language-plaintext highlighter-rouge">vsearch.accnos</code> file from <strong>Chimera.vsearch</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Pre.cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Chimera.vsearch</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ol>

  <blockquote class="question">
    <h3 id="question-question-6"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many sequences were flagged as chimeric? what is the percentage? (Hint: summary.seqs)</p>

    <blockquote class="solution">
      <h3 id="solution-solution-6"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>Looking at the chimera.vsearch <code class="language-plaintext highlighter-rouge">accnos</code> output, we see that <strong>3,439 representative sequences</strong> were flagged as chimeric. If we run summary.seqs on the resulting fasta file and count table, we see that we went from 128,655
sequences down to 118,091 total sequences in this step, for a reduction of <strong>10,564 total sequences</strong>, or 8.2%. This is a reasonable number of
sequences to be flagged as chimeric.</p>
    </blockquote>
  </blockquote>
</blockquote>

<h1 id="taxonomic-classification">Taxonomic Classification</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#taxonomic-classification"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<p>Now that we have thoroughly cleaned our data, we are finally ready to assign a taxonomy to our sequences.</p>

<p>We will do this using a Bayesian classifier (via the <strong>Classify.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool) and a mothur-formatted <a href="https://www.mothur.org/wiki/RDP_reference_files">training
set provided by the Schloss lab</a> based on the RDP (Ribosomal Database Project, <a class="citation" href="#Cole2013">Cole <i>et al.</i> 2013</a>) reference taxonomy.</p>

<blockquote class="comment">
  <h3 id="comment-background-taxonomic-assignment"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Taxonomic assignment</h3>

  <p>In this tutorial we will use the RDP classifier and reference taxonomy for classification, but there are several different taxonomic
assignment algorithms and reference databases available for this purpose.</p>

  <p>An overview of different methods is given by <a class="citation" href="#Liu2008">Liu <i>et al.</i> 2008</a> and shown below:</p>

  <p><img src="../../images/classification_methods.jpg" alt="overview of different methods for taxonomy assignment" width="50%" /></p>

  <p>The most commonly used reference taxonomies are:</p>

  <ul>
    <li>SILVA (<a class="citation" href="#Quast2012">Quast <i>et al.</i> 2012</a>)</li>
    <li>GreenGenes (<a class="citation" href="#DeSantis2006">DeSantis <i>et al.</i> 2006</a>)</li>
    <li>RDP (<a class="citation" href="#Cole2013">Cole <i>et al.</i> 2013</a>)</li>
    <li>NCBI Taxonomy Database (<a class="citation" href="#Federhen2011">Federhen 2011</a>)</li>
  </ul>

  <p>The choice of taxonomic classifier and reference taxonomy can impact <span class="notranslate">downstream</span> results. The figure from <a class="citation" href="#Liu2008">Liu <i>et al.</i> 2008</a>
given below shows the taxonomic composition determined when using different classifiers and reference taxonomies, for different primer sets (16S regions).</p>

  <p><img src="../../images/reference_taxonomy_comparison.jpg" alt="comparison of reference taxonomies" title="Compositions at the phylum level for each of the three datasets: (a) Guerrero Negro mat, (b) Human gut and (c) Mouse gut, using a range of different methods (separate subpanels within each group). The x-axis of each graph shows region sequenced. The y-axis shows abundance as a fraction of the total number of sequences in the community. The legend shows colors for phyla (consistent across graphs)." width="75%" /></p>

  <!-- figure captions not working in includes, hardcode html til fixed -->
  <figure><figcaption><span class="figcaption-prefix">Figure:</span> Compositions at the phylum level for each of the three datasets: (a) Guerrero Negro mat, (b) Human gut and (c) Mouse gut, using a range of different methods (separate subpanels within each group). The x-axis of each graph shows region sequenced. The y-axis shows abundance as a fraction of the total number of sequences in the community. The legend shows colors for phyla (consistent across graphs). </figcaption></figure>

  <p>Which reference taxonomy is best for your experiments depends on a number of factors such as the type of sample and variable region sequenced.</p>

  <p>Another discussion about how these different databases compare was described by <a class="citation" href="#Balvoit2017">Balvoƒçi≈´tƒó and Huson 2017</a>.</p>

</blockquote>

<h2 id="removal-of-non-bacterial-sequences">Removal of non-bacterial sequences</h2>

<p>Despite all we have done to improve data quality, there may still be more to do:
there may be 18S r<span class="notranslate">RNA</span> gene fragments or 16S r<span class="notranslate">RNA</span> from Archaea, chloroplasts, and mitochondria
that have survived all the cleaning steps up to this point. We are generally not interested in these sequences
and want to remove them from our dataset.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-taxonomic-classification-and-removal-of-undesired-sequences"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Taxonomic Classification and Removal of undesired sequences</h3>

  <ol>
    <li><strong>Classify.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Remove.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúreference‚Äù</em>: <code class="language-plaintext highlighter-rouge">trainset9032012.pds.fasta</code> from your history</li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: <code class="language-plaintext highlighter-rouge">trainset9032012.pds.tax</code> from your history</li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> file from <strong>Remove.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>

      <p>Have a look at the taxonomy output. You will see that every read now has a classification.</p>

      <p>Now that everything is classified we want to remove our undesirables. We do this with the <strong>Remove.lineage</strong>
 tool:</p>
    </li>
    <li><strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: the taxonomy output from <strong>Classify.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">param-text</span> <em>‚Äútaxon - Manually select taxons for filtering‚Äù</em>: <code class="language-plaintext highlighter-rouge">Chloroplast-Mitochondria-unknown-Archaea-Eukaryota</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Remove.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Remove.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ol>

  <blockquote class="question">
    <h3 id="question-questions"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

    <ol>
      <li>How many unique (representative) sequences were removed in this step?</li>
      <li>How many sequences in total?</li>
    </ol>

    <blockquote class="solution">
      <h3 id="solution-solution-7"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <ol>
        <li>
          <p>20 representative sequences were removed.
The fasta file output from Remove.seqs had 2281 sequences while the fasta output from Remove.lineages
contained 2261 sequences.</p>
        </li>
        <li>
          <p>162 total sequences were removed.
If you run summary.seqs with the count table, you will see that we now have 2261 unique sequences
representing a total of 117,929 total sequences (down from 118,091 before). This means 162 of our
sequences were in represented by these 20 representative sequences.</p>
        </li>
      </ol>
    </blockquote>
  </blockquote>
</blockquote>

<p>The data is now as clean as we can get it. In the next section we will use the Mock sample to assess how accurate
our sequencing and bioinformatics pipeline is.</p>

<h1 id="optional-calculate-error-rates-based-on-our-mock-community">Optional: Calculate error rates based on our mock community</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#optional-calculate-error-rates-based-on-our-mock-community"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<blockquote class="comment">
  <h3 id="comment-skipping-the-mock-community-analysis"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Skipping the mock community analysis</h3>

  <p>The mock community analysis is optional. If you are low on time or want to skip ahead, you can jump straight to <a href="#otu-clustering">the next section</a>
where we will cluster our sequences into OTUs, classify them and perform some visualisations.
<br /><br />
Click <a href="#otu-clustering">here</a> to skip this section and continue with the analysis.</p>

</blockquote>

<p>The following step is only possible if you have co-sequenced a mock community with your samples. A mock community is a sample
of which you know the exact composition and is something we recommend to do, because it will give you an idea of how
accurate your sequencing and analysis protocol is.</p>

<blockquote class="comment">
  <h3 id="comment-background-mock-communities"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Mock communities</h3>

  <p><strong>What is a mock community?</strong></p>

  <p>A mock community is an artificially constructed sample; a defined mixture of microbial cells and/or
viruses or nucleic acid molecules created <em>in vitro</em> to simulate the composition of a microbiome
sample or the nucleic acid isolated therefrom.</p>

  <p><strong>Why sequence a mock community?</strong></p>

  <p>In a mock community, we know exactly which sequences/organisms we expect to find, and at which proportions.
Therefore, we can use such an artificial sample to assess the error rates of our sequencing and
analysis pipeline.</p>
  <ul>
    <li>Did we miss any of the sequences we know to be present in the sample (false negatives)?</li>
    <li>Do we find any sequences that were not present in the sample (false positives)?</li>
    <li>Were we able to accurately detect their relative abundances?</li>
  </ul>

  <p>If our <span class="notranslate">workflow</span> performed well on the mock sample, we have more confidence in the accuracy of the
results on the rest of our samples.</p>

  <p><strong>Example</strong></p>

  <p>As an example, consider the following image from Fouhy et al <a class="citation" href="#Fouhy2016">Fouhy <i>et al.</i> 2016</a>.
A mock community sample was sequenced for different combinations of sequencer and primer sets (V-regions).
Since we know the expected outcome, we can assess the accuracy of each pipeline. A similar approach can be used to
assess different parameter settings of the <em>in-silico</em>  analysis pipeline.</p>

  <p><img src="../../images/mock_community.jpg" alt="example results of mock community sequencing to assess error rates" title="Example of usage of a mock community to assess accuracy. On the left is the expected result given that we know the exact composition of the mock sample. This was then used to assess the accuracy of different combinations of sequencing platform and primer set (choice of V-region)" /></p>

  <p><strong>Further reading</strong></p>

  <ul>
    <li>Next generation sequencing data of a defined microbial mock community <a class="citation" href="#Singer2016">Singer <i>et al.</i> 2016</a></li>
    <li>16S r<span class="notranslate">RNA</span> gene sequencing of mock microbial populations- impact of <span class="notranslate">DNA</span> extraction method, primer choice and sequencing platform <a class="citation" href="#Fouhy2016">Fouhy <i>et al.</i> 2016</a></li>
  </ul>

</blockquote>

<p>The mock community in this experiment was composed of genomic <span class="notranslate">DNA</span> from 21 bacterial strains. So in a perfect world, this is
exactly what we would expect the analysis to produce as a result.</p>

<p>First, let‚Äôs extract the sequences belonging to our mock samples from our data:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-extract-mock-sample-from-our-dataset"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: extract mock sample from our dataset</h3>

  <ul>
    <li><strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúgroup file or count table‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>‚Äúgroups‚Äù</em>: <code class="language-plaintext highlighter-rouge">Mock</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">param-check</span> <em>‚Äúoutput logfile?‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>In the log file we see the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Selected 58 sequences from your fasta file.
Selected 4046 sequences from your count file
</code></pre></div></div>

<p>The Mock sample has 58 unique sequences, representing a total of 4,046 total sequences.</p>

<p>The <strong>Seq.error</strong> tool measures the error rates using our mock reference. Here we align
the <span class="notranslate">reads</span> from our mock sample back to their known sequences, to see how many fail to match.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-assess-error-rates-based-on-a-mock-community"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Assess error rates based on a mock community</h3>
  <ul>
    <li><strong>Seq.error</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúpick.fasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúreference‚Äù</em>: <code class="language-plaintext highlighter-rouge">HMP_MOCK.v35.fasta</code> file from your history</li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">param-check</span> <em>‚Äúoutput log?‚Äù</em>: <code class="language-plaintext highlighter-rouge">yes</code></li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>In the log file we see something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Overall error rate:    6.5108e-05
Errors    Sequences
0    3998
1    3
2    0
3    2
4    1
[..]
</code></pre></div></div>

<p>That is pretty good! The error rate is only 0.0065%! This gives us confidence that the rest of the samples
are also of high quality, and we can continue with our analysis.</p>

<h3 id="cluster-mock-sequences-into-otus">Cluster mock sequences into OTUs</h3>

<p>We will now estimate the accuracy of our sequencing and analysis pipeline by clustering the Mock sequences into OTUs,
and comparing the results with the expected outcome.</p>

<blockquote class="comment">
  <h3 id="comment-background-what-are-operational-taxonomic-units-otus"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: What are Operational Taxonomic Units (OTUs)?</h3>

  <p>In 16S metagenomics approaches, OTUs are clusters of similar sequence variants of the 16S r<span class="notranslate">DNA</span> marker gene
sequence. Each of these clusters is intended to represent a taxonomic unit of a bacteria species or genus
depending on the sequence similarity threshold. Typically, OTU cluster are defined by a 97% identity
threshold of the 16S gene sequence variants at species level. 98% or 99% identity is suggested for strain
separation.</p>

  <p><img src="../../images/OTU_graph.png" alt="OTU graph" /></p>

  <p>(Image credit: Danzeisen et al. 2013, 10.7717/peerj.237)</p>
</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-cluster-mock-sequences-into-otus"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Cluster mock sequences into OTUs</h3>

  <p>First we calculate the pairwise distances between our sequences</p>

  <ol>
    <li><strong>Dist.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> from <strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúcutoff‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.20</code></li>
      </ul>

      <p>Next we group sequences into OTUs</p>
    </li>
    <li><strong>Cluster - Assign sequences to OTUs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcolumn‚Äù</em>: the <code class="language-plaintext highlighter-rouge">dist</code> output from <strong>Dist.seqs</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>

      <p>Now we make a <em>shared</em> file that summarizes all our data into one handy table</p>
    </li>
    <li><strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúlist‚Äù</em>: the <code class="language-plaintext highlighter-rouge">OTU list</code> from <strong>Cluster</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Get.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúlabel‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.03</code> (this indicates we are interested in the clustering at a 97% identity threshold)</li>
      </ul>

      <p>And now we generate intra-sample rarefaction curves</p>
    </li>
    <li><strong>Rarefaction.single</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshared‚Äù</em>: the <code class="language-plaintext highlighter-rouge">shared</code> file from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ol>

  <blockquote class="question">
    <h3 id="question-question-7"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

    <p>How many OTUs were identified in our mock community?</p>
    <blockquote class="solution">
      <h3 id="solution-solution-8"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <p>Answer: <strong>34</strong></p>

      <p>This can be determined by opening the shared file or OTU list and looking at the header line. You will see a column for each OTU</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Open the rarefaction output (dataset named <code class="language-plaintext highlighter-rouge">sobs</code> inside the <code class="language-plaintext highlighter-rouge">rarefaction curves</code> output collection), it should look
something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numsampled	0.03-	lci-	hci-
1	1.0000	1.0000	1.0000
100	18.0240	16.0000	20.0000
200	19.2160	17.0000	22.0000
300	19.8800	18.0000	22.0000
400	20.3600	19.0000	22.0000

[..]

3000	30.4320	28.0000	33.0000
3100	30.8800	28.0000	34.0000
3200	31.3200	29.0000	34.0000
3300	31.6320	29.0000	34.0000
3400	31.9920	30.0000	34.0000
3500	32.3440	30.0000	34.0000
3600	32.6560	31.0000	34.0000
3700	32.9920	31.0000	34.0000
3800	33.2880	32.0000	34.0000
3900	33.5920	32.0000	34.0000
4000	33.8560	33.0000	34.0000
4046	34.0000	34.0000	34.0000

</code></pre></div></div>

<p>When we use the full set of 4060 sequences, we find 34 OTUs from the Mock community; and with
3000 sequences, we find about 31 OTUs. In an ideal world, we would find exactly 21 OTUs. Despite our
best efforts, some chimeras or other contaminations may have slipped through our filtering steps.</p>

<blockquote class="comment">
  <h3 id="comment-background-rarefaction"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Rarefaction</h3>

  <p>To estimate the fraction of species sequenced, rarefaction curves are typically used. A rarefaction curve
plots the number of species as a function of the number of individuals sampled. The curve usually begins
with a steep slope, which at some point begins to flatten as fewer species are being discovered per sample:
the gentler the slope, the less contribution of the sampling to the total number of operational taxonomic
units or OTUs.</p>

  <p><img src="../../images/rarefaction.png" alt="Rarefaction curves" /></p>

  <p>Green, most or all species have been sampled; blue, this habitat has not been exhaustively sampled; red,
species rich habitat, only a small fraction has been sampled.</p>

  <p>(<em>A Primer on Metagenomics</em> <a class="citation" href="#Wooley2010">Wooley <i>et al.</i> 2010</a> )</p>
</blockquote>

<p>Now that we have assessed our error rates we are ready for some real analysis.</p>

<h1 id="otu-clustering">OTU Clustering</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#otu-clustering"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<p>In this tutorial we will continue with an OTU-based approach, for the phylotype and phylogenic
approaches, please refer to the <a href="https://www.mothur.org/wiki/MiSeq_SOP">mothur wiki page</a>.</p>

<blockquote class="comment">
  <h3 id="comment-background-what-are-operational-taxonomic-units-otus-1"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: What are Operational Taxonomic Units (OTUs)?</h3>

  <p>In 16S metagenomics approaches, OTUs are clusters of similar sequence variants of the 16S r<span class="notranslate">DNA</span> marker gene
sequence. Each of these clusters is intended to represent a taxonomic unit of a bacteria species or genus
depending on the sequence similarity threshold. Typically, OTU cluster are defined by a 97% identity
threshold of the 16S gene sequence variants at species level. 98% or 99% identity is suggested for strain
separation.</p>

  <p><img src="../../images/OTU_graph.png" alt="OTU graph" /></p>

  <p>(Image credit: Danzeisen et al. 2013, 10.7717/peerj.237)</p>
</blockquote>

<h3 id="remove-mock-sample">Remove Mock Sample</h3>

<p>Now that we have cleaned up our data set as best we can, and assured ourselves of the quality of our sequencing
pipeline by considering a mock sample, we are almost ready to cluster and classify our real data. But
before we start, we should first remove the Mock dataset from our data, as we no longer need it. We do this using
the <strong>Remove.groups</strong> tool:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-remove-mock-community-from-our-dataset"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Remove Mock community from our dataset</h3>

  <ul>
    <li><strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>‚ÄúSelect input type‚Äù</em>: <code class="language-plaintext highlighter-rouge">fasta , name, taxonomy, or list with a group file or count table</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúgroup or count table‚Äù</em>: the <code class="language-plaintext highlighter-rouge">pick.count_table</code> output from <strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>‚Äúgroups‚Äù</em>: <code class="language-plaintext highlighter-rouge">Mock</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">pick.fasta</code> output from <strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: the <code class="language-plaintext highlighter-rouge">pick.taxonomy</code> output from <strong>Remove.lineage</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ul>

</blockquote>

<h3 id="cluster-sequences-into-otus">Cluster sequences into OTUs</h3>

<p>There are several ways we can perform clustering. For the Mock community, we used the traditional approach of
using the <strong>Dist.seqs</strong> and <strong>Cluster</strong> tools. Alte<span class="notranslate">rna</span>tively, we can also use the <strong>Cluster.split</strong> tool. With
this approach, the sequences are split into bins, and then clustered with each bin.  Taxonomic information is used to guide this process.
The Schloss lab have <a href="https://www.mothur.org/wiki/MiSeq_SOP#OTUs">published results</a> showing that if you split at the level of Order or Family, and cluster to a 0.03
cutoff, you‚Äôll get just as good of clustering as you would with the ‚Äútraditional‚Äù approach. In addition, this approach
is less computationally expensive and can be parallelized, which is especially advantageous when you have large
datasets.</p>

<p>We‚Äôll now use the <strong>Cluster</strong> tool, with <code class="language-plaintext highlighter-rouge">taxlevel</code> set to <code class="language-plaintext highlighter-rouge">4</code>, requesting that clustering be done at the <em>Order</em> level.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-cluster-our-data-into-otus"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Cluster our data into OTUs</h3>

  <ol>
    <li><strong>Cluster.split</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúSplit by‚Äù</em>: <code class="language-plaintext highlighter-rouge">Classification using fasta</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúfasta‚Äù</em>: the <code class="language-plaintext highlighter-rouge">fasta</code> output from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúname file or count table‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> output from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äútaxlevel‚Äù</em>: <code class="language-plaintext highlighter-rouge">4</code></li>
        <li><em>‚Äúcutoff‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.03</code></li>
      </ul>

      <p>Next we want to know how many sequences are in each OTU from each group and we can do this using the
<strong>Make.shared</strong> tool. Here we tell mothur that we‚Äôre really only interested in the 0.03 cutoff level:</p>
    </li>
    <li><strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúlist‚Äù</em>: the <code class="language-plaintext highlighter-rouge">list</code> output from <strong>Cluster.split</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúlabel‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.03</code></li>
      </ul>

      <p>We probably also want to know the taxonomy for each of our OTUs. We can get the consensus taxonomy for each
OTU using the <strong>Classify.otu</strong> tool:</p>
    </li>
    <li><strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúlist‚Äù</em>: the <code class="language-plaintext highlighter-rouge">list</code> output from <strong>Cluster.split</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúlabel‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.03</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>Examine <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-eye</span> the <code class="language-plaintext highlighter-rouge">taxonomy</code> output of <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>. This is a collection, and the different levels of taxonomy are shown in the names of the collection elements. In this example we only calculated one level, 0.03. This means we used a 97% similarity threshold. This threshold is commonly used to differentiate at <em>species level</em>.</p>

<p>Opening the taxonomy output for level 0.03 (meaning 97% similarity, or <em>species</em> level) shows a file structured like the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OTU       Size    Taxonomy
..
Otu0008	5260	Bacteria(100);"Bacteroidetes"(100);"Bacteroidia"(100);"Bacteroidales"(100);"Rikenellaceae"(100);Alistipes(100);
Otu0009	3613	Bacteria(100);"Bacteroidetes"(100);"Bacteroidia"(100);"Bacteroidales"(100);"Porphyromonadaceae"(100);"Porphyromonadaceae"_unclassified(100);
Otu0010	3058	Bacteria(100);Firmicutes(100);Bacilli(100);Lactobacillales(100);Lactobacillaceae(100);Lactobacillus(100);
Otu0011	2958	Bacteria(100);"Bacteroidetes"(100);"Bacteroidia"(100);"Bacteroidales"(100);"Porphyromonadaceae"(100);"Porphyromonadaceae"_unclassified(100);
Otu0012	2134	Bacteria(100);"Bacteroidetes"(100);"Bacteroidia"(100);"Bacteroidales"(100);"Porphyromonadaceae"(100);"Porphyromonadaceae"_unclassified(100);
Otu0013	1856	Bacteria(100);Firmicutes(100);Bacilli(100);Lactobacillales(100);Lactobacillaceae(100);Lactobacillus(100);
..
</code></pre></div></div>

<p>The first line shown in the snippet above indicates that Otu008 occurred 5260 times, and that all of the
sequences (100%) were binned in the genus <em><a href="https://en.wikipedia.org/wiki/Alistipes">Alistipes</a></em>.</p>

<blockquote class="question">
  <h3 id="question-question-8"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Which samples contained sequences belonging to an OTU classified as Staphylococcus?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-9"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>Examine the <code class="language-plaintext highlighter-rouge">tax.summary</code> file output by <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>.</p>

    <p>Samples F3D141, F3D142,  F3D144, F3D145, F3D2. This answer can be found by
examining the tax.summary output and finding the columns with nonzero
values for the line of Staphylococcus</p>
  </blockquote>
</blockquote>

<p>Before we continue, let‚Äôs remind ourselves what we set out to do. Our original question was about the stability of
the microbiome and whether we could observe any change in community structure between the early and late samples.</p>

<p>Because some of our sample may contain more sequences than others, it is generally a good idea to normalize the
dataset by subsampling.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-subsampling"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Subsampling</h3>

  <p>First we want to see how many sequences we have in each sample. We‚Äôll do this with the
<strong>Count.groups</strong> tool:</p>

  <ol>
    <li><strong>Count.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshared‚Äù</em>: the <code class="language-plaintext highlighter-rouge">shared</code> file from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>

      <blockquote class="question">
        <h3 id="question-question-9"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>
        <p>How many sequences did the smallest sample consist of?</p>
        <blockquote class="solution">
          <h3 id="solution-solution-10"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>The smallest sample is <code class="language-plaintext highlighter-rouge">F3D143</code>, and consists of 2389 sequences. This is a reasonable number, so we will now subsample all the other samples down to this level.</p>
        </blockquote>
      </blockquote>
    </li>
    <li><strong>Sub.sample</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúSelect type of data to subsample‚Äù</em>: <code class="language-plaintext highlighter-rouge">OTU Shared</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshared‚Äù</em>: the <code class="language-plaintext highlighter-rouge">shared</code> file from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúsize‚Äù</em>: <code class="language-plaintext highlighter-rouge">2389</code></li>
      </ul>

      <blockquote class="question">
        <h3 id="question-question-10"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What would you expect the result of <code class="language-plaintext highlighter-rouge">count.groups</code> on this new shared output collection to be? Check if you are correct.</p>
        <blockquote class="solution">
          <h3 id="solution-solution-11"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>all groups (samples) should now have 2389 sequences. Run count.groups again on the shared output collection by the sub.sample
tool to confirm that this is indeed what happened.</p>
        </blockquote>
      </blockquote>
    </li>
  </ol>

  <p><strong>Note:</strong> since subsampling is a stochastic process, your results from any tools using this subsampled data
will deviate from the ones presented here.</p>
</blockquote>

<h1 id="diversity-analysis">Diversity Analysis</h1>
<p><a href="../mothur-miseq-sop-short/tutorial.html#diversity-analysis"><i class="fas fa-exchange-alt" aria-hidden="true"></i><span class="visually-hidden">exchange</span> Switch to short tutorial</a></p>

<p>Species diversity is a valuable tool for describing the ecological complexity of a single sample (alpha diversity)
or between samples (beta diversity). However, diversity is not a physical quantity that can be measured directly,
and many different metrics have been proposed to quantify diversity by <a class="citation" href="#Finotello2016">Finotello <i>et al.</i> 2016</a>.</p>

<blockquote class="comment">
  <h3 id="comment-background-species-diversity"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Species Diversity</h3>

  <p>Species diversity consists of three components: species richness, taxonomic or phylogenetic diversity and species evenness.</p>

  <ul>
    <li><strong>Species richness</strong> = the number of different species in a community.</li>
    <li><strong>Species evenness</strong> = how even in numbers each species in a community is.</li>
    <li><strong>Phylogenetic diversity</strong> = how closely related the species in a community are.</li>
  </ul>

  <p><br /><br /></p>

  <p>Each of these factors play a role in diversity, but how to combine them into a single measure of diversity is nontrivial.
Many different metrics have been proposed for this, for example: <em>shannon, chao, pd, ace, simpson, sobs, jack, npshannon,
smithwilson, heip bergerparker, boney, efron, shen, solow, bootstrap, qstat, coverage, anderberg, hamming, jclass, jest,
ochiai, canberra, thetayc, invsimpson</em>, just to name a few ;). A comparison of several different diversity metrics is discussed in <a class="citation" href="#BonillaRosso2012">Bonilla-Rosso <i>et al.</i> 2012</a></p>

  <blockquote class="question">
    <h3 id="question-question-11"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>
    <p>To understand the difference between richness and evenness, consider the following example:</p>

    <p><img src="../../images/richness-evenness-blank.png" alt="illustration of richness and evenness" /></p>

    <ol>
      <li>Which of these communities has the highest richness?</li>
      <li>Which of these communities has the highest evenness?</li>
    </ol>

    <blockquote class="solution">
      <h3 id="solution-solution-12"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
      <ol>
        <li>Both communities have 4 different species, so they have same richness.</li>
        <li>Community B is more even, because each species has the same abundance.</li>
      </ol>

      <p><img src="../../images/richness-evenness.png" alt="illustration of richness and evenness" /></p>
    </blockquote>

  </blockquote>
  <p><br /><br /></p>

  <p>Even when two samples have identical richness and evenness, we still may conclude that one is more diverse than
the other if the species are very dissimilar in one of the samples (have high phylogenetic distance), but very
closely related to each other in the second sample.</p>

  <p><img src="../../images/phylogenetic-distance.png" alt="illustration of phylogenetic distance" width="50%" /></p>

  <p>Now, you do not need to know what all these different metrics are, but just remember that there is not a single
definition of diversity and as always, the metric you choose to use may influence your results.</p>

</blockquote>

<h2 id="alpha-diversity">Alpha diversity</h2>

<p>In order to estimate alpha diversity of the samples, we first generate the <em>rarefaction curves</em>. Recall that
rarefaction measures the number of observed OTUs as a function of the subsampling size.</p>

<blockquote class="comment">
  <h3 id="comment-background-rarefaction-1"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Background: Rarefaction</h3>

  <p>To estimate the fraction of species sequenced, rarefaction curves are typically used. A rarefaction curve
plots the number of species as a function of the number of individuals sampled. The curve usually begins
with a steep slope, which at some point begins to flatten as fewer species are being discovered per sample:
the gentler the slope, the less contribution of the sampling to the total number of operational taxonomic
units or OTUs.</p>

  <p><img src="../../images/rarefaction.png" alt="Rarefaction curves" /></p>

  <p>Green, most or all species have been sampled; blue, this habitat has not been exhaustively sampled; red,
species rich habitat, only a small fraction has been sampled.</p>

  <p>(<em>A Primer on Metagenomics</em> <a class="citation" href="#Wooley2010">Wooley <i>et al.</i> 2010</a> )</p>
</blockquote>

<p>We calculate rarefaction curves with the <strong>Rarefaction.single</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-calculate-rarefaction"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Calculate Rarefaction</h3>
  <ul>
    <li><strong>Rarefaction.single</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshared‚Äù</em>: the <code class="language-plaintext highlighter-rouge">shared file</code> from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>Note that we used the default diversity measure here (<em>sobs</em>; observed species richness), but there are many
more options available under the <em>calc</em> parameter. The mothur wiki describes some of these calculators
<a href="https://mothur.org/wiki/Calculators">here</a>.</p>

<p>Examine the rarefaction curve output.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numsampled    0.03-F3D0    lci-F3D0    hci-F3D0    0.03-F3D1   ...
1              1.0000       1.0000      1.0000      1.0000
100           41.6560      35.0000     48.0000     45.0560
200           59.0330      51.0000     67.0000     61.5740
300           70.5640      62.0000     79.0000     71.4700
400           78.8320      71.0000     87.0000     78.4730
500           85.3650      77.0000     94.0000     83.9990
...
</code></pre></div></div>

<p>This file displays the number of OTUs identified per amount of sequences used (<code class="language-plaintext highlighter-rouge">numsampled</code>). What we would like
to see is the number of additional OTUs identified when adding more sequences reaching a plateau. Then we know
we have covered our full diversity. This information would be easier to interpret in the form of a graph.
Let‚Äôs plot the rarefaction curve for a couple of our sequences:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-plot-rarefaction"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Plot Rarefaction</h3>

  <ul>
    <li><strong>Plotting tool - for multiple series and graph types</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúPlot Title‚Äù</em>: <code class="language-plaintext highlighter-rouge">Rarefaction</code></li>
        <li><em>‚ÄúLabel for x axis‚Äù</em>: <code class="language-plaintext highlighter-rouge">Number of Sequences</code></li>
        <li><em>‚ÄúLabel for y axis‚Äù</em>: <code class="language-plaintext highlighter-rouge">Number of OTUs</code></li>
        <li><em>‚ÄúOutput File Type‚Äù</em>: <code class="language-plaintext highlighter-rouge">PNG</code></li>
        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> Click on <strong>Insert Series</strong>,
          <ul>
            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúDataset‚Äù</em>: rarefaction curve collection</li>
            <li><em>‚ÄúHeader in first line?‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
            <li><em>‚ÄúColumn for x axis‚Äù</em>: <code class="language-plaintext highlighter-rouge">Column 1</code></li>
            <li><em>‚ÄúColumn for y-axis‚Äù</em>: <code class="language-plaintext highlighter-rouge">Column 2</code> and <code class="language-plaintext highlighter-rouge">Column 5</code> and every third column until the end (we are
skipping the low confidence and high confidence interval columns)</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

</blockquote>

<p>View the rarefaction plot output. From this image can see that the rarefaction curves for all samples have started to level
off so we are confident we cover a large part of our sample diversity:</p>

<p><img src="../../images/rarefaction_curves.png" alt="Rarefaction curves" /></p>

<p>Finally, let‚Äôs use the <strong>Summary.single</strong> tool to generate a summary report.  The following step
will randomly subsample down to 2389 sequences, repeat this process 1000 times, and report several metrics:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-summarysingle"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Summary.single</h3>

  <ul>
    <li><strong>Summary.single</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshare‚Äù</em>: the <code class="language-plaintext highlighter-rouge">shared</code> file from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúcalc‚Äù</em>: <code class="language-plaintext highlighter-rouge">nseqs,coverage,sobs,invsimpson</code></li>
        <li><em>‚Äúsize‚Äù</em>: <code class="language-plaintext highlighter-rouge">2389</code></li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>View the <code class="language-plaintext highlighter-rouge">summary</code> output from <strong>Summary.single</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>. This shows several alpha diversity metrics:</p>
<ul>
  <li><a href="https://www.mothur.org/wiki/Sobs">sobs</a>: observed richness (number of OTUs)</li>
  <li><a href="https://mothur.org/wiki/Coverage">coverage</a>: Good‚Äôs coverage index</li>
  <li><a href="https://en.wikipedia.org/wiki/Diversity_index#Simpson_index">invsimpson</a>: Inverse Simpson Index</li>
  <li><a href="https://www.mothur.org/wiki/Nseqs">nseqs</a>: number of sequences</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>label   group   sobs          coverage    invsimpson   invsimpson_lci   invsimpson_hci  nseqs
0.03    F3D0    167.000000    0.994697    25.686387    24.648040        26.816067       6223.000000
0.03    F3D1    145.000000    0.994030    34.598470    33.062155        36.284520       4690.000000
0.03    F3D141  154.000000    0.991060    19.571632    18.839994        20.362390       4698.000000
0.03    F3D142  141.000000    0.978367    17.029921    16.196090        17.954269       2450.000000
0.03    F3D143  135.000000    0.980738    18.643635    17.593785        19.826728       2440.000000
0.03    F3D144  161.000000    0.980841    15.296728    14.669208        15.980336       3497.000000
0.03    F3D145  169.000000    0.991222    14.927279    14.494740        15.386427       5582.000000
0.03    F3D146  161.000000    0.989167    22.266620    21.201364        23.444586       3877.000000
0.03    F3D147  210.000000    0.995645    15.894802    15.535594        16.271013       12628.000000
0.03    F3D148  176.000000    0.995725    17.788205    17.303206        18.301177       9590.000000
0.03    F3D149  194.000000    0.994957    21.841083    21.280343        22.432174       10114.000000
0.03    F3D150  164.000000    0.989446    23.553161    22.462533        24.755101       4169.000000
0.03    F3D2    179.000000    0.998162    15.186238    14.703161        15.702137       15774.000000
0.03    F3D3    127.000000    0.994167    14.730640    14.180453        15.325243       5315.000000
0.03    F3D5    138.000000    0.990523    29.415378    28.004777        30.975621       3482.000000
0.03    F3D6    155.000000    0.995339    17.732145    17.056822        18.463148       6437.000000
0.03    F3D7    126.000000    0.991916    13.343631    12.831289        13.898588       4082.000000
0.03    F3D8    158.000000    0.992536    23.063894    21.843396        24.428855       4287.000000
0.03    F3D9    162.000000    0.994803    24.120541    23.105499        25.228865       5773.000000
</code></pre></div></div>

<p>There are a couple of things to note here:</p>
<ul>
  <li>The differences in diversity and richness between early and late time points is small.</li>
  <li>All sample coverage is above 97%.</li>
</ul>

<p>There are many more diversity metrics, and for more information about the different calculators available in mothur, see <a href="https://mothur.org/wiki/Calculators">the mothur wiki page</a></p>

<p>We could perform additional statistical tests (e.g. ANOVA) to confirm our feeling that there is no significant difference based on sex or early vs. late, but this is beyond the scope of this tutorial.</p>

<h2 id="beta-diversity">Beta diversity</h2>

<p>Beta diversity is a measure of the similarity of the membership and structure found between <em>different</em> samples.
The default calculator in the following section is <em>thetaYC</em>, which is the <a href="http://csyue.nccu.edu.tw/2005communicationindex.pdf">Yue &amp; Clayton theta similarity
coefficient</a>. We will also calculate the <a href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard index</a> (termed <code class="language-plaintext highlighter-rouge">jclass</code> in mothur).</p>

<p>We calculate this with the <strong>Dist.shared</strong> tool, which will rarefy our data.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-beta-diversity"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Beta diversity</h3>

  <ol>
    <li><strong>Dist.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúshared‚Äù</em>: to the <code class="language-plaintext highlighter-rouge">shared</code> file from <strong>Make.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>‚Äúcalc‚Äù</em>: <code class="language-plaintext highlighter-rouge">thetayc,jclass</code></li>
        <li><em>‚Äúsubsample‚Äù</em>: <code class="language-plaintext highlighter-rouge">2389</code></li>
      </ul>

      <p>Let‚Äôs visualize our data in a Heatmap:</p>
    </li>
    <li><strong>Heatmap.sim</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúGenerate Heatmap for‚Äù</em>: <code class="language-plaintext highlighter-rouge">phylip</code></li>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚Äúphylip‚Äù</em>: the output of <strong>Dist.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> (this is a collection input)</li>
      </ul>
    </li>
  </ol>

  <!-- TODO: add image conversion tool for Galaxy instances that do not support viewing of SVGs files? -->
</blockquote>

<p>Look at some of the resulting heatmaps (you may have to download the SVG images first). In all of these
heatmaps the red colors indicate communities that are more similar than those with black colors.</p>

<p>For example this is the heatmap for the <code class="language-plaintext highlighter-rouge">thetayc</code> calculator (output <code class="language-plaintext highlighter-rouge">thetayc.0.03.lt.ave</code>):</p>

<p><img src="../../images/heatmap.sim_thetayc.png" alt="Heatmap for the thetayc calculator" /></p>

<p>and the jclass calulator (output <code class="language-plaintext highlighter-rouge">jclass.0.03.lt.ave</code>):</p>

<p><img src="../../images/heatmap.sim_jclass.png" alt="Heatmap for the jclass calculator" /></p>

<p>When generating Venn diagrams we are limited by the number of samples that we can analyze simultaneously.
Let‚Äôs take a look at the Venn diagrams for the first 4 time points of female 3 using the <strong>Venn</strong> tool:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-venn-diagram"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Venn diagram</h3>

  <ul>
    <li><strong>Venn</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúOTU Shared‚Äù</em>: output from <strong>Sub.sample</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> (collection)</li>
        <li><em>‚Äúgroups‚Äù</em>: <code class="language-plaintext highlighter-rouge">F3D0,F3D1,F3D2,F3D3</code></li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>This generates a 4-way Venn diagram and a table listing the shared OTUs.</p>

<p>Examine the Venn diagram:</p>

<p><img src="../../images/venn.png" alt="Venn diagram and table with shared OTUs" /></p>

<p>This shows that there were a total of 180 OTUs observed between the 4 time points. Only 76 of those OTUs were
shared by all four time points. We could look deeper at the shared file to see whether those OTUs were
numerically rare or just had a low incidence.</p>

<p>Next, let‚Äôs generate a dendrogram to describe the similarity of the samples to each other. We will generate a
dendrogram using the <code class="language-plaintext highlighter-rouge">jclass</code> and <code class="language-plaintext highlighter-rouge">thetayc</code> calculators within the <strong>Tree.shared</strong> tool:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-tree"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Tree</h3>

  <ol>
    <li><strong>Tree.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúSelect input format‚Äù</em>: <code class="language-plaintext highlighter-rouge">Phylip Distance Matrix</code></li>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚Äúphylip‚Äù</em>: the <code class="language-plaintext highlighter-rouge">distance files</code> output from <strong>Dist.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
    <li><strong>Newick display</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúNewick file‚Äù</em>: output from <strong>Tree.shared</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>Inspection of the the tree shows that the early and late communities cluster with themselves to the exclusion
of the others.</p>

<p><code class="language-plaintext highlighter-rouge">thetayc.0.03.lt.ave</code>:</p>

<p><img src="../../images/tree.thetayc.png" alt="Thetayc tree" /></p>

<p><code class="language-plaintext highlighter-rouge">jclass.0.03.lt.ave</code>:</p>

<p><img src="../../images/tree.jclass.png" alt="Jclass tree" /></p>

<h1 id="visualisations">Visualisations</h1>

<h2 id="krona">Krona</h2>

<p>A tool we can use to visualize the composition of our community, is <a href="https://github.com/marbl/Krona/wiki">Krona</a></p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-krona"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Krona</h3>

  <p>First we convert our mothur taxonomy file to a format compatible with Krona</p>

  <ol>
    <li><strong>Taxonomy-to-Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúTaxonomy file‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Classify.otu</strong></li>
      </ul>
    </li>
    <li><strong>Krona pie chart</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>‚ÄúType of input‚Äù</em>: <code class="language-plaintext highlighter-rouge">Tabular</code></li>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúInput file‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Taxonomy-to-Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>The resulting file is an HTML file containing an interactive visualization. For instance try double-clicking the
innermost ring labeled ‚ÄúBacteroidetes‚Äù below:</p>

<iframe id="krona" src="krona_all.html" frameborder="0" width="100%" height="900px"> ![Krona](../../images/krona.png) </iframe>

<blockquote class="question">
  <h3 id="question-question-12"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>What percentage of your sample was labelled <code class="language-plaintext highlighter-rouge">Lactobacillus</code>?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-13"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>Explore the Krona plot, double click on Firmicutes, here you should see Lactobacillus
clearly (16% in our case), click on this segment and the right-hand side will show you the percentages at
any point in the hierarchy (here 5% of all)</p>

    <p><img src="../../images/krona_lacto.png" alt="image showing view with Lactobacillus highlighted" /></p>
  </blockquote>
</blockquote>

<h3 id="exercise-generating-per-sample-krona-plots-optional">Exercise: generating per-sample Krona plots (Optional)</h3>

<p>You may have noticed that this plot shows the results for all samples together. In many
cases however, you would like to be able to compare results for different samples.</p>

<p>In order to save computation time, mothur pools all <span class="notranslate">reads</span> into a single file, and uses
the <code class="language-plaintext highlighter-rouge">count table</code> file to keep track of which samples the <span class="notranslate">reads</span> came from. However, Krona
does not understand the mothur count table format, so we cannot use that to supply information
about the groups. But luckily we can get <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> to output per-sample
taxonomy files. In the following exercise, we will create a Krona plot with per-sample subplots.</p>

<blockquote class="question">
  <h3 id="question-exercise-per-sample-plots"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Exercise: per-sample plots</h3>

  <p>Try to create per-sample Krona plots. An few hints are given below, and the full answer
is given in the solution box. <br /></p>

  <ol>
    <li>Re-run <i class="fas fa-sync-alt" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-refresh</span> the <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool we ran earlier
      <ul>
        <li>See if you can find a parameter to output a taxonomy file per sample (group)</li>
      </ul>
    </li>
    <li>Run <strong>Taxonomy-to-Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> again on the per-sample taxonomy files (collection)</li>
    <li>Run <strong>Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-full-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Full Solution</h3>

    <ol>
      <li>Find the previous run of <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> in your history
        <ul>
          <li>Hit the <strong>rerun</strong> button <i class="fas fa-sync-alt" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-refresh</span> to load the parameters you used before:
            <ul>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúlist‚Äù</em>: the <code class="language-plaintext highlighter-rouge">list</code> output from <strong>Cluster.split</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúcount‚Äù</em>: the <code class="language-plaintext highlighter-rouge">count table</code> from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äútaxonomy‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Remove.groups</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
              <li><em>‚Äúlabel‚Äù</em>: <code class="language-plaintext highlighter-rouge">0.03</code></li>
            </ul>
          </li>
          <li>Add new parameter setting:
            <ul>
              <li><em>‚Äúpersample - allows you to find a consensus taxonomy for each group‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
            </ul>
          </li>
        </ul>

        <p><br /> You should now have a collection with per-sample files <br /><br /></p>
      </li>
      <li><strong>Taxonomy-to-Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúTaxonomy file‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> collection from <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        </ul>
      </li>
      <li><strong>Krona pie chart</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
        <ul>
          <li><em>‚ÄúType of input‚Äù</em>: <code class="language-plaintext highlighter-rouge">Tabular</code></li>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúInput file‚Äù</em>: the collection from <strong>Taxonomy-to-Krona</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
          <li><em>‚ÄúCombine data from multiple datasets?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        </ul>
      </li>
    </ol>

    <p><br /> The final result should look something like this (switch between samples via the list on the left): <br /><br /></p>

    <iframe id="krona" src="krona_multisample.html" frameborder="0" width="100%" height="900px"> ![Krona](../../images/krona_multisample.png) </iframe>

  </blockquote>
</blockquote>

<h2 id="phinch">Phinch</h2>

<p>We may now wish to further visualize our results. We can convert our <em>shared</em> file to the more widely used <code class="language-plaintext highlighter-rouge">biom</code> format and
view it in a platform like <a href="http://www.phinch.org/">Phinch</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-phinch"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Phinch</h3>

  <ol>
    <li><strong>Make.biom</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚Äúshared‚Äù</em>: the output from <strong>Sub.sample</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚Äúconstaxonomy‚Äù</em>: the <code class="language-plaintext highlighter-rouge">taxonomy</code> output from <strong>Classify.otu</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúmetadata‚Äù</em>: the <code class="language-plaintext highlighter-rouge">mouse.dpw.metadata</code> file you uploaded at the start of this tutorial</li>
      </ul>
    </li>
    <li><strong>View</strong> the file in Phinch
      <ul>
        <li>If you expand the the output biom dataset, you will see a link to view the file at Phinch</li>
      </ul>

      <p><img src="../../../../shared/images/viewatphinch.png" alt="Icon to view at Phinch" /></p>

      <ul>
        <li>Click on this link (‚Äúview biom at Phinch‚Äù)</li>
      </ul>
    </li>
  </ol>

  <p>This link will lead you to a Phinch server (hosted by <span class="notranslate">Galaxy</span>), which will automatically load your file, and
 where you can several interactive visualisations:
 <img src="../../../../shared/images/phinch_overviewpage.png" alt="Phinch overview" /></p>

  <blockquote class="comment">
    <h3 id="comment-no-link-to-phinch-on-your-dataset"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> No link to Phinch on your dataset?</h3>

    <p>If this visualisation link is not present on your <span class="notranslate">Galaxy</span> dataset, you can download the generated BIOM file from <span class="notranslate">Galaxy</span>,
and upload it directly to the Phinch server at <a href="https://usegalaxy.eu/phinch/index.html">https://use<span class="notranslate">galaxy</span>.eu/phinch/</a>. <br /><br /></p>

    <p><strong>Important:</strong> After downloading, please change the file extension from <code class="language-plaintext highlighter-rouge">.biom1</code> to <code class="language-plaintext highlighter-rouge">.biom</code> before uploading to Phinch. <br /><br /></p>

    <p><strong>Note:</strong> This link will visualize your data in Phinch version 1. Recently, Phinch have released version 2 as a desktop application.
This file can also be visualized in Phinch2, but requires installation of Phinch to your local machine</p>
  </blockquote>
</blockquote>

<h1 class="no_toc" id="conclusion">Conclusion</h1>

<p>Well done! <i class="fas fa-trophy" aria-hidden="true"></i><span class="visually-hidden">trophy</span> You have completed the basics of the Schloss lab‚Äôs <a href="https://www.mothur.org/wiki/MiSeq_SOP">Standard Operating Procedure for Illumina MiSeq data</a>. You have worked your way through the following pipeline:</p>

<p><img src="../../images/mothur_sop_pipeline.jpg" alt="mothur sop tutorial pipeline" width="50%" /></p>



                    
                    <blockquote class="key_points">
                        <h3><i class="fas fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>
                        <ul>
                            
                            <li><p>16S rRNA gene sequencing analysis results depend on the many algorithms used and their settings</p>
</li>
                            
                            <li><p>Quality control and cleaning of your data is a crucial step in order to obtain optimal results</p>
</li>
                            
                            <li><p>Adding a mock community to serve as a control sample can help you asses the error rate of your experimental setup</p>
</li>
                            
                            <li><p>We can explore alpha and beta diversities using Krona and Phinch for dynamic visualizations</p>
</li>
                            
                        </ul>
                    </blockquote>
                    

                    
                    <h1 data-toc-skip>Useful literature</h1>
                    <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/metagenomics#references">here</a>.</p>
                    

                    
                    <h1 id="bibliography">References</h1>
                    <ol class="bibliography"><li><span id="DeSantis2006">DeSantis, T. Z., P. Hugenholtz, N. Larsen, M. Rojas, E. L. Brodie <i>et al.</i>, 2006 <b>Greengenes,  a Chimera-Checked 16S rRNA Gene Database and Workbench Compatible with ARB</b>. Applied and Environmental Microbiology 72: 5069‚Äì5072.</span>
    
    
    <a href="https://doi.org/10.1128/aem.03006-05">10.1128/aem.03006-05</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Liu2008">Liu, Z., T. Z. DeSantis, G. L. Andersen, and R. Knight, 2008 <b>Accurate taxonomy assignments from 16S rRNA sequences produced by highly parallel pyrosequencers</b>. Nucleic Acids Research 36: e120‚Äìe120.</span>
    
    
    <a href="https://doi.org/10.1093/nar/gkn491">10.1093/nar/gkn491</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Schloss2009">Schloss, P. D., S. L. Westcott, T. Ryabin, J. R. Hall, M. Hartmann <i>et al.</i>, 2009 <b>Introducing mothur: Open-Source,  Platform-Independent,  Community-Supported Software for Describing and Comparing Microbial Communities</b>. Applied and Environmental Microbiology 75: 7537‚Äì7541.</span>
    
    
    <a href="https://doi.org/10.1128/aem.01541-09">10.1128/aem.01541-09</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Wooley2010">Wooley, J. C., A. Godzik, and I. Friedberg, 2010 <b>A Primer on Metagenomics</b> (P. E. Bourne, Ed.). PLoS Computational Biology 6: e1000667.</span>
    
    
    <a href="https://doi.org/10.1371/journal.pcbi.1000667">10.1371/journal.pcbi.1000667</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Federhen2011">Federhen, S., 2011 <b>The NCBI Taxonomy database</b>. Nucleic Acids Research 40: D136‚ÄìD143.</span>
    
    
    <a href="https://doi.org/10.1093/nar/gkr1178">10.1093/nar/gkr1178</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="BonillaRosso2012">Bonilla-Rosso, G., L. E. Eguiarte, D. Romero, M. Travisano, and V. Souza, 2012 <b>Understanding microbial community diversity metrics derived from metagenomes: performance evaluation using simulated data sets</b>. FEMS Microbiology Ecology 82: 37‚Äì49.</span>
    
    
    <a href="https://doi.org/10.1111/j.1574-6941.2012.01405.x">10.1111/j.1574-6941.2012.01405.x</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Schloss2012">Schloss, P. D., 2012 <b>Secondary structure improves OTU assignments of 16S rRNA gene sequences</b>. The ISME Journal 7: 457‚Äì460.</span>
    
    
    <a href="https://doi.org/10.1038/ismej.2012.102">10.1038/ismej.2012.102</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Quast2012">Quast, C., E. Pruesse, P. Yilmaz, J. Gerken, T. Schweer <i>et al.</i>, 2012 <b>The SILVA ribosomal RNA gene database project: improved data processing and web-based tools</b>. Nucleic Acids Research 41: D590‚ÄìD596.</span>
    
    
    <a href="https://doi.org/10.1093/nar/gks1219">10.1093/nar/gks1219</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Cole2013">Cole, J. R., Q. Wang, J. A. Fish, B. Chai, D. M. McGarrell <i>et al.</i>, 2013 <b>Ribosomal Database Project: data and tools for high throughput rRNA analysis</b>. Nucleic Acids Research 42: D633‚ÄìD642.</span>
    
    
    <a href="https://doi.org/10.1093/nar/gkt1244">10.1093/nar/gkt1244</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Fouhy2016">Fouhy, F., A. G. Clooney, C. Stanton, M. J. Claesson, and P. D. Cotter, 2016 <b>16S rRNA gene sequencing of mock microbial populations- impact of DNA extraction method,  primer choice and sequencing platform</b>. BMC Microbiology 16:</span>
    
    
    <a href="https://doi.org/10.1186/s12866-016-0738-z">10.1186/s12866-016-0738-z</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Singer2016">Singer, E., B. Andreopoulos, R. M. Bowers, J. Lee, S. Deshpande <i>et al.</i>, 2016 <b>Next generation sequencing data of a defined microbial mock community</b>. Scientific Data 3: 160081.</span>
    
    
    <a href="https://doi.org/10.1038/sdata.2016.81">10.1038/sdata.2016.81</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Rognes2016">Rognes, T., T. Flouri, B. Nichols, C. Quince, and F. Mah√©, 2016 <b>VSEARCH: a versatile open source tool for metagenomics</b>. PeerJ 4: e2584.</span>
    
    
    <a href="https://doi.org/10.7717/peerj.2584">10.7717/peerj.2584</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Finotello2016">Finotello, F., E. Mastrorilli, and B. D. Camillo, 2016 <b>Measuring the diversity of the human microbiota with targeted next-generation sequencing</b>. Briefings in Bioinformatics bbw119.</span>
    
    
    <a href="https://doi.org/10.1093/bib/bbw119">10.1093/bib/bbw119</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li>
<li><span id="Balvoit2017">Balvoƒçi≈´tƒó, M., and D. H. Huson, 2017 <b>SILVA,  RDP,  Greengenes,  NCBI and OTT ‚Äî how do these taxonomies compare?</b> BMC Genomics 18:</span>
    
    
    <a href="https://doi.org/10.1186/s12864-017-3501-4">10.1186/s12864-017-3501-4</a>
    
    
      <!-- prevent duplicate doi links -->
      
    

</li></ol>
                    

                    <h1>Feedback</h1>
                    <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                    <div id="feedback-button">
                        <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                    </div>
                    <div id="feedback-form">
                    </div>
                    <script type="text/javascript">
                        (function (window, document) {
                            function onDocumentReady(fn) {
                                if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                    fn();
                                } else {
                                    document.addEventListener('DOMContentLoaded', fn);
                                }
                            }

                            onDocumentReady(function () {
                                $("#feedback-button").click(function(evt){
                                    var e = $(evt.target)
                                    e.hide();

                                    $("#feedback-form").html(`
                                        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=16S Microbial Analysis with mothur (extended) (Metagenomics)">Loading...</iframe>
                                    `)
                                })
                            });
                        })(window, document);
                    </script>



                    <h1>Citing this Tutorial</h1>
                    <p>
                        <ol>
                            <li id="citation-text">Saskia Hiltemann, B√©r√©nice Batut, Dave Clements, 2021 <b>16S Microbial Analysis with mothur (extended) (Galaxy Training Materials)</b>. <a href="/training-material/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.html">/training-material/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.html</a> Online; accessed TODAY
                            </li>
                            <li>
                            Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                            </li>
                        </ol>
                    </p>


                    <blockquote class="details">
                      <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                      <p style="display: none;">

                    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{metagenomics-mothur-miseq-sop,
    author = "Saskia Hiltemann and B√©r√©nice Batut and Dave Clements",
    title = "16S Microbial Analysis with mothur (extended) (Galaxy Training Materials)",
    year = "2021",
    month = "01",
    day = "06"
    url = "\url{/training-material/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.html}",
    note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
        doi = {10.1016/j.cels.2018.05.012},
        url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
        year = 2018,
        month = {jun},
        publisher = {Elsevier {BV}},
        volume = {6},
        number = {6},
        pages = {752--758.e1},
        author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
        title = {Community-Driven Data Analysis Training for Biology},
        journal = {Cell Systems}
}</code>
                    </pre></div></div>
                    </p>
                    </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                </div>
            </div>
        </div>

        <h3><i class="far fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Saskia Hiltemann, B√©r√©nice Batut, Dave Clements)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/metagenomics/tutorials/mothur-miseq-sop/tutorial.md">GitHub</a>.
        </p>
        <p>
    The content of the tutorials and website is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
