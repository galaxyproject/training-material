<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Mass spectrometry imaging: Loading and exploring MSI data</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Training material for proteomics workflows in Galaxy" />
        <meta property="og:title" content="Galaxy Training: Mass spectrometry imaging: Loading and exploring MSI data" />
        <meta property="og:description" content="Training material for proteomics workflows in Galaxy" />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<!-- Gitter -->


<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'Galaxy-Training-Network/Lobby'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/proteomics" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">topic</span> Proteomics
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Language Selector">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Language
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                Fran√ßais
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                Êó•Êú¨Ë™û
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                Espa√±ol
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                Portugu√™s
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fproteomics%2Ftutorials%2Fmass-spectrometry-imaging-loading-exploring-data%2Ftutorial.html&edit-text=&act=url" title="">
                                And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>

        <div class="dropdown-item">
            <div>
                Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
            </div>

        </div>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.md">
                            <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Mass spectrometry imaging: Loading and exploring MSI data",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Proteomics",
    "description": "Training material for proteomics workflows in Galaxy",
    "url": "https://training.galaxyproject.org//training-material/topics/proteomics/"
  },
  "courseCode": "proteomics / mass-spectrometry-imaging-loading-exploring-data / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Mass spectrometry imaging: Loading and exploring MSI data' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.html",
  "timeRequired": "PT45M",
  "description": "The questions this  addresses are:\n - Did the tryptic digestions work?\n - Is there an intensity gradient in the data?\n - How good is the m/z accuracy?\n\n\\nThe objectives are:\n - How to upload an imzML file into Galaxy\n - Getting an overview of the MSI data with the MSI quality control tool\n - How to export MSI data as tabular files\n\n",
  "coursePrerequisites": [
    {
      "@type": "CreativeWork",
      "url": "https://training.galaxyproject.org//training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Melanie F√∂ll"
    },
    {
      "@type": "Person",
      "name": "Bj√∂rn Gr√ºning"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Melanie F√∂ll"
    },
    {
      "@type": "Person",
      "name": "Bj√∂rn Gr√ºning"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Proteomics",
      "description": "Training material for proteomics workflows in Galaxy",
      "url": "https://training.galaxyproject.org//training-material/topics/proteomics/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/topic_0121",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "topic_0121",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_0121"
    }
  ],
  "skillLevel": "Introductory"
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Mass spectrometry imaging: Loading and exploring MSI data</h1>
        

        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame/foellmelanie/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/foellmelanie" alt="Melanie F√∂ll">Melanie F√∂ll</a>, <a href="/training-material/hall-of-fame/bgruening/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/bgruening" alt="Bj√∂rn Gr√ºning">Bj√∂rn Gr√ºning</a>

</div>

        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li><p>Did the tryptic digestions work?</p>
</li>
            
            <li><p>Is there an intensity gradient in the data?</p>
</li>
            
            <li><p>How good is the m/z accuracy?</p>
</li>
            
            </ul>

            <strong><i class="fas fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li><p>How to upload an imzML file into Galaxy</p>
</li>
            
            <li><p>Getting an overview of the MSI data with the MSI quality control tool</p>
</li>
            
            <li><p>How to export MSI data as tabular files</p>
</li>
            
            </ul>

            
            <strong><i class="fas fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

            
            </ul>
            

            
            <p><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 45 minutes</p>
            

            
            <p><strong><i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> Level: </strong>
             Introductory 
<span class="level introductory" title="Introductory Tutorial">
  <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span>
</span>

</p>
            

            
            

            
            <p id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></p>
            <ul>
                <div class="supporting_material">
                

                
                    <li class="btn btn-default supporting_material">
<a class="topic-icon" href="https://doi.org/10.5281/zenodo.1560645">
    <i class="far fa-copy" aria-hidden="true"></i><span class="visually-hidden">zenodo_link</span> Datasets
</a>

</li>
                

                
                    <li class="btn btn-default supporting_material">
    <a class="topic-icon" href="/training-material/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/workflows/" title="Workflows" alt="Mass spectrometry imaging: Loading and exploring MSI data workflows">
        <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> Workflows
    </a>

</li>
                

                

                
                    <li class="btn btn-default supporting_material">

    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span> Available on these Galaxies
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/proteomics/docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://africa.usegalaxy.eu/" title="Galaxy Africa">
            Galaxy Africa
        </a>
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://galaxy.genouest.org" title="Galaxy@GenOuest">
            Galaxy@GenOuest
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.eu" title="UseGalaxy.eu">
            UseGalaxy.eu
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.no/" title="UseGalaxy.no">
            UseGalaxy.no
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.org.au" title="UseGalaxy.org.au">
            UseGalaxy.org.au
        </a>
        
    
        
    
    </ul>


</li>
                
                </div>
            </ul>
            

            <p><strong> <i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Last modification:</strong> Jan 6, 2021 </p>
        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <h1 class="no_toc" id="introduction">Introduction</h1>

<p>Mass spectrometry imaging (MSI) is applied to measure the spatial distribution of hundreds of biomolecules in a sample. A mass spectrometer scans over the entire sample and collects a mass spectrum every 5-200 ¬µm. This results in thousands of spots in which a mass spectrum is acquired. Each mass spectrum consists of hundreds of analytes that are measured by their mass-to-charge (m/z) ratio. For each analyte the peak intensity in the mass spectra of every pixel is known and can be set together to map the spatial distribution of the analyte in the sample.</p>

<p>The technique has a broad range of applications as it is able to measure many different kinds of analytes such as peptides, proteins, metabolites or chemical compounds in a large variety of samples such as cells, tissues and liquid biopsies. Application areas include pharmacokinetic studies, biomarker discovery, molecular pathology, forensic studies, plant research and material sciences. The strength of MSI is the simultaneous analysis of hundreds of analytes in an unbiassed, untargeted, label free, fast and affordable measurement while maintaining morphological information.</p>

<p>Depending on the analyte of interest and the application, different mass spectrometers are used. A mass spectrometer measures the analytes by ionizing, evaporating and sorting them by their mass-to-charge (m/z) ratio. Put simply, a mass spectrometer needs basically three parts: an ionization source, a mass analyzer and a detector. Most common ionization sources for MSI are MALDI (Matrix Assisted Laser Desorption/Ionization), DESI (Desorption Electrospray Ionization) and SIMS (Secondary Ion Mass Spectrometry).</p>

<figure id="figure-1"><img src="../../images/MSI1_maldi_tof_imaging.png" alt="MSI measurement" /><figcaption><span class="figcaption-prefix">Figure 1:</span> MALDI TOF imaging of a mouse kidney</figcaption></figure>

<p>One common type of mass spectrometer for MSI is a MALDI Time-Of-Flight (MALDI-TOF) device. During MALDI ionization a laser shoots onto the sample that was covered with a special matrix which absorbs the laser energy and transfers it to the analytes. This process evaporizes and ionizes the analytes that due to their charge can then be accelerated in an electrical field towards the TOF tube. The time of flight through the tube to the detector is measured and as this correlates with the mass over charge (m/z) of the analyte, the flight time allows the calculation of m/z. During measurement complete mass spectra with hundreds of m/z - intensity pairs are acquired in thousands of sample plots leading to big and complex data. Each mass spectrum is annotated with coordinates (x,y) that define its location in the sample. This allows to visualize the intensity distribution of each m/z feature in the sample as a heatmap. Depending on the analyte of interest, the sample type and the mass spectrometer the sample preparation steps as well as the properties of the acquired data differ.</p>

<p>This tutorial introduces the handling of the mass spectrometry imaging (MSI) file type imzML in <span class="notranslate">Galaxy</span> and some first steps to explore the data.
The imzML file format was introduced to ease the exchange of MSI data between different instruments and data analysis software (<a href="https://doi.org/10.1016/j.jprot.2012.07.026">Schramm et al., Jou<span class="notranslate">rna</span>l of Proteomics, 2012</a>). More and more vendors provide an imzML export option and there are <a href="https://ms-imaging.org/wp/imzml/software-tools/">software solutions</a> to convert proprietary files into imzML files. Before starting any analysis it is recommended to visualize all features of the data in different ways to better understand the data and to obtain an idea about it‚Äôs quality and usefulness.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will deal with:</p>

<ol id="markdown-toc">
  <li><a href="#uploading-an-imzml-file-into-galaxy" id="markdown-toc-uploading-an-imzml-file-into-galaxy">Uploading an imzML file into <span class="notranslate">Galaxy</span></a></li>
  <li><a href="#exploring-msi-data-with-the-msi-qualitycontrol-tool" id="markdown-toc-exploring-msi-data-with-the-msi-qualitycontrol-tool">Exploring MSI data with the MSI Qualitycontrol tool</a></li>
  <li><a href="#exporting-msi-data-to-tabular-files-for-further-exploration-of-the-data" id="markdown-toc-exporting-msi-data-to-tabular-files-for-further-exploration-of-the-data">Exporting MSI data to tabular files for further exploration of the data</a></li>
</ol>

</blockquote>

<h1 id="uploading-an-imzml-file-into-galaxy">Uploading an imzML file into <span class="notranslate">Galaxy</span></h1>

<p>In case no direct imzML export is provided by the mass spectrometer software, proprietary files can be converted to imzML files with the tools provided on the following website: <a href="https://ms-imaging.org/wp/imzml/software-tools/">ms-imaging.org</a>.
The imzML file consists of two files: The first file contains the metadata in an XML file and has the extension <code class="language-plaintext highlighter-rouge">.imzML</code>. The second file contains the mass spectra data and is saved as binary file and its extension is <code class="language-plaintext highlighter-rouge">.ibd</code>. To be valid both files must have the same filename before the extension. More information about the imzML file structure can be found here: <a href="https://ms-imaging.org/wp/imzml/data-structure/">ms-imaging.org</a>. <span class="notranslate">Galaxy</span> provides the <code class="language-plaintext highlighter-rouge">composite</code> upload for files consisting of several components.</p>

<p>The data for this tutorial comes from MALDI-TOF imaging of peptides in a mouse kidney. To make computation times more suitable for this training, only the m/z range from 1220 - 1625 and a part of the pixels (purple rectangle in figure 1) containing about half of the kidney and one digestion control spot were kept.</p>

<figure id="figure-2"><img src="../../images/MSI1_mouse_kidney.png" alt="mouse kidney image" /><figcaption><span class="figcaption-prefix">Figure 2:</span> Mouse kidney sample before and after mass spectrometry measurement and H&amp;E staining</figcaption></figure>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-uploading-an-imzml-file"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Uploading an imzML file</h3>

  <ol>
    <li>
      <p><strong>Create a new history</strong> and give it a name.</p>

      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-history"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new history</h3>

        <p>Click the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel</p>

        <p>If the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>
        <ol>
          <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>
          <li>Select the option <strong>Create New</strong> from the menu</li>
        </ol>
      </blockquote>
    </li>
    <li>
      <p>Upload the data from <a href="https://zenodo.org/record/1560646">Zenodo</a> via the <strong>composite</strong> option</p>

      <blockquote class="tip">
        <h3 id="tip-tip-upload-via-the-composite-option"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Upload via the composite option</h3>
        <ul>
          <li>Open the <span class="notranslate">Galaxy</span> Upload Manager(<i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-upload</span> on the top-right of the tool panel)</li>
          <li>Click on <strong>Composite</strong> on the top</li>
          <li>Set <strong>Composite Type</strong> to <code class="language-plaintext highlighter-rouge">imzml</code></li>
          <li>Expand the first <strong>Select</strong> button (for the imzML metadata component)</li>
          <li>Select <strong>Paste/Fetch data</strong> and paste
            <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/1560646/files/mouse_kidney_cut.imzML
</code></pre></div>            </div>
          </li>
          <li>Expand the second <strong>Select</strong> button (for the mass spectral data component)</li>
          <li>Select <strong>Paste/Fetch data</strong> and paste
            <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/1560646/files/mouse_kidney_cut.ibd
</code></pre></div>            </div>
          </li>
          <li>Press <strong>Start</strong></li>
          <li><strong>Close</strong> the window</li>
        </ul>
      </blockquote>

      <figure id="figure-3"><img src="../../images/MSI1_upload_composite.png" alt="Upload imzML files" /><figcaption><span class="figcaption-prefix">Figure 3:</span> Upload an imzML file via the composite upload</figcaption></figure>

      <blockquote class="tip">
        <h3 id="tip-tip-ftp-upload-for-large-files"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: FTP upload for large files</h3>
        <ul>
          <li>In case one subfile is larger than 2 GB the uploading needs to be done via ftp.</li>
          <li>The necessary steps are explained in this tutorial <a href="/training-material/topics/galaxy-interface/tutorials/get-data/slides.html">Getting data into <span class="notranslate">Galaxy</span></a></li>
        </ul>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-tip-uploading-an-analyze75-file"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Uploading an Analyze7.5 file</h3>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Analyze7.5</code> files are also supported by <span class="notranslate">Galaxy</span>.</li>
          <li>The file consists of three components and is therefore uploaded via the ‚Äòcomposite‚Äô function, analogously to the imzML upload.</li>
          <li>The files to select in the <code class="language-plaintext highlighter-rouge">composite</code> tab are the header file <code class="language-plaintext highlighter-rouge">.hdr</code>, the m/z values file <code class="language-plaintext highlighter-rouge">.t2m</code> and the spectra file <code class="language-plaintext highlighter-rouge">.img</code>.</li>
        </ul>
      </blockquote>
    </li>
    <li>
      <p>Rename the data into <code class="language-plaintext highlighter-rouge">mouse_kidney_cut</code></p>

      <blockquote class="tip">
        <h3 id="tip-tip-rename-a-dataset"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Rename a dataset</h3>
        <ul>
          <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>
          <li>In the central panel, change the <strong>Name</strong> field to <code class="language-plaintext highlighter-rouge">mouse_kidney_cut</code></li>
          <li>Click the <strong>Save</strong> button</li>
        </ul>
      </blockquote>
    </li>
  </ol>
</blockquote>

<h1 id="exploring-msi-data-with-the-msi-qualitycontrol-tool">Exploring MSI data with the MSI Qualitycontrol tool</h1>

<p>Before starting any analysis, it is important to confirm that the quality of the acquired data is sufficient.
Furthermore, knowing the data‚Äôs properties is important to choose the right preprocessing steps and parameters.
The steps that most influence the spatial delocalization and preparation quality in an MALDI imaging experiment is the homogeneous matrix deposition and for peptide analysis in addition the trypsin deposition and digestion step as reported by <a href="https://doi.org/10.1002/prca.201800029">Ly et al.</a>. To monitor the digestion quality, three <em>Bombesin</em> peptide drops were spotted close to the tissue. Furthermore, the mouse kidney dataset contains inte<span class="notranslate">rna</span>l calibrants that were sprayed together with the matrix onto the tissue and can be used to monitor intensity gradients and mass accuracy. The used calibrants were <em>Angiotensin I</em>, <em>Substance P</em>, <em>Fibrinopeptide B</em> and <em>ACTH_18-39</em>.</p>

<p>The <em>*MSI Qualitycontrol</em> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> provides a fast way to obtain plenty of descriptive statistic plots for MSI datasets.
Inte<span class="notranslate">rna</span>l calibrants or other known, ubiquitous m/z features can be used to obtain further quality measures, such as m/z accuracies.</p>

<p>The mouse kidney dataset contains inte<span class="notranslate">rna</span>l calibrants that were sprayed together with the matrix onto the tissue. The used calibrants were <em>Angiotensin I</em>, <em>Substance P</em>,
<em>Fibrinopeptide B</em> and <em>ACTH_18-39</em>. We furthermore spotted <em>Bombesin</em> peptides close to the tissue to monitor the digestion quality with the fold change of digested vs. undigested <em>Bombesin</em>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-running-the-msi-qualitycontrol-tool"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Running the MSI Qualitycontrol tool</h3>
  <ol>
    <li>Create the tabular file with the m/z values of the inte<span class="notranslate">rna</span>l calibrants:
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m/z       name
1296.69    Angiotensin_I
1347.72    Substance_P
1570.68    Fibrinopeptide_B
2465.19    ACTH_18-39
</code></pre></div>      </div>
      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-file"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new file</h3>

        <ul>
          <li>Open the <span class="notranslate">Galaxy</span> Upload Manager</li>
          <li>Select <strong>Paste/Fetch Data</strong></li>
          <li>
            <p>Paste the file contents into the text field</p>
          </li>
          <li>From the Settings menu (<i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-gear</span>) select <strong>Convert spaces to tabs</strong></li>
          <li>Press <strong>Start</strong> and <strong>Close</strong> the window</li>
        </ul>
      </blockquote>
    </li>
    <li>
      <p><strong>Rename dataset</strong> to <code class="language-plaintext highlighter-rouge">Calibrants</code></p>

      <blockquote class="tip">

        <h3 id="tip-tip-renaming-a-dataset"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Renaming a dataset</h3>
        <ul>
          <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"><span class="notranslate">galaxy</span>-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>
          <li>In the central panel, change the <strong>Name</strong> field  to <code class="language-plaintext highlighter-rouge">Calibrants</code></li>
          <li>Click the <strong>Save</strong> button</li>
        </ul>
      </blockquote>
    </li>
    <li>Run the <strong>MSI Qualitycontrol</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúMSI data‚Äù</em>: <code class="language-plaintext highlighter-rouge">mouse_kidney_cut imzML</code> will be automatically recognized as input file</li>
        <li><em>‚ÄúTitle‚Äù</em>: <code class="language-plaintext highlighter-rouge">Mouse kidney introduction tutorial</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúm/z of interest‚Äù</em>: Select the <code class="language-plaintext highlighter-rouge">Calibrants</code> tabular file</li>
        <li><em>‚ÄúColumn with m/z values‚Äù</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
        <li><em>‚ÄúColumn with name of m/z values‚Äù</em>: <code class="language-plaintext highlighter-rouge">Column: 2</code></li>
        <li><em>‚ÄúTabular file contains a header line‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>‚ÄúPlot fold change of two m/z‚Äù</em>: <code class="language-plaintext highlighter-rouge">Insert Plot fold change of two m/z</code></li>
        <li><em>‚ÄúM/z 1‚Äù</em>: <code class="language-plaintext highlighter-rouge">1224.63</code> (digested <em>Bombesin</em>)</li>
        <li><em>‚ÄúM/z 2‚Äù</em>: <code class="language-plaintext highlighter-rouge">1619.89</code> (full length <em>Bombesin</em>)</li>
        <li>Press <strong>Execute</strong></li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>Open the pdf by clicking on the eye icon (view data) and answer the following questions according to the summary table on the first page.</p>

<blockquote class="question">
  <h3 id="question-questions"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many m/z features does the dataset contain?</li>
    <li>Are the spectra in profile mode or centroided?</li>
    <li>What is the median number of peaks per spectrum and how can this number be interpreted?</li>
    <li>How many of the provided Calibrants were valid?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>9013</li>
      <li>Centroided = FALSE means that the data were read in profile mode. The user has to define in every tool if the input data is in profile or centroided mode. The Centroid value reported here corresponds to the choice the user has made in the tool and not by automatic recognition. To find out what the correct choice is visit <a href="/training-material/topics/metabolomics/tutorials/msi-analyte-distribution/tutorial.html#quality-control-of-the-data">Mass spectrometry imaging: Examining the spatial distribution of analytes</a>.</li>
      <li>Median # peaks per spectrum: 4158. The <strong>MSI Qualitycontrol</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> consideres intensities &gt; 0 as peaks. Before peak picking this means that also noise with small intensities is counted as peak what explains why nearly every second m/z value has an intensity &gt; 0 (4158 peaks /9013 m/z values). After peak picking the number of peaks will decrease dramatically because only real peaks will be left.</li>
      <li>3 Calibrants out of the 4 Calibrants in the tabular files were valid, that means in the m/z range of the dataset. As we cut the m/z axis for this tutorial, <em>ACTH</em> is outside the m/z range that we kept (1220 - 1625).</li>
    </ol>
  </blockquote>
</blockquote>

<p>Each plot of the <strong>MSI Qualitycontrol</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> is described in the help section at the bottom of the tool, this tutorial will discuss a few selected plots in more detail.</p>

<h4 id="digestion-efficiency">Digestion efficiency</h4>

<p>The complete digestion of proteins into peptides is a crucial step when performing mass spectrometry of peptides. In MSI the digestion is further hindered by the fact that digestion has to occur on the tissue. One way to control digestion efficiency was suggested by <a href="https://www.sciencedirect.com/science/article/pii/S1570963916301820?via%3Dihub">Erich et al.</a>. They spotted <em>cytochrome c</em> next to the tissue before and after digestion and compared the protein intensities in the two spots.</p>

<p>For the mouse kidney dataset we applied a similar approach and added three <em>bombesin</em> spots next to the kidney tissue (Figure 2) before digestion. <em>Bombesin</em> has the amino acid sequence QRLGNQWAVGHLM and a mass of 1619.89 Da. During trypsin digestion <em>bombesin</em> is cleaved by trypsin after arginin (R) what leads to the cleaved peptide LGNQWAVGHLM with a mass of 1224.63 Da. The digestion efficiency can be estimated from the log2 ratio (fold change) of these two peptides in the pixels of the <em>bombesin</em> spot.</p>

<p>The fold change plots are on page 4 and 5 of the pdf report. The first plot shows the average mass spectra for the digested and the undigested <em>bombesin</em> peptides. The blue lines indicate the provided m/z value and the chosen ppm range. The average intensity of the full length <em>bombesin</em> peptide is higher than the one of the digested peptide but the average intensity is not helpful here, because we only spotted one drop next to the tissue and only the intensity fold change in those pixels is important. The spectra plot is useful to control the chosen m/z value and ppm range. To obtain the log2 fold change in each spectrum, for each peptide the intensities in the m/z ranges are averaged, the intensity of the first m/z feature is divided by the intensity of the second m/z feature and log2 transformed. The log2 fold change for each spectrum (pixel) is plotted on page 5 and reveals that many spectra in the upper left corner (where the <em>bombesin</em> spot is) have a log2 fold change &gt;= 0 what indicates that there is more digested than undigested <em>bombesin</em> peptides and that the tryptic digestion was successful.</p>

<figure id="figure-4"><img src="../../images/MSI1_foldchange.png" alt="Fold Change" /><figcaption><span class="figcaption-prefix">Figure 4:</span> Avererage mass spectra and log2 fold change for Bombesin and its digested peptide</figcaption></figure>

<h4 id="distribution-images-for-calibrants">Distribution images for Calibrants</h4>

<p>Have a look at the calibrant plots from page 6 on, especially regarding the distribution patterns. The colour code shows the intensity of the m/z value that is closest to the input m/z and if the ppm range contains several m/z features their intensities are averaged. The input m/z value and its name are printed on top of the image, the m/z number in the box shows the closest m/z value (that is 1296.68, as the m/z axis consists of mass bins slight differences are expected). Low <em>angiotensin</em> intensities occur at the boarder of the <em>bombesin</em> spot and at the boarder of the kidney tissue and on some spots in the kidney. In general calibrant intensities are higher in the matrix background than on the tissue due to ion suppression effects. <em>Substance P</em> shows also ion suppression in the <em>bombesin</em> spot. The heatmap shows no spatial intensity gradient what indicates that spraying of calibrants and matrix was homogeneous and that the MS performed stable during data acquisition.</p>

<figure id="figure-5"><img src="../../images/MSI1_angiotensin_image.png" alt="Angiotensin heatmap" /><figcaption><span class="figcaption-prefix">Figure 5:</span> Intensity distribution image of Angiotensin I</figcaption></figure>

<blockquote class="comment">
  <h3 id="comment-plotting-heatmaps"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Plotting heatmaps</h3>
  <ul>
    <li>The <strong>MSI mz images</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool allows to generate heatmaps with futher options such as contrast enhancement and smoothing functions. The usage of the tool is explained in more detail in the tutorial <a href="/training-material/topics/metabolomics/tutorials/msi-analyte-distribution/tutorial.html">Mass spectrometry imaging: Examining the spatial distribution of analytes</a>.</li>
  </ul>
</blockquote>

<h4 id="number-of-peaks-and-total-ion-current-images">Number of peaks and total ion current images</h4>

<p>On page 9 the number of peaks per spectrum is plotted and the shape of the kidney can be estimated due to slightly higher number of peaks. The number of peaks is defined as intensity &gt; 0 what means that before peak picking also noise with intensity &gt; 0 is counted in. It is quite common for raw MALDI datasets to have a noise baseline in each spectrum and therefore high amounts of ‚Äòpeaks‚Äô before baseline removal is performed. For the mouse kidney dataset baseline removal was already done during acquisition but as also suggested by the median number of peaks per spectrum in the summary table, about half of every m/z value has an intensity &gt; 0. This suggests to check the mass spectra for a baseline and if applicable remove the baseline during preprocessing of the data.</p>

<p>The plot on page 10 shows the total ion current (TIC) for each spectrum with a few outlier TIC &gt; 25000. The TIC is the sum of all intensities of a spectrum. Therefore with more peaks in a spectrum the TIC should also be higher. Due to their low intensities, noise peaks contribute less to the TIC than analyte peaks, but with the large amount of noise we have in this dataset, this of course also sums up. Deviations in TICs are common in MALDI MSI due to e.g. unhomogeneous matrix spray, ion source contamination or pH gradients. To render the spectra more comparable TIC normalization is a default preprocessing step for MALDI MSI data but is based on the assumption that there are comparable numbers of signals present in each spectrum <a href="https://link.springer.com/article/10.1007%2Fs00216-011-4929-z">Deininger et al.</a>.
Both plots can also serve to check for spraying gradients or reduced machine performance during acquisition time. The mouse kidney was measured from bottom to top (plot on page 2), the performance over time can be easier spotted in the upper plots on page 14 and 15, where the x axis represents the spectra in the order they were measured.</p>

<figure id="figure-6"><img src="../../images/MSI1_npeaks_TIC.png" alt="Npeaks and TIC heatmap" /><figcaption><span class="figcaption-prefix">Figure 6:</span> Number of peaks and TIC per spectrum</figcaption></figure>

<h4 id="most-abundand-mz-features">Most abundand m/z features</h4>

<p>The plot on page 13 shows for each spectrum the m/z with the highest intensity (‚Äòbase peak‚Äô). This plot can already reveal some morphological features of the dataset. The plot for the mouse kidney dataset shows that the base peak is the same on the kidney tissue and the matrix background but a different one in the <em>bombesin</em> spot. According to the legend the base peak in most spectra is roughly at m/z 1350, the base peak in the <em>bombesin</em> spot is roughly at 1280 and in a few spectra at 1570. Later, we will export the spectra information, including the base peak of each spectrum, as a tabular file to find the correct m/z values of the most abundant features in the following spectra: x = 40 y = 50; x = 23, y = 70; x = 20, y = 73.</p>

<figure id="figure-7"><img src="../../images/MSI1_most_abundant.png" alt="most abundant" /><figcaption><span class="figcaption-prefix">Figure 7:</span> Most abundant m/z for each spectrum and three selected pixel for further investigations</figcaption></figure>

<p>As the feature around m/z 1350 is the highest feature in most of the spectra it is no suprise to find this feature as highest peak in the average spectra plot on page 20. The second highest peak is around 1300 m/z. It is obvious that those features are the calibrants <em>substance P</em> and <em>angiotensin</em> as they occur as high intensity peaks on the tissue as well as on the background. At least the concentration of <em>substance P</em> but also the concentration of <em>angiotensin I</em> could be reduced in further experiments. The concentration of <em>fibrinopeptide B</em> is chosen well as the peak at m/z 1570 is visible in most of the spectra plots but does not dominate the spectra as the other two calibrants do.</p>

<h4 id="mz-accuracy">m/z accuracy</h4>

<p>A MSI dataset has not only deviations in the intensity dimension but also in the m/z dimension. Mass shifts can occur due to sample topography, small length changes in the flight tube or instable high voltage power supply. Mass accuracy is important for two reasons: First, the identification of m/z relies on accurate mass values and second, comparing m/z features across several spectra or even samples requires them to have similar values in order to be considered as the same molecule.</p>

<p>For precise m/z measurements the mass spectrometers are regularly calibrated with exte<span class="notranslate">rna</span>l calibrants that are often applied next to the sample. <a href="https://www.sciencedirect.com/science/article/pii/S1874391912003259?via%3Dihub">Gustafsson et al.</a> sprayed calibrants onto the complete sample and after MSI measurement used those inte<span class="notranslate">rna</span>l calibrants to recalibrate every spectra what dramatically reduced the m/z error and improved the identification of the m/z features. The same approach was used for the mouse kidney dataset that we use in this tutorial: three inte<span class="notranslate">rna</span>l calibrants are in the m/z range that we work with. These calibrants enable the calculation of the average m/z error as well as the m/z error in each spectrum.</p>

<p>Starting at page 22 for each of the three calibrants average mass spectra are plotted. Three different m/z ranges are visualized while the fourth plot represents each datapoint as blue dot what helps to estimate the correct window sizes during preprocessing of the data. The dashed blue line represents the theoretical m/z, the red line indicates the m/z with the highest average intensity and the green line shows the m/z value that is closest to the theoretical m/z. For <em>angiotensin I</em> the theoretical m/z value is ~0.06 m/z higher than the peak maximum. There is no m/z value with the exact m/z of <em>angiotensin I</em> (1296.69), the closest m/z value is 1296.6776 (green line). The following barplot (on page 25) shows the average m/z error for each calibrant by taking the difference between the m/z of the peak maximum and the theoretical m/z. For <em>angiotensin I</em> this is 1296.6346 - 1296.69 = -0.0554 m/z and corresponds to 0.0554/1296.69*1000000 = 42.7 ppm. The next barplot shows the smallest m/z error that is possible due to the discrete m/z bins of the dataset: the difference between the closest m/z value and the theoretical m/z value.</p>

<p>The average m/z error already gives a hint about the m/z accuracy but it is even more important to consider the m/z error in each individual spectrum. The plot on page 27 shows for each calibrant the m/z error in each spectrum. The spectra index corresponds to the order in which the spectra were measured and it becomes obvious that for all calibrants there is a m/z shift of about 200 ppm happening during acquisition. This gradient is also visible in the following plots where the m/z error in ppm is plotted in each pixel. The ppm error for <em>angiotensin</em> is about +50 ppm at the bottom of the dataset (start of acquisition) and decreases to about -150 ppm at the top of the image (end of acquisition). To be able to compare m/z features across the spectra they need to have the same m/z value, therefore recalibration with the <strong>MALDIquant preprocessing</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> or binning with the <strong>MSI preprocessing</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> and a  tolerance of 200 ppm is highly recommended.</p>

<figure id="figure-8"><img src="../../images/MSI1_mz_error.png" alt="mz error" /><figcaption><span class="figcaption-prefix">Figure 8:</span> Plots that show the average and individual m/z errors</figcaption></figure>

<blockquote class="comment">
  <h3 id="comment-plotting-mass-spectra"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Plotting mass spectra</h3>
  <ul>
    <li>The <strong>MSI plot spectra</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> tool allows to single, average or overlayed mass spectra plots and to zoom into m/z regions of interest. The tool is explained in more detail in the tutorial <a href="/training-material/topics/metabolomics/tutorials/msi-analyte-distribution/tutorial.html">Mass spectrometry imaging: Examining the spatial distribution of analytes</a>.</li>
  </ul>
</blockquote>

<h1 id="exporting-msi-data-to-tabular-files-for-further-exploration-of-the-data">Exporting MSI data to tabular files for further exploration of the data</h1>

<p>The data from the imzML file format is not directly readable, therefore special tools are needed to extract its information. The <strong>MSI data exporter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> provides the option to export spectra, feature and intensity data from imzML files as tabular files. The underlaying values of the quality report can be found in the tabular files and allow to follow up on interesting aspects seen in the quality report plots. Furthermore, tabular files are compatible with most software for statistical analysis and visualization. The intensity matrix of an unprocessed file might be huge as all pixels and all m/z values are stored in the file - therefore, the intensity matrix is often more helpful after preprocessing and filtering of the data. Despite preprocessing and filtering, the output tabular files are often too large for visual inspection. <span class="notranslate">Galaxy</span> offers many different text manipulation tools that are helpful to sort and filter such large tabular files.</p>

<p>To find the m/z value that has the highest mean intensity across all pixels, the feature data can be sorted on the column with the mean intensities. Keep in mind that so far also background spectra are included in the calculation of the mean intensity and those would need to be removed before the mean intensities for the tissue can be calculated.
The spectra data output can be filtered for certain spectra to obtain some spectra properties such as the accurate value of its base peak that could not be accurately determined in the corresponding plot of the quality report before.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-export-and-explore-information-from-msi-data"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Export and explore information from MSI data</h3>

  <ol>
    <li>Run <strong>MSI data exporter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúMSI data‚Äù</em>: <code class="language-plaintext highlighter-rouge">mouse_kidney_cut imzML</code></li>
        <li><em>‚ÄúMultiple output files can be selected‚Äù</em>: <code class="language-plaintext highlighter-rouge">mz feature output</code> and <code class="language-plaintext highlighter-rouge">pixel output</code></li>
      </ul>
    </li>
    <li>Run <strong>Sort data in ascending or descending order</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> from the ‚Äòtext manipulation‚Äô category with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSort Query‚Äù</em>: <code class="language-plaintext highlighter-rouge">Data exporter features</code> (output of <strong>MSI data exporter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúNumber of header lines‚Äù</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
        <li><em>‚Äúon column‚Äù</em>: <code class="language-plaintext highlighter-rouge">column: 3</code></li>
        <li><em>‚Äúin‚Äù</em>: <code class="language-plaintext highlighter-rouge">descending order</code></li>
        <li><em>‚ÄúFlavor‚Äù</em>: <code class="language-plaintext highlighter-rouge">general numeric sort</code></li>
      </ul>
    </li>
    <li>Run <strong>Select lines that match an <span class="notranslate">expression</span></strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> from the ‚Äòfilter and sort‚Äô category with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSelect lines from‚Äù</em>: <code class="language-plaintext highlighter-rouge">Data exporter spectra</code> (output of <strong>MSI data exporter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚Äúthe pattern‚Äù</em>: <code class="language-plaintext highlighter-rouge">(xy_40_40)|(xy_23_70)|(xy_20_73)</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>How many spectra does the dataset contain?</li>
    <li>How many numeric properties does the m/z feature output report?</li>
    <li>Which m/z values have the highest mean intensities over all pixels?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>1581 - Clicking on pixel output file name reveals that it has 1582 lines, every line contains the information of one spectrum, but the first line is a header line (click on dataset ‚ÄúMSI data exporter on data 1: spectra‚Äù in the history, the line number of the file is written below the dataset name)</li>
      <li>7 - The feature file has 8 columns and except for the mz_names, all columns contain numeric properties, that can be used for further calculations.</li>
      <li>The top m/z values are around 1347.71 and its isotopes (+1 m/z). This m/z feature derives from the <em>substance P</em> inte<span class="notranslate">rna</span>l calibrant (the m/z value is not accurate and ondolates a bit because the data was not yet binned or aligned).</li>
    </ol>
  </blockquote>
</blockquote>

<p>Exporting and sorting the feature information reveals that <em>substance P</em> has the highest mean intensity across all spectra what confirms our estimation when examining the average spectrum plot.
Exporting and filtering the spectra information for three pixel that have different base peaks confirms that the calibrants are the most abundant peaks in most of the spectra. <em>Substance P</em> is the base peak in spectrum xy_40_40 and thereby also the most abundant peak in most of the spectra (according to the colouring in the ‚Äòmost abundant m/z in each spectrum‚Äô plot) regardless if they belong to tissue or matrix. Only the pixels that belong to the <em>bombesin</em> spot show different base peaks. In spectrum xy_23_70 <em>angiotensin I</em> is the highest feature while in spectrum xy_20_73 <em>fibrinopeptide B</em> appears as base peak.</p>



                    
                    <blockquote class="key_points">
                        <h3><i class="fas fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>
                        <ul>
                            
                            <li><p>imzML (continuous or processed file type) and Analyze7.5 can be uploaded into Galaxy via the composite upload.</p>
</li>
                            
                            <li><p>The MSI Qualitycontrol tool gives valuable information before starting the analysis.</p>
</li>
                            
                            <li><p>The MSI data exporter can be used any time during the analysis when it is necessary to dig deeper into the data. Galaxy provides many text manipulation tools that can directly be applied on the exported tabular file to filter, sort, plot, ‚Ä¶ the data.</p>
</li>
                            
                        </ul>
                    </blockquote>
                    

                    
                    <h1 data-toc-skip>Useful literature</h1>
                    <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/proteomics#references">here</a>.</p>
                    

                    

                    <h1>Feedback</h1>
                    <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.</p>

                    <div id="feedback-button">
                        <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                    </div>
                    <div id="feedback-form">
                    </div>
                    <script type="text/javascript">
                        (function (window, document) {
                            function onDocumentReady(fn) {
                                if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                    fn();
                                } else {
                                    document.addEventListener('DOMContentLoaded', fn);
                                }
                            }

                            onDocumentReady(function () {
                                $("#feedback-button").click(function(evt){
                                    var e = $(evt.target)
                                    e.hide();

                                    $("#feedback-form").html(`
                                        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Mass spectrometry imaging: Loading and exploring MSI data (Proteomics)">Loading...</iframe>
                                    `)
                                })
                            });
                        })(window, document);
                    </script>



                    <h1>Citing this Tutorial</h1>
                    <p>
                        <ol>
                            <li id="citation-text">Melanie F√∂ll, Bj√∂rn Gr√ºning, 2021 <b>Mass spectrometry imaging: Loading and exploring MSI data (Galaxy Training Materials)</b>. <a href="/training-material/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.html">/training-material/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.html</a> Online; accessed TODAY
                            </li>
                            <li>
                            Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                            </li>
                        </ol>
                    </p>


                    <blockquote class="details">
                      <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                      <p style="display: none;">

                    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{proteomics-mass-spectrometry-imaging-loading-exploring-data,
    author = "Melanie F√∂ll and Bj√∂rn Gr√ºning",
    title = "Mass spectrometry imaging: Loading and exploring MSI data (Galaxy Training Materials)",
    year = "2021",
    month = "01",
    day = "06"
    url = "\url{/training-material/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.html}",
    note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
        doi = {10.1016/j.cels.2018.05.012},
        url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
        year = 2018,
        month = {jun},
        publisher = {Elsevier {BV}},
        volume = {6},
        number = {6},
        pages = {752--758.e1},
        author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
        title = {Community-Driven Data Analysis Training for Biology},
        journal = {Cell Systems}
}</code>
                    </pre></div></div>
                    </p>
                    </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                </div>
            </div>
        </div>

        <h3><i class="far fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Melanie F√∂ll, Bj√∂rn Gr√ºning)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/proteomics/tutorials/mass-spectrometry-imaging-loading-exploring-data/tutorial.md">GitHub</a>.
        </p>
        <p>
    The content of the tutorials and website is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
