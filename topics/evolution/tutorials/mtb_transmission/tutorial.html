<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Identifying tuberculosis transmission links: from SNPs to transmission clusters</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="phylogenetics" />
        <meta property="og:title" content="Galaxy Training: Identifying tuberculosis transmission links: from SNPs to..." />
        <meta property="og:description" content="phylogenetics" />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/evolution" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Evolution
                        </a>
                        
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Languages">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Languages
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            
                              <strong class="dropdown-header">Automatic Translations</strong>
            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url">
                            Fran√ßais
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url">
                            Êó•Êú¨Ë™û
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url">
                            Espa√±ol
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url">
                            Portugu√™s
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url">
                            ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/evolution/tutorials/mtb_transmission/tutorial.html&edit-text=&act=url" title="">
                            And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/evolution/faqs/" title="Check our FAQs for the Evolution topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/evolution/tutorials/mtb_transmission/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/evolution/tutorials/mtb_transmission/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2022-03-01/topics/evolution/tutorials/mtb_transmission/tutorial.html" title="Version 2022-03-01">2022-03-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2022-02-01/topics/evolution/tutorials/mtb_transmission/tutorial.html" title="Version 2022-02-01">2022-02-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/2022-01-01/topics/evolution/tutorials/mtb_transmission/tutorial.html" title="Version 2022-01-01">2022-01-01</a>
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        











<!-- Gitter -->




<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'Galaxy-Training-Network/Lobby'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<script type="application/ld+json">
    


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:33:42 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Identifying tuberculosis transmission links: from SNPs to transmission clusters",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Evolution",
    "description": "phylogenetics",
    "url": "https://training.galaxyproject.org//training-material/topics/evolution/"
  },
  "courseCode": "evolution / mtb_transmission / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Identifying tuberculosis transmission links: from SNPs to transmission clusters' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/evolution/tutorials/mtb_transmission/tutorial.html",
  "timeRequired": "PT2H",
  "description": "The objectives are:\n - Create a SNP alignment\n - Calculate pairwise SNP distances between MTB samples\n - Identify transmission clusters based on SNP distances\n - Study the emergence and spread of drug resistance based on transmission analysis.\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "coursePrerequisites": [
    {
      "@type": "CreativeWork",
      "url": "https://training.galaxyproject.org//training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Galo A. Goig"
    },
    {
      "@type": "Person",
      "name": "Daniela Brites"
    },
    {
      "@type": "Person",
      "name": "Christoph Stritt"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Galo A. Goig"
    },
    {
      "@type": "Person",
      "name": "Daniela Brites"
    },
    {
      "@type": "Person",
      "name": "Christoph Stritt"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Evolution",
      "description": "phylogenetics",
      "url": "https://training.galaxyproject.org//training-material/topics/evolution/"
    }
  ],
  "skillLevel": "Intermediate"
}
</script>

<section class="tutorial topic-evolution">
    <h1 data-toc-skip>Identifying tuberculosis transmission links: from SNPs to transmission clusters</h1>
    
    <div class="alert alert-warning" role="alert">
        <h4 class="alert-heading">Under Development!</h4>
        <p>This tutorial is not in its final state. The content may change a lot in the next months.
        Because of this status, it is also not listed in the topic pages.</p>
    </div>
    


    <div class="contributors-line">Authors: 
<a href="/training-material/hall-of-fame/GaloGS/" class="contributor-badge contributor-GaloGS"><img src="https://avatars.githubusercontent.com/GaloGS?s=27" alt="Avatar">Galo A. Goig</a>


<a href="/training-material/hall-of-fame/dbrites/" class="contributor-badge contributor-dbrites"><img src="https://avatars.githubusercontent.com/dbrites?s=27" alt="Avatar">Daniela Brites</a>


<a href="/training-material/hall-of-fame/cstritt/" class="contributor-badge contributor-cstritt"><img src="https://avatars.githubusercontent.com/cstritt?s=27" alt="Avatar">Christoph Stritt</a>


<a href="https://training.galaxyproject.org/training-material/topics/contributing/" class="contributor-badge contributor-newcontributors"><i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span>Add Contributions!</a>

</div>


    <blockquote class="overview">
        <h3>Overview</h3>
        
        <img alt="Creative Commons License" class="float-right" style="border-width:0; display: inline-block; margin:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" aria-hidden="true" />
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Create a SNP alignment</p>
</li>
        
        <li><p>Calculate pairwise SNP distances between MTB samples</p>
</li>
        
        <li><p>Identify transmission clusters based on SNP distances</p>
</li>
        
        <li><p>Study the emergence and spread of drug resistance based on transmission analysis.</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

        
        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 2 hours</div>
        

        
        <div><strong><i class="fas fa-graduation-cap" aria-hidden="true"></i> Level: </strong>
        


 Intermediate <span class="visually-hidden">Intermediate</span>
<span class="level intermediate" title="Intermediate Tutorial">
  <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i>
</span>

</div>
        

        
        

        
        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            

            
                <li class="btn btn-default supporting_material">


<a class="topic-icon" title="Zenodo datasets used in this tutorial" href="https://zenodo.org/record/6010176">
    <i class="far fa-copy" aria-hidden="true"></i> Datasets
</a>

</li>
            

            
                <li class="btn btn-default supporting_material">


    <a class="topic-icon" href="/training-material/topics/evolution/tutorials/mtb_transmission/workflows/" title="Workflows" alt="Identifying tuberculosis transmission links: from SNPs to transmission clusters workflows">
        <i class="fas fa-share-alt" aria-hidden="true"></i> Workflows
    </a>

</li>
            

            

            

            
            
            
                 <li class="btn btn-default supporting_material">
    <a class="topic-icon" href="/training-material/topics/evolution/tutorials/mtb_transmission/faqs/" title="Frequently Asked Questions" alt="Tutorial FAQs">
        <i class="far fa-question-circle" aria-hidden="true"></i> FAQs
    </a>
  </li>


            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            











  



            
                <li class="btn btn-default supporting_material">


    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span> Available on these Galaxies 
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/main/topics/evolution/docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://africa.usegalaxy.eu/" title="Galaxy Africa">
            Galaxy Africa
        </a>
        
    
        
        <a class="dropdown-item" href="https://india.usegalaxy.eu/" title="Galaxy India">
            Galaxy India
        </a>
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://galaxy.genouest.org" title="Galaxy@GenOuest">
            Galaxy@GenOuest
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a class="dropdown-item" href="https://streetscience.usegalaxy.eu/" title="Street Science">
            Street Science
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.eu" title="UseGalaxy.eu">
            UseGalaxy.eu
        </a>
        
    
        
    
        
        <a class="dropdown-item" href="https://usegalaxy.no/" title="UseGalaxy.no">
            UseGalaxy.no
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    </ul>


</li>
            
        </ul>
        

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Mar 16, 2022 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>
            
            <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">The GTN Framework is licensed under MIT</a>
        </div>
    </blockquote>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <h1 id="pre-requisites">Pre-requisites</h1>
<p>This tutorial assumes that you have watched the respective webinars about (<a href="https://youtu.be/Ddwt-_gQR2M">Drug resistance prediction</a>, <a href="https://youtu.be/1ps_o5rpnmw">Phylogenetic mutations</a>, <a href="https://youtu.be/l4cPUECJ7VU">The concept of clustering</a> and
  <a href="https://youtu.be/kKNgmpy1N94">Genetic distance thresholds</a>) and therefore you understand 1) How genotypic drug susceptibility is determined
based on WGS analysis 2) The concept of clustering. It also assumes that you have completed the tutorial on <a href="https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/tb-variant-analysis/tutorial.html">MTB variant analysis</a>.</p>

<h1 class="no_toc" id="introduction">Introduction</h1>

<p>Now you are familiar with the process of genome sequencing, quality control of sequencing data, <span class="notranslate">mapping</span> and
variant calling. Additionally, you know how to run <code class="language-plaintext highlighter-rouge">TB-profiler</code> in order to detect drug resistance-conferring
mutations and predict drug-resistant phenotypes. However you have only analyzed one sample unrelated to our study for the purpose of
learning. Before starting the transmission analysis, we would need to analyze the 20 samples that we
have been asked to analyze. The process to follow is exactly the same for any sample, meaning that
we would need to analyze the 20 samples following the same steps‚Ä¶ twenty times??? Of course not.</p>

<p>The way you can perform the same analysis tasks on multiple samples at a a time in <span class="notranslate">Galaxy</span> (being it
a simple step like running Trimmomatic, or a complete analysis pipeline composed of many different steps)
is by using <code class="language-plaintext highlighter-rouge">Dataset collections</code>. To know more about dataset collections,
you can <a href="https://galaxyproject.org/tutorials/collections/">have a look at the following material</a>, however the idea is very simple:
all samples to be analyzed are merged into a ‚Äúdataset collection‚Äù, and then you analyze that ‚Äúcollection‚Äù
as you would analyze a single sample, with the difference that all steps will be performed for each
sample individually. Do not worry if you do not fully understand this right now, we will be creating
a dataset collection at the beginning of this tutorial and we will analyze it.</p>

<p>To save you some time, (and server load) we have run the pipeline that you used in the previous tutorial for
the 20 samples that we want to analyze. Thus, we now have 20 VCF files that describe the
mutations found for each of the samples. <strong>These 20 VCFs files will be the starting point of this tutorial.</strong>
 If you want to perform the <span class="notranslate">mapping</span> and variant calling for
all of the samples, feel free to do it. You can find the respective <a href="https://zenodo.org/record/5911437">FASTQ files here</a>, and
the <a href="./workflows/Galaxy-Workflow-From_Fastqs_to_VCFs_and_BAMs.ga"><span class="notranslate">Galaxy</span> workflows used here</a>. However this is completely optional,
and we suggest you to do it after you have finished all the tutorials of this workshop.</p>

<p>Before starting, bear in mind that this tutorial assumes that you watched the respective webinars of
this lesson</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will cover:</p>

<ol id="markdown-toc">
  <li><a href="#pre-requisites" id="markdown-toc-pre-requisites">Pre-requisites</a></li>
  <li><a href="#get-the-data" id="markdown-toc-get-the-data">Get the data</a></li>
  <li><a href="#generate-a-snp-alignment" id="markdown-toc-generate-a-snp-alignment">Generate a SNP alignment</a>    <ol>
      <li><a href="#generate-complete-genomes" id="markdown-toc-generate-complete-genomes">Generate complete genomes</a></li>
      <li><a href="#multiple-sequence-alignment-msa-of-all-genomes" id="markdown-toc-multiple-sequence-alignment-msa-of-all-genomes">Multiple-sequence alignment (MSA) of all genomes</a></li>
    </ol>
  </li>
  <li><a href="#identify-transmission-clusters" id="markdown-toc-identify-transmission-clusters">Identify transmission clusters</a>    <ol>
      <li><a href="#calculate-pairwise-snp-distances" id="markdown-toc-calculate-pairwise-snp-distances">Calculate pairwise SNP distances</a></li>
      <li><a href="#determine-transmission-clusters-based-on-a-snp-threshold" id="markdown-toc-determine-transmission-clusters-based-on-a-snp-threshold">Determine transmission clusters based on a SNP threshold</a></li>
      <li><a href="#determine-transmission-clusters-using-rscript" id="markdown-toc-determine-transmission-clusters-using-rscript">Determine transmission clusters using Rscript</a></li>
    </ol>
  </li>
  <li><a href="#using-clustering-to-investigate-the-emergence-of-drug-resistance" id="markdown-toc-using-clustering-to-investigate-the-emergence-of-drug-resistance">Using clustering to investigate the emergence of drug resistance</a>    <ol>
      <li><a href="#get-the-data-1" id="markdown-toc-get-the-data-1">Get the data</a></li>
      <li><a href="#summarize-the-data" id="markdown-toc-summarize-the-data">Summarize the data</a></li>
    </ol>
  </li>
  <li><a href="#put-everything-together" id="markdown-toc-put-everything-together">Put everything together</a></li>
  <li><a href="#bonus" id="markdown-toc-bonus">Bonus</a></li>
</ol>

</blockquote>

<h1 id="get-the-data">Get the data</h1>
<p>As mentioned in the introduction, we have performed <span class="notranslate">mapping</span> and variant calling for the 20 samples
that we need to analyze. The result are the respective 20 VCF files that describe the mutations found
for each of the samples. Before starting the analysis of such mutations, we will need to import them
into <span class="notranslate">Galaxy</span>:</p>
<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-data-upload"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Data upload</h3>

  <ol>
    <li>Create a new history for this tutorial</li>
    <li>
      <p>Import the files from <a href="https://zenodo.org/record/6010176">Zenodo</a> or from
the shared data library (<code class="language-plaintext highlighter-rouge">GTN - Material</code> -&gt; <code class="language-plaintext highlighter-rouge">evolution</code>
 -&gt; <code class="language-plaintext highlighter-rouge">Identifying tuberculosis transmission links: from SNPs to transmission clusters</code>):
Import the VCF files containing the variants of each sample</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6010176/files/ERR1203059.vcf
https://zenodo.org/record/6010176/files/ERR181435.vcf
https://zenodo.org/record/6010176/files/ERR2659153.vcf
https://zenodo.org/record/6010176/files/ERR2704678.vcf
https://zenodo.org/record/6010176/files/ERR2704679.vcf
https://zenodo.org/record/6010176/files/ERR2704687.vcf
https://zenodo.org/record/6010176/files/ERR313115.vcf
https://zenodo.org/record/6010176/files/ERR551620.vcf
https://zenodo.org/record/6010176/files/ERR5987300.vcf
https://zenodo.org/record/6010176/files/ERR5987352.vcf
https://zenodo.org/record/6010176/files/ERR6362078.vcf
https://zenodo.org/record/6010176/files/ERR6362138.vcf
https://zenodo.org/record/6010176/files/ERR6362139.vcf
https://zenodo.org/record/6010176/files/ERR6362156.vcf
https://zenodo.org/record/6010176/files/ERR6362253.vcf
https://zenodo.org/record/6010176/files/ERR6362333.vcf
https://zenodo.org/record/6010176/files/ERR6362484.vcf
https://zenodo.org/record/6010176/files/ERR6362653.vcf
https://zenodo.org/record/6010176/files/SRR13046689.vcf
https://zenodo.org/record/6010176/files/SRR998584.vcf
</code></pre></div>      </div>

      <p>We will also need the reference genome that was used for SNP calling</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/3497110/files/MTB_ancestor_reference.fasta
</code></pre></div>      </div>
    </li>
    <li>
      <p>Finally  Create a <strong>Dataset List (Collection)</strong> for all the VCFs.</p>

      <p>Use a meaningful name, for example <strong>MTB VCFs</strong>.</p>
    </li>
  </ol>
</blockquote>

<blockquote class="tip">
  <h3 id="tip-tip"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip</h3>
  <p>To create a dataset collection:</p>
  <ul>
    <li>Click on the box under the history name (bottom right) that says ‚ÄúOperations on multiple datasets‚Äù</li>
    <li>Tick all 20 VCFs files that we just imported.</li>
    <li>In the ‚ÄúFor all selected‚Ä¶‚Äù box, select ‚ÄúBuild Dataset List‚Äù</li>
    <li>You can also <a href="https://www.youtube.com/watch?v=F3qNs1_675g">watch this one minute video</a> about how to create collections</li>
  </ul>
</blockquote>

<h1 id="generate-a-snp-alignment">Generate a SNP alignment</h1>

<p>In this tutorial we aim to calculate the genetic differences (in SNPs) between pairs of MTB genomes.
To do so, we need to compare, between each pair of genomes (thus pairwise), the nucleotides that are
observed at each position. Each time we find a different nucleotide at a given position, we will sum
1 SNP of genetic distance. For example, if two strains have a genetic distance of 5 SNPs, that would
mean that their respective genomes are almost identical, except for 5 positions along all the genome
in which they have different nucleotides.</p>

<p>To do such calculation we need to first build an alignment of all the genomes (multiple-sequence
  alignment, or MSA). Afterwards, we will use specific software to analyze this MSA, count SNPs,
  and thus calculate the genetic distance between each pair of samples.</p>

<figure id="figure-1"><img src="./images/MSA.png" alt="MSA of 5 MTB genomes. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 1:</span> A SNP is highlighted in a MSA of five MTB genomes</figcaption></figure>

<h2 id="generate-complete-genomes">Generate complete genomes</h2>
<p>The first step to generate the genomes MSA will be‚Ä¶ to get the complete genomes of our samples!
In the <a href="/training-material/topics/variant-analysis/tutorials/tb-variant-analysis/tutorial.html">MTB Variant Analysis tutorial</a> we have analyzed short-read high-throughput sequencing data (Illumina) to
obtain the respective VCF files that describe the mutations found in each of our samples, as compared
to the reference genome. We can now use these VCF files to build the complete genome of each of our
samples.</p>

<h3 id="filter-vcf-files-for-epidemiologicalphylogenetic-investigation">Filter VCF files for epidemiological/phylogenetic investigation</h3>
<p>Interpreting <strong>mixed calls</strong> or <strong>indels</strong> in phylogenetic/epidemiological applications can be very
complicated. That is the reason why we tipically use alignments that only contain <strong>fixed SNPs</strong>.</p>

<p>Thus, the first step in this tutorial will be to filter the VCFs so we are sure that
they only contain <strong>fixed SNPs</strong>. As it was introduced in day 2 webinar <a href="https://youtu.be/38GUBKwWXv8"><span class="notranslate">Mapping</span> and Variant calling</a>, we will consider fixed
those variants at a frequency equal or greater than 90%. We will be using here the tool
<strong>TB Variant Filter</strong>.</p>

<p><em>Note: TB variant Filter refers to SNPs as SNVs. These two short forms are interchangeable, meaning <strong>S</strong>ingle <strong>N</strong>ucleotide <strong>P</strong>olymorphism and <strong>S</strong>ingle <strong>N</strong>ucleotide <strong>V</strong>ariant, respectively.</em></p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-filter-vcf-files-for-epidemiological-investigation"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Filter VCF files for epidemiological investigation</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/tb_variant_filter/tb_variant_filter/0.3.5+galaxy2" title="Tested with toolshed.g2.bx.psu.edu/repos/iuc/tb_variant_filter/tb_variant_filter/0.3.5+galaxy2"><strong>TB Variant Filter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/iuc/tb_variant_filter/tb_variant_filter/0.3.5+<span class="notranslate">galaxy</span>2</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>‚ÄúVCF file to be filter‚Äù</em>: <code class="language-plaintext highlighter-rouge">MTB VCFs</code> (Select Dataset Collection instead of Single Dataset)</li>
        <li><em>‚ÄúFilters to apply‚Äù</em>: <code class="language-plaintext highlighter-rouge">Only accept SNVs</code>, <code class="language-plaintext highlighter-rouge">Filter variants by percentage alt allele</code></li>
        <li><em>‚ÄúShow options for the filters‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>‚ÄúMinimum alte<span class="notranslate">rna</span>te allele percentage to accept‚Äù</em>: <code class="language-plaintext highlighter-rouge">90.0</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p><strong><code class="language-plaintext highlighter-rouge">TB Variant Filter</code></strong> <span class="notranslate">reads</span> the VCF and output only SNPs that have, at least, 90% frequency.
How can this sofware extract such information from the VCF files?</p>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>That information is contained, for each mutation, in the VCF:</p>
    <ul>
      <li>The <code class="language-plaintext highlighter-rouge">TYPE</code> field within the INFO string will tell us if the mutation is a SNP (TYPE=snp)</li>
      <li>You can look for other types of mutations like insertions (TYPE=ins)</li>
      <li>The <code class="language-plaintext highlighter-rouge">AF</code> field within the INFO string describes the estimated <strong>A</strong>llele <strong>F</strong>requency</li>
      <li>An alterntive way to calculate it, would be to divide the number of observations of the
alte<span class="notranslate">rna</span>te allele (<code class="language-plaintext highlighter-rouge">AO</code>) by the total depth at that position (<code class="language-plaintext highlighter-rouge">DP</code>)</li>
    </ul>
  </blockquote>

</blockquote>

<h3 id="reconstruct-the-complete-genome-of-each-sample-with-bcftools-consensus">Reconstruct the complete genome of each sample with <strong>bcftools consensus</strong></h3>
<p>Our VCF files now only contain <strong>fixed SNPs</strong> that were found in the genome of the respective strains.
Genomic positions not in the VCF mean that, at that particular position, the strain has the
same nucleotide than the reference genome. Knowing this information, one could reconstruct the
complete genome of each strain pretty easily. From the first to the last position in the genome,
one would put the same nucleotide than in the reference if that position is not in the VCF, or the
SNP described in the VCF otherwise. This is exactly what <code class="language-plaintext highlighter-rouge">bcftools consensus</code> will do for us,
given the reference genome and the VCF of the strain we want to reconstruct the genome for.</p>

<p>https://use<span class="notranslate">galaxy</span>.eu/root?tool_id=<span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/iuc/bcftools_consensus/bcftools_consensus/1.9+<span class="notranslate">galaxy</span>2</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-reconstruct-the-complete-genome-of-each-sample"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Reconstruct the complete genome of each sample</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/bcftools_consensus/bcftools_consensus/1.9+galaxy2" title="Tested with toolshed.g2.bx.psu.edu/repos/iuc/bcftools_consensus/bcftools_consensus/1.9+galaxy2"><strong>bcftools consensus</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/iuc/bcftools_consensus/bcftools_consensus/1.9+<span class="notranslate">galaxy</span>2</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúVCF/BCF Data‚Äù</em>: <code class="language-plaintext highlighter-rouge">MTB VCFs filtered</code> (output of <strong>TB Variant Filter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúChoose the source for the reference genome‚Äù</em>: <code class="language-plaintext highlighter-rouge">Use a genome from the history</code> (The reference genome that was used for SNP-calling)
          <ul>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúReference genome‚Äù</em>: <code class="language-plaintext highlighter-rouge">(MTB_ancestor_reference.fasta)</code></li>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSet output FASTA ID from name of VCF‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p>Imagine that we forgot to filter the VCFs to contain only fixed variants, and there are also
SNPs with frequencies, of 15%, 30%, or 56.78%. Which allele do you think bcftools consensus would
insert in the genome?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-1"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>The behaviour of bcftools consensus in this case can be specified with the option <code class="language-plaintext highlighter-rouge">--haplotype</code>
For example, we can set <code class="language-plaintext highlighter-rouge">haplotype=2</code> so the second allele will be used‚Ä¶ wait‚Ä¶ what?</p>
  </blockquote>
</blockquote>

<blockquote class="question">
  <h3 id="question-second-allelle"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Second allelle!?</h3>

  <p>What do you think that things like ‚Äúsecond allele‚Äù or ‚Äú<em>The</em> alterntive allele‚Äù mean here?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-2"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>Many of the bioinformatic programs are developed to analyze eukaryotic genomes, particularly
human genomes. That means that these programs have in mind that the genomes
are diploid and thus each posible position in the genome has two possible alleles. In
bacterial genomics, in contrast, we are <strong>always sequencing a population</strong> of cells with
potential genetic diversity (with the exception of <span class="notranslate">single-cell</span> sequencing).
That does not mean that we cannot use this type of software, we can (and we do!) but it is
good to know what they are ment for, and their possible limitations</p>
  </blockquote>
</blockquote>

<h2 id="multiple-sequence-alignment-msa-of-all-genomes">Multiple-sequence alignment (MSA) of all genomes</h2>
<p>Multiple sequence alignment is a process in which multiple <span class="notranslate">DNA</span>, <span class="notranslate">RNA</span> or protein sequences are arranged
to find regions of similarity that are supposed to reflect the consequences of different evolutionary
processes (Figure 1). MSAs are used to test hypotheses about this evoluitionary processes and infer phylogenetic
relationships, and for these reasons we build MSA for sequences for which we already assume some sort
of evolutionary relationship. You will learn more on MSAs and phylogenetic inference in the next
tutorial.</p>

<p>Building MSAs of several complete genomes can be a complicated process and computationally demanding. To perform
such task there are many software packages available like <code class="language-plaintext highlighter-rouge">Muscle</code>, <code class="language-plaintext highlighter-rouge">MAFFT</code> or <code class="language-plaintext highlighter-rouge">Clustal</code> just to mention some.
Which one are we going to use in this tutorial? Well, we are going to use a trick. We are going to
just stack one genome on top of each other within a text file. (More on why we can do this below).</p>

<p>Our aim is to generate a <strong>multifasta</strong> file in which the genomes of our samples are aligned.
Something that looks like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;Sample 1
TTGACCGATGACCCCGGTTCAGGCTTCACCACAGTGTGGAACGC...
&gt;Sample 2
ATGACCGATGACCCCGGTTCAGGCTTCACCACAGTGTGGAACGC...
&gt;Sample 3
TTCGTTCGATGACCCCGGTTCAGGCTTCACCACAGTGTGGAACG...
</code></pre></div></div>

<p>This could be done manually, by copy-pasting all genomes in a single text file.
However we can do the same with a specific command that <em>concatenates</em> files.</p>

<h3 id="build-a-multiple-sequence-alignment-from-complete-genomes-with-concatenate-datasets">Build a multiple-sequence alignment from complete genomes with ‚Äú<strong>Concatenate datasets</strong>‚Äù</h3>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-concatenate-genomes-to-build-a-msa"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Concatenate genomes to build a MSA</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1" title="Tested with toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1"><strong>Concatenate datasets tail-to-head (cat)</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúDatasets to concatenate‚Äù</em>: <code class="language-plaintext highlighter-rouge">Dataset collection</code> (output of <strong>bcftools consensus</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
      </ul>
    </li>
    <li>The output of <strong>concatenate datasets</strong> may be of type tabular. Make sure <span class="notranslate">Galaxy</span> sees this file as
a fasta file by editing its attributes. Click in the pencil icon, select ‚ÄúDatatypes‚Äù and then select fasta.</li>
  </ol>

</blockquote>

<p>Now we have a multifasta file, where <strong>each position of each genome corresponds to the same position
of the rest of genomes in the file</strong>. This can be seen and used as a multiple-sequence alignment of
all of our genomes! However, it is important that you understand the following question‚Ä¶</p>

<blockquote class="question">
  <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Generating multiple-sequence alignments can be complicated and computationally demanding, and there are
many software packages to perform such task. How is then possible that we were able to build a MSA by just
stacking genomes one on top of each other? Can you think about what makes our case special, so we can
just use this ‚Äútrick‚Äù?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-3"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <p>We have generated the complete genome of each sample by substituting in the reference genome
those <strong>SNPs</strong> that we found in that said sample (described in the VCF). Remember that <strong>we
removed indels from the VCF when filtering!</strong> Because the complete genomes we generated do not
contain insertions or deletions, ALL the genomes have the same length (the length of the
reference genome) and each nucleotide corresponds to the same genomic coordinate (the one
also in the reference genome). So we are not aligning genomes <em>per se</em> but, knowing this, we
can build a MSA by just stacking genomes that <strong>are the same length¬†¬ªAND¬´¬†have the same coordinates</strong>.</p>
  </blockquote>

</blockquote>

<h3 id="remove-invariant-positions-with-finds-snp-sites">Remove invariant positions with <strong>Finds SNP sites</strong></h3>

<p>We have generated a MSA that is the basis for the transmission (clustering) and phylogenetic
analysis. Although we could already use this MSA for such analysis, it is common practice to remove
the invariant sites from the alignment. Think that our file now contains 20 genomes of 4.4 Mb each.
MTB genomes have a very low genetic diversity, meaning that in reality, there are only some hundreds or
thousands of SNPs <em>in total</em>, because the genomes are &gt;99% identical between them. Identical positions
in a MSA provide no information, so we can remove those and
generate a <strong>SNP alignment</strong> that only contain variant positions with phylogenetic information. By
doing this, we will generate a much smaller file, that will be easier to handle by <span class="notranslate">downstream</span> applications.</p>

<p>We can exemplify this with a couple of pictures:</p>

<p>In the following picture, a polymorphic position in the alignment (SNP)
is highlighted in blue and green. Invariant positions are not highlighted and have an asterisc <code class="language-plaintext highlighter-rouge">*</code>
on the upper part of the alignment. Most of the MSA is composed of these invariant positions, making
our file larger than necessary.</p>

<figure id="figure-2"><img src="./images/MSA.png" alt="MSA of 5 MTB genomes. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 2:</span> A SNP is highlighted in a MSA of five MTB genomes</figcaption></figure>

<p>After removing invariant positions, we end up with a SNP alignment like the following.</p>

<figure id="figure-3"><img src="./images/SNP_MSA.png" alt="MSA of 5 MTB genomes. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 3:</span> A SNP alignment where all positions are polymorphic</figcaption></figure>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-removing-invariant-sites-from-a-msa"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Removing invariant sites from a MSA</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/snp_sites/snp_sites/2.5.1+galaxy0" title="Tested with toolshed.g2.bx.psu.edu/repos/iuc/snp_sites/snp_sites/2.5.1+galaxy0"><strong>Finds SNP sites</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/iuc/snp_sites/snp_sites/2.5.1+<span class="notranslate">galaxy</span>0</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúFASTA file‚Äù</em>: <code class="language-plaintext highlighter-rouge">Single dataset</code> (output of <strong>Concatenate datasets</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúOutput‚Äù</em>: <code class="language-plaintext highlighter-rouge">Sequence alignment / VCF</code>
          <ul>
            <li><em>‚ÄúOutput formats‚Äù</em>: <code class="language-plaintext highlighter-rouge">Multi-FASTA alignment file</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>In SNP alignments you have to <strong>bear in mind that positions do not longer correspond to genomic
coordinates</strong>, meaning that two contiguous nucleotides may correspond to coordinates thousands of
positions apart.</p>

<h1 id="identify-transmission-clusters">Identify transmission clusters</h1>

<h2 id="calculate-pairwise-snp-distances">Calculate pairwise SNP distances</h2>
<p>Now we are all set to calculate pairwise SNP distances between samples and decide whether two
patients are within the same transmission cluster or not. Having a SNP alignment, this is fairly
easy. We will use <strong>SNP distance matrix</strong>, that will generate a matrix with pairwise SNP distances.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-distance-matrix-from-snp-alignment"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Distance matrix from SNP alignment.</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/snp_dists/snp_dists/0.6.3+galaxy0" title="Tested with toolshed.g2.bx.psu.edu/repos/iuc/snp_dists/snp_dists/0.6.3+galaxy0"><strong>SNP distance matrix</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/iuc/snp_dists/snp_dists/0.6.3+<span class="notranslate">galaxy</span>0</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúFASTA multiple sequence alignment‚Äù</em>: <code class="language-plaintext highlighter-rouge">Single dataset</code> (output of <strong>Finds SNP sites</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-comment"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment</h3>

        <p>Have a look at the distance matrix to make sure you understand the whole process. Given that
we only have 20 samples, you could already spot some samples that are involved in the same
transmission chain (samples with a small number of SNPs between them as explained below).</p>
      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="determine-transmission-clusters-based-on-a-snp-threshold">Determine transmission clusters based on a SNP threshold</h2>
<p>Now that we have a distance matrix that describes the SNP distance between each pair of samples, we
could already describe the transmission clusters based on a <strong>SNP threshold</strong>, as <a href="https://youtu.be/kKNgmpy1N94">explained in the
respective webinar</a> . If two samples are at a distance below that threshold, we will say that they
belong to the same transmission cluster, because they are close enough genetically speaking. Again,
we could do this manually, but we are doing bioinformatics, and we want to be able to do the same
analysis regardless of whether we are analyzing two or two million samples. Also, <strong>note that two samples
that are dozens of SNPs apart may belong to the same transmission cluster</strong> if there are other samples
linking them in between as exemplified in the picture below.</p>

<figure id="figure-4"><img src="./images/Cluster.png" alt="MSA of 5 MTB genomes. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 4:</span> Example of transmission cluster using 10 SNPs threshold</figcaption></figure>

<blockquote class="question">
  <h3 id="question-very-important-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Very Important Question</h3>

  <ol>
    <li>In the image above exemplifying a transmission cluster, the distance between samples A and E is
17 SNPs. Being the other pairwise distances in the figure the same,
would it be possible that the distance between A and E is different?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-4"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>The figure used above as an example is a <strong>flagrant oversimplification</strong>. In the figure not all pairwise
distances are represented (for example between sample A and C).
Most importantly you have to remember that <strong>transmission clusters do not reflect transmission
events</strong>.
In fact it may happen that transmission does not happen within the cluster we are analyzing!
For example, when a patient that is not sampled is the source of infection of all the cases in
the cluster (may be a superspreading event). You have to consider that, taking into account the
same SNP distances, another possible (yet still oversimplified) scenario could be‚Ä¶</li>
    </ol>
    <figure id="figure-5"><img src="./images/Cluster2.png" alt="MSA of 5 MTB genomes. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 5:</span> Example of transmission cluster using 10 SNPs threshold</figcaption></figure>
  </blockquote>
</blockquote>

<h2 id="determine-transmission-clusters-using-rscript">Determine transmission clusters using Rscript</h2>

<p>Currently there is not tool in <span class="notranslate">Galaxy</span> to perform the exact task that we need (although we plan to
include it!).  So far, we can use <code class="language-plaintext highlighter-rouge">R</code> and the library <code class="language-plaintext highlighter-rouge">cluster</code> within <span class="notranslate">Galaxy</span> to perform such task.
Again, don‚Äôt worry about this, programming in <code class="language-plaintext highlighter-rouge">R</code> is beyong the scope of this workshop, but if you
have some <code class="language-plaintext highlighter-rouge">R</code> or other programming language knowledge, or if you plan to learn in the future, you could
also reuse this code for your own analyses.</p>

<p>First you will need to open Rstudio within <span class="notranslate">Galaxy</span>. To do this look for Rstudio in the tool panel,
click on it and click on <code class="language-plaintext highlighter-rouge">execute</code>. Rstudio will appear in your story as a job that is being continously
executed. This is the normal behaviour because, indeed, Rstudio is now being executed and will only
stop once we have finish using it.</p>

<p>To access your Rstudio instance within <span class="notranslate">Galaxy</span>, go to <em>User&gt;Active Interactive Tools</em> in the top center
panel. Now click on the link <code class="language-plaintext highlighter-rouge">Rstudio</code> that appears below <em>Name</em>. The status below <em>Job Info</em> should be <code class="language-plaintext highlighter-rouge">running</code>.</p>

<p>Wait for Rstudio to open, and copy-paste the following code in the Console of Rstudio (left panel):</p>

<p><strong>IMPORTANT</strong>: Note the third line of the next block of code, where it <span class="notranslate">reads</span>:
<code class="language-plaintext highlighter-rouge">distance &lt;- gx_get(<span class="notranslate">Galaxy</span> history ID)</code>
In this part is where we are importing the SNP distance matrix generated in <span class="notranslate">Galaxy</span> into
R. You need to take note of the history ID of the step that generated the SNP distance
matrix. For example, imagine that in our story says <em>198: SNP distance matrix on data 197</em>.</p>

<p>Then the history ID is <em>198</em>, and the block of code should be:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the SNP distance matrix object from <span class="notranslate">Galaxy</span></span><span class="w">
</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gx_get</span><span class="p">(</span><span class="m">198</span><span class="p">)</span><span class="w">
</span><span class="c1"># Read the SNP distance matrix</span><span class="w">
</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.dist</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span><span class="w">

</span><span class="c1"># Perform clustering based on SNP distances and a SNP threshold of 10 (h=10)</span><span class="w">
</span><span class="n">clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">agnes</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">diss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"average"</span><span class="p">)</span><span class="w">
</span><span class="n">clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">cutree</span><span class="p">(</span><span class="n">as.hclust</span><span class="p">(</span><span class="n">clusters</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"cluster_id"</span><span class="w">

</span><span class="c1">## Discard groups of only one patient by picking clusters with more than one entry</span><span class="w">
</span><span class="c1"># Get cluster_ids that are "duplicated" (meaning they have more than one patient)</span><span class="w">
</span><span class="n">clusterIDs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span><span class="w"> </span><span class="n">duplicated</span><span class="p">(</span><span class="n">clusters</span><span class="o">$</span><span class="n">cluster_id</span><span class="p">))</span><span class="o">$</span><span class="n">cluster_id</span><span class="p">)</span><span class="w">
</span><span class="c1"># Get samples within these "duplicated" clusters</span><span class="w">
</span><span class="n">clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span><span class="w"> </span><span class="n">cluster_id</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">clusterIDs</span><span class="p">)</span><span class="w">
</span><span class="c1"># Add proper Sample name column</span><span class="w">
</span><span class="n">clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">Sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">clusters</span><span class="p">),</span><span class="w"> </span><span class="n">clusters</span><span class="p">)</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Transmission_clusters.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This code has written the results to a file called <em>Transmission_clusters.tsv</em>. You can
check the results and/or download the file by clicking in the right bottom panel, under <em>Files</em>.</p>

<p>The output of the R script is a table containing, for samples that were found within a cluster,
their respective names and the cluster id (an arbitrary number) they belong to:</p>

<table>
  <thead>
    <tr>
      <th>Sample</th>
      <th>cluster_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ERR6362484.vcf</td>
      <td>10</td>
    </tr>
    <tr>
      <td>ERR6362138.vcf</td>
      <td>12</td>
    </tr>
    <tr>
      <td>ERR6362156.vcf</td>
      <td>12</td>
    </tr>
    <tr>
      <td>ERR6362253.vcf</td>
      <td>12</td>
    </tr>
    <tr>
      <td>ERR5987352.vcf</td>
      <td>10</td>
    </tr>
  </tbody>
</table>

<blockquote class="question">
  <h3 id="question-questions-2"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p>How many transmission clusters did we find? How many samples are linked to recent transmission in our dataset?</p>

  <blockquote class="solution">
    <h3 id="solution-answer"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Answer</h3>
    <p>We have found two transmission clusters with respective IDs 10 and 12. Transmission cluster 10
is composed by two samples linked by recent transmission and transmission cluster 12 by three samples
linked by recent transmission. For example samples ERR6362484 and ERR5987352 are linked by
recent transmission.</p>
  </blockquote>
</blockquote>

<blockquote class="question">
  <h3 id="question-question-1"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Let‚Äôs assume that we have the isolation dates of samples ERR6362484 and ERR5987352, which
belong to the same transmission cluster. Sample ERR6362484 was isolated on January 2021, while sample
 ERR5987352 was isolated on September 2021. Would you be able to determine who was the infector and who the infectee?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-5"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p><strong>NO</strong></p>

    <p>Isolation dates have been used traditionally to define <strong>index cases</strong> within transmission clusters
under the assumption that the most likely scenario is the first isolated sample to be the
source of transmission. Today we know that this assumption often leads
to misidentification of index cases. <strong>Remember:</strong> we cannot rule out the possibility
that patients within the cluster were infected by an index case that was not sampled.</p>

    <p>Read <a href="https://doi.org/10.1371/journal.pmed.1002961">Xu et al., 2019</a> for more information on this topic.</p>
  </blockquote>
</blockquote>

<h1 id="using-clustering-to-investigate-the-emergence-of-drug-resistance">Using clustering to investigate the emergence of drug resistance</h1>

<p>Although we have stressed the fact that <strong>clustering cannot be used to delineate
transmission events</strong>, clustering is very useful to investigate outbreaks and determine which cases are
involved in the same transmission chain. We can leverage this information to investigate the relationship
between tuberculosis transmission and particular biological or clinical traits.</p>

<p>In this part of the tutorial, we will investigate the emergence and spread of drug resistance based
on our clustering analysis.</p>

<h2 id="get-the-data-1">Get the data</h2>

<p>In the <a href="https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/tb-variant-analysis/tutorial.html">MTB Variant Analysis tutorial</a>
you have used <strong>TB-profiler</strong> to generate a report with determinants of drug resistance of a
particular MTB strain, and predict its genotypic drug susceptibility. We have done <strong>exactly the same</strong>
for the 20 samples that we used in the clustering analysis, so we have now the TB-profiler report for
all of them.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-data-upload-1"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Data upload</h3>

  <ol>
    <li>
      <p>Import the files from <a href="https://zenodo.org/record/6010176">Zenodo</a> or from
the shared data library (<code class="language-plaintext highlighter-rouge">GTN - Material</code> -&gt; <code class="language-plaintext highlighter-rouge">evolution</code>
 -&gt; <code class="language-plaintext highlighter-rouge">Identifying tuberculosis transmission links: from SNPs to transmission clusters</code>):</p>

      <p>Import the TB profiler report of each sample</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6010176/files/ERR1203059.TBprof.txt
https://zenodo.org/record/6010176/files/ERR181435.TBprof.txt
https://zenodo.org/record/6010176/files/ERR2659153.TBprof.txt
https://zenodo.org/record/6010176/files/ERR2704678.TBprof.txt
https://zenodo.org/record/6010176/files/ERR2704679.TBprof.txt
https://zenodo.org/record/6010176/files/ERR2704687.TBprof.txt
https://zenodo.org/record/6010176/files/ERR313115.TBprof.txt
https://zenodo.org/record/6010176/files/ERR551620.TBprof.txt
https://zenodo.org/record/6010176/files/ERR5987300.TBprof.txt
https://zenodo.org/record/6010176/files/ERR5987352.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362078.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362138.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362139.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362156.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362253.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362333.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362484.TBprof.txt
https://zenodo.org/record/6010176/files/ERR6362653.TBprof.txt
https://zenodo.org/record/6010176/files/SRR13046689.TBprof.txt
https://zenodo.org/record/6010176/files/SRR998584.TBprof.txt
</code></pre></div>      </div>
    </li>
    <li>
      <p>Create a <strong>Dataset List (Collection)</strong> for all the report files.</p>

      <p>Use a meaningful name, for example <strong>TBprofiler reports</strong>.</p>
    </li>
  </ol>
</blockquote>

<h2 id="summarize-the-data">Summarize the data</h2>
<p>TB-profiler reports are very useful and comprehensive, and we will use them to better investigate
drug resistance in our dataset. However, it is always useful to summarize the data on a per-sample basis,
on a table, so we can quickly check which strains are, for example, MDR, an which are pan-susceptible.
We would like to generate a table like the following:</p>

<table>
  <thead>
    <tr>
      <th>Sample</th>
      <th>DR profile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Sample A</td>
      <td>Sensitive</td>
    </tr>
    <tr>
      <td>Sample B</td>
      <td>Sensitive</td>
    </tr>
    <tr>
      <td>Sample C</td>
      <td>MDR</td>
    </tr>
    <tr>
      <td>Sample Z</td>
      <td>XDR</td>
    </tr>
  </tbody>
</table>

<p>If we have a look at a TB profiler report we can see that there is one line describing the genotypic drug susceptibility.
Let‚Äôs have a look at the first part of the TB-profiler report for sample ERR6362653:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
TBProfiler report
=================

The following report has been generated by TBProfiler.

Summary
-------
ID: tbprofiler
Date: Fri Jan 28 13:14:47 2022
Strain: lineage2.2.1
Drug-resistance: MDR

Lineage report
--------------
Lineage	Estimated Fraction	Family	Spoligotype	Rd
lineage2	1.000	East-Asian	Beijing	RD105
lineage2.2	0.996	East-Asian (Beijing)	Beijing-RD207	RD105;RD207
lineage2.2.1	0.999	East-Asian (Beijing)	Beijing-RD181	RD105;RD207;RD181
</code></pre></div></div>

<p>As you can see, this strain is multi-drug resistant as inficated by (<code class="language-plaintext highlighter-rouge">Drug-resistance: MDR</code>)
We could then look for this information in each TB-profiler report and generate this table manually,
for example in a sp<span class="notranslate">reads</span>heet. However this is not feasible when analyzing hundreds or thousands of samples
(and very <strong>error-prone!</strong>).</p>

<p>We are here to learn bioinformatics, so let‚Äôs generate this table using Linux commands.</p>

<p>The process will consist of three steps:</p>

<ol>
  <li>
    <p>Select the line containing the drug resistance profile with <strong>grep</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Drug-resistance: MDR
</code></pre></div>    </div>
  </li>
  <li>
    <p>Prepend the name of the sample with <strong>Add input name as column</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERR6362653.txt Drug-resistance: MDR
</code></pre></div>    </div>
  </li>
  <li>
    <p>Concatenate results from all samples in a single file with <strong>Concatenate datasets</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERR6362653.txt Drug-resistance: MDR
ERR313115.txt Drug-resistance: Sensitive
ERR5987300.txt Drug-resistance: Pre-XDR
.... etc
</code></pre></div>    </div>
  </li>
  <li>
    <p>As an optional step, we can reformat the table with <strong>sed</strong> to get rid of the <code class="language-plaintext highlighter-rouge">.txt</code> and <code class="language-plaintext highlighter-rouge">Drug-resistance:</code>
so the table looks like:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERR6362653 MDR
ERR313115 Sensitive
ERR5987300 Pre-XDR
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="select-the-line-containing-the-drug-resistance-profile-with-grep">Select the line containing the drug resistance profile with <code class="language-plaintext highlighter-rouge">grep</code></h4>

<p><strong>grep</strong> is used to search patterns of text within text files. Each time <strong>grep</strong> finds that
pattern, it will print as a result <strong>the complete line</strong> containing such pattern.</p>

<p>If we use <strong>grep</strong> to search for the pattern ‚Äú<code class="language-plaintext highlighter-rouge">Drug-resistance</code>‚Äù, in a TB-profiler file, we will get
as output the complete line, for example <code class="language-plaintext highlighter-rouge">Drug-resistance: MDR</code></p>

<h4 id="search-in-textfiles-grep"><em>Search in textfiles (grep)</em></h4>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-search-for-drug-resistance-in-tb-profiler-files"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Search for <code class="language-plaintext highlighter-rouge">Drug-resistance</code> in TB-profiler files</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_grep_tool/1.1.1" title="Tested with toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_grep_tool/1.1.1"><strong>Search in textfiles</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/bgruening/text_processing/tp_grep_tool/1.1.1</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúSelect lines from‚Äù</em>: <code class="language-plaintext highlighter-rouge">Dataset collection</code> (Collection of the TB profiler reports we just imported) <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚ÄúRegular <span class="notranslate">Expression</span>‚Äù</em>: <code class="language-plaintext highlighter-rouge">Drug-Resistance</code></li>
      </ul>
    </li>
  </ol>
</blockquote>

<h4 id="prepend-the-sample-name">Prepend the sample name</h4>
<p>We will add the name of the input file, to know to which sample the DR line refers to.
We will <em>prepend</em> the column with the sample name so it appears as the first column.
 This is arbitrary and just a matter of personal taste:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-prepend-the-sample-name-to-the-dr-profile"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Prepend the sample name to the DR profile</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/mvdbeek/add_input_name_as_column/addName/0.2.0" title="Tested with toolshed.g2.bx.psu.edu/repos/mvdbeek/add_input_name_as_column/addName/0.2.0"><strong>Add input name as column</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/mvdbeek/add_input_name_as_column/ad<span class="notranslate">dNa</span>me/0.2.0</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚Äúto Dataset‚Äù</em>: <code class="language-plaintext highlighter-rouge">Dataset collection</code> (output of <strong>Search in textfiles</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>‚Äúinput contains a header line?‚Äù</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>‚ÄúPrepend the colum‚Äù</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      </ul>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1" title="Tested with toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1"><strong>Concatenate datasets</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cat/0.1.1</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúDatasets to concatenate‚Äù</em>: <code class="language-plaintext highlighter-rouge">Dataset collection</code> (output of <strong>Add input name as column</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
      </ul>
    </li>
  </ol>

</blockquote>

<h4 id="cleanup-the-table-optional">Cleanup the table (optional)</h4>
<p>In this step we will use a simple tool that searches and replaces text. We want to remove the ‚Äú.txt‚Äù
at the end of sample names, and the string ‚ÄúDrug-resistance:‚Äù. So we will tell the tool to search
for these two <em>patterns</em> and to replace them with ‚Äú<em>nothing</em>‚Äù</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-task-description"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Task description</h3>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2" title="Tested with toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2"><strong>Replace Text</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <span class="notranslate">toolshed</span>.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2</span></span>  with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>‚ÄúFile to process‚Äù</em>: <code class="language-plaintext highlighter-rouge">Single file</code> (output of <strong>Concatenate datasets</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>‚ÄúReplacement‚Äù</em>:
          <ul>
            <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>‚ÄúInsert Replacement‚Äù</em>
              <ul>
                <li><em>‚ÄúFind pattern‚Äù</em>: <code class="language-plaintext highlighter-rouge">.txt</code></li>
                <li><em>‚ÄúReplace with:‚Äù (leave this in blank)</em>:</li>
              </ul>
            </li>
            <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>‚ÄúInsert Replacement‚Äù</em>
              <ul>
                <li><em>‚ÄúFind pattern‚Äù</em>: <code class="language-plaintext highlighter-rouge">Drug-resistance:</code></li>
                <li><em>‚ÄúReplace with:‚Äù(leave this in blank)</em>:</li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <h3 id="question-question-2"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <ol>
    <li>How many MDR strains did we find in the dataset?</li>
    <li>What does it mean to be Pre-MDR?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-6"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>Eight MDR strains, three of which are pre-XDR because they have additional resistance to fluoroquinolones. (You can look into details by looking into the TB profiler reports).</li>
      <li>As MDR means to be resistant to INH and RIF, pre-MDR means to be either INH-monoresistant or RIF-monoresistant.
If we have a look at the respective TB-profiler reports, we can see that these three strains are RIF-monoresistant.</li>
    </ol>
  </blockquote>
</blockquote>

<h1 id="put-everything-together">Put everything together</h1>
<p>Now that we have performed a clustering analysis and know which DR mutations carry each strain,
let‚Äôs try answer a series of questions about how DR may be emerging and spreading in our study
population.
We will be supporting our findings in the results of our analysis, and the concepts introduced in the webinars.</p>

<table>
  <thead>
    <tr>
      <th>Sample</th>
      <th>Cluster_id</th>
      <th>DR profile</th>
      <th>Clustering</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ERR1203059</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR181435</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR2659153</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR2704678</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR2704679</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR2704687</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR313115</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR551620</td>
      <td>-</td>
      <td>MDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR5987300</td>
      <td>-</td>
      <td>Pre-XDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR6362078</td>
      <td>-</td>
      <td>MDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR6362139</td>
      <td>-</td>
      <td>Pre-MDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR6362333</td>
      <td>-</td>
      <td>Pre-XDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR6362653</td>
      <td>-</td>
      <td>MDR</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>SRR13046689</td>
      <td>-</td>
      <td>Other</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>SRR998584</td>
      <td>-</td>
      <td>Sensitive</td>
      <td>Unclustered</td>
    </tr>
    <tr>
      <td>ERR5987352</td>
      <td>10</td>
      <td>Pre-MDR</td>
      <td>Clustered</td>
    </tr>
    <tr>
      <td>ERR6362484</td>
      <td>10</td>
      <td>Pre-MDR</td>
      <td>Clustered</td>
    </tr>
    <tr>
      <td>ERR6362138</td>
      <td>12</td>
      <td>MDR</td>
      <td>Clustered</td>
    </tr>
    <tr>
      <td>ERR6362156</td>
      <td>12</td>
      <td>Pre-XDR</td>
      <td>Clustered</td>
    </tr>
    <tr>
      <td>ERR6362253</td>
      <td>12</td>
      <td>MDR</td>
      <td>Clustered</td>
    </tr>
  </tbody>
</table>

<blockquote class="question">
  <h3 id="question-question-3"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>Assuming that we have a very good sampling of the outbreak. Which strains <strong>may</strong> represent instances
of <em>de novo</em> evolution of drug resistance and which ones instances of <em>transmitted</em> (primary) resistance?
Remember that you can look at the TB-profiler reports of independent samples for detailed information.</p>

  <blockquote class="solution">
    <h3 id="solution-solution-7"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>In a simplistic scenario, we could consider clustered strains as instances of transmission and
unclustered strains as instances of de novo evolution of DR. Thus, we see that for example there
are three MDR strains (ERR551620, ERR6362078, ERR6362653) that are unclustered and therefore may
represent cases in which drug resistance evolved independently as response to treatment within the respective
patients. However you need to always bear in mind that, although <strong>within our population</strong> those MDR
strains doesn‚Äôt seem to be linked to transmission, this does NOT rule out the possibility that
some of these patients were infected with an MDR strain somewhere else.</p>

    <p>When looking at clustered strains, distinguishing between transmitted and <em>de-novo</em> may be tricky. Note
that, for example, for the two RIF-monoresistant strains linked within the same transmission
cluster there are, at least, a couple of scenarios possibe: one in which a RIF-monoresistant strain
evolved in one patient and was transmitted to the other patient afterwards, and one in which both
were infected with the same RIF-monoresistant strain from a third patient that we have not sampled.
We need to note that, in the first scenario, drug resistance evolved <em>de novo</em> in one patient,
and was <em>transmitted</em> to the other patient, whereas in the second scenario drug resistance was
<em>transmitted</em> in both cases.</p>
  </blockquote>
</blockquote>

<blockquote class="question">
  <h3 id="question-question-4"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <ol>
    <li>The same principles than those explained above apply to the three MDR strains that are
within the same transmission cluster. However in this case there is one strain that shows clear
evidence of <em>de-novo</em> evolution of DR. Do you know which strain and why?</li>
    <li>Are there possible scenarios other than <em>de-novo</em> evolution of DR for this strain?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-8"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>Within this cluster of MDR strains, there is one tagged as Pre-XDR by TB-profiler. If we have
a look at the TB profiler report, we can see that this strain carries an additional mutation in
<em>gyrA</em> that confers resistance to fluorioquinolones. This is compatible with an scenario in which
fluoroquinolone resistance evolved independently within this patient after being infected with
the MDR strain.</li>
    </ol>
  </blockquote>
</blockquote>

<blockquote class="question">
  <h3 id="question-question-5"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <p>There is one strain with a DR profile ‚Äúother‚Äù, because it is only resistant to pyrazinamide. This
strain is not within a transmission cluster. Therefore, we conclude that pyrazinamide resistance
most likely evolved <em>de-novo</em> in this patient due to antibiotic treatment. But we are wrong. Do you know why?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-9"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>The strain is indeed PZA-resistant. And indeed this is strain is NOT linked to transmission
within our population. However, if we have a look at the TB-profiler report, we observe that this
is a <em>M. bovis</em> strain, which are known to be intrinsically resistant to PZA.</p>
  </blockquote>
</blockquote>

<blockquote class="question">
  <h3 id="question-question-6"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

  <ol>
    <li>Is it possible to find in the same transmission cluster two RIF-monoresistant strains that
carry different rpoB mutations?</li>
    <li>Is it possible to find in the same transmission cluster strains of different MTB sublineages?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-10"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>Yes, it is <strong>possible</strong>. In that scenario, both patiens were <strong>recently</strong>
transmitted with the <strong>same susceptible strain</strong>, and RIF resistance evolved <strong>independently</strong> in both.</li>
      <li>No, by definition. Remember that clustering is based on a threshold that we set of genetic
distance measured in SNPs. We want to cluster samples that are genetically so similar that we
can consider them as the same genotype, that is to say, as the same strain. Two different
sublineages, by definition, do not belong to the same genotype and will have a distance in SNPs
between them well beyond any SNP threshold we could use.</li>
    </ol>
  </blockquote>
</blockquote>

<h1 class="no_toc" id="conclusion">Conclusion</h1>

<p>You have learned how to perform a clustering analysis to identify patients that are linked by events of
<strong>recent transmission</strong>. Clustering analysis is very useful in outbreak investigation and
can also be used to describe the emergence and spread of drug-resistance within a population. You have
also learned, however, that interpreting clustering results requires careful considerations, given the
limitations of the methodology. Clustering analysis is better complemented with phylogenetic analysis,
which may help overcome some of these limitations.</p>

<p>In the following tutorial you will perform a phylogenetic analysis of these same 20 strains.</p>

<h1 id="bonus">Bonus</h1>

<p>You might have noticed that one of the strains analyzed presents thousands of differences (SNPs) to
the reference genome, standing out from the rest of strains. This strain is a <em>M. canettii</em> strain,
that was actually not part of the outbreak investigated. However we decided to include it here. Why? Let‚Äôs find out
in the next tutorial.</p>


                
                <blockquote class="key_points">
                    <h3><i class="fas fa-key" aria-hidden="true"></i> Key points</h3>
                    <ul>
                        
                        <li><p>Clustering is a useful tool to detect transmission links between patients and oubreak investigation.</p>
</li>
                        
                        <li><p>Clustering can be used to investigate the transmission of certain traits, like drug resistance.</p>
</li>
                        
                        <li><p>Clustering does not provide information about particular transmission events nor their directionality (who infected whom).</p>
</li>
                        
                        <li><p>Clustering is very much influenced by sampling. Lower sampling proportions and shorter sampling timeframes lead to lower clustering rates that shoud not be confounded with lack of transmission.</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the <a href="faqs/">tutorial FAQ page</a> or the  <a href="/training-material/topics/evolution/faqs/">FAQ page for the Evolution topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <div id="feedback-button">
                    <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                </div>
                <div id="feedback-form">
                </div>
                <script type="text/javascript">
                    (function (window, document) {
                        function onDocumentReady(fn) {
                            if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                fn();
                            } else {
                                document.addEventListener('DOMContentLoaded', fn);
                            }
                        }

                        onDocumentReady(function () {
                            $("#feedback-button").click(function(evt){
                                var e = $(evt.target)
                                e.hide();

                                $("#feedback-form").html(`
                                    <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Identifying tuberculosis transmission links: from SNPs to transmission clusters (Evolution)">Loading...</iframe>
                                `)
                            })
                        });
                    })(window, document);
                </script>



                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">Galo A. Goig, Daniela Brites, Christoph Stritt, 2022 <b>Identifying tuberculosis transmission links: from SNPs to transmission clusters (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/evolution/tutorials/mtb_transmission/tutorial.html">https://training.galaxyproject.org/training-material/topics/evolution/tutorials/mtb_transmission/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>


                <blockquote class="details">
                  <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                  <p style="display: none;">

                <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{evolution-mtb_transmission,
author = "Galo A. Goig and Daniela Brites and Christoph Stritt",
title = "Identifying tuberculosis transmission links: from SNPs to transmission clusters (Galaxy Training Materials)",
year = "2022",
month = "03",
day = "16"
url = "\url{https://training.galaxyproject.org/training-material/topics/evolution/tutorials/mtb_transmission/tutorial.html}",
note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
    doi = {10.1016/j.cels.2018.05.012},
    url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
    year = 2018,
    month = {jun},
    publisher = {Elsevier {BV}},
    volume = {6},
    number = {6},
    pages = {752--758.e1},
    author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
    title = {Community-Driven Data Analysis Training for Biology},
    journal = {Cell Systems}
}</code>
                </pre></div></div>
                </p>
                </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                <h3><i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!</h3>

                

                

            </div>
        </div>
    </div>
</section>
<br/>
<br/>
<br/>

        </div>
        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
