<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module TopicFilter - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-annotate_path">::annotate_path</a>
    <li ><a href="#method-c-collate_materials">::collate_materials</a>
    <li ><a href="#method-c-enumerate_topics">::enumerate_topics</a>
    <li ><a href="#method-c-extract_workflow_tool_list">::extract_workflow_tool_list</a>
    <li ><a href="#method-c-fetch_tutorial_material">::fetch_tutorial_material</a>
    <li ><a href="#method-c-fill_cache">::fill_cache</a>
    <li ><a href="#method-c-filter_by_tag">::filter_by_tag</a>
    <li ><a href="#method-c-filter_by_topic">::filter_by_topic</a>
    <li ><a href="#method-c-filter_by_topic_subtopic">::filter_by_topic_subtopic</a>
    <li ><a href="#method-c-get_contributors">::get_contributors</a>
    <li ><a href="#method-c-get_posts">::get_posts</a>
    <li ><a href="#method-c-get_version">::get_version</a>
    <li ><a href="#method-c-identify_contributors">::identify_contributors</a>
    <li ><a href="#method-c-identify_funders">::identify_funders</a>
    <li ><a href="#method-c-list_all_materials">::list_all_materials</a>
    <li ><a href="#method-c-list_all_tags">::list_all_tags</a>
    <li ><a href="#method-c-list_materials_by_tool">::list_materials_by_tool</a>
    <li ><a href="#method-c-list_materials_structured">::list_materials_structured</a>
    <li ><a href="#method-c-list_topics">::list_topics</a>
    <li ><a href="#method-c-list_topics_h">::list_topics_h</a>
    <li ><a href="#method-c-list_videos">::list_videos</a>
    <li ><a href="#method-c-process_pages">::process_pages</a>
    <li ><a href="#method-c-resolve_material">::resolve_material</a>
    <li ><a href="#method-c-short_tool">::short_tool</a>
    <li ><a href="#method-c-topic_filter">::topic_filter</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-TopicFilter">
  <h1 id="module-TopicFilter" class="module">
    module TopicFilter
  </h1>

  <section class="description">
    
<p>The main GTN module to parse tutorials and topics into useful lists of things that can bes shown on topic pages</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">





     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-annotate_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">annotate_path</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Annotation of a path with topic and tutorial information Params:</p>
<dl class="rdoc-list note-list"><dt><code>path</code>
<dd>
<p>The path to annotate</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The annotation</p>
</dd></dl>

<p>This is a bit of a hack, but it works for now.</p>

<p>Example:</p>

<pre>/topics/assembly/tutorials/velvet-assembly/tutorial.md
=&gt; {
  &quot;topic&quot; =&gt; &quot;assembly&quot;,
  &quot;topic_name&quot; =&gt; &quot;assembly&quot;,
  &quot;material&quot; =&gt; &quot;assembly/velvet-assembly&quot;,
  &quot;tutorial_name&quot; =&gt; &quot;velvet-assembly&quot;,
  &quot;dir&quot; =&gt; &quot;topics/assembly/tutorials/velvet-assembly&quot;
  &quot;type&quot; =&gt; &quot;tutorial&quot;
}</pre>

          <div class="method-source-code" id="annotate_path-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 225</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">annotate_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)
  <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;topics&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;tutorials&#39;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span>

  <span class="ruby-identifier">material</span> = {
    <span class="ruby-string">&#39;topic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>], <span class="ruby-comment"># Duplicate</span>
    <span class="ruby-string">&#39;topic_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>],
    <span class="ruby-string">&#39;material&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{parts[1]}/#{parts[3]}&quot;</span>,
    <span class="ruby-string">&#39;tutorial_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">3</span>],
    <span class="ruby-string">&#39;dir&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">3</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;/&#39;</span>),
  }

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r{/faqs/}</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/data[_-]library.yaml/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/data[_-]manager.yaml/</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/tutorial.*\.md/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tutorial&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/slides.*\.html/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;slides&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/ipynb$/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;ipynb&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/Rmd$/</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;rmd&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;workflows&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;workflow&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tours&#39;</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tour&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;index.md&#39;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-comment"># material[&#39;type&#39;] = &#39;unknown&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">material</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-collate_materials" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">collate_materials</span><span
            class="method-args">(site, pages)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Collate the materials into a large hash Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>pages</code>
<dd>
<p>The list of pages to collate</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The collated materials</p>
</dd></dl>

<p>Example: <a href="TopicFilter.html#method-c-collate_materials"><code>collate_materials</code></a>(site, pages)</p>

<h1 id="method-c-collate_materials-label-3E+-7B">&gt; {<span><a href="#method-c-collate_materials-label-3E+-7B">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>“assembly/velvet-assembly” =&gt; {</p>

<pre>&quot;topic&quot; =&gt; &quot;assembly&quot;,
&quot;topic_name&quot; =&gt; &quot;assembly&quot;,
&quot;material&quot; =&gt; &quot;assembly/velvet-assembly&quot;,
&quot;tutorial_name&quot; =&gt; &quot;velvet-assembly&quot;,
&quot;dir&quot; =&gt; &quot;topics/assembly/tutorials/velvet-assembly&quot;,
&quot;resources&quot; =&gt; [
  {
  &quot;type&quot; =&gt; &quot;slides&quot;,
  &quot;url&quot; =&gt; &quot;/topics/assembly/tutorials/velvet-assembly/slides.html&quot;,
  &quot;title&quot; =&gt; &quot;Slides&quot;,
  &quot;priority&quot; =&gt; 1
  },
  {
  &quot;type&quot; =&gt; &quot;tutorial&quot;,
  &quot;url&quot; =&gt; &quot;/topics/assembly/tutorials/velvet-assembly/tutorial.html&quot;,
  &quot;title&quot; =&gt; &quot;Tutorial&quot;,
  &quot;priority&quot; =&gt; 2
  }
 ]
}</pre>

          <div class="method-source-code" id="collate_materials-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>)
  <span class="ruby-comment"># In order to speed up queries later, we&#39;ll store a set of &quot;interesting&quot;</span>
  <span class="ruby-comment"># pages (i.e. things that are under `topic_name`)</span>
  <span class="ruby-identifier">shortlinks</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;shortlinks&#39;</span>]
  <span class="ruby-identifier">shortlinks_reversed</span> = <span class="ruby-identifier">shortlinks</span>[<span class="ruby-string">&#39;id&#39;</span>].<span class="ruby-identifier">invert</span>

  <span class="ruby-identifier">get_posts</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">post</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;short_id&#39;</span>] = <span class="ruby-identifier">shortlinks_reversed</span>[<span class="ruby-identifier">post</span>.<span class="ruby-identifier">url</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">interesting</span> = {}
  <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;short_id&#39;</span>] = <span class="ruby-identifier">shortlinks_reversed</span>[<span class="ruby-identifier">page</span>.<span class="ruby-identifier">url</span>]

    <span class="ruby-comment"># Skip anything outside of topics.</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;/topics/&#39;</span>)

    <span class="ruby-comment"># Extract the material metadata based on the path</span>
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;url&#39;</span>] = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">url</span>
    <span class="ruby-identifier">material_meta</span> = <span class="ruby-identifier">annotate_path</span>(<span class="ruby-identifier">page</span>.<span class="ruby-identifier">path</span>)

    <span class="ruby-comment"># If unannotated then we want to skip this material.</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">material_meta</span>.<span class="ruby-identifier">nil?</span>

    <span class="ruby-identifier">mk</span> = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;material&#39;</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">interesting</span>.<span class="ruby-identifier">key?</span> <span class="ruby-identifier">mk</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>] = <span class="ruby-identifier">material_meta</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;type&#39;</span>) <span class="ruby-comment"># Remove the type since it&#39;s specific, not generic</span>
      <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>][<span class="ruby-string">&#39;resources&#39;</span>] = []
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;dir&#39;</span>] = <span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;dir&#39;</span>]
    <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;short_id&#39;</span>] = <span class="ruby-identifier">shortlinks_reversed</span>[<span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;url&#39;</span>]]

    <span class="ruby-identifier">interesting</span>[<span class="ruby-identifier">mk</span>][<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">push</span>([<span class="ruby-identifier">material_meta</span>[<span class="ruby-string">&#39;type&#39;</span>], <span class="ruby-identifier">page</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">interesting</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-enumerate_topics" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">enumerate_topics</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This function returns a list of all the topics that are available. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>The topic objects themselves</p>
</dd></dl>

          <div class="method-source-code" id="enumerate_topics-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">enumerate_topics</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">list_topics_h</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">values</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-extract_workflow_tool_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">extract_workflow_tool_list</span><span
            class="method-args">(data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Extract the list of tools used in a workflow Params:</p>
<dl class="rdoc-list note-list"><dt><code>data</code>
<dd>
<p>The workflow data</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>The list of tool IDs</p>
</dd></dl>

          <div class="method-source-code" id="extract_workflow_tool_list-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">extract_workflow_tool_list</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">out</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tool&#39;</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>] }.<span class="ruby-identifier">compact</span>
  <span class="ruby-identifier">out</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;steps&#39;</span>].<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
           <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;subworkflow&#39;</span>
         <span class="ruby-keyword">end</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">extract_workflow_tool_list</span>(<span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;subworkflow&#39;</span>]) }
  <span class="ruby-identifier">out</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fetch_tutorial_material" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">fetch_tutorial_material</span><span
            class="method-args">(site, topic_name, tutorial_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Fetch a specific tutorial material by topic and tutorial name Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code>
<dd>
<p>The name of the topic</p>
</dd><dt><code>tutorial_name</code>
<dd>
<p>The name of the tutorial</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The tutorial material</p>
</dd></dl>

          <div class="method-source-code" id="fetch_tutorial_material-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fetch_tutorial_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">tutorial_name</span>)
  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Topic cache not filled, cannot fetch tutorial material for #{topic_name}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;tutorial_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">tutorial_name</span> }[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-fill_cache" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">fill_cache</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Fill the cache with all the topics Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns: <code>nil</code></p>

          <div class="method-source-code" id="fill_cache-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;cache_topic_filter&#39;</span>)

  <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Begin Cache Prefill&#39;</span>
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>] = {}

  <span class="ruby-comment"># For each topic</span>
  <span class="ruby-identifier">list_topics</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">topic</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic</span>] = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;[GTN/TopicFilter] End Cache Prefill&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-filter_by_tag" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">filter_by_tag</span><span
            class="method-args">(site, topic_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="filter_by_tag-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 637</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-comment"># Here we make a (cached) call to load materials into memory and sort them</span>
  <span class="ruby-comment"># properly.</span>
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)

  <span class="ruby-comment"># Select those with that topic ID or that tag</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">topic_name</span> }
  <span class="ruby-identifier">resource_pages</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">topic_name</span>) }

  <span class="ruby-comment"># The complete resources we&#39;ll return is the introduction slides first</span>
  <span class="ruby-comment"># (EDIT: not anymore, we rely on prioritisation!)</span>
  <span class="ruby-comment"># and then the rest of the pages.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>) }

  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant tagged pages for #{topic_name}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-filter_by_topic" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">filter_by_topic</span><span
            class="method-args">(site, topic_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="filter_by_topic-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-comment"># Here we make a (cached) call to load materials into memory and sort them</span>
  <span class="ruby-comment"># properly.</span>
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)

  <span class="ruby-comment"># Select out the materials by topic:</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">topic_name</span> }

  <span class="ruby-comment"># If there is nothing with that topic name, try generating it by tags.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">topic_name</span>) } <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-comment"># The complete resources we&#39;ll return is the introduction slides first</span>
  <span class="ruby-comment"># (EDIT: not anymore, we rely on prioritisation!)</span>
  <span class="ruby-comment"># and then the rest of the pages.</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>) }

  <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant pages for #{topic_name}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-filter_by_topic_subtopic" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">filter_by_topic_subtopic</span><span
            class="method-args">(site, topic_name, subtopic_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Filter a list of materials by topic and subtopic.</p>

          <div class="method-source-code" id="filter_by_topic_subtopic-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 658</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">filter_by_topic_subtopic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">subtopic_id</span>)
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)

  <span class="ruby-comment"># Select out materials with the correct subtopic</span>
  <span class="ruby-identifier">resource_pages</span> = <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;subtopic&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">subtopic_id</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">resource_pages</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error? Could not find any relevant pages for #{topic_name} / #{subtopic_id}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">resource_pages</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-get_contributors" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_contributors</span><span
            class="method-args">(material)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get the contributors for a material. This is the third time I&#39;ve seen this function. I should probably refactor it out</p>

<p>Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>material</code>
<dd>
<p>A material object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>An array of contributors as strings.</p>
</dd></dl>

          <div class="method-source-code" id="get_contributors-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 680</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_contributors</span>(<span class="ruby-identifier">material</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">material</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;contributors&#39;</span>)
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;contributors&#39;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;contributions&#39;</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> }.<span class="ruby-identifier">flatten</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-get_posts" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_posts</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get the list of posts from the site Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>The list of posts</p>
</dd></dl>

<p>This is a transition period function that can later be removed. It is added because with the jekyll version we&#39;re using, site.posts is an iterable in prod+dev (_config-dev.yml) modes, however! If we access site.posts.docs in prod it&#39;s fine, while in dev mode, site.posts claims to be an Array (rather than I guess a &#39;posts&#39; object with a docs method). So we check if it has docs and use that, otherwise just site.posts should be iterable.</p>

          <div class="method-source-code" id="get_posts-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 282</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_posts</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-comment"># Handle the transition period</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:docs</span>)
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">docs</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">posts</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-get_version" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_version</span><span
            class="method-args">(tool)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get the version of a tool. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>tool</code>
<dd>
<p>A tool string</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The version of the tool.</p>
</dd></dl>

<p>Examples: <a href="TopicFilter.html#method-c-get_version"><code>get_version</code></a>(“toolshed.g2.bx.psu.edu/repos/galaxyp/regex_find_replace/regex1/1.0.0”) =&gt; “1.0.0”</p>

          <div class="method-source-code" id="get_version-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 725</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_version</span>(<span class="ruby-identifier">tool</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;/&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
    <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tool</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-identify_contributors" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">identify_contributors</span><span
            class="method-args">(materials, site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get a list of contributors for a list of materials Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>materials</code>
<dd>
<p>An array of materials</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>An array of contributors as strings.</p>
</dd></dl>

          <div class="method-source-code" id="identify_contributors-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 694</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">identify_contributors</span>(<span class="ruby-identifier">materials</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>] }.<span class="ruby-identifier">flatten</span>
    <span class="ruby-comment"># Not 100% sure why this flatten is needed? Probably due to the map over hash</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mat</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get_contributors</span>(<span class="ruby-identifier">mat</span>) }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">shuffle</span>
    .<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;contributors&#39;</span>][<span class="ruby-identifier">c</span>][<span class="ruby-string">&#39;funder&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-identify_funders" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">identify_funders</span><span
            class="method-args">(materials, site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get a list of funders for a list of materials Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>materials</code>
<dd>
<p>An array of materials</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>An array of funders as strings.</p>
</dd></dl>

          <div class="method-source-code" id="identify_funders-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 708</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">identify_funders</span>(<span class="ruby-identifier">materials</span>, <span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>] }.<span class="ruby-identifier">flatten</span>
    <span class="ruby-comment"># Not 100% sure why this flatten is needed? Probably due to the map over hash</span>
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mat</span><span class="ruby-operator">|</span> <span class="ruby-identifier">get_contributors</span>(<span class="ruby-identifier">mat</span>) }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">shuffle</span>
    .<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;contributors&#39;</span>][<span class="ruby-identifier">c</span>][<span class="ruby-string">&#39;funder&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_all_materials" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_all_materials</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This is a helper function to get all the materials in a site.</p>

          <div class="method-source-code" id="list_all_materials-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 591</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_all_materials</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_all_tags" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_all_tags</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>List every tag used across all materials. This is used to generate the tag cloud.</p>

<p>Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object, used to get the list of pages.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>An array of strings, each string is a tag. (sorted and unique)</p>
</dd></dl>

          <div class="method-source-code" id="list_all_tags-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 611</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_all_tags</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
  (<span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;tags&#39;</span>] <span class="ruby-operator">||</span> [] }.<span class="ruby-identifier">flatten</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">list_topics</span>(<span class="ruby-identifier">site</span>)).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_materials_by_tool" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_materials_by_tool</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>List materials by tool Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object, used to get the list of pages.</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>A hash of tool_id =&gt; {</p>
</dd></dl>

<pre>&quot;tool_id&quot; =&gt; [tool_id, version],
&quot;tutorials&quot; =&gt; [tutorial_id, tutorial_title, topic_title, tutorial_url]</pre>

<p>}</p>

          <div class="method-source-code" id="list_materials_by_tool-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 759</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_materials_by_tool</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">tool_map</span> = {}

  <span class="ruby-identifier">list_all_materials</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">m</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;tools&#39;</span>, []).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tool</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">short_tool</span>(<span class="ruby-identifier">tool</span>)
      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>] = { <span class="ruby-string">&#39;tool_id&#39;</span> <span class="ruby-operator">=&gt;</span> [], <span class="ruby-string">&#39;tutorials&#39;</span> <span class="ruby-operator">=&gt;</span> [] } <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tool_map</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">sid</span>)

      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>][<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">push</span>([<span class="ruby-identifier">tool</span>, <span class="ruby-identifier">get_version</span>(<span class="ruby-identifier">tool</span>)])
      <span class="ruby-identifier">tool_map</span>[<span class="ruby-identifier">sid</span>][<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">push</span>([
                                        <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;id&#39;</span>], <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;url&#39;</span>]
                                      ])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Uniqueify/sort</span>
  <span class="ruby-identifier">t</span> = <span class="ruby-identifier">tool_map</span>.<span class="ruby-identifier">to_h</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">sort_by!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k2</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k2</span>[<span class="ruby-value">1</span>] }
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tool_id&#39;</span>].<span class="ruby-identifier">reverse!</span>

    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">sort!</span>
    [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Order by most popular tool</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;tutorials&#39;</span>].<span class="ruby-identifier">length</span> }.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">to_h</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_materials_structured" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_materials_structured</span><span
            class="method-args">(site, topic_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This function returns a list of all the materials that are available for a specific topic, but this time in a structured manner Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code>
<dd>
<p>The name of the topic</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Hash</code>
<dd>
<p>The subtopics and their materials</p>
</dd></dl>

<p>Example:</p>

<pre>{
 &quot;intro&quot; =&gt; {
   &quot;subtopic&quot; =&gt; {&quot;title&quot; =&gt; &quot;Introduction&quot;, &quot;description&quot; =&gt; &quot;Introduction to the topic&quot;, &quot;id&quot; =&gt; &quot;intro&quot;},
   &quot;materials&quot; =&gt; [
     ...
   ]
 },
 &quot;__OTHER__&quot; =&gt; {
   &quot;subtopic&quot; =&gt; {&quot;title&quot; =&gt; &quot;Other&quot;, &quot;description&quot; =&gt; &quot;Other materials&quot;, &quot;id&quot; =&gt; &quot;__OTHER__&quot;},
   &quot;materials&quot; =&gt; [.. ]
 }
]</pre>

          <div class="method-source-code" id="list_materials_structured-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_materials_structured</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-comment"># This method is built with the idea to replace the &quot;topic_filter&quot; command,</span>
  <span class="ruby-comment"># and instead of returning semi-structured data, we will immediately return</span>
  <span class="ruby-comment"># fully structured data for a specific &quot;topic_name&quot; query, like, &quot;admin&quot;</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># Instead of returning a flat list of tutorials, instead we&#39;ll structure</span>
  <span class="ruby-comment"># them properly in subtopics (if they exist) or return the flat list</span>
  <span class="ruby-comment"># otherwise.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># This will let us generate new &quot;views&quot; into the tutorial lists, having</span>
  <span class="ruby-comment"># them arranged in new and exciting ways.</span>

  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)

  <span class="ruby-comment"># Here we want to either return data structured around subtopics</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>].<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;subtopics&#39;</span>)
    <span class="ruby-comment"># We&#39;ll construct a new hash of subtopic =&gt; tutorials</span>
    <span class="ruby-identifier">out</span> = {}
    <span class="ruby-identifier">seen_ids</span> = []
    <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;subtopics&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subtopic</span>, <span class="ruby-identifier">_v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">specific_resources</span> = <span class="ruby-identifier">filter_by_topic_subtopic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>, <span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>])
      <span class="ruby-identifier">out</span>[<span class="ruby-identifier">subtopic</span>[<span class="ruby-string">&#39;id&#39;</span>]] = {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">subtopic</span>,
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">specific_resources</span>
      }
      <span class="ruby-identifier">seen_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">specific_resources</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>] }
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># And we&#39;ll have this __OTHER__ subtopic for any tutorials that weren&#39;t</span>
    <span class="ruby-comment"># in a subtopic.</span>
    <span class="ruby-identifier">all_topics_for_tutorial</span> = <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
    <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>] = {
      <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Other&#39;</span>, <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Assorted Tutorials&#39;</span>, <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;other&#39;</span> },
      <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">all_topics_for_tutorial</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seen_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;custom_ordering&#39;</span>]
    <span class="ruby-comment"># TODO</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-string">&#39;UNIMPLEMENTED&#39;</span>
    <span class="ruby-identifier">out</span> = {}
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">topic_name</span>][<span class="ruby-string">&#39;tag_based&#39;</span>] <span class="ruby-comment"># Tag based Topic</span>
    <span class="ruby-comment"># We&#39;ll construct a new hash of subtopic(parent topic) =&gt; tutorials</span>
    <span class="ruby-identifier">out</span> = {}
    <span class="ruby-identifier">seen_ids</span> = []
    <span class="ruby-identifier">tn</span> = <span class="ruby-identifier">topic_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;by_tag_&#39;</span>, <span class="ruby-string">&#39;&#39;</span>)

    <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)

    <span class="ruby-comment"># Which topics are represented in those materials?</span>
    <span class="ruby-identifier">seen_topics</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] }.<span class="ruby-identifier">sort</span>

    <span class="ruby-comment"># Treat them like subtopics, but fake subtopics.</span>
    <span class="ruby-identifier">seen_topics</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">parent_topic</span>, <span class="ruby-identifier">_v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">specific_resources</span> = <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;topic_name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">parent_topic</span> }
      <span class="ruby-identifier">out</span>[<span class="ruby-identifier">parent_topic</span>] = {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parent_topic</span>, <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">parent_topic</span>][<span class="ruby-string">&#39;title&#39;</span>], <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span> },
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">specific_resources</span>
      }
      <span class="ruby-identifier">seen_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">specific_resources</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>] }
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># And we&#39;ll have this __OTHER__ subtopic for any tutorials that weren&#39;t</span>
    <span class="ruby-comment"># in a subtopic.</span>
    <span class="ruby-identifier">all_topics_for_tutorial</span> = <span class="ruby-identifier">filter_by_tag</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">tn</span>)
    <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>] = {
      <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Other&#39;</span>, <span class="ruby-string">&#39;description&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Assorted Tutorials&#39;</span>, <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;other&#39;</span> },
      <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">all_topics_for_tutorial</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seen_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;id&#39;</span>]) }
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Or just the list (Jury is still out on this one, should it really be a</span>
    <span class="ruby-comment"># flat list? Or in this identical structure.)</span>
    <span class="ruby-identifier">out</span> = {
      <span class="ruby-string">&#39;__FLAT__&#39;</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-string">&#39;subtopic&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&#39;materials&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">filter_by_topic</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
      }
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Cleanup empty sections</span>
  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;__OTHER__&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">out</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;__OTHER__&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">out</span>[<span class="ruby-string">&#39;__OTHER__&#39;</span>][<span class="ruby-string">&#39;materials&#39;</span>].<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;materials&#39;</span>].<span class="ruby-identifier">sort_by!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">m</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;priority&#39;</span>, <span class="ruby-value">1</span>), <span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;title&#39;</span>]] }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_topics" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_topics</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This function returns a list of all the topics that are available. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>The list of topics</p>
</dd></dl>

          <div class="method-source-code" id="list_topics-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_topics</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">list_topics_h</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_topics_h" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_topics_h</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="list_topics_h-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_topics_h</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;editorial_board&#39;</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-list_videos" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_videos</span><span
            class="method-args">(site)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This is a helper function to get all the materials in a site.</p>

          <div class="method-source-code" id="list_videos-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 597</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">list_videos</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">site</span>.<span class="ruby-identifier">pages</span>)
  <span class="ruby-identifier">materials</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-string">&#39;video&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-process_pages" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_pages</span><span
            class="method-args">(site, pages)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_pages-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 546</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">process_pages</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>)
  <span class="ruby-comment"># eww.</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_processed_pages&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;cache_processed_pages&#39;</span>)

  <span class="ruby-identifier">materials</span> = <span class="ruby-identifier">collate_materials</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">pages</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">resolve_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">v</span>) }
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Filling Materials Cache&#39;</span>
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_processed_pages&#39;</span>] = <span class="ruby-identifier">materials</span>

  <span class="ruby-comment"># Prepare short URLs</span>
  <span class="ruby-identifier">shortlinks</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;shortlinks&#39;</span>]
  <span class="ruby-identifier">mappings</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = [] }

  <span class="ruby-identifier">shortlinks</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">kp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">shortlinks</span>[<span class="ruby-identifier">kp</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">v</span>].<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;/short/#{k}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Update the materials with their short IDs + redirects</span>
  <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Set the short id on the material</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>]
      <span class="ruby-comment"># Initialise redirects if it wasn&#39;t set</span>
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
      <span class="ruby-identifier">p</span>[<span class="ruby-string">&#39;ref&#39;</span>].<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)

      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Same for news</span>
  <span class="ruby-identifier">get_posts</span>(<span class="ruby-identifier">site</span>).<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># Set the short id on the material</span>
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;redirect_from&#39;</span>)
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">url</span>])
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;redirect_from&#39;</span>].<span class="ruby-identifier">uniq!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">materials</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-resolve_material" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">resolve_material</span><span
            class="method-args">(site, material)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="resolve_material-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">resolve_material</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">material</span>)
  <span class="ruby-comment"># We&#39;ve already</span>
  <span class="ruby-comment"># looked in every /topic/*/tutorials/* folder, and turn these disparate</span>
  <span class="ruby-comment"># resources into a page_obj as well. Most variables are copied directly,</span>
  <span class="ruby-comment"># either from a tutorial, or a slides (if no tutorial is available.) This</span>
  <span class="ruby-comment"># means we do not (cannot) support external_slides AND external_handson.</span>
  <span class="ruby-comment"># This is probably a sub-optimal situation we&#39;ll end up fixing someday.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">tutorials</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tutorial&#39;</span> }
  <span class="ruby-identifier">slides</span>    = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;slides&#39;</span> }
  <span class="ruby-identifier">tours</span>     = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;resources&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;tours&#39;</span> }

  <span class="ruby-comment"># Our final &quot;page&quot; object (a &quot;material&quot;)</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">slide_has_video</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">slide_translations</span> = []
  <span class="ruby-identifier">page_ref</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">min</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> }[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">slide_has_video</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;video&#39;</span>, <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">slide_translations</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;translations&#39;</span>, [])
    <span class="ruby-identifier">page_ref</span> = <span class="ruby-identifier">page</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># No matter if there were slides, we override with tutorials if present.</span>
  <span class="ruby-identifier">tutorial_translations</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">page</span> = <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">min</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">path</span> }[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">tutorial_translations</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;translations&#39;</span>, [])
    <span class="ruby-identifier">page_ref</span> = <span class="ruby-identifier">page</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">Jekyll</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-string">&#39;[GTN/TopicFilter] Could not process material&#39;</span>
    <span class="ruby-keyword">return</span> {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Otherwise clone the metadata from it which works well enough.</span>
  <span class="ruby-identifier">page_obj</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;id&#39;</span>] = <span class="ruby-node">&quot;#{page[&#39;topic_name&#39;]}/#{page[&#39;tutorial_name&#39;]}&quot;</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;ref&#39;</span>] = <span class="ruby-identifier">page_ref</span>

  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;id&#39;</span>]
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>] = {}

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;video-library&#39;</span>)
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>][<span class="ruby-string">&#39;tutorial&#39;</span>] = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;video-library&#39;</span>][<span class="ruby-node">&quot;#{id}/tutorial&quot;</span>]
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>][<span class="ruby-string">&#39;slides&#39;</span>] = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;video-library&#39;</span>][<span class="ruby-node">&quot;#{id}/slides&quot;</span>]
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>][<span class="ruby-string">&#39;demo&#39;</span>] = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;video-library&#39;</span>][<span class="ruby-node">&quot;#{id}/demo&quot;</span>]
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>][<span class="ruby-string">&#39;both&#39;</span>] = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;video-library&#39;</span>][<span class="ruby-identifier">id</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video_library&#39;</span>][<span class="ruby-string">&#39;session&#39;</span>] = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;session-library&#39;</span>][<span class="ruby-identifier">id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;session-library&#39;</span>)

  <span class="ruby-comment"># Sometimes `hands_on` is set to something like `external`, in which</span>
  <span class="ruby-comment"># case it is important to not override it. So we only do that if the</span>
  <span class="ruby-comment"># key isn&#39;t already set. Then we choose to set it to a test for the</span>
  <span class="ruby-comment"># tutorial being present. We probably don&#39;t need to test both, but it</span>
  <span class="ruby-comment"># is hard to follow which keys are which and safer to test for both in</span>
  <span class="ruby-comment"># case someone edits the code later. If either of these exist, we can</span>
  <span class="ruby-comment"># automatically set `hands_on: true`</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;hands_on&#39;</span>] = <span class="ruby-identifier">tutorials</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;hands_on&#39;</span>)

  <span class="ruby-comment"># Same for slides, if there&#39;s a resource by that name, we can</span>
  <span class="ruby-comment"># automatically set `slides: true`</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;slides&#39;</span>] = <span class="ruby-identifier">slides</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slides&#39;</span>)

  <span class="ruby-identifier">folder</span> = <span class="ruby-identifier">material</span>[<span class="ruby-string">&#39;dir&#39;</span>]

  <span class="ruby-identifier">ymls</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/quiz/*.yml&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/quiz/*.yaml&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ymls</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">quizzes</span> = <span class="ruby-identifier">ymls</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>] }
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;quiz&#39;</span>] = <span class="ruby-identifier">quizzes</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">quiz_data</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-node">&quot;#{folder}/quiz/#{q}&quot;</span>)
      {
        <span class="ruby-string">&#39;id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">q</span>,
        <span class="ruby-string">&#39;path&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{folder}/quiz/#{q}&quot;</span>,
        <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">quiz_data</span>[<span class="ruby-string">&#39;title&#39;</span>],
        <span class="ruby-string">&#39;contributors&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">quiz_data</span>[<span class="ruby-string">&#39;contributors&#39;</span>],
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># In dev configuration, this breaks for me. Not sure why config isn&#39;t available.</span>
  <span class="ruby-identifier">domain</span> = <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">site</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;url&#39;</span>)
             <span class="ruby-node">&quot;#{site.config[&#39;url&#39;]}#{site.config[&#39;baseurl&#39;]}&quot;</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-string">&#39;http://localhost:4000//training-material/&#39;</span>
           <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Similar as above.</span>
  <span class="ruby-identifier">workflows</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/workflows/*.ga&quot;</span>) <span class="ruby-comment"># TODO: support gxformat2</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflows</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-identifier">workflow_names</span> = <span class="ruby-identifier">workflows</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>)[<span class="ruby-value">-1</span>] }
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;workflows&#39;</span>] = <span class="ruby-identifier">workflow_names</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wf</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">wfid</span> = <span class="ruby-node">&quot;#{page[&#39;topic_name&#39;]}-#{page[&#39;tutorial_name&#39;]}&quot;</span>
      <span class="ruby-identifier">wfname</span> = <span class="ruby-identifier">wf</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">downcase</span>
      <span class="ruby-identifier">trs</span> = <span class="ruby-node">&quot;api/ga4gh/trs/v2/tools/#{wfid}/versions/#{wfname}&quot;</span>
      <span class="ruby-identifier">wf_path</span> = <span class="ruby-node">&quot;#{folder}/workflows/#{wf}&quot;</span>
      <span class="ruby-identifier">wf_json</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">wf_path</span>))
      <span class="ruby-identifier">license</span> = <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;license&#39;</span>]
      <span class="ruby-identifier">creators</span> = <span class="ruby-identifier">wf_json</span>[<span class="ruby-string">&#39;creator&#39;</span>] <span class="ruby-operator">||</span> []

      <span class="ruby-comment"># /galaxy-intro-101-workflow.eu.json</span>
      <span class="ruby-identifier">workflow_test_results</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">wf_path</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga$/</span>, <span class="ruby-string">&#39;.*.json&#39;</span>))
      <span class="ruby-identifier">workflow_test_outputs</span> = {}
      <span class="ruby-identifier">workflow_test_results</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">test_result</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">server</span> = <span class="ruby-identifier">workflow_test_results</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\.(..)\.json$/</span>)[<span class="ruby-value">1</span>]
        <span class="ruby-identifier">workflow_test_outputs</span>[<span class="ruby-identifier">server</span>] = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">test_result</span>))
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">workflow_test_outputs</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflow_test_outputs</span>.<span class="ruby-identifier">empty?</span>

      {
        <span class="ruby-string">&#39;workflow&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf</span>,
        <span class="ruby-string">&#39;tests&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{folder}/workflows/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">wf</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.ga/</span>, <span class="ruby-string">&#39;-test*&#39;</span>)).<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>,
        <span class="ruby-string">&#39;url&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{domain}/#{folder}/workflows/#{wf}&quot;</span>,
        <span class="ruby-string">&#39;path&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wf_path</span>,
        <span class="ruby-string">&#39;wfid&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wfid</span>,
        <span class="ruby-string">&#39;wfname&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">wfname</span>,
        <span class="ruby-string">&#39;trs_endpoint&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{domain}/#{trs}&quot;</span>,
        <span class="ruby-string">&#39;license&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">license</span>,
        <span class="ruby-string">&#39;creators&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">creators</span>,
        <span class="ruby-string">&#39;test_results&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">workflow_test_outputs</span>,
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Really only used for tool list install for ephemeris, not general.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;api&#39;</span>] = <span class="ruby-node">&quot;#{domain}/api/topics/#{page[&#39;topic_name&#39;]}/tutorials/#{page[&#39;tutorial_name&#39;]}/tutorial.json&quot;</span>

  <span class="ruby-comment"># Tool List</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># This is exposed in the GTN API to help admins/devs easily get the tool</span>
  <span class="ruby-comment"># list for installation.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] = []
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">content</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/{% tool \[[^\]]*\]\(([^)]*)\)\s*%}/</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;hands_on&#39;</span>]

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;workflows&#39;</span>]&amp;.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wf</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">wf_path</span> = <span class="ruby-node">&quot;#{folder}/workflows/#{wf[&#39;workflow&#39;]}&quot;</span>

    <span class="ruby-identifier">wf_data</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">wf_path</span>))
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">extract_workflow_tool_list</span>(<span class="ruby-identifier">wf_data</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>] = <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">topic</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]]
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;supported_servers&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;use&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">topic</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;basics&#39;</span>
                                    <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Supported</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;public-server-tools&#39;</span>], <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>])
                                  <span class="ruby-keyword">else</span>
                                    []
                                  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">topic_name_human</span> = <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name&#39;</span>]][<span class="ruby-string">&#39;title&#39;</span>]
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;topic_name_human&#39;</span>] = <span class="ruby-identifier">topic_name_human</span> <span class="ruby-comment"># TODO: rename &#39;topic_name&#39; and &#39;topic_name&#39; to &#39;topic_id&#39;</span>
  <span class="ruby-identifier">admin_install</span> = <span class="ruby-constant">Gtn</span><span class="ruby-operator">::</span><span class="ruby-constant">Toolshed</span>.<span class="ruby-identifier">format_admin_install</span>(<span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;toolshed-revisions&#39;</span>], <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tools&#39;</span>],
                                                     <span class="ruby-identifier">topic_name_human</span>)
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;admin_install&#39;</span>] = <span class="ruby-identifier">admin_install</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;admin_install_yaml&#39;</span>] = <span class="ruby-identifier">admin_install</span>.<span class="ruby-identifier">to_yaml</span>

  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tours&#39;</span>] = <span class="ruby-identifier">tours</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">positive?</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;video&#39;</span>] = <span class="ruby-identifier">slide_has_video</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>] = {}
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;tutorial&#39;</span>] = <span class="ruby-identifier">tutorial_translations</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;slides&#39;</span>] = <span class="ruby-identifier">slide_translations</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;translations&#39;</span>][<span class="ruby-string">&#39;video&#39;</span>] = <span class="ruby-identifier">slide_has_video</span> <span class="ruby-comment"># Just demand it?</span>
  <span class="ruby-comment"># I feel less certain about this override, but it works well enough in</span>
  <span class="ruby-comment"># practice, and I did not find any examples of `type: &lt;anything other</span>
  <span class="ruby-comment"># than tutorial&gt;` in topics/*/tutorials/*/tutorial.md but that doesn&#39;t</span>
  <span class="ruby-comment"># make it future proof.</span>
  <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;tutorial&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;draft&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;draft&#39;</span>]
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tags&#39;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page_obj</span>.<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;tags&#39;</span>
    <span class="ruby-identifier">page_obj</span>[<span class="ruby-string">&#39;tags&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;work-in-progress&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">page_obj</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-short_tool" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">short_tool</span><span
            class="method-args">(tool)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get a short version of a tool. Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>tool</code>
<dd>
<p>A tool string</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>String</code>
<dd>
<p>The short version of the tool.</p>
</dd></dl>

<p>Examples: <a href="TopicFilter.html#method-c-short_tool"><code>short_tool</code></a>(“toolshed.g2.bx.psu.edu/repos/galaxyp/regex_find_replace/regex1/1.0.0”) =&gt; “galaxyp/regex1”</p>

          <div class="method-source-code" id="short_tool-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">short_tool</span>(<span class="ruby-identifier">tool</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tool</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;/&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
    <span class="ruby-node">&quot;#{tool.split(&#39;/&#39;)[2]}/#{tool.split(&#39;/&#39;)[4]}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tool</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-topic_filter" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">topic_filter</span><span
            class="method-args">(site, topic_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>This function returns a list of all the materials that are available for a specific topic. Params:</p>
<dl class="rdoc-list note-list"><dt><code>site</code>
<dd>
<p>The <code>Jekyll::Site</code> object</p>
</dd><dt><code>topic_name</code>
<dd>
<p>The name of the topic</p>
</dd></dl>

<p>Returns:</p>
<dl class="rdoc-list note-list"><dt><code>Array</code>
<dd>
<p>The list of materials</p>
</dd></dl>

          <div class="method-source-code" id="topic_filter-source">
            <pre><span class="ruby-comment"># File _plugins/jekyll-topic-filter.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">topic_filter</span>(<span class="ruby-identifier">site</span>, <span class="ruby-identifier">topic_name</span>)
  <span class="ruby-identifier">fill_cache</span>(<span class="ruby-identifier">site</span>)
  <span class="ruby-identifier">site</span>.<span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;cache_topic_filter&#39;</span>][<span class="ruby-identifier">topic_name</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.3.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

